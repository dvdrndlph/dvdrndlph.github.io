/* abcDE_full_min.js v5.0.147 */
function Abc(user){function clone(e){if(!e)return e;var t=new e.constructor;for(var n in e)t[n]=e[n];return t}function errbld(e,t,n,r){var i,s,a,o,c;if(user.errbld){switch(e){case 0:e="warn";break;case 1:e="error";break;default:e="fatal"}return void user.errbld(e,t,n,r)}if(void 0!=r&&r>=0){for(a=0,i=-1,o=0;;){if(s=parse.file.indexOf("\n",i+1),0>s){i=parse.file.length-1;break}if(s>r)break;a++,i=s}o=r-i}switch(c="",n&&(c=n,a&&(c+=":"+(a+1)+":"+(o+1)),c+=" "),e){case 0:c+="Warning: ";break;case 1:c+="Error: ";break;default:c+="Internal bug: "}t=t.replace(/&/g,"&amp;"),t=t.replace(/</g,"&lt;"),t=t.replace(/>/g,"&gt;"),user.errmsg(c+t,a,o)}function error(e,t,n){t&&t.ctx?errbld(e,n,t.ctx.fname,t.istart):errbld(e,n)}function scanBuf(){this.index=0,this["char"]=function(){return this.index>=this.buffer.length?void 0:this.buffer[this.index]},this.next_char=function(){return this.index>=this.buffer.length?void 0:this.buffer[++this.index]},this.advance=function(){this.index<this.buffer.length&&this.index++},this.get_int=function(){for(var e=0,t=this.buffer[this.index];t>="0"&&"9">=t;)e=10*e+Number(t),t=this.next_char();return e},this.get_float=function(){for(var e,t="";;){if(e=this.buffer[this.index],"0123456789.-".indexOf(e)<0)break;t+=e,this.index++}return parseFloat(t)},this.error=function(e){errbld(1,e,parse.ctx.fname,this.index+parse.bol-1)}}function syntax(e,t){errbld(e,t,parse.ctx.fname,parse.istart)}function abc2svg_init(){font_init(),init_tune()}function y_get(e,t,n,r){var i,s=staff_tb[e],a=Math.floor(n/realwidth*YSTEP),o=Math.floor((n+r)/realwidth*YSTEP);if(0>a&&(a=0),o>=YSTEP&&(o=YSTEP-1,a>o&&(a=o)),t)for(i=s.top[a++];o>=a;)i<s.top[a]&&(i=s.top[a]),a++;else for(i=s.bot[a++];o>=a;)i>s.bot[a]&&(i=s.bot[a]),a++;return i}function y_set(e,t,n,r,i){var s=staff_tb[e],a=Math.floor(n/realwidth*YSTEP),o=Math.floor((n+r)/realwidth*YSTEP);if(0>a&&(a=0),o>=YSTEP&&(o=YSTEP-1,a>o&&(a=o)),t)for(;o>=a;)s.top[a]<i&&(s.top[a]=i),a++;else for(;o>=a;)s.bot[a]>i&&(s.bot[a]=i),a++}function set_str(e,t){var n=t.match(/^@([0-9.-]+),([0-9.-]+)/);n?(e.x+=Number(n[1]),e.dy=Number(n[2]),e.str=t.replace(n[0],"")):(e.str=t,e.dy=0)}function up_p(e,t){switch(t){case SL_ABOVE:return!0;case SL_BELOW:return!1}return e.multi&&0!=e.multi?e.multi>0:voice_tb[e.v].have_ly?e.pos.voc!=SL_ABOVE:!1}function d_arp(e){var t,n,r,i=e.s,s=e.dd,a=0;for(t=0;t<=i.nhd;t++){if(i.notes[t].acc)r=5+i.notes[t].shac;else switch(r=6-i.notes[t].shhd,i.head){case"square":case"oval":r+=2.5}r>a&&(a=r)}n=3*(i.notes[i.nhd].pit-i.notes[0].pit)+4,t=s.h,t>n&&(n=t),e.flags.val=!0,e.val=n,e.x=i.x-a,e.y=3*(i.notes[0].pit-18)-3}function d_cresc(e){if(!e.flags.ldst){var t,n,r,i,s,a,o,c,u,l=e.s,f=e.start;f?(t=f.s,s=t.x+3,c=f.ix,c>0&&(u=a_de[c-1])):(t=first_note,s=t.x-t.wl-4),e.st=l.st,e.flags.lden=!1,e.flags.val=!0,i=up_p(l,l.pos.dyn),i&&(e.flags.up=!0),u&&u.s==t&&(e.flags.up&&!u.flags.up||!e.flags.up&&u.flags.up)&&(r=u.dd,r.func>=6&&(o=u.x+u.val+4,o>s&&(s=o))),e.defl.noen?(a=e.x-s,20>a&&(s=e.x-20-3,a=20)):(o=l.x,e.next&&e.next.s==t&&(e.flags.up&&!e.next.flags.up||!e.flags.up&&e.next.flags.up)&&(r=e.next.dd,r.func>=6&&(o-=5)),a=o-s-4,20>a&&(s-=.5*(20-a),e.start||(s-=.5*(20-a)),a=20)),e.val=a,e.x=s,n=e.dd,e.y=y_get(e.st,i,s,a),i||(e.y-=n.h)}}function d_near(e){var t,n,r=e.s,i=e.dd;return i.str?(e.x=r.x,e.y=r.y,void set_str(e,i.str)):(n=r.multi?r.multi>0:r.stem<0,t=n?Math.floor(r.ymx):Math.floor(r.ymn-i.h),t>-6&&24>t&&(n&&(t+=3),t=6*Math.floor((t+6)/6)-6),n?r.ymx=t+i.h:r.ymn=t,e.y=t,e.x=r.x+r.notes[r.stem>=0?0:r.nhd].shhd,void("d"==i.name[0]&&r.nflags>=-1&&(n?r.stem>0&&(e.x+=3.5):r.stem<0&&(e.x-=3.5))))}function d_pf(e){var t,n,r,i,s,a=e.s,o=e.dd;e.val=o.wl+o.wr,i=up_p(a,a.pos.vol),i&&(e.flags.up=!0),r=a.x-o.wl,e.ix>0&&(s=a_de[e.ix-1],s.s==a&&(e.flags.up&&!s.flags.up||!e.flags.up&&s.flags.up)&&(t=s.dd,t.func>=6&&(n=s.x+s.val+4,n>r&&(r=n)))),e.x=r,e.y=y_get(a.st,i,r,e.val),i||(e.y-=o.h),o.str?set_str(e,o.str):"sfz"!=o.name&&(e.str=o.name)}function d_slide(e){var t,n,r=e.s,i=r.notes[0].pit,s=5;for(t=0;t<=r.nhd;t++){if(r.notes[t].acc)n=4+r.notes[t].shac;else switch(n=5-r.notes[t].shhd,r.head){case"square":case"oval":n+=2.5}r.notes[t].pit<=i+3&&n>s&&(s=n)}e.x=r.x-s,e.y=3*(i-18)}function d_trill(e){if(!e.flags.ldst){var t,n,r,i,s,a,o,c=e.s;if(e.start?(t=e.start.s,s=t.x,t.type==NOTE&&t.a_dd&&t.a_dd.length>1&&(s+=10)):(t=first_note,s=t.x-t.wl-4),e.st=r=c.st,i=c.multi>=0,e.defl.noen?(o=e.x-s,20>o&&(s=e.x-20-3,o=20)):(o=c.x-s-6,c.type==NOTE&&(o-=6),20>o&&(s-=.5*(20-o),e.start||(s-=.5*(20-o)),o=20)),n=e.dd,a=y_get(r,i,s,o),i){var u=staff_tb[t.st].topbar+2;u>a&&(a=u)}else{a-=n.h;var l=staff_tb[t.st].botbar-2;a>l&&(a=l)}e.flags.lden=void 0,e.flags.val=!0,e.val=o,e.x=s,e.y=a,i&&(a+=n.h),y_set(r,i,s,o,a),i?t.ymx=c.ymx=a:t.ymn=c.ymn=a}}function d_upstaff(e){var t,n,r,i=e.s,s=e.dd,a=i.x,o=s.wl+s.wr,c=staff_tb[i.st].topbar+2,u=staff_tb[i.st].botbar-2;if(i.nhd&&(a+=i.notes[i.stem>=0?0:i.nhd].shhd),n=-1,4!=s.func)switch(i.pos.orn){case SL_ABOVE:n=1;break;case SL_BELOW:n=0}switch(s.glyph){case"accent":case"cpu":!n||0>n&&(i.multi<0||!i.multi&&i.stem>0)?(t=y_get(i.st,!1,i.x-s.wl,o),t>u&&(t=u),t-=s.h,y_set(i.st,!1,i.x,0,t),r=!0,i.ymn=t):(t=y_get(i.st,!0,i.x,0),c>t&&(t=c),y_set(i.st,!0,i.x-s.wl,o,t+s.h),i.ymx=t+s.h);break;case"brth":case"lphr":case"mphr":case"sphr":for(t=c+1,i=i.ts_next;i&&!i.shrink;i=i.ts_next);a+=i?.4*(i.x-a):.4*(realwidth-a);break;default:0==s.name.indexOf("invert")&&(r=!0),"invertedfermata"!=s.name&&(n>0||0>n&&i.multi>=0)?(t=y_get(i.st,!0,i.x-s.wl,o),c>t&&(t=c),y_set(i.st,!0,i.x-s.wl,o,t+s.h),i.ymx=t+s.h):(t=y_get(i.st,!1,i.x-s.wl,o),t>u&&(t=u),t-=s.h,y_set(i.st,!1,i.x-s.wl,o,t),"fermata"==s.name&&(r=!0),i.ymn=t)}r&&(t+=s.h,e.flags.inv=!0),e.x=a,e.y=t,s.str&&set_str(e,s.str)}function deco_add(e){user_deco_tb||(user_deco_tb=[]),user_deco_tb.push(e)}function deco_build(e){var t,n,r,i;if(a=e.match(/(.+)\s+(\d+)\s+(.+?)\s+([0-9.]+)\s+([0-9.]+)\s+([0-9.]+)/),!a)return void error(1,null,"Invalid decoration '"+e+"'");var s=Number(a[2]),o=parseFloat(a[4]),c=parseFloat(a[5]),u=parseFloat(a[6]);return isNaN(s)?void error(1,null,"%%deco: bad C function value '"+a[2]+"'"):(0>s||s>=func_tb.length)&&(32>s||s>41)?void error(1,null,"%%deco: bad C function index '"+s+"'"):0>o||0>c||0>u?void error(1,null,"%%deco: cannot have a negative value '"+e+"'"):o>50||c>80||u>80?void error(1,null,"%%deco: abnormal h/wl/wr value "+e+"'"):(t=dd_tb[a[1]],t||(t={name:a[1]},dd_tb[a[1]]=t),t.func=s,t.glyph=a[3],t.h=o,t.wl=c,t.wr=u,i=e.replace(a[0],"").trim(),i&&('"'==i[0]&&(i=i.slice(1,-1)),t.str=i),r=t.name[t.name.length-1],("("==r||")"==r&&t.name.indexOf("(")<0)&&("("==r?t.ldst=!0:t.lden=!0,name2=t.name.slice(0,-1)+("("==r?")":"("),n=dd_tb[name2],n&&("("==r?t.ld_en_dd=n:n.ld_en_dd=t)),t)}function deco_cnv(e,t,n){var r,i,s,a,o,c=e.length;for(r=0;c>r;r++)if(a=e[r],s=dd_tb[a],s||(s=deco_def(a)))switch(s.func){default:if("head-"==s.name.slice(0,5)){if(!t.notes){error(1,t,"!"+s.name+"! must be on a note or rest");break}for(i=0;i<=t.nhd;i++)o=t.notes[i],o.a_dcn||(o.a_dcn=[]),o.a_dcn.push(s.name)}else t.a_dd||(t.a_dd=[]),t.a_dd.push(s);break;case 32:t.invisible=!0;break;case 33:if(t.type!=BAR){error(1,t,"!beamon! must be on a bar");break}t.beam_on=!0;break;case 34:if(t.type!=NOTE||!n||n.type!=NOTE){error(1,t,"!"+s.name+"! must be on the last of a couple of notes");break}for(t.trem2=!0,t.beam_end=!0,n.trem2=!0,n.beam_st=!0,t.ntrem=n.ntrem=Number(s.name[4]),t.nflags--,n.nflags--,t.nflags>0?(t.nflags+=t.ntrem,n.nflags+=t.ntrem):(t.nflags<=-2&&(t.stemless=!0,n.stemless=!0),t.nflags=t.ntrem,n.nflags=t.ntrem),i=0;i<=t.nhd;i++)t.notes[i].dur*=2;for(i=0;i<=n.nhd;i++)n.notes[i].dur*=2;break;case 35:if(t.type!=NOTE){error(1,t,"!xstem! must be on a note");break}t.xstem=!0,t.nflags=0;break;case 36:if(t.type!=NOTE){error(1,t,"!"+s.name+"! must be on a note");break}"1"==s.name[6]?t.beam_br1=!0:t.beam_br2=!0;break;case 37:t.rbstop=1;break;case 38:if(t.type!=NOTE){error(1,t,"!"+s.name+"! must be on a note");break}t.trem1=!0,t.ntrem=s.name.length,t.nflags>0?t.nflags+=t.ntrem:t.nflags=t.ntrem;break;case 39:if(t.type!=NOTE){error(1,t,"!"+s.name+"! must be on a note");break}t.feathered_beam="a"==s.name[5]?1:-1;break;case 40:t.stemless=!0;break;case 41:t.rbstop=2}else cfmt.decoerr&&error(1,t,"Unknown decoration '"+a+"'")}function deco_def(e){var t,n,r=e+" ";if(user_deco_tb)for(n=user_deco_tb.length,t=0;n>t;t++)if(0==user_deco_tb[t].indexOf(r))return deco_build(user_deco_tb[t]);for(n=std_deco_tb.length,t=0;n>t;t++)if(0==std_deco_tb[t].indexOf(r))return deco_build(std_deco_tb[t])}function deco_update(e,t){var n,r,i=a_de.length;for(n=0;i>n;n++)r=a_de[n],r.s==e&&(r.x+=t)}function deco_width(e){var t,n,r=0,i=e.a_dd,s=i.length;for(n=n=0;s>n;n++)switch(t=i[n],t.func){case 1:7>r&&(r=7);break;case 2:14>r&&(r=14)}return 0!=r&&e.prev&&e.prev.type==BAR&&(r-=3),r}function draw_all_deco(){if(0!=a_de.length){var e,t,n,r,i,s,a,o,c,u,l=[];if(!cfmt.dynalign)for(r=nstaff,s=staff_tb[r].y;--r>=0;)a=staff_tb[r].y,l[r]=.5*(s+24+a),s=a;for(;;){if(e=a_de.shift(),!e)break;t=e.dd,t.ldst&&t.ld_en_dd||(n=t.glyph,u=n.indexOf("/"),u>0&&(n=e.s.stem>=0?n.slice(0,u):n.slice(u+1)),r=e.st,s=e.y+staff_tb[r].y,t.func>=6&&!cfmt.dynalign&&(e.flags.up&&r>0||!e.flags.up&&r<nstaff)&&(o=e.flags.up?l[--r]:l[r++],o-=.5*t.h,(e.flags.up&&o>s||!e.flags.up&&s>o)&&(a=y_get(r,!e.flags.up,e.x,e.val)+staff_tb[r].y,e.flags.up&&(a-=t.h),(e.flags.up&&a>o||!e.flags.up&&o>a)&&(s=o,y_set(r,e.flags.up,e.x,e.val,(e.flags.up?s+t.h:s)-staff_tb[r].y)))),set_scale(e.s),i=e.x,c=user[n],c&&"function"==typeof c?c(i,s,e):psdeco(n,i,s,e)||(e.flags.grace?(output.push('<g transform="translate('),out_sxsy(i,",",s),e.flags.inv?output.push(') scale(0.7, -0.7)">\n'):output.push(') scale(0.7)">\n'),stv_g.trans=!0,i=s=0):e.flags.inv&&(output.push('<g transform="translate('),out_sxsy(i,",",s),output.push(') scale(1, -1)">\n'),stv_g.trans=!0,i=s=0),e.flags.val?2!=t.func||stv_g.st<0?out_deco_val(i,s,n,e.val/stv_g.scale,e.defl):out_deco_val(i,s,n,e.val,e.defl):e.str?out_deco_str(i,s+e.dy+.2*t.h,n,e.str):xygl(i,s,n),stv_g.trans&&(stv_g.trans=!1,output.push("</g>\n"))))}}}function draw_deco_head(e,t,n,r){var i,s,a=dd_tb[e];if(!a&&(a=deco_def(e),!a))return error(1,null,"Unknown decoration '"+e+"'"),!1;if(i=a.glyph,pshdeco(i,t,n,a))return 0==a.name.indexOf("head-");if(a.str)s={x:t},set_str(s,a.str),out_deco_str(s.x,n+s.dy,i,s.str);else switch(a.func){default:xygl(t,n,i);break;case 2:case 5:case 7:error(1,null,"Cannot have !"+a.name+"! on a head");break;case 3:case 4:xygl(t,n,i)}return 0==a.name.indexOf("head-")}function create_deco(e){var t,n,r,i,s=e.a_dd.length;for(n=0;s>n;n++){switch(t=e.a_dd[n],t.func){default:r=0;break;case 3:case 4:case 5:r=e.pos.orn;break;case 6:r=e.pos.vol;break;case 7:r=e.pos.dyn}if(r!=SL_HIDDEN)if(0!=t.name.indexOf("head-"))i={s:e,dd:t,st:e.st,ix:a_de.length,flags:{},defl:{},dy:0},a_de.push(i),e.grace&&(i.flags.grace=!0),t.ldst?i.flags.ldst=!0:t.lden&&(i.flags.lden=!0,i.defl.nost=!0),t.func>=3||(e.type==NOTE?func_tb[t.func](i):error(1,e,"Cannot have !"+t.name+"! on a rest or a bar"));else switch(e.type){case NOTE:case REST:break;default:error(1,e,"Cannot have !"+t.name+"! on a bar")}}}function draw_deco_near(){var e,t,n;for(e=tsfirst;e;e=e.ts_next){switch(e.type){case BAR:case MREST:break;case NOTE:case REST:case SPACE:n||(n=e);break;case GRACE:for(t=e.extra;t;t=t.next)t.a_dd&&create_deco(t);continue;default:continue}e.a_dd&&create_deco(e)}first_note=n}function draw_deco_note(){var e,t,n,r,i,s,a,o;for(n_de=a_de.length,e=0;e<n_de;e++)if(de=a_de[e],de.flags.ldst){for(r=de.dd,i=r.ld_en_dd,i||(i={name:r.name.slice(0,-1)+")",func:r.func,glyph:r.glyph,h:r.h},r.ld_en_dd=i),o=de.s.v,t=e+1;t<n_de&&(n=a_de[t],n.dd!=i||n.s.v!=o);t++);if(t==n_de)for(a=de.s.st,t=e+1;t<n_de&&(n=a_de[t],n.dd!=i||n.s.st!=a);t++);t==n_de&&(n={s:de.s,st:de.st,dd:i,ix:a_de.length-1,x:realwidth-6,y:de.s.y,flags:{lden:!0},defl:{noen:!0}},a_de.push(n)),n.start=de,delete n.defl.nost}for(e=0;e<n_de;e++)de=a_de[e],r=de.dd,s=r.func,3>s||s>=6||func_tb[s](de)}function draw_deco_staff(){function e(e){var t,n,r,s,a,o;for(r=staff_tb[e.st].topbar+6+20,t=e.sym;t;t=t.next)if(t.type==BAR&&t.rbstart&&!t.norepbra){if(!t.next)break;for(o||(o=t),n=t;t.next&&(t=t.next,!t.rbstop););s=y_get(e.st,!0,n.x,t.x-n.x),s>r&&(r=s),n.text&&(a=strw(n.text),s=y_get(e.st,!0,n.x+4,a),s+=gene.curfont.size+2,s>r&&(r=s)),t.rbstart&&(t=t.prev)}if(t=o)for(set_dscale(e.st),set_font("repeat"),s=r*staff_tb[e.st].staffscale;t;t=t.next)if(t.rbstart&&!t.norepbra){for(n=t;t.next&&(t=t.next,!t.rbstop););if(n==t)break;i=n.x,a=t.type!=BAR?t.rbstop?0:t.x-realwidth+4:t.bar_type.length>1&&"[]"!=t.bar_type||"]"==t.bar_type?n.st>0&&!(cur_sy.staves[n.st-1].flags&STOP_BAR)?t.wl:":"==t.bar_type[t.bar_type.length-1]?12:":"!=t.bar_type[0]||"]"==t.bar_type?0:8:8,a=(t.x-i-a)/staff_tb[e.st].staffscale,t.next||t.rbstop||e.bar_start||(e.bar_start=clone(t),e.bar_start.bar_type="[",e.bar_start.text=void 0,e.bar_start.rbstart=1,delete e.bar_start.a_gch),n.text&&xy_str(i+4,s-.9*gene.curfont.size,n.text),xypath(i,s),2==n.rbstart&&output.push("m0 20v-20"),output.push("h"),output.push(a.toFixed(2)),2==t.rbstop&&output.push("v20"),output.push('"/>\n'),y_set(n.st,!0,i,a,r+2),t.rbstart&&(t=t.prev)}}var t,n,r,i,s,a,o,c,u,l,f,d,p,h,m=new Array(nstaff);for(o=0;o<=nstaff;o++)m[o]={ymin:0,ymax:24};for(t=tsfirst;t;t=t.ts_next)if(t.a_gch){for(n||(n=t),c=t.a_gch.length,h=0;c>h&&(d=t.a_gch[h],!("g"==d.type&&(p=d,d.y<0)));h++);p&&(a=p.w,p.y>=0?(s=y_get(t.st,!0,t.x,a),s>m[t.st].ymax&&(m[t.st].ymax=s)):(s=y_get(t.st,!1,t.x,a),s<m[t.st].ymin&&(m[t.st].ymin=s)))}if(n){for(o=0;o<=nstaff;o++){var v=staff_tb[o].botbar;m[o].ymin-=3,m[o].ymin>v-10&&(m[o].ymin=v-10);var g=staff_tb[o].topbar;m[o].ymax+=3,m[o].ymax<g+10&&(m[o].ymax=g+10)}for(set_sscale(-1),t=n;t;t=t.ts_next)if(t.a_gch){switch(t.type){case NOTE:case REST:case SPACE:case MREST:break;case BAR:if(void 0==t.text)break;default:continue}draw_gchord(t,m[t.st].ymin,m[t.st].ymax)}}for(c=voice_tb.length,u=0;c>u;u++)r=voice_tb[u],!r.second&&r.sym&&e(r);for(o=0;o<=nstaff;o++)m[o]={ymin:0,ymax:0};for(c=a_de.length,o=0;c>o;o++)l=a_de[o],f=l.dd,f.func<6||(func_tb[f.func](l),f.ldst||cfmt.dynalign&&(l.flags.up?l.y>m[l.st].ymax&&(m[l.st].ymax=l.y):l.y<m[l.st].ymin&&(m[l.st].ymin=l.y)));for(o=0;c>o;o++)l=a_de[o],f=l.dd,f.ldst||f.func<6||(cfmt.dynalign?(s=l.flags.up?m[l.st].ymax:m[l.st].ymin,l.y=s):s=l.y,l.flags.up&&(s+=f.h),y_set(l.st,l.flags.up,l.x,l.val,s))}function draw_measnb(){var e,t,n,r,i,s,a,o,c,u=cur_sy;for(t=0;t<=nstaff&&u.staves[t].empty;t++);if(!(t>nstaff)){if(set_dscale(t),1!=staff_tb[t].staffscale&&(c=get_font("measure").size,param_set_font("measurefont","* "+(c/staff_tb[t].staffscale).toString())),set_font("measure"),e=tsfirst,n=gene.nbar,n>1)if(0==cfmt.measurenb)o=!0,i=y_get(t,!0,0,20),i<staff_tb[t].topbar+14&&(i=staff_tb[t].topbar+14),xy_str(0,i,n.toString()),y_set(t,!0,0,20,i+gene.curfont.size+2);else if(n%cfmt.measurenb==0){for(;;e=e.ts_next){switch(e.type){case METER:case CLEF:case KEY:case FORMAT:case STBRK:continue}break}for(;e.st!=t;)e=e.ts_next;e.prev.type!=CLEF&&(e=e.prev),r=e.x-e.wl,o=!0,s=cwid("0")*gene.curfont.swfac,n>=10&&(s*=n>=100?3:2),cfmt.measurebox&&(s+=4),i=y_get(t,!0,r,s),i<staff_tb[t].topbar+6&&(i=staff_tb[t].topbar+6),i+=2,xy_str(r,i,n.toString()),cfmt.measurebox&&(a=gene.curfont.size+3,s+=3,xybox(r-1,i-3+a,s,a)),i+=gene.curfont.size,y_set(t,!0,r,s,i),e.ymx=i}for(;e;e=e.ts_next){if(e.new_sy){for(u=u.next,t=0;t<nstaff&&u.staves[t].empty;t++);set_sscale(t)}e.type==BAR&&e.bar_num&&(n=e.bar_num,0!=cfmt.measurenb&&n%cfmt.measurenb==0&&e.next&&(o||(o=!0),s=cwid("0")*gene.curfont.swfac,n>=10&&(s*=n>=100?3:2),cfmt.measurebox&&(s+=4),r=e.x-.4*s,i=y_get(t,!0,r,s),i<staff_tb[t].topbar+6&&(i=staff_tb[t].topbar+6),e.next.type==NOTE&&(e.next.stem>0?i<e.next.ys-gene.curfont.size&&(i=e.next.ys-gene.curfont.size):i<e.next.y&&(i=e.next.y)),i+=2,xy_str(r,i,n.toString()),cfmt.measurebox&&(a=gene.curfont.size+3,s+=3,xybox(r-1,i-3+a,s,a)),i+=gene.curfont.size,y_set(t,!0,r,s,i),e.ymx=i))}gene.nbar=n,c&&param_set_font("measurefont","* "+c.toString())}}function draw_notempo(e,t,n,r,i){var s,a,o,c=identify_note(e,r),u=c[0],l=c[1],f=c[2];switch(stv_g.started&&(output.push("</g>\n"),stv_g.started=!1),output.push('<g transform="translate('),out_sxsy(t+8,",",n+3),output.push(") scale("+i+')">\n'),u){case"oval":a="HD";break;case"empty":a="Hd";break;default:a="hd"}if(xygl(-posx,posy,a),s=4,l){switch(o=8,f>0&&(o+=4),u){case"square":case"oval":o+=2;break;case"empty":o+=1}for(s=o*l,o-=posx;--l>=0;)out_dot(o,posy),o+=3.5}return r<BASE_LEN&&(0>=f?out_stem(-posx,posy,21):(out_stem(-posx,posy,21,!1,f),6>s&&(s=6))),output.push("\n</g>\n"),(s+15)*i}function tempo_width(e){var t,n,r=0;if(set_font("tempo"),e.tempo_str1&&(r=strw(e.tempo_str1)),e.tempo_value){for(t=1,n=e.tempo_notes.length;n>t;)r+=10,t++;r+=6+cwid(" ")*gene.curfont.swfac*6+10+10}return e.tempo_str2&&(r+=strw(e.tempo_str2)),r}function write_tempo(e,t,n,r){var i,s,a,o;if(set_font("tempo"),e.tempo_str1&&(xy_str(t,n,e.tempo_str1),t+=strw(e.tempo_str1)+6),e.tempo_value){for(r*=.7*gene.curfont.size/15,s=e.tempo_notes.length,i=0;s>i;i++)t+=draw_notempo(e,t,n,e.tempo_notes[i],r);t+=5,xy_str(t,n,"="),t+=strw("= ")+5,e.tempo_value.indexOf("/")<0?(xy_str(t,n,e.tempo_value.toString()),a=cwid("0")*gene.curfont.swfac,t+=a+5,e.tempo_value>=10&&(t+=a,e.tempo_value>=100&&(t+=a))):(o=e.tempo_value.split("/"),2==o.length&&Number(o[1])>0&&draw_notempo(e,t,n,o[0]*BASE_LEN/o[1],r))}e.tempo_str2&&xy_str(t,n,e.tempo_str2)}function draw_partempo(e,t){var n,r,i,s,a,o,c,u=0,l=0,f=staff_tb[e].topbar+12,d=0,p=1,h=0;for(n=tsfirst;n;n=n.ts_next)if(r=n.extra){for(;r&&r.type!=TEMPO;r=r.next);r&&(s||(s=!0),o=tempo_width(r),c=y_get(e,!0,n.x-5,o)+2,c>f&&(f=c),h>=n.x-5&&!(d&p>>1)&&(d|=p),p<<=1,h=n.x-5+o)}if(s)for(set_font("tempo"),l=gene.curfont.size+2+2,c=2-l,a=c-l,0!=d&&(l*=2),f+l>t&&(u=f+l-t),n=tsfirst;n;n=n.ts_next)if(n.seqst){for(r=n.extra;r&&(r.type!=TEMPO||r.deleted);r=r.next);r&&((user.anno_start||user.anno_stop)&&(r.x=n.x,r.wl=5,r.wr=40,r.ymn=1&d?a:c,r.ymx=r.ymn+14,user.anno_start&&anno_start(r)),write_tempo(r,n.x-5,1&d?a:c,1),user.anno_stop&&anno_stop(r),d>>=1)}for(f=staff_tb[e].topbar+14,n=tsfirst;n;n=n.ts_next)if(r=n.extra){for(;r&&r.type!=PART;r=r.next);r&&(i||(i=!0,set_font("parts"),a=gene.curfont.size+2+2),o=strw(r.text),c=y_get(e,!0,n.x-10,o+15)+5,c>f&&(f=c))}if(i)for(f+a+l>t&&(u=f+a+l-t),n=tsfirst;n;n=n.ts_next)if(r=n.extra){for(;r&&r.type!=PART;r=r.next);r&&((user.anno_start||user.anno_stop)&&(r.x=n.x-10,o=strw(r.text),r.wl=0,r.wr=o,r.ymn=2-l-a,r.ymx=r.ymn+a,user.anno_start&&anno_start(r)),xy_str(n.x-10,2-l-a,r.text),cfmt.partsbox&&(o=strw(r.text)+4,xybox(n.x-10-2,2-l-4,o,a)),user.anno_stop&&anno_stop(r))}return u}function b_pos(e,t,n,r){function i(e){var t=6*Math.round((e+12)/6)-12;return t-e}var s,a,o,c,u=e?3:BEAM_SHIFT,l=e?1.7:BEAM_DEPTH;if(t>0){if(a=r-(n-1)*u-l,a>26)return 0;s=r}else{if(s=r+(n-1)*u+l,-2>s)return 0;a=r}return o=i(s-BEAM_OFFSET),c=i(a+BEAM_OFFSET),o*o>c*c?c:o}function sym_dup(e){var t,n,r=clone(e);for(r.invisible=!0,delete r.text,delete r.a_gch,delete r.a_ly,delete r.a_dd,r.notes=clone(e.notes),t=0;t<=r.nhd;t++)n=r.notes[t]=clone(e.notes[t]),delete n.a_dcn;return r}function calculate_beam(e,t){var n,r,i,s,a,o,c,u,l,f,d,p,h,m,v,g,y,_,b,x,w,k,E,C;for(t.beam_st||(n=sym_dup(t),n.prev=t.prev,n.prev?n.prev.next=n:voice_tb[n.v].sym=n,t.prev=n,n.next=t,t.ts_prev.ts_next=n,n.ts_prev=t.ts_prev,t.ts_prev=n,n.ts_next=t,n.x-=12,n.x>t.prev.x+12&&(n.x=t.prev.x+12),n.beam_st=!0,delete n.beam_end,n.tmp=!0,n.slur_start=0,delete n.slur_end,t=n),i=s=0,c=u=!1,a=t.st,o=t.v,E=t.grace?GSTEM_XOFF:3.5,r=t;r.type!=NOTE||(r.nflags>s&&(s=r.nflags),i++,r.st!=a&&(c=!0),r.stem!=t.stem&&(u=!0),!r.beam_end);r=r.next)if(!r.next){for(;r.type!=NOTE;r=r.prev);n=sym_dup(r),n.next=r.next,n.next&&(n.next.prev=n),r.next=n,n.prev=r,n.ts_next=r.ts_next,n.ts_next&&(n.ts_next.ts_prev=n),r.ts_next=n,n.ts_prev=r,delete n.beam_st,n.beam_end=!0,n.tmp=!0,delete n.slur_start,delete n.slur_end,n.x+=12,n.x<realwidth-12&&(n.x=realwidth-12),r=n,i++;break}if(e.s2=r,0==staff_tb[a].y){if(c)return!1}else if(!c)return e.s1=t,e.a=(t.ys-r.ys)/(t.xs-r.xs),e.b=t.ys-t.xs*e.a+staff_tb[a].y,e.nflags=s,!0;for(y=_=b=x=w=0,n=t;n.type!=NOTE||(1==(C=voice_tb[n.v].scale)&&(C=staff_tb[n.st].staffscale),f=n.stem>=0?E+n.notes[0].shhd:-E+n.notes[n.nhd].shhd,f*=C,f+=n.x,n.xs=f,d=n.ys+staff_tb[n.st].y,y+=f,_+=d,b+=f*f,x+=f*d,w+=d*d,n!=r);n=n.next);if(h=(x*i-y*_)/(b*i-y*y),m=(_-h*y)/i,t.grace?h>BEAM_SLOPE?h=BEAM_SLOPE:-0.5>h&&(h=-0.5):(i>=3&&(l=w-h*x-m*_,l>0&&l/(i-2)>.5&&(h*=BEAM_FLATFAC)),h=h>=0?BEAM_SLOPE*h/(BEAM_SLOPE+h):BEAM_SLOPE*h/(BEAM_SLOPE-h)),k=h*(r.xs-t.xs)/(20*(i-1)),.0036>k*k&&(h=0),m=(_-h*y)/i,cfmt.flatbeams&&(m=t.grace?35+staff_tb[a].y:-11+staff_tb[a].y,h=0),g=0,n=t,u)p=t.grace?3:BEAM_SHIFT,p*=s-1,p+=BEAM_DEPTH,p*=.5,p*=t.stem!=r.stem&&t.nflags<r.nflags?r.stem:t.stem,m+=p;else if(t.grace)for(;p=h*n.xs+m-staff_tb[n.st].y,v=12,n.stem>0?v-=p-3*(n.notes[n.nhd].pit-18):v+=p-3*(n.notes[0].pit-18),v+=3*(n.nflags-1),v>g&&(g=v),n!=r;n=n.next);else{for(var T=BEAM_DEPTH+BEAM_SHIFT*(s-1);n.ts_prev&&n.ts_prev.type==NOTE&&n.ts_prev.time==n.time&&n.ts_prev.x>t.xs;)n=n.ts_prev;for(;n&&n.time<=r.time;n=n.ts_next)if(!(n.type!=NOTE||n.invisible||n.st!=a&&n.v!=o)){if(f=n.v==o?n.xs:n.x,p=h*f+m-staff_tb[n.st].y,n.v==o)v=0==n.nhd?min_tb[0][n.nflags]:min_tb[1][n.nflags],n.stem>0?(n.notes[n.nhd].pit>26&&(v-=2,n.notes[n.nhd].pit>28&&(v-=2)),v-=p-3*(n.notes[n.nhd].pit-18)):(n.notes[0].pit<18&&(v-=2,n.notes[0].pit<16&&(v-=2)),v-=3*(n.notes[0].pit-18)-p),v+=BEAM_DEPTH+BEAM_SHIFT*(n.nflags-1);else{if(t.stem>0)if(n.stem>0){if(n.ymn>p+4||n.ymx<p-T-2)continue;v=n.v>o?n.ymx-p:n.ymn+8-p}else v=n.ymx-p;else if(n.stem<0){if(n.ymx<p-4||n.ymn>p-T-2)continue;v=n.v<o?p-n.ymn:p-n.ymx+8}else v=p-n.ymn;v+=2+T}v>g&&(g=v)}}if(g>0&&(m+=t.stem*g),!c&&!u)for(n=t.next;;n=n.next){var S;switch(n.type){case REST:if(S=n.ts_next,!S||S.st!=a||S.type!=NOTE&&S.type!=REST)break;case BAR:if(n.invisible)break;case CLEF:d=h*n.x+m,t.stem>0?(d=n.ymx-d+BEAM_DEPTH+BEAM_SHIFT*(s-1)+2,d>0&&(m+=d)):(d=n.ymn-d-BEAM_DEPTH-BEAM_SHIFT*(s-1)-2,0>d&&(m+=d));break;case GRACE:for(S=n.extra;S;S=S.next)S.type==NOTE&&(d=h*S.x+m,t.stem>0?(d=S.ymx-d+BEAM_DEPTH+BEAM_SHIFT*(s-1)+2,d>0&&(m+=d)):(d=S.ymn-d-BEAM_DEPTH-BEAM_SHIFT*(s-1)-2,0>d&&(m+=d)))}if(n==r)break}for(0==h&&(m+=b_pos(t.grace,t.stem,s,m-staff_tb[a].y)),n=t;;n=n.next){var O;switch(n.type){case NOTE:n.ys=h*n.xs+m-staff_tb[n.st].y,n.stem>0?(n.ymx=n.ys+2.5,n.ts_prev&&n.ts_prev.stem>0&&n.ts_prev.st==n.st&&n.ts_prev.ymn<n.ymx&&n.ts_prev.x==n.x&&0==n.notes[0].shhd&&(n.ts_prev.x-=5,n.ts_prev.xs-=5)):n.ymn=n.ys-2.5;break;case REST:if(d=h*n.x+m-staff_tb[n.st].y,O=BEAM_DEPTH+BEAM_SHIFT*(s-1)+("full"!=n.head?4:9),t.stem>0){if(d-=O,0==t.multi&&d>12&&(d=12),n.y<=d)break}else if(d+=O,0==t.multi&&12>d&&(d=12),n.y>=d)break;"full"!=n.head&&(d=6*Math.floor((d+3+12)/6)-12),n.y=d}if(n==r)break}return 0==staff_tb[a].y?!1:(e.s1=t,e.a=h,e.b=m,e.nflags=s,!0)}function draw_beams(e){function t(e,t,n,r,i,s){var a,o,c=i.s1,u=c.nflags;c.ntrem&&(u-=c.ntrem),c.trem2&&s>u&&(c.dur>=BASE_LEN/2?(e=c.x+6,t=i.s2.x-6):c.dur<BASE_LEN/4&&(e+=5,t-=6)),a=i.a*e+i.b-n,t-=e,t/=stv_g.scale,o=i.a*t*stv_g.scale,xypath(e,a,!0),output.push("l"+t.toFixed(2)+" "+(-o).toFixed(2)+"v"+r.toFixed(2)+"l"+(-t).toFixed(2)+" "+o.toFixed(2)+'"/>\n')}var n,r,i,s,a,o,c,u,l,f,d,p,h=e.s1,m=e.s2;for(h.grace?(a=3,o=3.2,s=.29,c=1.6):(a=BEAM_SHIFT,o=BEAM_STUB,s=.34,c=BEAM_DEPTH),i=h.stem,h.stem!=m.stem&&h.nflags<m.nflags&&(i=m.stem),0>i&&(c=-c),t(h.xs-s,m.xs+s,0,c,e,1),u=0,n=h;n.type==NOTE&&n.stem!=i&&(n.ys=e.a*n.xs+e.b-staff_tb[n.st].y+a*(n.nflags-1)*n.stem-c),n!=m;n=n.next);for(h.feathered_beam&&(u=a/(m.xs-h.xs),h.feathered_beam>0?(u=-u,a=u*h.xs):a=u*m.xs,u*=i),s=0,r=2;r<=e.nflags;r++)for(s+=a,0!=u&&(e.a+=u),n=h;;n=n.next)if(n.type!=NOTE||n.nflags<r){if(n==m)break}else if(n.trem1&&r>n.nflags-n.ntrem){if(p=n.dur>=BASE_LEN/2?n.x:n.xs,t(p-5,p+5,(s+2.5)*i,c,e,r),n==m)break}else{for(f=n;;){if(n==m)break;if(l=n.next,l.type==NOTE||l.type==REST)if(l.trem1){if(l.nflags-l.ntrem<r)break}else if(l.nflags<r)break;if(l.beam_br1||l.beam_br2&&r>2)break;n=l}for(d=n;d.type!=NOTE;)d=d.prev;if(p=f.xs,f==d)if(f==h)p+=o;else if(f==m)p-=o;else if(f.beam_br1||f.beam_br2&&r>2)p+=o;else{for(l=f.next;l.type!=NOTE;)l=l.next;if(l.beam_br1||l.beam_br2&&r>2)p-=o;else{for(f=f.prev;f.type!=NOTE;)f=f.prev;f.nflags<l.nflags||f.nflags==l.nflags&&f.dots<l.dots?p+=o:p-=o}}if(t(p,d.xs,s*i,c,e,r),n==m)break}h.tmp?unlksym(h):m.tmp&&unlksym(m)}function draw_lstaff(e){function t(e,t,n){for(var r,i,s,a;cur_sy.staves[t].empty;){if(cur_sy.staves[t].flags&n)return;t++}for(r=i=t;;){if(cur_sy.staves[r].empty||(i=r),cur_sy.staves[r].flags&n)break;r++}s=staff_tb[t].y+staff_tb[t].topbar*staff_tb[t].staffscale,a=staff_tb[i].y+staff_tb[i].botbar*staff_tb[i].staffscale,n&(CLOSE_BRACE|CLOSE_BRACE2)?out_brace(e,a,s-a):out_bracket(e,s,s-a)}if(!cfmt.alignbars){var n,r,i,s,a=cur_sy.nstaff,o=0;for(n=0;(cur_sy.staves[n].flags&(OPEN_BRACE|OPEN_BRACKET)&&o++,cur_sy.staves[n].empty)&&(cur_sy.staves[n].flags&(CLOSE_BRACE|CLOSE_BRACKET)&&o--,n!=a);n++);for(r=a;r>n&&cur_sy.staves[r].empty;r--);if(n!=r||0!=o)for(i=staff_tb[r].y+staff_tb[r].botbar*staff_tb[r].staffscale,s=staff_tb[n].y+staff_tb[n].topbar*staff_tb[n].staffscale-i,xypath(e,i),output.push("v"+(-s).toFixed(2)+'"/>\n'),n=0;a>=n;n++)cur_sy.staves[n].flags&OPEN_BRACE&&t(e,n,CLOSE_BRACE),cur_sy.staves[n].flags&OPEN_BRACKET&&t(e,n,CLOSE_BRACKET),cur_sy.staves[n].flags&OPEN_BRACE2&&t(e-6,n,CLOSE_BRACE2),cur_sy.staves[n].flags&OPEN_BRACKET2&&t(e-6,n,CLOSE_BRACKET2)}}function draw_meter(e,t){if(t.a_meter){var n,r,i=t.st,s=staff_tb[i].y;for(e-=t.wl,r=0;r<t.a_meter.length;r++){var a,o=t.a_meter[r];if(n="C|"==o.top?13:13*o.top.length,o.bot)o.bot.length>o.top.length&&(n=13*o.bot.length),output.push('<g style="font:bold 16px serif"\n	transform="translate('),out_sxsy(e+.5*n,",",s),output.push(') scale(1.2,1)">\n	<text y="-12" text-anchor="middle">'+o.top+'</text>\n	<text text-anchor="middle">'+o.bot+"</text>\n</g>\n");else switch(o.top[0]){case"C":a="|"!=o.top[1]?"csig":"ctsig",e-=5,s+=12;break;case"c":a="."!=o.top[1]?"imsig":"iMsig";break;case"o":a="."!=o.top[1]?"pmsig":"pMsig";break;default:output.push('<g style="font:bold 18px serif"\n	transform="translate('),out_sxsy(e+.5*n,",",s),output.push(') scale(1.2,1)">\n	<text y="-6" text-anchor="middle">'+o.top+"</text>\n</g>\n")}a&&xygl(e+.5*n,s,a),e+=n}}}function draw_acc(e,t,n,r,i){if(r)if(r==i)n=-1==n?-2:2;else if(2*r!=i)return void xygl(e,t,"acc"+n+"_"+r+"_"+i);xygl(e,t,"acc"+n)}function draw_hl(e,t,n,r,i){var s=staff_tb[r],a=s.y,o=s.stafflines,c=2*(o.length-1)*3;if(!(c-s.botline<4)){for(t=6*Math.ceil(t/6);t<s.botline;t+=6)xygl(e,a+t,i);for(n-=n%6;n>c;n-=6)xygl(e,a+n,i)}}function draw_keysig(e,t,n){if(!n.k_none){var r,i,s,a=n.k_old_sf,o=e.st,c=staff_tb[o].y,u=n.k_y_clef;for(1&u&&(u+=7),u/=2;0>u;)u+=7;if(u%=7,n.k_a_acc){var l,f=n.k_a_acc[0].acc,d=100;for(r=0;r<n.k_a_acc.length;r++)l=n.k_a_acc[r],i=3*(n.k_y_clef+l.pit-18),0!=r&&(i>d+18||d-18>i)?t-=5.5:l.acc!=f&&(t+=3),f=l.acc,draw_hl(t,i,i,o,"hl"),d=i,draw_acc(t,c+i,l.acc,l.micro_n,l.micro_d),t+=5.5}else{if((cfmt.cancelkey||0==n.k_sf)&&(0==n.k_sf||a*n.k_sf<0)){for(i=sharp_cl[u],s=i>9?sharp1:sharp2,r=0;a>r;r++)xygl(t,c+i,"acc3"),i+=s[r],t+=5.5;for(i=flat_cl[u],s=18>i?flat1:flat2,r=0;r>a;r--)xygl(t,c+i,"acc3"),i+=s[-r],t+=5.5;0!=n.k_sf&&(t+=3)}if(n.k_sf>0){for(i=sharp_cl[u],s=i>9?sharp1:sharp2,r=0;r<n.k_sf;r++)xygl(t,c+i,"acc1"),i+=s[r],t+=5.5;if(cfmt.cancelkey&&a>r)for(t+=2;a>r;r++)xygl(t,c+i,"acc3"),i+=s[r],t+=5.5}if(n.k_sf<0){for(i=flat_cl[u],s=18>i?flat1:flat2,r=0;r>n.k_sf;r--)xygl(t,c+i,"acc-1"),i+=s[-r],t+=5.5;if(cfmt.cancelkey&&n.k_sf>a)for(t+=2;r>a;r--)xygl(t,c+i,"acc3"),i+=s[-r],t+=5.5}}}}function bar_cnv(e){switch(e){case"[":case"[]":return"";case":":return"|";case"|:":case"|::":case"|:::":return"["+e;case":|":case"::|":case":::|":return e+"]";case"::":return cfmt.dblrepbar}return e}function draw_bar(e,t,n){var r,i,s=e.st,a=e.x;if(e.bar_mrep)if(i=staff_tb[s].y,set_scale(e),1==e.bar_mrep){for(var o=e.prev;o.type!=REST;o=o.prev);xygl(o.x,i,"mrep")}else xygl(a,i,"mrep2"),e.v==cur_sy.top_voice&&(set_font("annotation"),xy_str(a,i+staff_tb[s].topbar+4,e.bar_mrep.toString(),"c"));0==s||!e.ts_prev||e.ts_prev.type==BAR&&e.ts_prev.st==s-1||(n=staff_tb[s].topbar*staff_tb[s].staffscale);var c=e.bar_dotted||":"==e.bar_type,u=bar_cnv(e.bar_type);if(u)for(r=u.length;--r>=0;){switch(u[r]){case"|":set_sscale(-1),c?out_dotbar(a,t,n):out_bar(a,t,n);break;default:a-=3,set_sscale(-1),out_thbar(a,t,n);break;case":":a-=2,set_sscale(s),xygl(a+1,staff_tb[s].y,"rdots")}a-=3}}function draw_rest(e){var t,n,r,i,s,a,o,c=staff_tb[e.st];if(!c.empty){if(e.dur==voice_tb[e.v].meter.wmeasure){for(t=e.ts_next;t&&t.time!=e.time+e.dur;)t=t.ts_next;for(s=t?t.x:realwidth,t=e;!t.seqst;)t=t.ts_prev;t=t.ts_prev,s=(s+t.x)/2,e.a_dd&&deco_update(e,s-e.x),e.x=s}else s=e.x,e.notes[0].shhd&&(s+=e.notes[0].shhd*stv_g.scale);if(!e.invisible){if(o=c.y,e.repeat_n)return void(e.repeat_n<0?xygl(s,o,"srep"):(xygl(s,o,"mrep"),e.repeat_n>2&&e.v==cur_sy.top_voice&&(set_font("annotation"),xy_str(s,o+24+4,e.repeat_n.toString(),"c"))));if(a=e.y,e.notes[0].a_dcn)for(i=0;i<note.a_dcn.length;i++)draw_deco_head(e.notes[0].a_dcn[i],s,a+o,e.stem);else{if(n=5-e.nflags,7==n&&12==a&&c.stafflines.length<=2&&(a-=6),xygl(s,a+o,rest_tb[n]),n>=6)switch(r=a/6,n){case 6:"|"!=c.stafflines[r]&&xygl(s,a+o,"hl");break;case 7:"|"!=c.stafflines[r+1]&&xygl(s,a+6+o,"hl");break;default:"|"!=c.stafflines[r+1]&&xygl(s,a+6+o,"hl"),9==n&&(a-=6,r--),"|"!=c.stafflines[r]&&xygl(s,a+o,"hl")}for(s+=8,a+=o-3,n=0;n<e.dots;n++)out_dot(s,a),s+=3.5}}}}function draw_gracenotes(e){var t,n,r,i,s,a,o,c,u,l,f,d,p,h,m,v,g={};for(h=e.extra;h&&(h.type!=NOTE||(user.anno_start&&anno_start(e),h.beam_st&&!h.beam_end&&calculate_beam(g,h)&&draw_beams(g),draw_note(h,!g.s2),h==g.s2&&(g.s2=void 0),h.sappo&&(h.next?(i=.5*(h.next.x-h.x)+4,s=.5*(h.ys+h.next.ys)-h.y,h.stem>0?s-=1:s+=1):(i=9,s=h.stem>0?5:-5),v=h.notes[h.stem<0?0:h.nhd],out_acciac(x_head(h,v),y_head(h,v),i,s,h.stem>0)),user.anno_stop&&anno_stop(e),h.next));h=h.next);if(!voice_tb[e.v].key.k_bagpipe&&cfmt.graceslurs&&!e.slur_start&&e.next&&e.next.type==NOTE){if(m=h,m.stem>=0){for(t=127,h=e.extra;h;h=h.next)h.type==NOTE&&h.y<t&&(t=h.y,m=h);n=m.x,r=m.y-5,e.extra!=m&&(n-=4,r+=1),e=e.next,c=e.x-1,e.stem<0&&(c-=4),u=3*(e.notes[0].pit-18)-5,d=.4*(c-n),d>3&&(d=3),p=d,l=.2,f=.8,r>u+7?(n=m.x-1,r+=.5,u+=6.5,c=e.x-5.5,d=.8*(r-u),p=.2*(r-u),l=0):u>r+4&&(u=r+4,n=m.x+2,r=m.y-4)}else{for(t=-127,h=e.extra;h;h=h.next)h.type==NOTE&&h.y>t&&(t=h.y,m=h);n=m.x,r=m.y+5,e.extra!=m&&(n-=4,r-=1),e=e.next,c=e.x-1,e.stem>=0&&(c-=2),u=3*(e.notes[e.nhd].pit-18)+5,d=.4*(n-c),-3>d&&(d=-3),p=d,l=.2,f=.8,u-7>r?(n=m.x-1,r-=.5,u-=6.5,c=e.x-5.5,d=.8*(r-u),p=.2*(r-u),l=0):r-4>u&&(u=r-4,n=m.x+2,r=m.y+4)}i=l*c+(1-l)*n-n,s=l*u+(1-l)*r-d-r,a=f*c+(1-f)*n-n,o=f*u+(1-f)*r-p-r,xypath(n,r+staff_tb[e.st].y),output.push("c"+i.toFixed(2)+" "+(-s).toFixed(2)+" "+a.toFixed(2)+" "+(-o).toFixed(2)+" "+(c-n).toFixed(2)+" "+(-u+r).toFixed(2)+'"/>\n')}}function setdoty(e,t){var n,r,i;for(n=0;n<=e.nhd;n++)i=3*(e.notes[n].pit-18),i%6==0&&(e.dot_low?i-=3:i+=3),t[n]=i;for(n=0;n<e.nhd;n++)if(!(t[n+1]>t[n])){for(r=n;r>0&&!(t[r]>t[r-1]+6);)r--;if(3*(e.notes[r].pit-18)-t[r]<t[n+1]-3*(e.notes[n+1].pit-18))for(;n>=r;)t[r++]-=6;else t[n+1]=t[n]+6}}function x_head(e,t){return e.x+t.shhd}function y_head(e,t){return staff_tb[e.st].y+3*(t.pit-18)}function draw_basic_note(e,t,n,r){var i,s,a,o,c,u,l,f,d=!1,p=t.notes[n];if(staffb=staff_tb[t.st].y,a=3*(p.pit-18),shhd=p.shhd*stv_g.scale,x_note=e+shhd,y_note=a+staffb,u=0,p.a_dcn)for(s=0;s<p.a_dcn.length;s++)u|=draw_deco_head(p.a_dcn[s],e+shhd,a+staffb,t.stem);if(!(t.invisible||void 0!=t.nohdi1&&n>=t.nohdi1&&n<t.nohdi2)){var h=identify_note(t,p.dur),m=h[0],v=h[1];h[2];if(a%6==0&&shhd!=(t.stem>0?t.notes[0].shhd:t.notes[t.nhd].shhd)&&(c=0,a>=30?(c=a,c%6&&(c-=3)):-6>=a&&(c=a,c%6&&(c+=3)),c&&xygl(x_note,c+staffb,"hl")),u);else if(p.map&&p.map[0])i=-t.nflags,0>i&&(i=0),o=p.map[0][i],o||(o=p.map[0][p.map[0].length-1]),i=o.indexOf("/"),i>=0&&(o=t.stem>=0?o.slice(0,i):o.slice(i+1));else if(t.grace)o="ghd",
x_note-=4.5*stv_g.scale;else if(t.type==CUSTOS)o="custos";else switch(m){case"oval":if(p.dur<2*BASE_LEN){o="HD";break}if("square"!=t.head){o="HDD";break}case"square":o=p.dur<4*BASE_LEN?"breve":"longa",tsnext||!t.next||t.next.type!=BAR||t.next.next||(v=0);break;case"empty":o="Hd";break;default:o="hd"}if(p.map&&p.map[2]&&(d=set_color(p.map[2])),o&&xygl(x_note,y_note,o),v)for(l=e+(7.7+t.xmx)*stv_g.scale,void 0==r[n]&&(r[n]=3*(t.notes[n].pit-18),0==(1&t.notes[n].pit)&&(r[n]+=3)),f=r[n]+staffb;--v>=0;)out_dot(l,f),l+=3.5;p.acc&&(e-=p.shac*stv_g.scale,t.grace?(output.push('<g transform="translate('),out_sxsy(e,",",a+staffb),output.push(') scale(.7)">\n'),stv_g.trans=!0,draw_acc(0,0,p.acc,p.micro_n,p.micro_d),stv_g.trans=!1,output.push("</g>\n")):draw_acc(e,a+staffb,p.acc,p.micro_n,p.micro_d)),0!=d&&set_color(d)}}function draw_note(e,t){var n,r,i,s,a,o,c,u,i,l,f=new Array(e.nhd+1);if(e.dots&&setdoty(e,f),l=e.notes[e.stem<0?e.nhd:0],u=x_head(e,l),s=staff_tb[e.st].y,!e.invisible){if(e.grace)o="ghl";else switch(e.head){default:o="hl";break;case"oval":o="hl1";break;case"square":o="hl2"}draw_hl(u,3*(e.notes[0].pit-18),3*(e.notes[e.nhd].pit-18),e.st,o)}if(i=y_head(e,l),e.invisible||e.stemless?e.xstem&&(n=e.ts_prev,a=(n.stem>0?n.y:n.ys)-e.y,a+=staff_tb[n.st].y-s,a/=voice_tb[e.v].scale,out_stem(u,i,a)):(a=e.ys-e.y,c=e.nflags,e.ntrem&&(c-=e.ntrem),!t||0>=c?(e.nflags>0&&(e.stem>=0?a-=1:a+=1),out_stem(u,i,a,e.grace)):out_stem(u,i,a,e.grace,c,cfmt.straightflags)),!e.invisible&&t&&e.trem1){var d=e.ntrem?e.ntrem:0,p=u;a=3*(e.notes[e.stem>0?e.nhd:0].pit-18),"full"==e.head||"empty"==e.head?(p+=(e.grace?GSTEM_XOFF:3.5)*e.stem,e.stem>0?a+=6+5.4*d:a-=11.4):e.stem>0?a+=5+5.4*d:a-=10.4,a/=voice_tb[e.v].scale,out_trem(p,s+a,d)}for(u=e.x,r=0;r<=e.nhd;r++)draw_basic_note(u,e,r,f)}function next_scut(e){var t=e;for(e=e.next;e;e=e.next){if(e.type==BAR&&(":"==e.bar_type[0]||"|]"==e.bar_type||"[|"==e.bar_type||e.text&&"1"!=e.text[0]))return e;t=e}return t}function prev_scut(e){for(;e.prev;)if(e=e.prev,e.type==BAR&&(":"==e.bar_type[0]||"|]"==e.bar_type||"[|"==e.bar_type||e.text&&"1"!=e.text[0]))return e;for(e=voice_tb[e.v].sym;e.type!=CLEF;)e=e.ts_prev;return e.next.type==KEY&&(e=e.next),e.next.type==METER?e.next:e}function slur_direction(e,t){var n,r,i;for(n=e;;n=n.next){if(n.type==NOTE){if(!n.stemless){if(n.stem<0)return 1;r=!0}n.notes[0].pit<22&&(i=!0)}if(n==t)break}return r||i?-1:1}function slur_out(e,t,n,r,i,s,a){var o,c,u,l=.3,f=.45;c=r-t,0>c&&(c=-c),o=n-e,o>40&&.7>c/o&&(l=.3+.002*(o-40),l>.7&&(l=.7));var d=.5*(e+n),p=.5*(t+r),h=d+l*(e-d),m=p+l*(t-p)+s;h=e+f*(h-e),m=t+f*(m-t);var v=d+l*(n-d),g=p+l*(r-p)+s;v=n+f*(v-n),g=r+f*(g-r),o=.03*(n-e),c=2*i,u=.2+.001*(n-e),u>.6&&(u=.6),u*=i;var y=stv_g.v?stv_g.scale:1;a?output.push('<path class="stroke" stroke-dasharray="5,5" d="M'):output.push('<path class="fill" d="M'),out_sxsy(e," ",t),output.push("c"+((h-e)/stv_g.scale).toFixed(2)+" "+((t-m)/y).toFixed(2)+" "+((v-e)/stv_g.scale).toFixed(2)+" "+((t-g)/y).toFixed(2)+" "+((n-e)/stv_g.scale).toFixed(2)+" "+((t-r)/y).toFixed(2)),a||output.push("\n	v"+(-u).toFixed(2)+"c"+((v-o-n)/stv_g.scale).toFixed(2)+" "+((r+u-g-c)/y).toFixed(2)+" "+((h+o-n)/stv_g.scale).toFixed(2)+" "+((r+u-m-c)/y).toFixed(2)+" "+((e-n)/stv_g.scale).toFixed(2)+" "+((r+u-t)/y).toFixed(2)),output.push('"/>\n')}function slur_multi(e,t){for(;;){if(e.multi)return e.multi;if(e==t)break;e=e.next}return 0}function draw_slur(e,t,n,r,i){for(var s,a,o,c,u,l,f,d,p,h,m,v,g,y,_,b=e;b.v!=t.v;)b=b.ts_next;switch(7&i){case SL_ABOVE:_=1;break;case SL_BELOW:_=-1;break;default:_=slur_multi(b,t),_||(_=slur_direction(b,t))}var x=1,w=b.st,k=!1;if(b!=t)for(s=b.next;;){if((s.type==NOTE||s.type==REST)&&(x++,s.st!=w&&(k=!0,s.st<w&&(w=s.st))),s==t)break;s=s.next}if(k&&error(2,b,"*** multi-staves slurs not treated yet"),o=e.x,e.notes&&e.notes[0].shhd&&(o+=e.notes[0].shhd),e!=t)u=t.x,t.notes&&(u+=t.notes[0].shhd);else{for(s=t.ts_next;s&&!s.new_sy;s=s.ts_next);u=s?s.x:realwidth}if(n>=0?c=3*(b.notes[n].pit-18)+5*_:(c=_>0?b.ymx+2:b.ymn-2,b.type==NOTE&&(_>0?b.stem>0?(o+=5,b.beam_end&&b.nflags>=-1&&!b.in_tuplet?b.nflags>0?(o+=2,c=b.ys-3):c=b.ys-6:c=b.ys+3):c=b.y+8:b.stem<0?(o-=1,b.beam_end&&b.nflags>=-1&&(!b.in_tuplet||b.ys<c+3)?b.nflags>0?(o+=2,c=b.ys+3):c=b.ys+6:c=b.ys-3):c=b.y-8)),r>=0?l=3*(t.notes[r].pit-18)+5*_:(l=_>0?t.ymx+2:t.ymn-2,t.type==NOTE&&(_>0?t.stem>0?(u+=1,l=t.beam_st&&t.nflags>=-1&&!t.in_tuplet?t.ys-6:t.ys+3):l=t.y+8:t.stem<0?(u-=5,l=t.beam_st&&t.nflags>=-1&&!t.in_tuplet?t.ys+6:t.ys-3):l=t.y-8)),b.type!=NOTE&&(c=l+1.2*_,o=b.x+.5*b.wr,o>u-12&&(o=u-12)),t.type!=NOTE&&(l=b.type==NOTE?c+1.2*_:c,b!=t&&(u=t.x-.3*t.wl)),x>=3&&(b.next.type!=BAR&&b.next.x<o+48&&(_>0?(h=b.next.ymx-2,h>c&&(c=h)):(h=b.next.ymn+2,c>h&&(c=h))),t.prev&&t.prev.type!=BAR&&t.prev.x>u-48&&(_>0?(h=t.prev.ymx-2,h>l&&(l=h)):(h=t.prev.ymn+2,l>h&&(l=h)))),p=(l-c)/(u-o),(p>SLUR_SLOPE||-1>p)&&(p=p>SLUR_SLOPE?SLUR_SLOPE:-1,p*_>0?c=l-p*(u-o):l=c+p*(u-o)),h=l-c,h>8?h=8:-8>h&&(h=-8),m=h,0>m&&(m=-m),g=.5*m,y=.3*h,h*_>0?(u-=g,l-=y):(o+=g,c+=y),b.grace&&(o=b.x-.8),t.grace&&(u=t.x+1.5*GSTEM_XOFF),v=0,p=(l-c)/(u-o),b!=t&&b.v==t.v){for(d=c-p*o,s=b.next;s!=t;s=s.next)if(s.st==w)switch(s.type){case NOTE:case REST:_>0?(h=3*(s.notes[s.nhd].pit-18)+6,h<s.ymx&&(h=s.ymx),h-=p*s.x+d,h>v&&(v=h)):(h=3*(s.notes[0].pit-18)-6,h>s.ymn&&(h=s.ymn),h-=p*s.x+d,v>h&&(v=h));break;case GRACE:for(a=s.extra;a;a=a.next)a.type==NOTE&&(_>0?(h=3*(a.notes[a.nhd].pit-18)+6,h<a.ymx&&(h=a.ymx),h-=p*a.x+d,h>v&&(v=h)):(h=3*(a.notes[0].pit-18)-6,h>a.ymn&&(h=a.ymn),h-=p*a.x+d,v>h&&(v=h)))}c+=.45*v,l+=.45*v,v*=.65}if(f=x>3?(.08*(u-o)+12)*_:(.03*(u-o)+8)*_,_>0?(3*v>f&&(f=3*v),f>40&&(f=40)):(f>3*v&&(f=3*v),-40>f&&(f=-40)),h=l-c,0>h&&(h=-h),_>0?.8*h>f&&(f=.8*h):f>-.8*h&&(f=-.8*h),f*=cfmt.slurheight,slur_out(o,c,u,l,_,f,i&SL_DOTTED),g=u-o,p=(l-c)/g,d=c-p*o+.4*f,b.v==t.v)for(s=b;s!=t;s=s.next)s.st==w&&(h=p*s.x+d,s.ymx<h?s.ymx=h:s.ymn>h&&(s.ymn=h),s.next==t?(g=u,t.sl1&&(g-=5)):g=s.next.x,s!=b&&(o=s.x),g-=o,y_set(w,_>0,o,g,h));return(_>0?SL_ABOVE:SL_BELOW)|i&SL_DOTTED}function draw_slurs(e,t){for(var n,r,i,s,a,o,c,u,l=e;;){if(!l||l==t){if(!i||!(l=i.next)||l==t)break;i=null}if(l.type!=GRACE)if(l.type!=NOTE&&l.type!=REST&&l.type!=SPACE||!l.slur_start&&!l.sl1)l=l.next;else{r=null,n=l.next;for(var f=!1;;)if(n)if(n.type!=GRACE){if(n.type==BAR&&(":"==n.bar_type[0]||"|]"==n.bar_type||"[|"==n.bar_type||n.text&&"1"!=n.text[0])){r=n;break}if(n.type==NOTE||n.type==REST||n.type==SPACE){if(n.slur_end||n.sl2){r=n;break}if(n.slur_start||n.sl1){if(s){for(r=n;r.next;r=r.next);r.next=s.next,s.next&&(s.next.prev=r),r=null}draw_slurs(n,t),s&&s.next&&(delete s.next.prev.next,s.next.prev=s)}if(n==t)break;n=n.next}else n=n.next}else s=n,n=n.extra;else{if(s){n=s.next,s=null;continue}if(!i||f)break;n=i.next,f=!0}if(n){if(!r){if(l=n,l==t)break;continue}}else r=next_scut(l);if(i){for(n=l;n.next;n=n.next);n.next=i.next,i.next&&(i.next.prev=n),i.slur_start=SL_AUTO}if(s&&(s.prev.next=s.extra,s.extra.prev=s.prev,s.slur_start=SL_AUTO),l.slur_start)c=15&l.slur_start,l.slur_start>>=4,a=-1;else{for(a=0;a<=l.nhd&&!l.notes[a].sl1;a++);c=15&l.notes[a].sl1,l.notes[a].sl1>>=4,l.sl1--}if(o=-1,u=0,r.type!=NOTE&&r.type!=REST&&r.type!=SPACE||!r.slur_end&&!r.sl2)r.type==BAR&&(":"==r.bar_type[0]||"|]"==r.bar_type||"[|"==r.bar_type||r.text&&"1"!=r.text[0])||(u=1);else if(r.slur_end)r.slur_end--;else{for(o=0;o<=r.nhd&&!r.notes[o].sl2;o++);r.notes[o].sl2--,r.sl2--}if(c=draw_slur(l,r,a,o,c),u&&(voice_tb[r.v].slur_start<<=4,voice_tb[r.v].slur_start+=c),i&&i.next&&(delete i.next.prev.next,i.next.prev=i),s&&(s.prev.next=s,delete s.extra.prev),!l.slur_start&&!l.sl1){if(l==t)break;l=l.next}}else i=l,l=l.extra}}function draw_tuplet(e,t){var n,r,i,s,a,o,c,u,l,f,d,p,h,m,v,g,y,_,b,v,x,w=t;if(1==e.tuplet_f[0])return w;for(s=e.next;s;s=s.next)s.type==TUPLET&&(i=draw_tuplet(s,t),i.time>w.time&&(w=i));for(a=e.tuplet_r,o=t.st,r=t;r;r=r.next){if(r!=t&&r.in_tuplet)for(s=r.extra;s;s=s.next)s.type==TUPLET&&(i=draw_tuplet(s,r),i.time>w.time&&(w=i));if(r.type==NOTE||r.type==REST){if((r.slur_start||r.slur_end||r.sl1||r.sl2)&&(u=!0),r.st<o&&(o=r.st),n||(n=r),--a<=0)break}else if(r.type==GRACE)for(s=r.extra;s;s=s.next)s.type==NOTE&&(s.slur_start||s.sl1)&&(u=!0)}if(!r)return w;if(r.time>w.time&&(w=r),n==r)c=!0;else if(1==e.tuplet_f[1])c=!0,draw_slur(n,r,-1,-1,n.stem>0?SL_ABOVE:SL_BELOW);else if(2==e.tuplet_f[0]||n.type!=NOTE||r.type!=NOTE)c=!1;else{for(c=!0,i=n;;i=i.next){if(i.type!=NOTE&&i.type!=REST){if(i.type==GRACE||i.type==SPACE)continue;c=!1;break}if(i==r)break;if(i.beam_end){c=!1;break}}if(c&&!n.beam_st&&!n.beam_br1&&!n.beam_br2)for(i=n.prev;i;i=i.prev)if(i.type==NOTE||i.type==REST){i.nflags>=n.nflags&&(c=!1);break}if(c&&!r.beam_end)for(i=r.next;i;i=i.next)if(i.type==NOTE||i.type==REST){!i.beam_br1&&!i.beam_br2&&i.nflags>=r.nflags&&(c=!1);break}}if(c){if(1==e.tuplet_f[2])return w;for(h=.5*(r.x+n.x),v=n==r?0:(r.ys-n.ys)/(r.x-n.x),x=n.ys-v*n.x,y=v*h+x,n.stem>0?(m=y_get(o,1,h-3,6),m>y&&(x+=m-y),x+=2):(m=y_get(o,0,h-3,6),y>m&&(x+=m-y),x-=10),i=n;!(i.x>=h);i=i.next);return n.stem*r.stem>0&&(n.stem>0?h+=1.5:h-=1.5),m=v*h+x,0==e.tuplet_f[2]?out_bnum(h,m,e.tuplet_p):out_bnum(h,m,e.tuplet_p+":"+e.tuplet_q),n.stem>0?(m+=10,i.ymx<m&&(i.ymx=m),y_set(o,!0,h-3,6,m)):(i.ymn>m&&(i.ymn=m),y_set(o,!1,h-3,6,m)),t.in_tuplet=!1,w}if(u){if(draw_slurs(n,r),n.slur_start||n.sl1)return w;for(i=n.next;i!=r;i=i.next)if(i.slur_start||i.slur_end||i.sl1||i.sl2)return w;if(r.slur_end||r.sl2)return w}if(0!=e.tuplet_f[1]&&error(2,e,"'what' value of %%tuplets not yet coded"),n.multi>=0){if(l=n.x-4,d=24,n.st==o){if(i=n,i.type!=NOTE)for(i=i.next;i!=r&&i.type!=NOTE;i=i.next);m=y_get(o,1,i.x,0),m>d&&(d=m),n.stem>0&&(l+=3)}if(p=24,r.st==o){if(i=r,i.type!=NOTE)for(i=i.prev;i!=n&&i.type!=NOTE;i=i.prev);m=y_get(o,1,i.x,0),m>p&&(p=m)}for(r.dur>r.prev.dur?f=r.next?r.next.x-r.next.wl-5:realwidth-6:(f=r.x+4,a=r.stem>=0?0:r.nhd,r.notes[a].shhd>0&&(f+=r.notes[a].shhd),r.st==o&&r.stem>0&&(f+=3.5)),h=.5*(l+f),m=.5*(d+p),v=(p-d)/(f-l),g=3*(r.notes[r.nhd].pit-n.notes[n.nhd].pit)/(f-l),g>0?0>v?v=0:v>g&&(v=g):v>0?v=0:g>v&&(v=g),.1*.1>v*v&&(v=0),b=0,i=n;;i=i.next)if(i.dur&&i.st==o){if(y=m+(i.x-h)*v,_=y_get(o,1,i.x,0),_-y>b&&(b=_-y),i==r)break}else if(i==r)break;for(m+=b+2,d=m+v*(l-h),p=m+v*(f-h),out_tubr(l,d+4,f-l,p-d,!0),m+=8,i=n;;i=i.next)if(i.st==o){if(y=m+(i.x-h)*v,i.ymx<y&&(i.ymx=y),i==r)break;y_set(o,!0,i.x,i.next.x-i.x,y)}else if(i==r)break}else{if(l=n.x-7,r.dur>r.prev.dur?f=r.next?r.next.x-r.next.wl-8:realwidth-6:(f=r.x+2,r.notes[r.nhd].shhd>0&&(f+=r.notes[r.nhd].shhd)),n.st==o){if(i=n,i.type!=NOTE)for(i=i.next;i!=r&&i.type!=NOTE;i=i.next);d=y_get(o,0,i.x,0)}else d=0;if(r.st==o){if(i=r,i.type!=NOTE)for(i=i.prev;i!=n&&i.type!=NOTE;i=i.prev);p=y_get(o,0,i.x,0)}else p=0;for(h=.5*(l+f),m=.5*(d+p),v=(p-d)/(f-l),g=3*(r.notes[0].pit-n.notes[0].pit)/(f-l),g>0?0>v?v=0:v>g&&(v=g):v>0?v=0:g>v&&(v=g),.1*.1>v*v&&(v=0),b=0,i=n;;i=i.next)if(i.dur&&i.st==o){if(y=m+(i.x-h)*v,_=y_get(o,0,i.x,0),b>_-y&&(b=_-y),i==r)break}else if(i==r)break;for(m+=b-10,d=m+v*(l-h),p=m+v*(f-h),out_tubr(l,d+4,f-l,p-d),m-=2,i=n;;i=i.next){if(i.st==o){if(i==r)break;y=m+(i.x-h)*v,i.ymn>y&&(i.ymn=y),y_set(o,!1,i.x,i.next.x-i.x,y)}if(i==r)break}}return 1==e.tuplet_f[2]?(t.in_tuplet=!1,w):(y=.5*(d+p),0==e.tuplet_f[2]?out_bnum(h,y,e.tuplet_p,!0):out_bnum(h,y,e.tuplet_p+":"+e.tuplet_q,!0),n.multi>=0?(y+=9,y_set(o,!0,h-3,6,y)):y_set(o,!1,h-3,6,y),t.in_tuplet=!1,w)}function draw_note_ties(e,t,n,r,i){var s,a,o,c,u,l,f,d,p,h,m,v,g,y;for(s=0;s<n.length;s++){switch(o=n[s],l=e.notes[o].pit,c=r[s],f=t.notes[c].pit,a=(7&e.notes[o].ti1)==SL_ABOVE?1:-1,m=e.x,y=e.notes[o].shhd,a>0?o<e.nhd&&l+1==e.notes[o+1].pit&&e.notes[o+1].shhd>y&&(y=e.notes[o+1].shhd):o>0&&l==e.notes[o-1].pit+1&&e.notes[o-1].shhd>y&&(y=e.notes[o-1].shhd),m+=.6*y,v=t.x,y=t.notes[c].shhd,a>0?c<t.nhd&&f+1==t.notes[c+1].pit&&t.notes[c+1].shhd<y&&(y=t.notes[c+1].shhd):c>0&&f==t.notes[c-1].pit+1&&t.notes[c-1].shhd<y&&(y=t.notes[c-1].shhd),v+=.6*y,p=e.st,i){case 0:u=l==f||1&l?l:f;break;case 1:case 3:m=e.x,m>v-20&&(m=v-20),u=f,p=t.st,3==i&&(a=-a);break;default:if(e!=t)v-=t.wl;else{for(h=t.ts_next;h&&!h.new_sy;h=h.ts_next);v=h?h.x:realwidth}m+16>v&&(v=m+16),u=l}v-m>20&&(m+=3.5,v-=3.5),d=3*(u-18),1!=i&&3!=i?(1&u&&(d+=2*a),a>0&&!(1&u)&&e.dots>0&&(d=3*(u-18)+6)):1&u&&(d+=2*a),g=(.04*(v-m)+10)*a,slur_out(m,staff_tb[p].y+d,v,staff_tb[p].y+d,a,g,e.notes[o].ti1&SL_DOTTED)}}function draw_ties(e,t,n){var r,i,s,a,o,c,u=[],l=[],f=[],d=e.nhd,p=e.time+e.dur;if(e.type==GRACE)for(r=e.extra;r;)r.type==NOTE&&(e=r),r=r.next;if(t&&t.type==GRACE)for(r=t.extra;r;){if(r.type==NOTE){t=r,2==n&&(n=0);break}r=r.next}if(2==n){for(i=0;d>=i;i++)e.notes[i].ti1&&f.push(i);return void draw_note_ties(e,t||e,f,f,n)}for(i=0;d>=i;i++)if(e.notes[i].ti1){for(c=-1,o=e.notes[i].apit,a=t.nhd;a>=0;a--){switch(t.notes[a].apit-o){case 1:case-1:e.notes[i].acc!=t.notes[a].acc&&(c=a);default:continue;case 0:c=a}break}c>=0?(u.push(i),l.push(c)):f.push(i)}if(draw_note_ties(e,t,u,l,n),0!=f.length){for(r=e.ts_next;r&&r.time<p;)r=r.ts_next;for(;r&&r.time==p;)if(r.type==NOTE&&r.st==e.st){for(u.length=0,l.length=0,i=f.length;--i>=0;)for(s=f[i],o=e.notes[s].apit,a=r.nhd;a>=0;a--)if(r.notes[a].apit==o){u.push(s),l.push(a),f[i]=f.pop();break}if(u.length>0&&(draw_note_ties(e,r,u,l,1==n?1:0),0==f.length))return;r=r.ts_next}else r=r.ts_next;0!=f.length&&error(1,e,"Bad tie")}}function tie_comb(e){var t,n,r;for(n=e.time+e.dur,r=e.st,t=e.ts_next;t;t=t.ts_next)if(t.st==r)if(t.time!=n){if(t.time>n)return e}else if(t.type==NOTE)return t;return null}function draw_all_ties(e){var t,n,r,i,s,a,o,c,u;for(t=e.sym;t;t=t.next){switch(t.type){case CLEF:case KEY:case METER:continue}break}for(a=e.s_rtie,n=t;n&&(!n.dur&&n.type!=GRACE);n=n.next)n.type==BAR&&n.text&&("1"==n.text[0]?a=e.s_tie:e.s_tie=a);if(n){for(e.s_tie&&(e.s_tie.x=t.x+t.wr,t=e.s_tie,delete e.s_tie,t.st=n.st,t.ts_next=n.ts_next,t.time=n.time-t.dur,draw_ties(t,n,1));;){for(t=n;t&&!t.ti1;t=t.next)if(a&&t.type==BAR&&t.text)if("1"!=t.text[0]){if("|"!=t.bar_type){for(n=t.next;n&&n.type!=NOTE;n=n.next);if(!n){t=null;break}o=clone(a),o.x=t.x+t.wr,o.next=n,o.st=n.st,o.time=n.time-o.dur,draw_ties(o,n,1)}}else a=null;if(!t)break;for(s=t.time+t.dur,n=t.next;n&&!n.dur;n=n.next);if(n){if(n.type!=NOTE){error(1,t,"Bad tie");continue}n.time!=s&&(n=tie_comb(t))}else{for(n=t.ts_next;n;n=n.ts_next)if(n.st==t.st&&!(n.time<s)){if(n.time>s){n=null;break}if(n.dur)break}if(!n){draw_ties(t,null,2),e.s_tie=t;break}}for(r=t.ts_next;r;r=r.ts_next)if(r.st==t.st){if(r.time>s)break;if(r.type!=CLEF){if(r.type==BAR){if(":"==r.bar_type[0]||"|]"==r.bar_type||"[|"==r.bar_type){n=r;break}if(!r.text)continue;if("1"!=r.text[0]){n=r;break}a=t}}else i=!0}i||t.st!=n.st?(i=!1,u=.4*(n.x-t.x),c=n.x,n.x-=u,n.x>t.x+32&&(n.x=t.x+32),draw_ties(t,n,2),n.x=c,c=t.x,t.x+=u,t.x<n.x-24&&(t.x=n.x-24),draw_ties(t,n,3),t.x=c):draw_ties(t,n,n.type==NOTE?0:2)}e.s_rtie=a}}function draw_all_slurs(e){var t,n,r,i=e.sym;if(i){var s=0;if(r=e.slur_start)for(;0!=r;)s<<=4,s|=15&r,r>>=4;for(delete e.slur_start,draw_slurs(i,void 0);i;i=i.next)if(i.type==NOTE||i.type==REST||i.type==SPACE)for(;i.slur_end||i.sl2;){if(i.slur_end)i.slur_end--,n=-1;else{for(n=0;n<=i.nhd&&!i.notes[n].sl2;n++);i.notes[n].sl2--,i.sl2--}r=15&s,t=prev_scut(i),draw_slur(t,i,-1,n,r),t.type==BAR&&(":"==t.bar_type[0]||"|]"==t.bar_type||"[|"==t.bar_type||t.text&&"1"!=t.text[0])||(s>>=4)}for(i=e.sym;0!=s;)r=15&s,s>>=4,t=next_scut(i),draw_slur(i,t,-1,-1,r),t.type==BAR&&(":"==t.bar_type[0]||"|]"==t.bar_type||"[|"==t.bar_type||t.text&&"1"!=t.text[0])||(e.slur_start<<=4,e.slur_start+=r)}}function draw_sym_near(){var e,t,n,r,i,s,a,o,c,u,i;for(r=0;r<voice_tb.length;r++){var l={},f=!0;for(e=voice_tb[r],n=e.sym;n;n=n.next){for(a=n.extra;a;a=a.next)a.type==NOTE&&a.beam_st&&!a.beam_end&&calculate_beam(l,a);n.type==NOTE&&(n.beam_st&&!n.beam_end||f&&!n.beam_st)&&(f=!1,calculate_beam(l,n))}}for(i=0;i<=nstaff;i++)for(t=staff_tb[i],t.top||(t.top=[],t.bot=[]),u=0;u<YSTEP;u++)t.top[u]=0,t.bot[u]=24;for(set_tie_room(),draw_deco_near(),n=tsfirst;n;n=n.ts_next)if(!n.invisible)if(n.type!=GRACE)n.type!=MREST?(y_set(n.st,!0,n.x-n.wl,n.wl+n.wr,n.ymx+2),y_set(n.st,!1,n.x-n.wl,n.wl+n.wr,n.ymn-2)):y_set(n.st,!0,n.x-16,32,n.ymx+2),n.type==NOTE&&(n.notes[n.nhd].acc&&(s=n.y+8,n.ymx<s&&(n.ymx=s),y_set(n.st,!0,n.x,0,s)),n.notes[0].acc&&(s=n.y,s-=1==n.notes[0].acc||3==n.notes[0].acc?7:5,n.ymn>s&&(n.ymn=s),y_set(n.st,!1,n.x,0,s)));else for(a=n.extra;a;a=a.next)y_set(n.st,!0,a.x-2,4,a.ymx+1),y_set(n.st,!1,a.x-2,4,a.ymn-1);for(cfmt.measurenb>=0&&draw_measnb(),draw_deco_note(),r=0;r<voice_tb.length;r++)if(e=voice_tb[r],n=e.sym){for(i=e.st,set_dscale(i);n;n=n.next)if(n.in_tuplet)for(a=n.extra;a;a=a.next)if(a.type==TUPLET){n=draw_tuplet(a,n);break}for(draw_all_slurs(e),n=e.sym;n;n=n.next)if(n.in_tuplet)for(a=n.extra;a;a=a.next)if(a.type==TUPLET){n=draw_tuplet(a,n);break}}for(i=0;i<=nstaff;i++)for(t=staff_tb[i],o=t.topbar+2,c=t.botbar-2,u=0;u<YSTEP;u++)o>t.top[u]&&(t.top[u]=o),c<t.bot[u]&&(t.bot[u]=c);for(r=0;r<voice_tb.length;r++)if(e=voice_tb[r],e.have_ly){draw_all_lyrics();break}draw_deco_staff(),set_sscale(-1)}function draw_vname(e){var t,n,r,i,s,a,o,c=[];for(r=cur_sy.nstaff;r>=0&&cur_sy.staves[r].empty;r--);if(!(0>r)){for(i=0;i<voice_tb.length;i++)if(t=voice_tb[i],t.sym&&(r=cur_sy.voices[i].st,cur_sy.staves[r]&&!cur_sy.staves[r].empty&&(t.new_name?(delete t.new_name,a=t.nm):a=t.snm,a))){if(cur_sy.staves[r].flags&CLOSE_BRACE2)for(;!(cur_sy.staves[r].flags&OPEN_BRACE2);)r--;else if(cur_sy.staves[r].flags&CLOSE_BRACE)for(;!(cur_sy.staves[r].flags&OPEN_BRACE);)r--;c[r]?c[r]+="\\n"+a:c[r]=a}if(0!=c.length)for(set_font("voice"),e=.5*-e,r=0;r<c.length;r++)if(c[r]){if(s=c[r].split("\\n"),o=staff_tb[r].y+.5*staff_tb[r].topbar*staff_tb[r].staffscale+9*(s.length-1)-.3*gene.curfont.size,n=r,cur_sy.staves[r].flags&OPEN_BRACE2)for(;!(cur_sy.staves[n].flags&CLOSE_BRACE2);)n++;else if(cur_sy.staves[r].flags&OPEN_BRACE)for(;!(cur_sy.staves[n].flags&CLOSE_BRACE);)n++;for(n!=r&&(o-=.5*(staff_tb[r].y-staff_tb[n].y)),n=0;n<s.length;n++)a=s[n],xy_str(e,o,a,"c"),o-=18}}}function set_staff(){var e,t,n,r,i,s,a,o,c,u,l,f,d,p,h=[];for(r=0;r<=nstaff;r++)staff_tb[r].empty=!1,h[r]=!0;for(t=cur_sy,r=0;r<t.staves.length;r++)t.staves[r].empty||(h[r]=!1);for(e=tsfirst;e;e=e.ts_next)if(e.new_sy)for(t=t.next,r=0;r<t.staves.length;r++)t.staves[r].empty||(h[r]=!1);for(s=0;s<voice_tb.length;s++)d=voice_tb[s],1!=d.scale&&(d.scale_str='transform="scale('+d.scale.toFixed(2)+')"');for(r=0;r<=nstaff&&h[r];r++)staff_tb[r].empty=!0;if(a=0,r>nstaff)r--;else for(p=staff_tb[r],n=0;n<YSTEP;n++)f=p.top[n],f>a&&(a=f);if(a+=draw_partempo(r,a),h[r])return a;o=.5*cfmt.staffsep+staff_tb[r].topbar*staff_tb[r].staffscale,o>a&&(a=o),p.y=-a,i=r;var m=t.staves[i];for(r++;r<=nstaff;r++)if(p=staff_tb[r],h[r])p.empty=!0;else{if(o=m.sep?m.sep:cfmt.sysstaffsep,u=m.maxsep?m.maxsep:cfmt.maxsysstaffsep,c=0,p.staffscale==staff_tb[i].staffscale){for(n=0;n<YSTEP;n++)f=p.top[n]-staff_tb[i].bot[n],f>c&&(c=f);c*=p.staffscale}else for(n=0;n<YSTEP;n++)f=p.top[n]*p.staffscale-staff_tb[i].bot[n]*staff_tb[i].staffscale,f>c&&(c=f);o+=p.topbar*p.staffscale,o>c&&(c=o),u+=p.topbar*p.staffscale,c>u&&(c=u),a+=c,p.y=-a,i=r,m=t.staves[i]}for(l=0,n=0;n<YSTEP;n++)f=staff_tb[i].bot[n],l>f&&(l=f);for(l*=staff_tb[i].staffscale,r=0;r<=nstaff;r++)p=staff_tb[r],c=p.y,1!=p.staffscale?(p.scale_str='transform="translate(0,'+(posy-c).toFixed(2)+") scale("+p.staffscale.toFixed(2)+')"',p.y_delayed=0):p.y_delayed=posy-c;if(0==l){for(r=nstaff;r>=0&&h[r];r--);if(0>r)return a}return c=-l,o=.5*cfmt.staffsep,o>c&&(c=o),u=.5*cfmt.maxstaffsep,c>u&&(c=u),a+=c,a>cfmt.maxstaffsep&&(a=cfmt.maxstaffsep),a}function bar_set(e,t){var n,r,i,s,a=0;for(n=0;n<=cur_sy.nstaff;n++)cur_sy.staves[n].empty?e[n]=t[n]=0:(r=staff_tb[n].staffscale,i=staff_tb[n].topbar*r,s=staff_tb[n].botbar*r,0==a&&(a=staff_tb[n].y+i),t[n]=a-staff_tb[n].y-s,e[n]=staff_tb[n].y+s,a=cur_sy.staves[n].flags&STOP_BAR?0:e[n])}function draw_systems(e){function t(e,t,n){var r,i,s=staff_tb[e].y,a=staff_tb[e].stafflines;if("."!=a[a.length-1]){for(set_sscale(e),r=(n-t)/stv_g.scale,i=0;i<a.length&&"."==a[i];i++)s+=6;for(xypath(t,s),output.push("h"+r.toFixed(2)),s=0,i++;i<a.length;i++)s-=6,"."!=a[i]&&(output.push("m-"+r.toFixed(2)+" "+s),output.push("h"+r.toFixed(2)),s=0);output.push('"/>\n')}}var n,r,i,s,a,o,c,u=[],l=[],f=[];for(draw_vname(e),s=0;s<=nstaff;s++)u[s]=!cur_sy.staves[s]||cur_sy.staves[s].empty?-1:0;for(bar_set(l,f),draw_lstaff(0),r=tsfirst;r;r=r.ts_next){if(r.new_sy){for(n=cur_sy.next,s=0;s<=nstaff;s++)if(a=u[s],0>a)n.staves[s]&&!n.staves[s].empty&&(r.type==BAR?u[s]=r.x:u[s]=r.x-r.wl-2);else{if(o=r.ts_prev.type==BAR?r.ts_prev.x:r.x-r.wl-2,!n.staves[s]||n.staves[s].empty)u[s]=-1;else{if(n.staves[s].stafflines==cur_sy.staves[s].stafflines)continue;u[s]=o}t(s,a,o)}cur_sy=n,c=bar_set(),l=c[0],f=c[1]}switch(s=r.st,r.type){case BAR:if((r.second||cur_sy.staves[s].empty)&&(r.invisible=!0),r.invisible)break;user.anno_start&&anno_start(r),draw_bar(r,l[s],f[s]),user.anno_stop&&anno_stop(r);break;case STBRK:if(0==cur_sy.voices[r.v].range&&r.xmx>14){for(var d=0,p=0;p<voice_tb.length;p++)cur_sy.voices[p].range>0&&d++;for(i=r.ts_next;i&&i.type==STBRK;i=i.ts_next)d--;0==d&&draw_lstaff(r.x)}if(i=r.prev,!i)break;if(o=i.x,i.type!=BAR&&(o+=i.wr),s=r.st,a=u[s],a>=0){if(a>=o)continue;t(s,a,o)}u[s]=r.x}}for(s=0;s<=nstaff;s++)(a=u[s])<0||t(s,a,realwidth)}function draw_symbols(e){var t,n,r,i,s,a,o={};for(a=!0,t=e.sym;t;t=t.next){if(t.extra)for(n=t.extra;n;n=n.next)n.type==FORMAT&&"voicecolor"==n.fmt_type&&(e.color=n.color,set_color(e.color));if(!t.invisible||t.type==NOTE||t.type==REST||t.type==GRACE)switch(r=t.x,t.type){case NOTE:set_color(e.color),set_scale(t),(t.beam_st&&!t.beam_end||a&&!t.beam_st)&&(a=!1,calculate_beam(o,t)&&draw_beams(o)),user.anno_start&&anno_start(t),draw_note(t,!o.s2),user.anno_stop&&anno_stop(t),t==o.s2&&(o.s2=null);break;case REST:set_color(e.color),set_scale(t),user.anno_start&&anno_start(t),draw_rest(t),user.anno_stop&&anno_stop(t);break;case BAR:break;case CLEF:if(s=t.st,t.second)break;if(t.invisible||staff_tb[s].empty)break;set_color(void 0),set_sscale(s),user.anno_start&&anno_start(t),i=staff_tb[s].y,t.clef_name?xygl(r,i+t.y,t.clef_name):t.clef_small?xygl(r,i+t.y,"s"+t.clef_type+"clef"):xygl(r,i+t.y,t.clef_type+"clef"),t.clef_octave&&(t.clef_octave>0?(i+=t.ymx-10,t.clef_small&&(i-=1)):(i+=t.ymn+2,t.clef_small&&(i+=1)),xygl(r-2,i,"oct")),user.anno_stop&&anno_stop(t);break;case METER:if(e.meter=t,t.second||staff_tb[t.st].empty)break;if(cfmt.alignbars&&0!=t.st)break;set_color(void 0),set_sscale(t.st),user.anno_start&&anno_start(t),draw_meter(r,t),user.anno_stop&&anno_stop(t);break;case KEY:if(e.key=t,t.second||staff_tb[t.st].empty)break;set_color(void 0),set_sscale(t.st),user.anno_start&&anno_start(t),draw_keysig(e,r,t),user.anno_stop&&anno_stop(t);break;case MREST:set_color(e.color),set_scale(t),xygl(r,staff_tb[t.st].y+12,"mrest"),output.push('<text style="font:bold 15px serif"\n	x ="'),out_sxsy(r,'" y="',staff_tb[t.st].y+28),output.push('" text-anchor="middle">'+t.nmes+"</text>\n");break;case GRACE:set_color(e.color),set_scale(t),draw_gracenotes(t);break;case SPACE:case STBRK:case FORMAT:break;case CUSTOS:set_color(e.color),set_scale(t),t.stemless=!0,draw_note(t,0);break;default:error(2,t,"draw_symbols - Cannot draw symbol "+t.type)}}set_color(e.color),set_scale(e.sym),draw_all_ties(e),set_color(void 0)}function draw_all_sym(){var e,t,n,r=voice_tb.length;for(n=0;r>n;n++)e=voice_tb[n],e.sym&&draw_symbols(e);for(t=tsfirst;t;t=t.ts_next)t.type==CLEF&&(staff_tb[t.st].clef=t)}function set_tie_dir(e){var t,n,r,i,s,a,o;for(t=e;t;t=t.next)if(t.ti1)if(0==t.multi){for(s=r=0,a=128,n=0;n<=t.nhd;n++)t.notes[n].ti1&&(r++,128>a&&t.notes[n].pit<=a+1&&s++,a=t.notes[n].pit);if(1>=r){for(i=t.stem<0?SL_ABOVE:SL_BELOW,n=0;n<=t.nhd;n++)if(o=t.notes[n].ti1){(7&o)==SL_AUTO&&(t.notes[n].ti1=o&SL_DOTTED|i);break}}else if(0!=s){for(a=128,n=0;n<=t.nhd;n++)if(t.notes[n].ti1){if(128>a&&t.notes[n].pit<=a+1){r=n;break}a=t.notes[n].pit}for(i=SL_BELOW,n=0;n<=t.nhd;n++)o=t.notes[n].ti1,0!=o&&(r==n&&(i=SL_ABOVE),(7&o)==SL_AUTO&&(t.notes[n].ti1=o&SL_DOTTED|i))}else{if(1&r){for(r=(r-1)/2,i=SL_BELOW,n=0;n<=t.nhd;n++)o=t.notes[n].ti1,0!=o&&(0==r&&t.notes[n].pit>=22&&(i=SL_ABOVE),(7&o)==SL_AUTO&&(t.notes[n].ti1=o&SL_DOTTED|i),0==r--&&(i=SL_ABOVE));continue}for(r/=2,i=SL_BELOW,n=0;n<=t.nhd;n++)o=t.notes[n].ti1,0!=o&&((7&o)==SL_AUTO&&(t.notes[n].ti1=o&SL_DOTTED|i),0==--r&&(i=SL_ABOVE))}}else for(i=t.multi>0?SL_ABOVE:SL_BELOW,n=0;n<=t.nhd;n++)o=t.notes[n].ti1,(7&o)==SL_AUTO&&(t.notes[n].ti1=o&SL_DOTTED|i)}function set_tie_room(){var e,t,n,r,i,s,a;for(r=0;r<voice_tb.length;r++)if(e=voice_tb[r],t=e.sym,t&&(t=t.next))for(set_tie_dir(t);t;t=t.next)if(t.ti1){if(t.notes[0].pit<20&&(7&t.notes[0].ti1)==SL_BELOW);else if(!(t.notes[t.nhd].pit>24&&(7&t.notes[t.nhd].ti1)==SL_ABOVE))continue;for(n=t.next;n&&n.type!=NOTE;)n=n.next;if(n){if(n.st!=t.st)continue;i=n.x-t.x-10}else i=realwidth-t.x-10;a=100>i?9:300>i?12:16,t.notes[t.nhd].pit>24&&(s=3*(t.notes[t.nhd].pit-18)+a,t.ymx<s&&(t.ymx=s),n&&n.ymx<s&&(n.ymx=s),y_set(t.st,!0,t.x+5,i,s)),t.notes[0].pit<20&&(s=3*(t.notes[0].pit-18)-a,t.ymn>s&&(t.ymn=s),n&&n.ymn>s&&(n.ymn=s),y_set(t.st,!1,t.x+5,i,s))}}function get_bool(e){return!e.match(/^(0|n|f)/i)}function get_int(e){var t=parseInt(e);return isNaN(t)&&(parse.line.error("Bad integer value\n"),t=1),t}function get_font_scale(e){var t=e.split(/\s+/);if(!(t.length<=1)){var n=parseFloat(t[t.length-1]);if(isNaN(n)||0>=t)return void parse.line.error("Bad scale value in %%font");font_scale_tb[t[0]]=n;for(var r in font_tb){var i=font_tb[r];i.name==t[0]&&(i.swfac=i.size*n)}}}function param_set_font(e,t){var n,r,i,s,a,o,c,u,l;if("-"==e[e.length-2]){if(s=e[e.length-1],"1">s||s>"9")return;e="u"+s+"font"}r=cfmt[e],r&&(n=font_tb[r],n&&(i=n.name+"."+n.size)),a=t.split(/\s+/),o=a[0],"*"==o&&n?o=n.name:(o=o.replace("Times-Roman","serif"),o=o.replace("Times","serif"),o=o.replace("Helvetica","sans-serif"),o=o.replace("Courier","monospace")),a.length>1?(u=a[a.length-1],"*"==u&&(u=n.size)):u=n.size,c=o+"."+u,c!=i&&(n=font_tb[c],n||(l=font_scale_tb[o],l||(l=1.1),n={name:o,size:Number(u),swfac:u*l},font_tb[c]=n),cfmt[e]=c)}function get_unit(e){var t=parseFloat(e);switch(e.slice(-2)){case"CM":case"cm":t*=28.35;break;case"IN":case"in":t*=72}return t}function get_unitp(e){var t=parseFloat(e);switch(e.slice(-2)){case"CM":case"cm":t*=CM;break;case"IN":case"in":t*=IN}return t}function set_infoname(e){for(var t=cfmt.infoname.split("\n"),n=e[0],r=0;r<t.length;r++){var i=t[r];if(i[0]==n)return 1==e.length?t.splice(r,1):t[r]=e,void(cfmt.infoname=t.join("\n"))}cfmt.infoname+="\n"+e}function get_textopt(e){return textopt[e]}function set_pos(e,t){var n,r,i;switch(r=t[0]>="0"&&t[0]<="3"?parseInt(t):posval[t]||0,e[0]){case"d":e="dyn";break;case"g":e="c"==e[1]?"gch":"gst";break;case"o":e="orn";break;case"s":e="ste";break;case"v":e="c"==e[2]?"voc":"vol";break;default:return}if(i=curvoice?curvoice.pos:cfmt.pos,i[e]=r,!curvoice)for(n=0;n<voice_tb.length;n++)voice_tb[n].pos[e]=r}function set_writefields(e){var t,n,r=e.split(/\s+/);if(get_bool(r[1]))for(n=0;n<r[0].length;n++)t=r[0][n],cfmt.writefields.indexOf(t)<0&&(cfmt.writefields+=t);else for(n=0;n<r[0].length;n++)t=r[0][n],cfmt.writefields.indexOf(t)>=0&&(cfmt.writefields=cfmt.writefields.replace(t,""))}function set_format(e,t,n){function r(e,t){return curvoice?void(curvoice[e]=t):0==parse.state?void(cfmt["voice"+e]=t):(parse.voice_param||(parse.voice_param={}),void(parse.voice_param[e]=t))}var s,a,o,c;if(n)n[e]=!0;else if(n[e])return;if(e.match(/.+font$/)||e.match(/.+font-[\d]$/)){if(" box"==t.slice(-4)&&(c=!0,t=t.slice(0,-4)),param_set_font(e,t),c)switch(e){case"gchordfont":cfmt.gchordbox=c;break;case"measurefont":cfmt.measurebox=c;break;case"partsfont":cfmt.partsbox=c}}else switch(e){case"aligncomposer":case"barsperstaff":case"infoline":case"measurefirst":case"measurenb":case"rbmax":case"rbmin":case"shiftunison":case"staffnonote":cfmt[e]=get_int(t);break;case"microscale":if(s=get_int(t),4>s||s>256||s%1){parse.line.error("Bad value for "+e);break}if(cfmt.microscale=s,0==parse.state)break;if(1==parse.state)for(o=0;o<voice_tb.length;o++)voice_tb[o].microscale=cfmt.microscale;else 2==parse.state&&goto_tune(),curvoice.microscale=cfmt.microscale;break;case"bgcolor":case"dblrepbar":case"titleformat":cfmt[e]=t;break;case"breaklimit":case"lineskipfac":case"maxshrink":case"pagescale":case"parskipfac":case"scale":case"slurheight":case"stemheight":case"stretchlast":if(s=parseFloat(t),!s){parse.line.error("Bad value for "+e);break}"scale"==e?s/=.75:"pagescale"==e&&(e="scale"),cfmt[e]=s;break;case"bstemdown":case"breakoneoln":case"cancelkey":case"custos":case"decoerr":case"dynalign":case"flatbeams":case"gchordbox":case"graceslurs":case"hyphencont":case"keywarn":case"linewarn":case"measurebox":case"partsbox":case"singleline":case"squarebreve":case"straightflags":case"stretchstaff":case"timewarn":case"titlecaps":case"titleleft":case"titletrim":cfmt[e]=get_bool(t);break;case"composerspace":case"indent":case"infospace":case"maxstaffsep":case"maxsysstaffsep":case"musicspace":case"partsspace":case"staffsep":case"subtitlespace":case"sysstaffsep":case"textspace":case"titlespace":case"topspace":case"vocalspace":case"wordsspace":cfmt[e]=get_unit(t);break;case"leftmargin":case"pagewidth":case"rightmargin":cfmt[e]=get_unitp(t);break;case"contbarnb":cfmt.contbarnb=get_int(t);break;case"writefields":set_writefields(t);break;case"dynamic":case"gchord":case"gstemdir":case"ornament":case"stemdir":case"vocal":case"volume":set_pos(e,t);break;case"font":get_font_scale(t);break;case"fullsvg":if(0!=parse.state){parse.line.error("Cannot have 'fullsvg' inside a tune");break}cfmt[e]=t;break;case"gracespace":case"tuplets":cfmt[e]=t.split(/\s+/);break;case"infoname":set_infoname(t);break;case"notespacingfactor":if(s=parseFloat(t),!s||1>s||s>2){parse.line.error("Bad value for notespacingfactor");break}for(i=5,a=space_tb[i];--i>=0;)a/=s,space_tb[i]=a;for(i=5,a=space_tb[i];++i<space_tb.length;)a*=s,space_tb[i]=a;break;case"pos":e=t.match(/(\w|-)+/),e=e[0],t=t.replace(e,"").trim(),set_pos(e,t);break;case"staffwidth":o=cfmt.pagewidth-get_unitp(t)-cfmt.leftmargin,0>o?parse.line.error("'staffwidth' too big"):cfmt.rightmargin=o;break;case"textoption":cfmt[e]=get_textopt(t);break;case"combinevoices":case"voicecombine":if(o=parseInt(t),isNaN(o)||-1>o||o>2)return void parse.line.error("Bad value in %%voicecombine");if(curvoice&&"combinevoices"==e)for(s=0;s<voice_tb.length;s++)voice_tb[s].combine=o;r("combine",o);break;case"voicemap":r("map",t);break;case"voicescale":if(o=parseFloat(t),isNaN(o)||.6>o||o>1.5)return void parse.line.error("Bad %%voicescale value");r("scale",o)}}function font_init(){param_set_font("annotationfont","sans-serif 12"),param_set_font("composerfont","serifItalic 14"),param_set_font("gchordfont","sans-serif 12"),param_set_font("historyfont","serif 16"),param_set_font("infofont","serifItalic 14"),param_set_font("measurefont","serifItalic 14"),param_set_font("partsfont","serif 15"),param_set_font("repeatfont","serif 13"),param_set_font("subtitlefont","serif 16"),param_set_font("tempofont","serifBold 15"),param_set_font("textfont","serif 16"),param_set_font("titlefont","serif 20"),param_set_font("vocalfont","serifBold 13"),param_set_font("voicefont","serifBold 13"),param_set_font("wordsfont","serif 16")}function style_add_font(e){var t=e.name,n=t.indexOf("Italic"),r=100,i=t.indexOf("Oblique"),s=t.indexOf("Bold");font_style+="\n.f"+e.fid+cfmt.fullsvg+" {font:",s>0&&(font_style+="bold ",r=s),(n>0||i>0)&&(n>0&&(font_style+="italic ",r>n&&(r=n)),i>0&&(font_style+="oblique ",r>i&&(r=i))),100!=r&&("-"==t[r-1]&&r--,t=t.slice(0,r)),font_style+=e.size+"px "+t+"}"}function use_font(e){defined_font[e.fid]||(defined_font[e.fid]=!0,style_add_font(e))}function get_font(e){e+="font";var t=cfmt[e],n=font_tb[t];return n?(n.fid||(n.fid=fid++),use_font(n),n):(parse.line.error("Unknown font "+e),null)}function cnv_escape(e){for(var t,n,r,i,s="",a=0;;){if(r=e.indexOf("\\",a),0>r)break;if(s+=e.slice(a,r),t=e[++r],void 0==t)return s+"\\";switch(t){case"0":case"2":if("0"==e[r+1])switch(e[r+2]){
case"1":s+="",a=r+3;continue;case"2":s+="",a=r+3;continue;case"3":s+="",a=r+3;continue;case"4":i=[55348,56618],s+=String.fromCharCode.apply(null,i),a=r+3;continue;case"5":i=[55348,56619],s+=String.fromCharCode.apply(null,i),a=r+3;continue}case"1":case"3":if(e[r+1]>="0"&&e[r+1]<="7"&&e[r+2]>="0"&&e[r+2]<="7"){a=parseInt(e.slice(r,r+3),8),s+=String.fromCharCode(a),a=r+3;continue}break;case"u":i=[],a=parseInt(e.slice(r+1,r+5),16),i.push(a),a>=55296&&57343>=a?(a=parseInt(e.slice(r+7,r+11),16),i.push(a),a=r+11):a=r+5,s+=String.fromCharCode.apply(null,i);continue;default:if(n=abc_utf[e.slice(r,r+2)]){s+=n,a=r+2;continue}}s+="\\"+t,a=r+1}return s+e.slice(a)}function do_include(e){var t,n;return user.read_file?0>=include?void syntax(1,"Too many include levels"):(include--,(t=user.read_file(e))?(n=clone(parse),tosvg(e,t),parse=n,void include++):void error(1,void 0,"Cannot read file '"+e+"'")):void syntax(1,"No read_file support")}function tosvg(e,t){function n(){for(f=u;l>f&&(c=t[f]," "==c||"	"==c);)f++}function r(){for(d=l-1;d>u&&(c=t[d]," "==c||"	"==c);)d--;d++}function i(){var e=t.indexOf("K:",u);return 0>e?!1:(e=t.indexOf("\n",e),parse.select.test(t.slice(u,e))?!0:(l=t.indexOf("\n\n",e),0>l?l=B-1:l++,!1))}function s(e,t){var n,r,i,s;for(t&&e.indexOf("\\")>=0&&(e=cnv_escape(e)),s=e.length,n=0;s>n;n++){switch(i=e[n]){case"\\":n++;continue;case"%":return e.slice(0,n).replace(/\s+$/,"");case'"':break;default:continue}for(r=n+1;(r=e.indexOf('"',r),!(0>r))&&"\\"==e[r-1];);if(0>r)break;n=r}return e=e.replace(/\s+$/,""),e.replace(/\\%/g,"%")}function a(){gen_ly(!1),put_history(),blk_out(),blk_flush(),parse.state=0,cfmt=E,posx=cfmt.leftmargin/cfmt.scale,info=C,char_tb=T,glovar=S,maps=O,init_tune()}var o,c,u,l,f,d,p,h,m,v,g,y,_,b,x,w,k,E,C,T,S,O,A,N="\n",B=t.length;for(parse.file=t,parse.ctx={fname:e},line=new scanBuf,parse.line=line,line.buffer=t,line.index=0,u=0,u=0;!(u>=B);u=l+1)if(l=t.indexOf("\n",u),0>l&&(l=B),l!=u){if(parse.istart=parse.bol=u,parse.iend=parse.eol=l,v=t[u],g=t[u+1],"%"==v){if(parse.prefix.indexOf(g)<0)continue;"a"==t[u+2]&&"b"==t[u+3]&&"c"==t[u+4]&&" "==t[u+5]?(u+=6,v=t[u],g=t[u+1]):A=!0}else"I"==v&&":"==g&&(A=!0);if(A){if(A=!1,u+=2,n(),r(),b=t.slice(f,d),!b||"%"==b[0])continue;switch(x=b.split(/\s+/,2),x[0]||x.shift(),x[0]){case"abcm2ps":parse.prefix=x[1];continue;case"abc-include":if(h=x[1].match(/.*\.(.*)/),!h)continue;switch(h[1]){case"abc":do_include(x[1])}continue}if(w=x[0].match(/begin(.*)/)){if(p="\n"+v+g+"end"+w[1],o=t.indexOf(p,l),0>o){syntax(1,"No "+p.slice(1)+" after %%"+w[0]),l=B;continue}do_begin_end(w[1],x[1],parse.file.slice(l+1,o).replace(new RegExp("^"+v+g,"gm"),"")),l=t.indexOf("\n",o+6),0>l&&(l=B);continue}switch(x[0]){case"select":if(0!=parse.state){syntax(1,"%%select ignored");continue}m=s(b.slice(7).trim(),!1),'"'==m[0]&&(m=m.slice(1,-1)),m=m.replace(/\(/g,"\\("),m=m.replace(/\)/g,"\\)"),parse.select=new RegExp(m,"m");continue;case"tune":syntax(1,"%%tune not treated yet");continue;case"voice":if(0!=parse.state){syntax(1,"%%voice ignored");continue}if(m=s(b.slice(6).trim(),!1),!m){parse.cur_tune_opts?parse.cur_tune_opts.voice_opts=null:parse.voice_opts=null;continue}if("end"==m)continue;for(parse.cur_tune_opts?(parse.cur_tune_opts.voice_opts||(parse.cur_tune_opts.voice_opts={}),_=parse.cur_tune_opts.voice_opts):(parse.voice_opts||(parse.voice_opts={}),_=parse.voice_opts),_[m]=[];;){if(u=++l,"%"!=t[u])break;if(l=t.indexOf("\n",l),t[u+1]==g){switch(u+=2,b=0>l?t.slice(u):t.slice(u,l),x=b.split(/\s+/,1),x[0]){default:_[m].push(s(b.trim(),!0));continue;case"score":case"staves":case"tune":case"voice":u-=2}break}}l=u-1;continue}do_pscom(s(b.trim(),!0))}else if(":"==g){if(b=t.slice(u+2,l),b=s(b.trim(),!0),"+"==v&&":"==g){if(!y){syntax(1,"No previous info field");continue}N=" ",v=y}switch(v){case"X":if(0!=parse.state){syntax(1,"X: found in tune - ignored");continue}if(parse.select&&!i())continue;E=clone(cfmt),cfmt.pos=clone(cfmt.pos),C=clone(info),T=clone(char_tb),S=clone(glovar),O=maps,info.X=b,parse.state=1;continue;case"T":if(0==parse.state)continue;if(curvoice=voice_tb[0],!curvoice){void 0==info.T?info.T=b:info.T+="\n"+b;continue}k={type:BLOCK,subtype:"title",text:b},sym_link(k);continue;case"K":if(0==parse.state)continue;if(1==parse.state?info.K=b:2==parse.state&&goto_tune(),parse.line.buffer=b,parse.line.index=0,do_info(v,b),1!=parse.state)continue;parse.state=2,glovar.ulen||(glovar.ulen=BASE_LEN/8);continue;case"W":if(0==parse.state||cfmt.writefields.indexOf("W")<0)break;info.W?info.W+=N+b:info.W=b;break;case"s":if(3!=parse.state)break;break;case"w":if(3!=parse.state||cfmt.writefields.indexOf("w")<0)break;if(get_lyrics(b," "==N),"\\"==b[b.length-1]){N=" ",y=v;continue}break;case"|":if(3!=parse.state){if(2!=parse.state)continue;goto_tune()}parse_music_line();continue;default:if("ABCDFGHOSZ".indexOf(v)>=0){if(parse.state>=2){syntax(1,v+": in tune - ignored");continue}info[v]?info[v]+=N+b:info[v]=b;break}parse.line.buffer=b,parse.line.index=0,do_info(v,b);continue}N="\n",y=v}else{if(y=void 0,3!=parse.state){if(2!=parse.state)continue;goto_tune()}parse_music_line()}}else 1==parse.state?(parse.istart=u,syntax(1,"Empty line in tune header - ignored")):parse.state>=2&&a();parse.state>=2&&a(),blk_flush(),parse.state=0}function set_head_shift(e){var t,n,r,i,s,a,o=dx_tb[e.head],c=e.stem,u=e.nhd;if(e.dur>=2*BASE_LEN&&"oval"==e.head&&(o=15.8),0==u)return void(e.notes[0].acc&&(e.grace&&(o*=.7),e.notes[0].shac=o));a=.78*o,e.grace&&(a*=.5),c>=0?(n=1,r=u+1,s=e.notes[0].pit):(a=-a,n=u-1,r=-1,s=e.notes[u].pit);var l=!1,f=0;for(t=n;t!=r;t+=c){if(i=e.notes[t].pit-s,s=e.notes[t].pit,0==i){if(l){var d=e.notes[t].shhd=e.notes[t-c].shhd+a;d>f&&(f=d);continue}if(t+c!=r&&s+c==e.notes[t+c].pit){e.notes[t].shhd=-a,-a>f&&(f=-a);continue}}0>i&&(i=-i),i>3||i>=2&&"square"!=e.head?l=!1:(l=!l,l&&(e.notes[t].shhd=a,a>f&&(f=a)))}e.xmx=f}function set_acc_shft(){function e(e,t){var n,r,i,s,a,o,c,u=e.length;for(n=u-1;--n>=0;)if(i=e[n].shhd,i&&!(i>0))for(i=t-i,a=e[n].pit,r=u;--r>=0;)if(e[r].acc){if(o=e[r].pit,a-3>o)break;o>a+3||e[r].shac<i&&(e[r].shac=i)}for(n=u;--n>=0;)if(c=e[n].acc){for(i=e[n].shac,i||(i=e[n].shhd,i=0>i?t-i:t),a=e[n].pit,r=u;--r>n;)e[r].acc&&(o=e[r].pit,o>=a+4&&(o>a+4||0>c||e[r].acc<0)||i>e[r].shac-6&&(s=e[r].shac+7,s>i&&(i=s)));e[n].shac=i}}var t,n,r,i,s,r,a,o;for(t=tsfirst;t;)if(t.type!=NOTE||t.invisible)t=t.ts_next;else{for(r=t.st,a=t.time,s=!1,n=t;n&&(n.time==a&&n.type==NOTE&&n.st==r);n=n.ts_next)if(!s)for(i=0;i<=n.nhd;i++)if(n.notes[i].acc){s=!0;break}if(s){for(o=dx_tb[t.head],t.dur>=2*BASE_LEN&&"oval"==t.head&&(o=15.8),r={notes:[]};t!=n;t=t.ts_next)r.notes=r.notes.concat(t.notes);sort_pitch(r),e(r.notes,o)}else t=n}}function unlksym(e){if(e.next){if(e.next.prev=e.prev,e.extra){var t=e.next.extra;if(t){for(;t.next;t=t.next);t.next=e.extra}else e.next.extra=e.extra}}else if(e.extra)return e.type=FORMAT,void(e.fmt_type=void 0);e.prev?e.prev.next=e.next:voice_tb[e.v].sym=e.next,e.ts_next&&(e.seqst&&!e.ts_next.seqst&&(e.ts_next.seqst=!0,e.ts_next.shrink=e.shrink,e.ts_next.space=e.space),e.new_sy&&(e.ts_next.new_sy=!0),e.ts_next.ts_prev=e.ts_prev),e.ts_prev&&(e.ts_prev.ts_next=e.ts_next),tsfirst==e&&(tsfirst=e.ts_next),tsnext==e&&(tsnext=e.ts_next)}function may_combine(e){var t,n=e.ts_next;return!n||n.type!=NOTE&&n.type!=REST?!1:n.v==e.v||n.st!=e.st||n.time!=e.time||n.dur!=e.dur?!1:e.combine<=0&&n.type!=e.type?!1:e.a_gch&&n.a_gch?!1:e.type==REST?e.type==n.type&&e.invisible&&!n.invisible?!1:!0:n.a_ly||n.sl1||n.sl2||n.slur_start||n.slur_end?!1:n.beam_st!=e.beam_st||n.beam_end!=e.beam_end?!1:(t=n.nhd,e.combine<=1&&e.notes[0].pit<=n.notes[t].pit+1?!1:!0)}function combine_notes(e,t){var n,r,i;if(e.notes=e.notes.concat(t.notes),e.nhd=n=e.notes.length-1,sort_pitch(e),e.combine>=3){for(i=n;i>0;i--)e.notes[i].pit==e.notes[i-1].pit&&e.notes[i].acc==e.notes[i-1].acc&&e.notes.splice(i,1);e.nhd=n=e.notes.length-1}e.ymx=3*(e.notes[n].pit-18)+4,e.ymn=3*(e.notes[0].pit-18)-4,e.yav=(e.ymx+e.ymn)/2,e.a_dd?t.a_dd&&(e.a_dd=e.a_dd.concat(t.a_dd)):e.a_dd=t.a_dd,r=e.notes[0].ti1,(15&r)==SL_AUTO&&(e.notes[0].ti1=SL_BELOW|r&~SL_DOTTED),r=e.notes[n].ti1,(15&r)==SL_AUTO&&(e.notes[n].ti1=SL_ABOVE|r&~SL_DOTTED)}function do_combine(e){for(var t,n,r;;)if(n=e.nhd,t=e.ts_next,r=t.nhd,delete t.extra,e.type!=t.type?t.type!=REST&&(t=e,e=t.ts_next):e.type==REST?e.invisible&&!t.invisible&&delete e.invisible:combine_notes(e,t),t.text&&!e.text&&(e.text=t.text,e.a_gch=t.a_gch),unlksym(t),e.in_tuplet||!may_combine(e))break}function combine_voices(){var e,t,n,r,i;for(e=tsfirst;e.ts_next;e=e.ts_next)if(!(e.combine<0||0==e.combine&&e.type!=REST))if(e.in_tuplet){if(n=e.extra,!n)continue;for(i=0;n;n=n.next)n.type==TUPLET&&n.tuplet_r>i&&(i=n.tuplet_r);if(0==i)continue;for(r=i,t=e;t&&t.ts_next;t=t.next)if(t.type==NOTE||t.type==REST){if(!may_combine(t))break;if(--r<=0)break}if(r>0)continue;for(t=e;t.type!=NOTE&&t.type!=REST||(do_combine(t),!(--i<=0));t=t.next);}else if(e.type==NOTE){if(e.beam_st)if(e.beam_end)may_combine(e)&&do_combine(e);else{for(t=e;;){if(!may_combine(t)){t=null;break}if(t.beam_end)break;do t=t.next;while(t.type!=NOTE&&t.type!=REST)}if(t)for(t=e;;){if(do_combine(t),t.beam_end)break;do t=t.next;while(t.type!=NOTE&&t.type!=REST)}}}else e.type==REST&&may_combine(e)&&do_combine(e)}function insert_clef(e,t,n){var r,i=voice_tb[e.v],s=e.st;for(e.type==BAR&&e.prev&&e.prev.type==BAR&&(e=e.prev),i.last_sym=e.prev,i.last_sym||(i.sym=null),i.time=e.time,r=sym_add(i),r.type=CLEF,r.next=e,e.prev=r,r.clef_type=t,r.clef_line=n,r.st=s,r.clef_small=!0,r.second=void 0,r.notes=[],r.notes[0]={pit:e.notes[0].pit},r.nhd=0;!e.seqst;)e=e.ts_prev;return e.ts_prev.type!=CLEF&&(r.seqst=!0),r.ts_prev=e.ts_prev,r.ts_prev.ts_next=r,r.ts_next=e,e.ts_prev=r,r}function set_float(){var e,t,n,r,i,s,a,o;for(r=0;r<voice_tb.length;r++)if(e=voice_tb[r],e.floating)for(n=!1,t=e.st,i=e.sym;i;i=i.next)if(i.type==NOTE)if(i.floating)if(i.notes[0].pit>=19)n=!1;else if(i.notes[i.nhd].pit<=12)n=!0,i.st++;else{for(a=127,s=i.ts_prev;s&&(s.st==t&&s.v!=i.v);s=s.ts_prev)s.type==NOTE&&s.notes[0].pit<a&&(a=s.notes[0].pit);if(127!=a)if(i.notes[i.nhd].pit>a-3)n=!1;else{for(o=-127,s=i.ts_next;s&&(s.st==t+1&&s.v!=i.v);s=s.ts_next)s.type==NOTE&&s.notes[s.nhd].pit>o&&(o=s.notes[s.nhd].pit);if(-127!=o)if(i.notes[0].pit<o+3)n=!0,i.st++;else{if(a-=i.notes[i.nhd].pit,o=i.notes[0].pit-o,n){if(o-3>a){n=!1;continue}}else{if(o+3>a)continue;n=!0}i.st++}else n&&i.st++}else n&&i.st++}else n=!1;else n&&i.st++}function set_graceoffs(e){var t,n,r,i,s,a,o;for(s=Number(cfmt.gracespace[0]),a=Number(cfmt.gracespace[1]),o=Number(cfmt.gracespace[2]),i=0,t=e.extra;t.type!=NOTE;t=t.next);for(t.beam_st=!0;;t=t.next)if(t.type==NOTE){for(set_head_shift(t),r=t.nhd;r>=0;r--)if(t.notes[r].acc){i+=5,t.notes[r].micro&&(i+=2);break}if(t.x=i,t.nflags<=0&&(t.beam_st=!0,t.beam_end=!0),n=t.next,!n){t.beam_end=!0;break}n.nflags<=0&&(t.beam_end=!0),t.beam_end&&(n.beam_st=!0,i+=a/4),t.nflags<=0&&(i+=a/4),t.y>n.y+8&&(i-=1.5),i+=a}else if(!t.next)break;return i+=s+o,n=e.next,n&&n.type==NOTE&&(t.y>=3*(n.notes[n.nhd].pit-18)?i-=1:t.beam_st&&t.y<3*(n.notes[0].pit-18)-7&&(i+=2)),i}function gchord_width(e,t,n){for(var r,i,s,a,o=0,c=0,u=0;u<e.a_gch.length;u++)switch(i=e.a_gch[u],i.type){default:a=-i.x,a>o&&(o=a),s=i.w+2-a,s>c&&(c=s);break;case"<":s=i.w+t,s>o&&(o=s);break;case">":s=i.w+e.wr,s>c&&(c=s)}if(r=e.prev,r&&r.a_gch)for(r=e.ts_prev;;r=r.ts_prev){if(r==e.prev){o>n&&(n=o);break}r.seqst&&(o-=r.shrink)}if(r=e.next,r&&r.a_gch)for(r=e.ts_next;;r=r.ts_next){if(r==e.next){e.wr<c&&(e.wr=c);break}r.seqst&&(c-=8)}return n}function set_width(e){var t,n,r,i,s,a,o,c;switch(e.type){case NOTE:case REST:switch(e.head){default:a=8;break;case"oval":a=6;break;case"empty":a=5;break;case"full":a=4.5}if(e.wr=a,e.xmx>0&&(e.wr+=e.xmx+4),t=e.prev)switch(t.type){case BAR:case CLEF:case KEY:case METER:a+=3}for(r=0;r<=e.nhd;r++)if(i=e.notes[r].shhd,0>i&&-i+5>a&&(a=-i+5),e.notes[r].acc){var u=e.notes[r].shac+(e.notes[r].micro?6.5:4.5);u>a&&(a=u)}if(t)switch(t.type){case BAR:case CLEF:case KEY:case METER:a-=3}if(e.a_dd&&(a+=deco_width(e)),e.beam_st&&e.beam_end&&e.stem>0&&e.nflags>0&&e.wr<e.xmx+9&&(e.wr=e.xmx+9),e.dots>0){switch(e.head){case"square":case"oval":e.xmx+=2;break;case"empty":e.xmx+=1}e.wr<e.xmx+12&&(e.wr=e.xmx+12),e.dots>=2&&(e.wr+=3.5*(e.dots-1))}if(e.trem2&&e.beam_end&&20>a&&(a=20),o=a,t)switch(t.type){case NOTE:t.stem>0&&e.stem<0&&7>o&&(o=7),(e.y>27&&t.y>27||e.y<-3&&t.y<-3)&&6>o&&(o=6),t.ti1&&14>o&&(o=14);break;case CLEF:if(t.second||t.clef_small)break;o+=8;break;case KEY:o+=4}return e.a_gch&&(o=gchord_width(e,a,o)),e.a_ly&&(o=ly_width(e,o)),void(t&&t.type==GRACE?e.wl=a-4.5:e.wl=o);case SPACE:return i=e.width/2,e.wr=i,e.a_gch&&(i=gchord_width(e,i,i)),e.a_dd&&(i+=deco_width(e)),void(e.wl=i);case BAR:if(e.norepbra)break;if(e.invisible)e.wl=e.wr=0;else{var l=e.bar_type;switch(l){case"|":s=8;break;case"|:":case":|":s=16;break;case"::":s=24;break;default:if(!l)break;for(s=5+3*l.length,n=0;n<l.length;n++)switch(l[n]){case"[":case"]":s+=3;break;case":":s+=2}}e.wl=s,e.next&&e.next.type!=METER?e.wr=8:e.wr=5}return e.a_dd&&(e.wl+=deco_width(e)),void(e.a_gch&&e.a_gch[0].text.length<4&&(e.wl=gchord_width(e,e.wl,e.wl)));case CLEF:if(e.invisible)break;return e.wl=12,void(e.wr=e.clef_small?10:12);case KEY:var f,d,p;if(e.wl=3,p=4,e.k_a_acc){f=d=e.k_a_acc.length;var h=e.k_a_acc[0].acc;for(n=1;d>n;n++)c=e.k_a_acc[n],c.pit>e.k_a_acc[n-1].pit+6||c.pit<e.k_a_acc[n-1].pit-6?f--:c.acc!=h&&(p+=3),h=c.acc}else f=e.k_sf,d=e.k_old_sf&&(cfmt.cancelkey||0==f)?e.k_old_sf:0,f*d>=0?(0>f&&(f=-f),0>d&&(d=-d),d>f&&(f=d)):(f-=d,0>f&&(f=-f),p+=3);return void(e.wr=5.5*f+p);case METER:for(s=0,n=0;n<e.a_meter.length;n++){var m=e.a_meter[n];s+="C|"==m.top?6.5:!m.bot||m.top.length>m.bot.length?6.5*m.top.length:6.5*m.bot.length}return e.wl=s,void(e.wr=s+7);case MREST:return e.wl=36,void(e.wr=36);case GRACE:return e.wl=set_graceoffs(e),void(e.wr=0);case STBRK:return e.wl=e.xmx,void(e.next&&e.next.type==CLEF?(e.wr=2,delete e.next.clef_small):e.wr=8);case FORMAT:return e.wl=6,void(e.wr=0);default:error(2,e,"set_width - Cannot set width for symbol "+e.type)}e.wl=e.wr=0}function set_space(e){var t,n,r,i,s=e.ts_prev.time,a=e.time-s;if(0==a){switch(e.type){case MREST:return e.wl+16;case NOTE:case REST:if(e.ts_prev.type==BAR)return e.nflags<-2?space_tb[0]:space_tb[2]}return 0}if(e.ts_prev.type==MREST)return e.ts_prev.wr+16+3;if(smallest_duration>=BASE_LEN/2&&(a/=smallest_duration>=BASE_LEN?4:2),n=a>=BASE_LEN/4?a<BASE_LEN/2?5:a<BASE_LEN?6:a<2*BASE_LEN?7:a<4*BASE_LEN?8:9:a>=BASE_LEN/8?4:a>=BASE_LEN/16?3:a>=BASE_LEN/32?2:a>=BASE_LEN/64?1:0,r=a-(BASE_LEN/16/8<<n),i=space_tb[n],0!=r&&(0>r?i=space_tb[0]*a/(BASE_LEN/16/8):(n>=9&&(n=8),i+=(space_tb[n+1]-space_tb[n])*r/a)),!e.dur){switch(e.type){case BAR:i*=e.bar_type.length>1?.8:.7;break;case CLEF:i-=e.wl}return i}if(e.beam_st||(i*=.9),e.type==NOTE&&e.nflags>=-1&&e.stem>0){var o=!0;for(t=e.ts_prev;t&&t.time==s;t=t.ts_prev)if(t.type==NOTE&&(t.nflags<-1||t.stem>0)){o=!1;break}if(o){for(t=e.ts_next;t&&t.time==e.time;t=t.ts_next)if(t.type==NOTE&&(t.nflags<-1||t.stem<0)){o=!1;break}o&&(i*=.9)}}return i}function set_allsymwidth(e){for(var t,n,r,i,s=0,a=tsfirst;;)if(set_width(a),s<a.wl&&(s=a.wl),a=a.ts_next,a==e||a.seqst)break;if(tsfirst.shrink=s,tsfirst.space=0,a!=e)for(;;){t=a,r=i=0;do{var o,c,u,l,f;for(set_width(t),t.type==BAR?(o=50,c=-50):(o=t.ymx,c=t.ymn),f=t.wl,s=0,n=a.ts_prev;n;n=n.ts_prev){if(!(s<n.wr)||n.type!=NOTE&&n.type!=REST||t.type!=NOTE&&t.type!=REST||(s=n.wr),n.st==t.st&&(!n.invisible||n.v==t.v)&&s<n.wr+f)switch(n.type){case NOTE:case REST:if(t.type==NOTE||t.type==REST){s=n.wr+f;break}default:if(u=n.ymx,l=n.ymn,c>u||l>o)break;case SPACE:case BAR:case CLEF:case METER:case KEY:s=n.wr+f}if(n.seqst){if(0!=s)break;if(f-=n.shrink,0>f)break}}if(s>r&&(r=s),s=set_space(t),s>i&&(i=s),(t=t.ts_next)==e)break}while(!t.seqst);if(0==r&&0==i&&a.type==CLEF&&(delete a.seqst,a.time=a.ts_prev.time),a.shrink=r,a.space=i,(a=t)==e)break}}function to_rest(e){e.type=REST,delete e.in_tuplet,delete e.sl1,delete e.sl2,delete e.a_dd,delete e.a_gch,delete e.extra,e.slur_start=e.slur_end=0}function set_repeat(e,t){var n,r,i,s,a,o,c=t.st,u=t.v;if((a=e.repeat_n)<0){for(a=-a,i=a,r=t.prev;r;r=r.prev)if(r.dur){if(--i<=0)break}else if(r.type==BAR)return error(1,r,"Bar in sequence to repeat"),void(e.fmt_type=void 0);if(!r)return error(1,t,"Not enough symbols to repeat"),void(e.fmt_type=void 0);for(i=e.repeat_k*a,n=t;n;n=n.next)if(n.dur){if(--i<=0)break}else if(n.type==BAR)return error(1,n,"Bar in repeat sequence"),void(e.fmt_type=void 0);if(!n||!n.next)return error(1,t,"Not enough symbols after repeat sequence"),void(e.fmt_type=void 0);for(n=t.prev;n!=r;n=n.prev)if(n.type==NOTE){n.beam_end=!0;break}for(r=t,s=e.repeat_k;--s>=0;){for(i=a,r.dur&&i--,n=r.ts_next;i>0;)n.st==c&&(n.v==u&&n.dur&&i--,delete n.extra,unlksym(n),n=n.ts_next);to_rest(r),r.dur=r.notes[0].dur=n.time-r.time,r.repeat_n=-1,r.beam_st=!0,set_width(r),r.seqst&&(r.space=set_space(r)),r.head="square",r=n}return void(e.fmt_type=void 0)}for(i=a,n=t.prev.prev;n&&(n.type!=BAR&&n.time!=tsfirst.time||!(--i<=0));n=n.prev);if(!n)return error(1,t,"Not enough measures to repeat"),void(e.fmt_type=void 0);for(o=t.time-n.time,i=1==a?e.repeat_k:a,n=t;n&&!(n.type==BAR&&--i<=0);n=n.next);if(!n)return error(1,t,"Not enough bars after repeat measure"),void(e.fmt_type=void 0);if(i=e.repeat_k,2==a&&i>1){if(n=n.next,!n)return error(1,t,"Not enough bars after repeat measure"),void(e.fmt_type=void 0);e.repeat_k=1,t=clone(e),t.next=n.extra,t.next&&(t.next.prev=t),delete t.prev,n.extra=t,t.repeat_k=--i}if(o/=a,2==a){for(r=t,n=t.ts_next;;n=n.ts_next)if(n.st==c){if(n.v==u&&n.type==BAR)break;delete n.extra,unlksym(n)}for(to_rest(r),r.dur=r.notes[0].dur=o,r.invisible=!0,r.seqst&&(r.space=set_space(r)),n.bar_mrep=2,n.seqst&&(n.space=set_space(n)),r=n.next,n=r.next;;){if(n.type==BAR||n.type==CLEF)break;delete n.extra,unlksym(n),n=n.next}return to_rest(r),r.dur=r.notes[0].dur=o,r.invisible=!0,set_width(r),r.seqst&&(r.space=set_space(r)),void(n.seqst&&(n.space=set_space(n)))}for(r=t,s=e.repeat_k;--s>=0;){for(n=r.ts_next;;n=n.ts_next)if(n.st==c){if(n.v==u&&n.type==BAR)break;delete n.extra,unlksym(n)}if(to_rest(r),r.dur=r.notes[0].dur=o,r.beam_st=!0,r.seqst&&(r.space=set_space(r)),n.seqst&&(n.space=set_space(n)),1==e.repeat_k){r.repeat_n=1;break}r.repeat_n=e.repeat_k-s+1,r=n.next}}function custos_add(e){for(var t,n,r,i=e;;){if(i.type==NOTE)break;if(i=i.next,!i)return}for(t=voice_tb[e.v],t.last_sym=e.prev,t.time=e.time,n=sym_add(t),n.type=CUSTOS,n.next=e,e.prev=n,n.ts_prev=e.ts_prev,n.ts_prev.ts_next=n,n.ts_next=e,e.ts_prev=n,n.seqst=!0,n.wl=8,n.wr=4,n.shrink=e.shrink,n.shrink<12&&(n.shrink=12),n.space=i.space,n.nhd=i.nhd,n.notes=[],r=0;r<e.notes.length;r++)n.notes[r]={pit:i.notes[r].pit,shhd:0,dur:BASE_LEN/4};n.stemless=!0}function set_nl(e){function t(e){if(cfmt.custos&&1==voice_tb.length)custos_add(e);else switch(r=e.ts_prev,r.type){case BAR:case FORMAT:case CLEF:case KEY:case METER:break;default:i=voice_tb[r.v],i.last_sym=r,i.time=e.time,r=r.next,o=sym_add(i),o.type=FORMAT,o.next=r,r&&(r.prev=o),o.ts_prev=o.prev,o.ts_prev.ts_next=o,o.ts_next=e,e.ts_prev=o,o.seqst=!0,o.wl=6,o.shrink=e.shrink,o.space=e.space,e.x&&(o.x=e.x)}e.nl=!0}function n(e){if(e=e.next,!e)return e;for(;!e.seqst;)e=e.ts_prev;return t(e),e}var r,i,s,a,o,c;if(e.eoln&&!cfmt.keywarn&&!cfmt.timewarn)return n(e);switch(e.type){case CLEF:case BAR:break;case KEY:if(cfmt.keywarn&&!e.k_none)break;return n(e);case METER:if(cfmt.timewarn)break;return n(e);case GRACE:if(e=e.next,!e)return e;default:return n(e)}for(;e;e=e.ts_prev)if(e.seqst){switch(e.type){case KEY:case CLEF:case METER:continue}break}for(c=0;;e=e.ts_next){if(!e)return e;if(e.new_sy&&(a=!0,e.new_sy=!1),e.seqst){if(0>c)break;switch(e.type){case BAR:c||!e.bar_num&&e.next&&":"==e.bar_type[e.bar_type.length-1]&&":"!=e.bar_type[0]?s=!0:c=1;break;case STBRK:if(!e.stbrk_forced){unlksym(e);break}c=-1;break;case METER:cfmt.timewarn||(s=!0);break;case CLEF:c&&(s=!0);break;case KEY:(!cfmt.keywarn||e.k_none)&&(s=!0);break;default:if(!c||e.prev&&e.prev.type==GRACE)break;s=!0}if(s)break;e.extra&&(o?error(2,e,"Extra symbol may be misplaced"):o=e)}}if(o&&o!=e){for(r=o.extra;r.next;)r=r.next;r.next=e.extra,e.extra=o.extra,delete o.extra}return a&&(e.new_sy=!0),t(e),e}function get_ck_width(){var e,t,n=voice_tb.length;for(e=0;n>e&&(t=voice_tb[e],!t.clef);e++);return set_width(t.clef),set_width(t.key),cfmt.singleline?(set_width(t.meter),t.clef.wl+t.clef.wr+t.key.wl+t.key.wr+t.meter.wl+t.meter.wr):t.clef.wl+t.clef.wr+t.key.wl+t.key.wr}function get_width(e,t,n){var r,i,s,a=1-cfmt.maxshrink;for(r=e;r!=t;r=r.ts_next)r.seqst&&(r.x=n,i=r.shrink,n+=(s=r.space)<i?i:i*cfmt.maxshrink+s*a);return n}function set_lines(e,t,n,r){var i,s,a,o,c,u,l,f,d;for(l=get_width(e,t,r),i=e;;){if(f=Math.ceil(l/n),1>=f)return t&&(t=set_nl(t)),t;for(s=e=i,c=i.x+l/f*cfmt.breaklimit,u=i.x+n,d=!1;i!=t;i=i.ts_next)if(o=i.x){if(o>u)break;if(i.type==BAR){if(o>c){d=!0;break}s=i}}if(i==t)return t;if(!d){var p=!s.dur||s.beam_st||s.beam_end?0:1,h=s.time;for(i=s,s=a=null,u-=6;i!=t;i=i.ts_next){if(i.beam_st){if(!i.beam_end){p++;continue}}else i.beam_end&&p--;if(o=i.x,o&&!(c>o)){if(o+o.shrink>=u)break;0==p&&(s=i,(i.time-h)%(BASE_LEN/8)==0&&(a=i))}}for(a&&(s=a),s&&(i=s);!i.x||i.x+2*i.shrink>=u;)i=i.ts_prev}if(i.nl)for(error(0,i,"Line split problem - adjust maxshrink and/or breaklimit"),f=2,i=i.ts_next;i!=t&&!(i.x&&--f<=0);i=i.ts_next);if(i=set_nl(i),!i||t&&i.time>=t.time)break;l-=i.x-e.x}return i}function cut_tune(e,t){var n,r,i,s,n=tsfirst;if(e-=get_ck_width(),cfmt.custos&&1==voice_tb.length&&(e-=12),cfmt.barsperstaff){for(i=cfmt.barsperstaff,r=n;n;n=n.ts_next)n.type==BAR&&n.bar_num&&(--i>0||(n.eoln=!0,i=cfmt.barsperstaff));n=r}for(s=t,r=n;n;n=n.ts_next)if(n.seqst||n.eoln)if(s+=n.shrink,s>e){for(;n&&!n.eoln;n=n.ts_next);if(n=r=set_lines(r,n,e,t),!n)break;s=n.shrink,t=0}else if(n.eoln){if(r=set_nl(n),delete n.eoln,n=r,!n)break;s=n.shrink,t=0}}function set_yval(e){switch(e.type){case CLEF:if(e.second||e.invisible){e.ymx=e.ymn=12;break}switch(e.y=6*(e.clef_line-1),e.clef_type){default:e.ymx=e.y+28,e.ymn=e.y-14;break;case"c":e.ymx=e.y+13,e.ymn=e.y-11;break;case"b":e.ymx=e.y+7,e.ymn=e.y-12}e.clef_small&&(e.ymx-=2,e.ymn+=2),e.ymx<26&&(e.ymx=26),e.ymn>-1&&(e.ymn=-1),e.clef_octave&&(e.clef_octave>0?e.ymx+=12:e.ymn-=12);break;case KEY:e.k_sf>2?e.ymx=34:e.k_sf>0?e.ymx=30:e.ymx=26,e.ymn=-2;break;default:e.ymx=26,e.ymn=-2}}function set_auto_clef(e,t,n){var r,i,s,a,o,c;for(s=12,i=20,r=t;r&&(!r.new_sy||r==t);r=r.ts_next)if(r.st==e)if(r.type==NOTE)r.notes[0].pit<i?i=r.notes[0].pit:r.notes[r.nhd].pit>s&&(s=r.notes[r.nhd].pit);else if(r.type==CLEF){if("a"!=r.clef_type)break;unlksym(r)}if(i>=19||i>=13&&"b"!=n)return"t";if(13>=s||19>=s&&"t"!=n)return"b";"a"==n&&(n=(s+i)/2>=16?"t":"b");var u=n,l=r,f=null;for(r=t;r!=l&&(!r.new_sy||r==t);r=r.ts_next)if(r.st==e&&r.type==NOTE){if(a=r.time,"t"==u){if(r.notes[0].pit>12||r.notes[r.nhd].pit>20){r.notes[0].pit>20&&(f=r);continue}if(o=r.ts_prev,o&&o.time==a&&o.st==e&&o.type==NOTE&&o.notes[0].pit>=19)continue;if(o=r.ts_next,o&&o.st==e&&o.time==a&&o.type==NOTE&&o.notes[0].pit>=19)continue}else{if(r.notes[0].pit<12||r.notes[r.nhd].pit<20){r.notes[r.nhd].pit<12&&(f=r);continue}if(o=r.ts_prev,o&&o.time==a&&o.st==e&&o.type==NOTE&&o.notes[0].pit<=13)continue;if(o=r.ts_next,o&&o.st==e&&o.time==a&&o.type==NOTE&&o.notes[0].pit<=13)continue}if(f){for(c=r,o=r.ts_prev;o!=f;o=o.ts_prev)if(o.st==e){if(o.type==BAR&&o.v==r.v){c=o;break}o.type==NOTE&&o.beam_st&&!voice_tb[o.v].second&&(c=o)}c.time!=f.time?(f=r,u="t"==u?"b":"t",o=insert_clef(c,u,"t"==u?2:4),o.clef_auto=!0):f=r}else u=n="t"==u?"b":"t",f=r}return n}function set_clefs(){var e,t,n,r,i,s,a,o,c=new Array(nstaff),u=cur_sy;for(staff_tb=new Array(nstaff),n=0;n<=nstaff;n++)c[n]={autoclef:!0},staff_tb[n]={output:[]};for(r=0;r<voice_tb.length;r++)i=voice_tb[r],u.voices[r].range<0||(n=u.voices[r].st,u.voices[r].second||(void 0!=i.stafflines&&(u.staves[n].stafflines=i.stafflines),i.staffscale&&(u.staves[n].staffscale=i.staffscale),u.voices[r].sep&&(u.staves[n].sep=u.voices[r].sep),u.voices[r].maxsep&&(u.staves[n].maxsep=u.voices[r].maxsep)),u.voices[r].second||i.clef.clef_auto||(c[n].autoclef=!1));for(r=0;r<voice_tb.length;r++)i=voice_tb[r],u.voices[r].range<0||u.voices[r].second||(n=u.voices[r].st,e=i.clef,c[n].autoclef&&(e.clef_type=set_auto_clef(n,tsfirst,e.clef_type),e.clef_line="t"==e.clef_type?2:4),c[n].clef=staff_tb[n].clef=e);for(e=tsfirst;e;e=e.ts_next){for(s=e.extra;s;s=s.next)if(s.type==FORMAT&&"repeat"==s.fmt_type){set_repeat(s,e);break}if(e.new_sy){for(u=u.next,n=0;n<=nstaff;n++)c[n].autoclef=!0;for(r=0;r<voice_tb.length;r++)u.voices[r].range<0||(i=voice_tb[r],n=u.voices[r].st,u.voices[r].second||(void 0!=i.stafflines&&(u.staves[n].stafflines=i.stafflines),i.staffscale&&(u.staves[n].staffscale=i.staffscale),u.voices[r].sep&&(u.staves[n].sep=u.voices[r].sep),u.voices[r].maxsep&&(u.staves[n].maxsep=u.voices[r].maxsep)),t=i.clef,t.clef_auto||(c[n].autoclef=!1));for(r=0;r<voice_tb.length;r++)if(!(u.voices[r].range<0||u.voices[r].second))if(i=voice_tb[r],n=u.voices[r].st,t=i.clef,t.clef_auto?(a=set_auto_clef(n,e,c[n].clef?c[n].clef.clef_type:"a"),o="t"==a?2:4):(a=t.clef_type,o=t.clef_line),c[n].clef){if(a!=c[n].clef.clef_type||o!=c[n].clef.clef_line){for(s=e;s.v!=r;)s=s.ts_next;s.type!=CLEF&&(s=insert_clef(s,a,o),t.clef_auto&&(s.clef_auto=!0)),c[n].clef=i.clef=s}}else t.clef_auto&&("a"!=t.type&&(i.clef=clone(i.clef)),i.clef.clef_type=a,i.clef.clef_line=o),staff_tb[n].clef=c[n].clef=i.clef}if(e.type==CLEF)if(i=voice_tb[e.v],i.clef=e,e.second)unlksym(e);else{if(n=e.st,c[n].clef){if(e.clef_type==c[n].clef.clef_type&&e.clef_line==c[n].clef.clef_line&&!e.new_sy)continue}else staff_tb[n].clef=e;c[n].clef=e}}for(u=cur_sy,r=0;r<voice_tb.length;r++)if(!(u.voices[r].range<0)&&(t=voice_tb[r].sym,t&&127==t.notes[0].pit)){switch(n=u.voices[r].st,staff_tb[n].clef.clef_type){default:pitch=22;break;case"c":pitch=16;break;case"b":pitch=10}for(e=t;e;e=e.next)e.notes[0].pit=pitch}}function set_pitch(e){var t,n,r,i,s,a,o,c=new Array(nstaff);for(r=0;r<=nstaff;r++)t=staff_tb[r].clef,c[r]=delta_tb[t.clef_type]+2*t.clef_line,t.clef_oct_transp&&(c[r]-=t.clef_octave);for(a=BASE_LEN,t=tsfirst;t!=e;t=t.ts_next)switch(r=t.st,t.type){case CLEF:c[r]=delta_tb[t.clef_type]+2*t.clef_line,t.clef_oct_transp&&(c[r]-=t.clef_octave),set_yval(t);break;case GRACE:for(n=t.extra;n;n=n.next)if(n.type==NOTE){if(i=c[n.st],0!=i&&!voice_tb[t.v].key.k_drum)for(s=0;s<=n.nhd;s++)o=n.notes[s],o.pit+=i;n.ymn=3*(n.notes[0].pit-18)-2,n.ymx=3*(n.notes[n.nhd].pit-18)+2}set_yval(t);break;case KEY:t.k_y_clef=c[r];default:set_yval(t);break;case MREST:if(t.invisible)break;t.y=12,t.ymx=39,t.ymn=-2;break;case REST:if(1==voice_tb.length){t.y=12,t.ymx=24,t.ymn=0;break}case NOTE:if(i=c[r],0!=i&&!voice_tb[t.v].key.k_drum)for(s=t.nhd;s>=0;s--)t.notes[s].pit+=i;t.type==NOTE?(t.ymx=3*(t.notes[t.nhd].pit-18)+4,t.ymn=3*(t.notes[0].pit-18)-4,t.yav=(t.ymx+t.ymn)/2):(t.y=6*Math.floor((t.notes[0].pit-18)/2),t.ymx=t.y+rest_sp[5-t.nflags][0],t.ymn=t.y-rest_sp[5-t.nflags][1]),t.dur<a&&(a=t.dur)}smallest_duration=a}function set_stem_dir(){for(var e,t,n,r,i,s,a,o,c,u=[],l=tsfirst,f=cur_sy,d=f.nstaff;l;){for(r=0;d>=r;r++)u[r]=[];for(c=[],t=l;t&&t.type!=BAR;t=t.ts_next){if(t.new_sy){if(t!=l)break;for(f=f.next,r=d;r<=f.nstaff;r++)u[r]=[];d=f.nstaff}if(!(t.type!=NOTE&&t.type!=REST||t.invisible)){if(r=t.st,r>d){var p="*** fatal set_stem_dir(): bad staff number "+r+" max "+d;throw error(2,null,p),new Error(p)}for(s=t.v,v_st=c[s],v_st||(v_st={st1:-1,st2:-1},c[s]=v_st),v_st.st1<0?v_st.st1=r:v_st.st1!=r&&(r>v_st.st1?r>v_st.st2&&(v_st.st2=r):(v_st.st1>v_st.st2&&(v_st.st2=v_st.st1),v_st.st1=r)),a=u[r],i=f.voices[s].range,n=a.length;--n>=0&&(o=a[n],o.v!=i););if(0>n){for(o={v:i,ymx:0,ymn:24},n=0;n<a.length;n++)if(i<a[n].v){a.splice(n,0,o);break}n==a.length&&a.push(o)}t.type==NOTE&&(t.ymx>o.ymx&&(o.ymx=t.ymx),t.ymn<o.ymn&&(o.ymn=t.ymn),t.xstem&&(t.ts_prev.st!=r-1||t.ts_prev.type!=NOTE?(error(1,l,"Bad +xstem+"),delete t.xstem):(t.ts_prev.multi=1,t.multi=1,t.stemless=!0)))}}for(;l!=t;l=l.ts_next)if(!l.multi&&(l.type==NOTE||l.type==REST||l.type==GRACE))if(r=l.st,s=l.v,v_st=c[s],a=u[r],v_st&&v_st.st2>=0)r==v_st.st1?l.multi=-1:r==v_st.st2&&(l.multi=1);else if(a.length<=1)l.floating&&(r==voice_tb[s].st?l.multi=-1:l.multi=1);else{for(i=f.voices[s].range,n=a.length;--n>=0&&a[n].v!=i;);0>n||(n==a.length-1?l.multi=-1:(l.multi=1,0!=n&&n+2==a.length&&(a[n].ymn-cfmt.stemheight>a[n+1].ymx&&(l.multi=-1),e=l.ts_next,l.ts_prev&&l.ts_prev.time==l.time&&l.ts_prev.st==l.st&&l.notes[l.nhd].pit==l.ts_prev.notes[0].pit&&l.beam_st&&l.beam_end&&(!e||e.st!=l.st||e.time!=l.time)&&(l.multi=-1))))}for(;l&&l.type==BAR;)l.new_sy&&(f=f.next,d=f.nstaff),l=l.ts_next}}function set_rest_offset(){var e,t,n,r,i,s,a,o,c,u,l,f=[],d=cur_sy;for(e=tsfirst;e;e=e.ts_next)if(!e.invisible){switch(e.new_sy&&(d=d.next),e.type){default:continue;case NOTE:case REST:}if(s=f[e.v],s||(s={},f[e.v]=s),s.s=e,s.st=e.st,s.end_time=e.time+e.dur,e.type==REST){for(o=-127,a=127,i=u=!1,n=0;n<=f.length;n++)s=f[n],s&&s.s&&s.st==e.st&&n!=e.v&&(s.end_time<=e.time||(i=!0,t=s.s,d.voices[n].range<d.voices[e.v].range?t.ymn<a&&(t.time==e.time?(a=t.ymn,t.dots&&(u=!0)):a=(t.ymx+t.ymn)/2):t.ymx>o&&(t.time==e.time?(o=t.ymx,t.dots&&(u=!0)):o=(t.ymx+t.ymn)/2)));for(r=e.time+e.dur,t=e.ts_next;t&&!(t.time>=r);t=t.ts_next)t.st!=e.st||t.type!=NOTE&&t.type!=REST||t.invisible||(i=!0,d.voices[t.v].range<d.voices[e.v].range?t.ymn<a&&(t.time==e.time?(a=t.ymn,t.dots&&(u=!0)):a=(t.ymx+t.ymn)/2):t.ymx>o&&(t.time==e.time?(o=t.ymx,t.dots&&(u=!0)):o=(t.ymx+t.ymn)/2));if(c=a-e.ymx,0>c){if(c=6*Math.ceil(-c/6),e.ymn-c>=o){e.y-=c,e.ymx-=c,e.ymn-=c;continue}l=u?15:10,e.notes[0].shhd=l,e.xmx=l}else if(c=o-e.ymn,c>0){if(c=6*Math.ceil(c/6),e.ymx+c<=a){e.y+=c,e.ymx+=c,e.ymn+=c;continue}l=u?15:10,e.notes[0].shhd=l,e.xmx=l}else i||(e.y=12,e.ymx=24,e.ymn=0)}}}function new_sym(e,t,n){return s={type:e,ctx:n.ctx,v:t.v,st:t.st,time:n.time,next:t.last_sym.next},s.next&&(s.next.prev=s),t.last_sym.next=s,s.prev=t.last_sym,t.last_sym=s,s.ts_next=n,s.ts_prev=n.ts_prev,s.ts_prev.ts_next=s,s.ts_prev.type!=e&&(s.seqst=!0),n.ts_prev=s,n.type==e&&s.v!=n.v&&(delete n.seqst,n.shrink=0),s}function init_music_line(){var e,t,n,r,i,s=voice_tb.length;for(r=0;s>r;r++)if(e=voice_tb[r],!(cur_sy.voices[r].range<0)){for(e.second=cur_sy.voices[r].second,i=cur_sy.voices[r].st;i<nstaff&&cur_sy.staves[i].empty;)i++;e.st=i}for(n=tsfirst,t=n.extra;t;t=t.next)if(t.type==BLOCK)switch(t.subtype){case"center":write_text(t.text,"c");break;case"sep":vskip(t.sk1),output.push('<path class="stroke"\n	d="M'),out_sxsy(t.x," ",0),output.push("h"+t.l.toFixed(2)+'"/>\n'),vskip(t.sk2),blk_out();break;case"ml":svg_flush(),user.img_out(t.text);break;case"text":write_text(t.text,t.opt);break;case"title":write_title(t.text,!0);break;case"vskip":vskip(t.sk),blk_out()}for(;n.type==CLEF;)r=n.v,e=voice_tb[r],cur_sy.voices[r].range>=0&&!cur_sy.voices[r].second&&(delete n.clef_small,e.last_sym=e.sym=n),n=n.ts_next;for(r=0;s>r;r++)e=voice_tb[r],e.sym&&e.sym.type==CLEF||cur_sy.voices[r].range<0||cur_sy.voices[r].second&&!e.bar_start||(i=cur_sy.voices[r].st,staff_tb[i]&&staff_tb[i].clef&&(t=clone(staff_tb[i].clef),t.v=r,t.st=i,t.time=n.time,t.prev=null,t.next=e.sym,t.next&&(t.next.prev=t),e.sym=t,e.last_sym=t,t.ts_next=n,t.ts_prev=n.ts_prev,t.ts_prev?(t.ts_prev.ts_next=t,delete t.seqst):(tsfirst=t,t.seqst=!0),n.ts_prev=t,n.type==CLEF&&delete n.seqst,delete t.clef_small,t.second=cur_sy.voices[r].second,cur_sy.staves[i].empty&&(t.invisible=!0)));for(r=0;s>r;r++)cur_sy.voices[r].range<0||cur_sy.voices[r].second||cur_sy.staves[cur_sy.voices[r].st].empty||(e=voice_tb[r],n.v!=r||n.type!=KEY?(e.key.k_sf||e.key.k_a_acc)&&(t=new_sym(KEY,e,n),t.k_sf=e.key.k_sf,t.k_old_sf=e.key.k_sf,t.k_a_acc=e.key.k_a_acc,t.istart=e.key.istart,t.iend=e.key.iend,e.key.k_bagpipe&&(t.k_bagpipe=e.key.k_bagpipe,"p"==t.k_bagpipe&&(t.k_old_sf=3))):(e.last_sym=n,n=n.ts_next));if(1&insert_meter)for(r=0;s>r;r++)e=voice_tb[r],cur_sy.voices[r].range<0||cur_sy.voices[r].second||cur_sy.staves[cur_sy.voices[r].st].empty||0==e.meter.a_meter.length||(n.v!=r||n.type!=METER?(t=new_sym(METER,e,n),
t.istart=e.meter.istart,t.iend=e.meter.iend,t.wmeasure=e.meter.wmeasure,t.a_meter=e.meter.a_meter):(e.last_sym=n,n=n.ts_next));for(r=0;s>r;r++)e=voice_tb[r],!e.bar_start||cur_sy.voices[r].range<0||cur_sy.staves[cur_sy.voices[r].st].empty||(t=new_sym(BAR,e,n),t.istart=e.bar_start.istart,t.iend=e.bar_start.iend,t.bar_type=e.bar_start.bar_type,e.bar_start.invisible&&(t.invisible=!0),e.bar_start.norepbra&&(t.norepbra=!0),t.text=e.bar_start.text,t.a_gch=e.bar_start.a_gch,e.bar_start.rbstart&&(t.rbstart=e.bar_start.rbstart),delete e.bar_start);if(set_pitch(n),t=n)for(;t&&!t.seqst;t=t.ts_next);if(t)for(t=t.ts_next;t&&!t.seqst;t=t.ts_next);set_allsymwidth(t)}function set_words(e){var t,n,r,i,s;for(t=e.sym;t;t=t.next)if(t.type==NOTE){n=t.notes[0].pit;break}for(t||(n=127),r=!0,t=e.sym;t;t=t.next){switch(t.type){case MREST:r=!0;break;case BAR:t.beam_on||(r=!0),!t.next&&t.prev&&t.prev.type==NOTE&&t.prev.dur>=2*BASE_LEN&&(t.prev.head="square");break;case NOTE:case REST:if(t.trem2)break;i=t.nflags,t.ntrem&&(i+=t.ntrem),t.type==REST&&t.beam_end&&(t.beam_end=!1,r=!0),(r||0>=i)&&(s&&(s.beam_end=!0,s=null),0>=i?(t.beam_st=!0,t.beam_end=!0):t.type==NOTE&&(t.beam_st=!0,r=!1)),t.beam_end&&(r=!0),t.type==NOTE&&(s=t)}t.type==NOTE?(0!=t.nhd&&sort_pitch(t),n=t.notes[0].pit,t.prev&&t.prev.type!=NOTE&&(t.prev.notes[0].pit=(t.prev.notes[0].pit+n)/2)):(t.notes||(t.notes=[],t.notes[0]={},t.nhd=0),t.notes[0].pit=n)}s&&(s.beam_end=!0)}function set_rb(e){for(var t,n,r,i=e.sym;i;)if(i.type==BAR&&i.rbstart){if(n=cfmt.rbmax,i.text&&"1"==i.text[0]){for(r=0,t=null,i=i.next;i;i=i.next)if(i.type==BAR){if(r++,i.rbstop){r<=cfmt.rbmax&&(n=r,t=null);break}r==cfmt.rbmin&&(t=i)}t&&(t.rbstop=1,n=cfmt.rbmin)}for(;i;){if(2!=i.rbstart){if(i=i.next,!i)break;if(2!=i.rbstart){if(i=i.next,!i)break;if(2!=i.rbstart)break}}for(r=0,t=null,i=i.next;i;i=i.next)if(i.type==BAR){if(r++,i.rbstop)break;r==n&&(i.rbstop=1)}}}else i=i.next}function set_global(){var e,t,n,r,i=cur_sy;for(t=i.nstaff;;){if(i=i.next,!i)break;i.nstaff>t&&(t=i.nstaff)}for(nstaff=t,r=voice_tb.length,n=0;r>n;n++)e=voice_tb[n],set_words(e),e.second||e.norepbra||set_rb(e);set_float(),set_clefs(),set_pitch(null)}function set_indent(){var e,t,n,r,i,s,a,o,c=voice_tb.length,u=0;for(t=0;c>t;t++)if(r=voice_tb[t],!(cur_sy.voices[t].range<0)&&(e=cur_sy.voices[t].st,!cur_sy.staves[e].empty&&(i=r.new_name?r.nm:r.snm)))for(o||(o=get_font("voice"),gene.curfont=gene.deffont=o),s=0;;){if(a=i.indexOf("\\n",s),n=strw(0>a?i.slice(s):i.slice(s,a)),n>u&&(u=n),0>a)break;s=a+1}if(0!=u){for(n=0,e=0;e<=cur_sy.nstaff;e++){if(cur_sy.staves[e].flags&(OPEN_BRACE2|OPEN_BRACKET2)){n=20;break}cur_sy.staves[e].flags&(OPEN_BRACE|OPEN_BRACKET)&&0==n&&(n=10)}u+=4*cwid(" ")*o.swfac+n}return 2&insert_meter&&(u+=cfmt.indent),u}function set_beams(e){var t,n,r,i,s,a,o=-1,c=0;for(t=e;t;t=t.next)if(t.type==NOTE){if(t.stem||0!=(t.stem=t.multi))t.beam_st&&!t.beam_end&&(i=!0);else if(i)t.stem=o;else if(t.beam_st&&!t.beam_end){var u=t.yav,l=12;for(n=t.next;n;n=n.next){if(n.type==NOTE){if(n.multi){u=l-n.multi;break}u+=n.yav,l+=12}if(n.beam_end)break}l>u?o=1:(u>l||cfmt.bstemdown)&&(o=-1),i=!0,t.stem=o}else if(t.stem=t.yav>=12?-1:1,12==t.yav&&!cfmt.bstemdown)if(t.prev&&t.prev.type!=BAR)a=t.yav-c,a>-7&&7>a&&(t.stem=o);else{for(n=t.next;n&&(n.type!=NOTE&&n.type!=BAR);n=n.next);n&&n.type==NOTE&&n.yav<12&&(t.stem=1)}if(t.beam_end&&(i=!1),o=t.stem,c=t.yav,s){for(r=s.extra;r;r=r.next)r.stem=-o;s.stem=-o,s=null}}else{if(t.type!=GRACE)continue;for(r=t.extra;r.type!=NOTE;)r=r.next;if(2==r.stem){s=t;continue}for(t.stem||0!=(t.stem=t.multi)||(t.stem=1);r;r=r.next)r.stem=t.stem,r.multi=t.multi}}function same_head(e,t){var n,r,i,s,a,o,c,u,l,f,d;if(e.shiftunison&&e.shiftunison>=3)return!1;if((i=e.dur)>=BASE_LEN)return!1;if((s=t.dur)>=BASE_LEN)return!1;if(e.stemless&&t.stemless)return!1;if(e.dots!=t.dots&&(e.shiftunison&&1&e.shiftunison||e.dots*t.dots!=0))return!1;if(e.stem*t.stem>0)return!1;if(n=r=0,e.notes[0].pit>t.notes[0].pit){if(e.stem<0)return!1;for(;t.notes[r].pit!=e.notes[0].pit;)if(++r>t.nhd)return!1}else if(e.notes[0].pit<t.notes[0].pit){if(t.stem<0)return!1;for(;t.notes[0].pit!=e.notes[n].pit;)if(++n>e.nhd)return!1}if(t.notes[r].acc!=e.notes[n].acc)return!1;o=n,u=r,f=e.notes[n].shhd,d=t.notes[r].shhd;do{if(n++,r++,n>e.nhd)break;if(r>t.nhd)break;if(t.notes[r].acc!=e.notes[n].acc)return!1;f<e.notes[n].shhd&&(f=e.notes[n].shhd),d<t.notes[r].shhd&&(d=t.notes[r].shhd)}while(t.notes[r].pit==e.notes[n].pit);if(n<=e.nhd){if(r<=t.nhd)return!1;if(t.stem>0)return!1}else if(r<=t.nhd&&e.stem>0)return!1;if(c=n,l=r,a=0,i!=s)if(s>i&&(i=s,s=e.dur),i<BASE_LEN/2)t.dots>0?a=2:e.dots>0&&(a=1);else{if(!(s<BASE_LEN/4))return!1;if(e.shiftunison&&2&e.shiftunison)return!1;a=t.dur>=BASE_LEN/2?2:1}if(0==a&&(a=voice_tb[e.v].scale<voice_tb[t.v].scale?2:1),1==a){for(t.nohdi1=u,t.nohdi2=l,r=u;l>r;r++)delete t.notes[r].acc;for(r=0;r<=t.nhd;r++)t.notes[r].shhd+=f}else{for(e.nohdi1=o,e.nohdi2=c,n=o;c>n;n++)delete e.notes[n].acc;for(n=0;n<=e.nhd;n++)e.notes[n].shhd+=d}return!0}function unison_acc(e,t,n,r){var i,s;if(t.notes[r].acc){for(s=2*w_note[e.head]+e.xmx+t.notes[r].shac+2,t.notes[r].micro&&(s+=2),e.dots&&(s+=6),i=0;i<=t.nhd;i++)t.notes[i].shhd+=s,t.notes[i].shac-=s;t.xmx+=s}else{for(s=2*w_note[t.head]+t.xmx+e.notes[n].shac+2,e.notes[n].micro&&(s+=2),t.dots&&(s+=6),i=0;i<=e.nhd;i++)e.notes[i].shhd+=s,e.notes[i].shac-=s;e.xmx+=s}}function set_left(e,t){var n,r,i,s,a,o=w_note[e.head];for(r=0;MAXPIT>r;r++)t[r]=-100;for(s=o,e.stem>0?(s=-s,r=2*e.notes[0].pit,i=2*(Math.ceil((e.ymx-2)/3)+18)):(r=2*(Math.ceil((e.ymn+2)/3)+18),i=2*e.notes[e.nhd].pit),0>r&&(r=0);MAXPIT>r&&i>=r;r++)t[r]=s;for(a=e.notes[e.stem>0?0:e.nhd].shhd,n=0;n<=e.nhd;n++)s=-e.notes[n].shhd+o+a,r=2*e.notes[n].pit,0>r?r=0:r>=95&&(r=94),s>t[r]&&(t[r]=s),"square"!=e.head&&(s-=1),s>t[r-1]&&(t[r-1]=s),s>t[r+1]&&(t[r+1]=s)}function set_right(e,t){var n,r,i,s,a,o,c,u=w_note[e.head];for(r=0;MAXPIT>r;r++)t[r]=-100;for(a=e.nflags>0&&e.beam_st&&e.beam_end,o=u,e.stem<0?(o=-o,r=2*(Math.ceil((e.ymn+2)/3)+18),i=2*e.notes[e.nhd].pit,s=r+4):(r=2*e.notes[0].pit,i=2*(Math.ceil((e.ymx-2)/3)+18)),0>r&&(r=0);MAXPIT>r&&i>r;r++)t[r]=o;if(a)if(e.stem>0)for(r=0==e.xmx?2*e.notes[e.nhd].pit:2*e.notes[0].pit,r+=4,0>r&&(r=0);MAXPIT>r&&i-4>=r;r++)t[r]=11;else for(r=s,0>r&&(r=0);MAXPIT>r&&r<=2*e.notes[0].pit-4;r++)t[r]=3.5;for(c=e.notes[e.stem>0?0:e.nhd].shhd,n=0;n<=e.nhd;n++)o=e.notes[n].shhd+u-c,r=2*e.notes[n].pit,0>r?r=0:r>=95&&(r=94),o>t[r]&&(t[r]=o),"square"!=e.head&&(o-=1),o>t[r-1]&&(t[r-1]=o),o>t[r+1]&&(t[r+1]=o)}function set_overlap(){function e(){n=r,r=t,f=d,v=y,g=_,h=p}var t,n,r,i,s,a,o,c,u,l,f,d,p,h,m,v,g,y=[],_=[],b=[],x=[];for(t=tsfirst;t;t=t.ts_next)if(t.type==NOTE&&!t.invisible){if(t.xstem&&t.ts_prev.stem<0){for(r=t.ts_prev,o=0;o<=r.nhd;o++)r.notes[o].shhd+=7,r.notes[o].shac-=7;r.xmx+=7}for(r=t;r=r.ts_next,r;){if(r.time!=t.time){r=null;break}if(r.type==NOTE&&!r.invisible&&r.st==t.st)break}if(r&&(n=t,cur_sy.voices[n.v].range<cur_sy.voices[r.v].range?r.dot_low=!0:n.dot_low=!0,!(n.ymn>r.ymx||n.ymx<r.ymn||same_head(n,r)))){for(set_right(n,_),set_left(r,b),f=-10,i=0;MAXPIT>i;i++)b[i]+_[i]>f&&(f=b[i]+_[i]);if(!(-3>f&&(!n.dots||!r.dots||!r.dot_low||n.stem>0||r.stem<0||n.notes[n.nhd].pit+2!=r.notes[0].pit||1&r.notes[0].pit))){for(set_right(r,x),set_left(n,y),d=p=h=-100,i=0;MAXPIT>i;i++)y[i]+x[i]>d&&(d=y[i]+x[i]),x[i]>h&&(h=x[i]),_[i]>p&&(p=_[i]);for(u=0,s=n.nhd,a=r.nhd;;){switch(l=n.notes[s].pit-r.notes[a].pit){case 0:if(n.notes[s].acc!=r.notes[a].acc){u=-1;break}r.notes[a].acc&&(r.notes[a].acc=0),n.dots&&r.dots&&1&n.notes[s].pit&&(u=1);break;case-1:n.dots&&r.dots&&(1&n.notes[s].pit?(n.dot_low=!1,r.dot_low=!1):(n.dot_low=!0,r.dot_low=!0));break;case-2:if(n.dots&&r.dots&&!(1&n.notes[s].pit)){n.dot_low=!1,r.dot_low=!1;break}}if(0>u)break;if(l>=0&&--s<0)break;if(0>=l&&--a<0)break}if(0>u)unison_acc(n,r,s,a);else{if(c=0,n.dots?r.dots&&(u||(c=1)):r.dots&&f+h>d+p&&(c=1),v=b,g=x,f+h>d+p&&e(),f+=3,0>f&&(f=0),o=n.stem>=0?0:n.nhd,f+=n.notes[o].shhd,o=r.stem>=0?0:r.nhd,f-=r.notes[o].shhd,n.dots)if(m=7.7+n.xmx+3.5*n.dots-3.5+3,c){if(m<f+h+r.xmx){for(d=0,s=0;s<=n.nhd;s++)i=n.notes[s].pit,1&i||(n.dot_low?i--:i++),i*=2,1>i?i=1:i>=95&&(i=94),g[i]>d&&(d=g[i]),g[i-1]+1>d&&(d=g[i-1]=1),g[i+1]+1>d&&(d=g[i+1]+1);d>4.5&&7.7+n.xmx+2<f+d+r.xmx&&(r.xmx=d+3-7.7)}}else{for(d=-100,s=0;s<=n.nhd;s++)i=n.notes[s].pit,1&i||(n.dot_low?i--:i++),i*=2,1>i?i=1:i>=95&&(i=94),v[i]>d&&(d=v[i]),v[i-1]+1>d&&(d=v[i-1]+1),v[i+1]+1>d&&(d=v[i+1]+1);m+d+2>f&&(f=m+d+2)}for(o=r.nhd;o>=0;o--)r.notes[o].shhd+=f;r.xmx+=f,c&&(n.xmx=r.xmx)}}}}}function set_stems(){var e,t,n,r,i,s,a,o,c,u;for(e=tsfirst;e;e=e.ts_next)if(e.type==NOTE){if(set_head_shift(e),o=e.nflags,e.beam_st&&!e.beam_end){for(e.feathered_beam&&(o=++e.nflags),t=e.next;t.type!=NOTE||(e.feathered_beam&&t.nflags++,!t.beam_end);t=t.next);t.nflags>o&&(o=t.nflags)}else if(!e.beam_st&&e.beam_end){for(t=e.prev;!t.beam_st;t=t.prev);t.nflags>o&&(o=t.nflags)}switch(r=cfmt.stemheight,o){case 2:r+=2;break;case 3:r+=5;break;case 4:r+=10;break;case 5:r+=16}1!=(i=voice_tb[e.v].scale)&&(r*=.5*(i+1)),s=3*(e.notes[0].pit-18),e.nhd>0?(r-=2,a=3*(e.notes[e.nhd].pit-18)):a=s,e.ntrem&&(r+=2*e.ntrem),e.stemless?(e.stem>=0?(e.y=s,e.ys=a):(e.ys=s,e.y=a),-4==o&&(s-=6),e.ymx=a+4,e.ymn=s-4):e.stem>=0?(o>=2&&(r-=1),e.notes[e.nhd].pit>26&&(0>=o||!e.beam_st||!e.beam_end)&&(r-=2,e.notes[e.nhd].pit>28&&(r-=2)),e.y=s,e.notes[0].ti1&&(s-=3),e.ymn=s-4,e.ys=a+r,e.ys<12&&(e.ys=12),e.ymx=e.ys+2.5):(e.notes[0].pit<18&&(0>=o||!e.beam_st||!e.beam_end)&&(r-=2,e.notes[0].pit<16&&(r-=2)),e.ys=s-r,e.ys>12&&(e.ys=12),e.ymn=e.ys-2.5,e.y=a,e.notes[e.nhd].ti1&&(a+=3),e.ymx=a+4)}else{if(e.type!=GRACE)continue;for(c=u=12,n=e.extra;n;n=n.next)n.type==NOTE&&(r=GSTEM,n.nflags>1&&(r+=1.2*(n.nflags-1)),s=3*(n.notes[0].pit-18),a=3*(n.notes[n.nhd].pit-18),e.stem>=0?(n.y=s,n.ys=a+r,a=Math.round(n.ys)):(n.y=a,n.ys=s-r,s=Math.round(n.ys)),a+=2,s-=2,c>s?c=s:a>u&&(u=a),n.ymx=a,n.ymn=s);e.ymx=u,e.ymn=c}}function check_bar(e){for(var t,n,r=voice_tb[e.v];e.type==CLEF||e.type==KEY||e.type==METER;)if(e.type==METER&&e.time>r.sym.time&&(insert_meter|=1),e=e.prev,!e)return;if(e.type==BAR&&(void 0!=e.text&&(r.bar_start=clone(e),r.bar_start.bar_type="[",delete e.text,delete e.a_gch),t=e.bar_type,":"!=t&&":"==t[t.length-1])){if(r.bar_start||(r.bar_start=clone(e)),":"!=t[0])return r.bar_start.bar_type=t,void(e.prev&&e.prev.type==BAR?unlksym(e):e.bar_type="|");if("::"==t)return r.bar_start.bar_type="|:",void(e.bar_type=":|");for(n=0;":"==t[n];)n++;if(n<t.length){for(e.bar_type=t.slice(0,n)+"|",n=t.length-1;":"==t[n];)n--;r.bar_start.bar_type="|"+t.slice(n+1)}else n=Math.floor(t.length/2),e.bar_type=t.slice(0,n)+"|",r.bar_start.bar_type="|"+t.slice(n)}}function sym_staff_move(e,t,n){for(;;)if(t.st==e&&t.type!=CLEF&&(t.st++,t.invisible=!0),t=t.ts_next,t==tsnext||t.new_sy)break}function set_piece(){function e(e){var t=staff_tb[e],n=u.staves[e];t||(t=staff_tb[e]={}),t.y=0,t.stafflines=n.stafflines,t.staffscale=n.staffscale,c[e]=!0}function t(e){var t,n,r,i=e.staves.length;for(t=0;i>t;t++)if(e.staves[t].flags&(OPEN_BRACE|OPEN_BRACE2)){for(r=0,n=t;i>t&&(r|=e.staves[t].empty?1:2,!(e.staves[t].flags&(CLOSE_BRACE|CLOSE_BRACE2)));)t++;if(3==r)for(;t>=n;)e.staves[n++].empty=!1}}function n(){var e,t,n,r;for(e=0;e<=nstaff;e++)if(t=staff_tb[e],c[e])t.botbar=t.topbar=0;else{for(r=t.stafflines.length,t.topbar=6*(r-1),n=0;r-1>n&&"."==t.stafflines[n];n++);t.botline=t.botbar=6*n,n>=r-2&&(t.botbar-=6,t.topbar+=6)}}var r,i,s,a,o,c=[],u=cur_sy;for(nstaff=a=u.nstaff,i=0;a>=i;i++)e(i);for(r=tsfirst;r&&!r.nl;r=r.ts_next){if(r.new_sy){for(i=0;i<=nstaff;i++)u.staves[i].empty=c[i],c[i]=!0;for(t(u);a>=i;i++)u.staves[i].empty=!0;for(u=u.next,a=u.nstaff,a>nstaff&&(nstaff=a);a>=i;i++)e(i)}if(r.st>nstaff)unlksym(r);else if(c[r.st])switch(r.type){case GRACE:c[r.st]=!1;break;case NOTE:case REST:case SPACE:case MREST:cfmt.staffnonote>1?c[r.st]=!1:r.invisible||(0!=cfmt.staffnonote||r.type==NOTE)&&(c[r.st]=!1)}}for(tsnext=r,i=0;i<=nstaff;i++)u.staves[i].empty=c[i];for(t(u),n(),u=cur_sy,i=0;i<nstaff;i++)u.staves[i].empty&&sym_staff_move(i,tsfirst,u);if(u.next)for(r=tsfirst;r&&!r.nl;r=r.ts_next)if(r.new_sy){for(u=u.next,i=0;i<u.nstaff;i++)u.staves[i].empty&&sym_staff_move(i,r,u);if(!u.next)break}if(c[nstaff]&&(staff_tb[nstaff].topbar=0),init_music_line(),c[nstaff]||(insert_meter&=-2),tsnext)for(r=tsnext,r.nl=!1,r=r.ts_prev,r.ts_next=null,o=voice_tb.length,s=0;o>s;s++){if(voice_tb[s].sym&&voice_tb[s].sym.time<=tsnext.time){for(r=tsnext.ts_prev;r;r=r.ts_prev)if(r.v==s){voice_tb[s].s_next=r.next,r.next=null,check_bar(r);break}if(r)continue}voice_tb[s].s_next=voice_tb[s].sym,voice_tb[s].sym=null}}function set_sym_glue(e){for(var t,n,r,i,s,a,o,c,u=tsfirst,l=0,f=0,d=0;;){if(u.type==GRACE&&(c=!0),u.seqst&&(t=u.space,l+=u.shrink,t<u.shrink&&(t=u.shrink),f+=t),!u.ts_next)break;u=u.ts_next}for(d=f,cfmt.stretchstaff&&(d*=1.8),n=1,tsnext?f>=e?beta_last=0:(beta_last=(e-f)/(d-f),beta_last>n&&(cfmt.stretchstaff?cfmt.linewarn&&error(0,u,"Line underfull ("+(n*d+(1-n)*f).toFixed(2)+"pt of "+e.toFixed(2)+"pt)"):(e=f,beta_last=0))):e>f&&(i=(e-f)/(d-f),i>=beta_last&&(i=beta_last*d+(1-beta_last)*f,i<e*(1-cfmt.stretchlast)&&(e=i))),o=e/f,f=d=0,u=tsfirst;;){if(u.seqst&&(t=u.shrink,0!=u.space&&(t<u.space*o&&(t=u.space*o),d+=u.space*o*1.8),f+=t,d+=t,u.x=f,u.xmax=d),!u.ts_next)break;u=u.ts_next}switch(u.type){case BAR:break;case FORMAT:break;case CUSTOS:f+=u.wr,l+=u.wr,d+=u.wr;break;default:for(s=u.wr;!u.seqst;)u=u.ts_prev,u.wr>s&&(s=u.wr);l+=s+3,tsnext&&.8*tsnext.space>u.wr+4?(f+=.8*tsnext.space*o,d+=.8*tsnext.space*o*1.8):(f+=s+4,d+=s+4)}if(f>=e?(i=0,f==l?r=1:(r=(f-e)/(f-l),r>1&&error(0,u,"Line too much shrunk "+l.toFixed(2)+" "+f.toFixed(2)+" "+e.toFixed(2))),realwidth=l*r+f*(1-r)):(r=0,i=d>f?(e-f)/(d-f):1,i>n&&(cfmt.stretchstaff||(i=0)),realwidth=d*i+f*(1-i)),u=tsfirst,0!=r)if(1>r)for(f=l=0;u;u=u.ts_next)u.seqst&&(l+=u.shrink*r,f=l+u.x*(1-r)),u.x=f;else for(r=realwidth/f,f=0;u;u=u.ts_next)u.seqst&&(f=u.x*r),u.x=f;else for(f=0;u;u=u.ts_next)u.seqst&&(f=u.xmax*i+u.x*(1-i)),u.x=f;if(c)for(u=tsfirst;u;u=u.ts_next)if(u.type==GRACE)for(f=u.x-u.wl+Number(cfmt.gracespace[0]),a=u.extra;a;a=a.next)a.type==NOTE&&(a.x+=f)}function new_music_line(){var e,t,n,r=voice_tb.length;for(n=0;r>n;n++)e=voice_tb[n],t=e.s_next,e.sym=t,t&&(t.prev=null)}function gen_init(){for(var e=tsfirst;e;e=e.ts_next){switch(e.new_sy&&(e.new_sy=!1,cur_sy=cur_sy.next),e.type){case CLEF:case KEY:case METER:continue;case FORMAT:if(!e.extra&&(unlksym(e),!tsfirst))return}return}tsfirst=null}function output_music(){var e,t,n,r,i;if(user.get_abcmodel&&user.get_abcmodel(tsfirst,voice_tb,anno_type,info),user.img_out&&(gen_init(),tsfirst)){for(set_global(),voice_tb.length>1&&(combine_voices(),set_stem_dir()),t=0;t<voice_tb.length;t++)set_beams(voice_tb[t].sym);for(set_stems(),voice_tb.length>1&&(set_rest_offset(),set_overlap()),set_acc_shft(),set_allsymwidth(null),r=set_indent(),cfmt.singleline?(n=get_ck_width()+get_width(tsfirst,null,r),cfmt.pagewidth=(n+cfmt.leftmargin+cfmt.rightmargin)*cfmt.scale):(n=(cfmt.pagewidth-cfmt.leftmargin-cfmt.rightmargin)/cfmt.scale,50>n&&(error(1,null,"Bad page width "+n),n=10*CM),cut_tune(n,r)),beta_last=0;;){if(set_piece(),r=set_indent(),set_sym_glue(n-r),0!=r&&(posx+=r),e=output,output=void 0,draw_sym_near(),output=e,i=set_staff(),delayed_update(),draw_systems(r),draw_all_sym(),draw_all_deco(),set_sscale(-1),vskip(i),0!=r&&(posx-=r,insert_meter&=-3),tsfirst=tsnext,!tsnext)break;if(gen_init(),!tsfirst)break;blk_out(),tsfirst.ts_prev=null,new_music_line()}}}function reset_gen(){insert_meter=cfmt.writefields.indexOf("M")>=0?3:2}function new_clef(e){var t={type:CLEF,ctx:parse.ctx,istart:parse.istart,iend:parse.iend,clef_line:2,clef_type:"t"},n=1;switch(e[0]){case'"':n=e.indexOf('"'),t.clef_name=e.slice(1,n),n++;break;case"a":if("u"==e[1]){t.clef_type="a",t.clef_auto=!0,n=4;break}n=4;case"C":t.clef_type="c",t.clef_line=3;break;case"b":n=4;case"F":t.clef_type="b",t.clef_line=4;break;case"n":n=4,t.invisible=!0;break;case"t":if("e"==e[1]){t.clef_type="c",t.clef_line=4;break}n=6;case"G":break;case"p":n=4;case"P":t.clef_type="p",t.clef_line=3;break;default:return parse.line.error("unknown clef '"+e+"'"),void delete t}if(e[n]>="1"&&e[n]<="9"&&(t.clef_line=Number(e[n]),n++),"8"!=e[n+1])return t;switch(e[n]){case"^":t.clef_oct_transp=!0;case"+":t.clef_octave=7;break;case"_":t.clef_oct_transp=!0;case"-":t.clef_octave=-7;break;default:return t}return t}function get_transp(e){var t,n,r,s=[];if("0"==e[0])return 0;if("123456789-+".indexOf(e[0])>=0){if(t=3*parseInt(e),isNaN(t)||-108>t||t>108)return void parse.line.error("Bad %%transpose value");switch(e[e.length-1]){default:return t;case"#":t++;break;case"b":t+=2}return t>0?t:t-3}for(n=new scanBuf,n.buffer=e,n.index=0,n.ctx=parse.ctx,i=0;i<2;i++){if(r=parse_acc_pit(n),!r)return void parse.line.error("Bad %%transpose value");r.pit+=124,t=12*Math.floor(r.pit/7)+pit_st[r.pit%7],r.acc&&3!=r.acc&&(t+=r.acc),s[i]=t}switch(t=3*(s[1]-s[0]),r.acc){default:return t;case 2:case 1:t++;break;case-1:case-2:t+=2}return t>0?t:t-3}function set_linebreak(e){var t,n;for(t=0;128>t;t++)if("\n"==char_tb[t]){char_tb[t]=nil;break}for(e=e.split(/\s+/),t=0;t<e.length;t++){switch(n=e[t]){case"!":case"$":case"*":case";":case"?":case"@":break;case"<none>":continue;case"<EOL>":n="\n";break;default:parse.line.error("Bad value '"+n+"' in %%linebreak - ignored");continue}char_tb[n.charCodeAt(0)]="\n"}}function set_user(e){var t,n,r,i=e[0],s="!",a=e.indexOf("!");if(0>a){if(a=e.indexOf('"'),0>a)return void parse.line.error('Lack of starting ! or " in U:/%%user');s='"'}if(t=e.indexOf(s,a+1),0>t)return void parse.line.error("Lack of ending "+s+" in U:/%%user");if("\\"==i&&(i=e[1],"t"==i&&(i="	")),n=i.charCodeAt(0),n>=128)return void parse.line.error(not_ascii);switch(char_tb[n][0]){case"0":case"d":case"i":case" ":break;case'"':case"!":if(char_tb[n].length>1)break;default:return void parse.line.error("Bad user character '"+i+"'")}switch(r=e.slice(a,t+1)){case"!beambreak!":r=" ";break;case"!ignore!":r="i";break;case"!nil!":case"!none!":r="d"}char_tb[n]=r}function get_st_lines(e){var t,n;if("|"==e[0]||"."==e[0])return e;switch(t=parseInt(e)){case 0:return"...";case 1:return"..|";case 2:return".||";case 3:return"|||."}if(!(isNaN(t)||0>t||t>16)){for(n="|";--t>0;)n+="|";return n}}function new_block(e){2==parse.state&&goto_tune();var t={type:BLOCK,subtype:e};return curvoice=voice_tb[0],curvoice.last_sym&&(curvoice.last_sym.eoln=!0),sym_link(t),t}function do_pscom(e){var t,n,r,i,s,a,o,c=!1;if(e.match(/ lock$/)&&(c=!0,e=e.slice(0,-5).trim()),i=e.match(/(\w|-)+/)){switch(i=i[0],s=e.replace(i,"").trim(),i){case"break":return;case"center":return parse.state>=2?(r=new_block("center"),void(r.text=cnv_escape(s))):void write_text(cnv_escape(s),"c");case"clef":return void(parse.state>=2&&(2==parse.state&&goto_tune(),r=new_clef(s),r&&get_clef(r)));case"clip":return;case"deco":return void deco_add(s);case"linebreak":return void set_linebreak(s);case"map":return void get_map(s);case"maxsysstaffsep":if(3==parse.state)return void(par_sy.voices[curvoice.v].maxsep=get_unit(s));break;case"multicol":switch(generate(),s){case"start":blk_out(),multicol={posy:posy,maxy:posy,lmarg:cfmt.leftmargin,rmarg:cfmt.rightmargin,state:parse.state};break;case"new":if(!multicol){parse.line.error("%%multicol new without start");break}posy>multicol.maxy&&(multicol.maxy=posy),cfmt.leftmargin=multicol.lmarg,posx=cfmt.leftmargin/cfmt.scale,cfmt.rightmargin=multicol.rmarg,posy=multicol.posy;break;case"end":if(!multicol){parse.line.error("%%multicol end without start");break}cfmt.leftmargin=multicol.lmarg,posx=cfmt.leftmargin/cfmt.scale,cfmt.rightmargin=multicol.rmarg,posy<multicol.maxy&&(posy=multicol.maxy),multicol=void 0,blk_out();break;default:parse.line.error("Unknown keyword '"+s+"' in %%multicol")}return;case"repbra":return void(parse.state>=2&&(2==parse.state&&goto_tune(),curvoice.norepbra=!get_bool(s)));case"repeat":if(3!=parse.state){if(2!=parse.state)return;goto_tune()}if(!curvoice.last_sym)return void parse.line.error("%%repeat cannot start a tune");if(s.length){var u=s.split(/\s+/);if(a=parseInt(u[0]),o=parseInt(u[1]),isNaN(a)||1>a||curvoice.last_sym.type==BAR&&a>2)return void parse.line.error("Incorrect 1st value in %%repeat");if(isNaN(o))o=1;else if(1>o)return void parse.line.error("Incorrect 2nd value in repeat")}else a=1,o=1;return r={type:FORMAT,fmt_type:"repeat",repeat_k:o},curvoice.last_sym.type==BAR?r.repeat_n=a:r.repeat_n=-a,void sym_link(r);case"sep":lwidth=cfmt.pagewidth-cfmt.leftmargin-cfmt.rightmargin;var l,f;if(t=l=f=0,s){var d=s.split(/\s+/);t=get_unit(d[0]),d[1]&&(l=get_unit(d[1]),d[2]&&(f=get_unit(d[2])))}return 1>t&&(t=14),1>l&&(l=t),1>f&&(f=90),parse.state>=2?(r=new_block("sep"),r.x=(lwidth-f)/2/cfmt.scale,r.l=f/cfmt.scale,r.sk1=t,void(r.sk2=l)):(vskip(t),output.push('<path class="stroke"\n	d="M'),out_sxsy((lwidth-f)/2/cfmt.scale," ",0),output.push("h"+(f/cfmt.scale).toFixed(2)+'"/>\n'),vskip(l),void blk_out());case"setbarnb":return n=parseInt(s),isNaN(n)?void parse.line.error("Bad %%setbarnb value"):void(parse.state>=2?glovar.new_nbar=n:cfmt.measurefirst=n);case"staff":if(3!=parse.state){if(2!=parse.state)return;goto_tune()}if(n=parseInt(s),isNaN(n))return void parse.line.error("Bad %%staff value '"+s+"'");var p;return p="+"==s[0]||"-"==s[0]?curvoice.cst+n:n-1,0>p||p>nstaff?void parse.line.error("Bad %%staff number "+p+" cur "+curvoice.cst+" max "+nstaff):(delete curvoice.floating,void(curvoice.cst=p));case"staffbreak":if(3!=parse.state){if(2!=parse.state)return;goto_tune()}return r={type:STBRK},s[0]>="0"&&s[0]<="9"?(r.xmx=get_unit(s),"f"==s[s.length-1]&&(r.stbrk_forced=!0)):(r.xmx=14,"f"==s[0]&&(r.stbrk_forced=!0)),void sym_link(r);case"stafflines":return(n=get_st_lines(s))?curvoice?void(curvoice.stafflines=n):void(glovar.stafflines=n):void parse.line.error("Bad %%stafflines value");case"staffscale":return n=parseFloat(s),isNaN(n)||.3>n||n>2?void parse.line.error("Bad %%staffscale value"):curvoice?void(curvoice.staffscale=n):void(glovar.staffscale=n);case"staves":case"score":if(0==parse.state)return;return void get_staves(i,s);case"sysstaffsep":if(3==parse.state)return void(par_sy.voices[curvoice.v].sep=get_unit(s));break;case"text":return parse.state>=2?(r=new_block("text"),r.text=cnv_escape(s),void(r.opt=cfmt.textoption)):void write_text(cnv_escape(s),cfmt.textoption);case"transpose":if(2==parse.state&&goto_tune(),n=get_transp(s),!curvoice)return void(0==parse.state?cfmt.transpose=n:cfmt.transpose+=n);if(curvoice.ckey.k_bagpipe||curvoice.ckey.k_drum)return;if(curvoice.transpose=n+cfmt.transpose,r=curvoice.sym,!r)return curvoice.key=clone(curvoice.okey),key_transp(curvoice.key,curvoice.transpose),curvoice.ckey=clone(curvoice.key),void(curvoice.key.k_none&&(curvoice.key.k_sf=0));for(;r.type!=KEY;)if(r.time!=curvoice.time||!(r=r.prev)){r=sym_add(curvoice),r.type=KEY,r.k_old_sf=curvoice.key.k_sf;break}return r.k_sf=curvoice.okey.k_sf,curvoice.okey.k_none&&(r.k_none=curvoice.okey.k_none),curvoice.okey.k_a_acc&&(r.k_a_acc=curvoice.okey.k_a_acc),key_transp(r,curvoice.transpose),curvoice.ckey=clone(r),void(curvoice.key.k_none&&(r.k_sf=0));case"tune":return;case"user":return void set_user(s);case"voicecolor":if(parse.state<2)return;return 2==parse.state&&goto_tune(),r={type:FORMAT,fmt_type:"voicecolor"},"#000000"!=s&&"black"!=s&&(r.color=s),void sym_link(r);case"vskip":return n=get_unit(s),0>n?void parse.line.error("%%vskip cannot be negative"):parse.state>=2?(r=new_block("vskip"),void(r.sk=n)):(vskip(n),void blk_out());case"newpage":case"leftmargin":case"rightmargin":case"scale":return 2==parse.state&&goto_tune(),3==parse.state&&(generate(),blk_out()),"newpage"==i?void(block.newpage=!0):(set_format(i,s,c),void(posx=cfmt.leftmargin/cfmt.scale))}set_format(i,s,c)}}function do_begin_end(type,opt,text){var i,j,action,s;switch(type){default:case"ps":wpsobj&&(wpsobj.parse(text),output.push(svgbuf));break;case"js":eval(text);break;case"ml":parse.state>=2?(s=new_block("ml"),s.text=text):(svg_flush(),user.img_out(text));break;case"svg":for(j=0;;)if(i=text.indexOf('<style type="text/css">\n',j),i>=0){if(j=text.indexOf("</style>",i),0>j){parse.line.error("No </style> in %%beginsvg sequence");break}style+=text.slice(i+23,j)}else{if(i=text.indexOf("<defs>",j),!(i>=0))break;if(j=text.indexOf("</defs>",i),0>j){parse.line.error("No </defs> in %%beginsvg sequence");break}defs_add(text.slice(i+6,j))}break;case"text":if(action=get_textopt(opt),parse.state>=2){s=new_block("text"),s.text=text,s.opt=get_textopt(opt);break}write_text(text,action)}}function next_word(e,t){for(;e[t]&&" "!=e[t];)t++;for(;" "==e[t];)t++;return t}function parse_kv_args(e){var t,n,r=curvoice;for(r||(r=parse.voice_param={});;){if(n=e.shift(),!n)break;switch(n){case"clef=":t=new_clef(e.shift());break;case"octave=":r.octave=Number(e.shift());break;case"map=":r.map=e.shift();break;case"cue=":r.scale="on"==e.shift()?.7:1;break;case"stafflines=":if(n=get_st_lines(e.shift()),!n){parse.line.error("Bad stafflines= value");break}r.stafflines=n;break;default:switch(n.slice(0,4)){case"treb":case"bass":case"alto":case"teno":case"perc":t=new_clef(n);break;default:"GFC".indexOf(n[0])>=0?t=new_clef(n):"="==n[n.length-1]&&e.shift()}}}return t}function new_key(e){var t,n,r,i,s={type:KEY,ctx:parse.ctx,istart:parse.istart,iend:parse.iend,k_delta:0};if(!e.length)return[s,null];switch(t=1,e[0]){case"A":s.k_sf=3;break;case"B":s.k_sf=5;break;case"C":s.k_sf=0;break;case"D":s.k_sf=2;break;case"E":s.k_sf=4;break;case"F":s.k_sf=-1;break;case"G":s.k_sf=1;break;case"H":switch(e[1]){case"P":s.k_bagpipe="P",t++;break;case"p":s.k_bagpipe="p",s.k_sf=2,t++;break;default:parse.line.error("Unknown bagpipe-like key")}n=!0;break;case"P":s.k_drum=!0,n=!0;break;case"n":"none"==e.slice(0,4)&&(s.k_sf=0,s.k_none=!0,t=4);default:n=!0}if(!n){switch(e[t]){case"#":s.k_sf+=7,t++;break;case"b":s.k_sf-=7,t++}switch(e=e.slice(t).trim(),e.slice(0,3).toLowerCase()){case"aeo":case"m":case"min":s.k_sf-=3;break;case"dor":s.k_sf-=2;break;case"ion":case"maj":break;case"loc":s.k_sf-=5;break;case"lyd":s.k_sf+=1;break;case"mix":s.k_sf-=1;break;case"phr":s.k_sf-=4;break;default:if("m"==e[0]&&(" "==e[1]||"	"==e[1]||"\n"==e[1])){s.k_sf-=3;break}n=!0}if(n||(e=e.replace(/\w+\s*/,"")),"exp "==e.slice(0,4)&&(e=e.replace(/\w+\s*/,""),e||parse.line.error("no accidental after 'exp'"),s.k_exp=!0),r=e[0],"^"==r||"_"==r||"="==r){s.k_a_acc=[],i=new scanBuf,i.buffer=e,i.index=0,i.ctx=parse.ctx;do{var a=parse_acc_pit(i);if(!a)return[s,null];var o={pit:a.pit,acc:a.acc};for(s.k_a_acc.push(o),r=i["char"]();" "==r;)r=i.next_char()}while("^"==r||"_"==r||"="==r);e=e.slice(i.index)}else s.k_exp&&"none"==e.slice(0,4)&&(s.k_sf=0,e=e.replace(/\w+\s*/,""))}return s.k_delta=(cgd2cde[(s.k_sf+7)%7]+14)%7,e?[s,parse_kv_args(info_split(e,0))]:[s,null]}function get_map(e){if(e){var t,n,r,i,s,a,o=info_split(e,2);if(o.length<3)return void parse.line.error("Not enough parameters");if(a=o[1],"octave,"==a.slice(0,7)||"key,"==a.slice(0,4))a=a.replace(/[,']+$/m,"").toLowerCase(),"k"==a[0]&&(a=a.replace(/[_=^]+/,""));else if("*"==a[0]||"all"==a.slice(0,3))a="all";else{if(s=new scanBuf,s.buffer=o[1],s.index=0,s.ctx=parse.ctx,n=parse_acc_pit(s),!n)return void parse.line.error("Bad note in %%map");for(a="abcdefg"[(n.pit+77)%7],n.acc&&(a=["__","_","","^","^^","="][n.acc+2]+a),t=n.pit;t>=28;t-=7)a+="'";for(t=n.pit;21>t;t+=7)a+=","}if(maps||(maps={}),r=maps[o[0]],r||(maps[o[0]]=r={}),i=r[a],i||(r[a]=i=[]),o[2]){if(t=2,o[2].indexOf("=")<0){if("*"!=o[2][0]&&(s=new scanBuf,s.buffer=o[2],s.index=0,s.ctx=parse.ctx,i[1]=parse_acc_pit(s)),!o[3])return;t++,o[3].indexOf("=")<0&&(i[0]=o[3].split(","),t++)}for(;t<o.length;t++)switch(o[t]){case"heads=":i[0]=o[++t].split(",");break;case"print=":s=new scanBuf,s.buffer=o[++t],s.index=0,s.ctx=parse.ctx,i[1]=parse_acc_pit(s);break;case"color=":i[2]=o[++t]}}}}function new_meter(text){var s={type:METER,ctx:parse.ctx,istart:parse.istart,iend:parse.iend,a_meter:[]},meter={},val,v,m1=0,m2,i=0,j,wmeasure,p=text,in_parenth;if(0==p.indexOf("none"))i=4,wmeasure=1;else for(wmeasure=0;i<text.length&&"="!=p[i];){switch(p[i]){case"C":meter.top=p[i++],"|"==p[i]&&(meter.top+=p[i++]),m1=4,m2=4;break;case"c":case"o":m1="c"==p[i]?4:3,m2=4,meter.top=p[i++],"."==p[i]&&(meter.top+=p[i++]);break;case"(":for("("==p[i+1]&&(in_parenth=!0,meter.top=p[i++],s.a_meter.push(meter),meter={}),j=i+1;j<text.length&&")"!=p[j]&&"/"!=p[j];)j++;if(")"==p[j]&&"/"==p[j+1]){i++;continue}case")":in_parenth="("==p[i],meter.top=p[i++],s.a_meter.push(meter),meter={};continue;default:if(p[i]<="0"||p[i]>"9")return void parse.line.error("Bad char '"+p[i]+"' in M:");for(m2=2,meter.top=p[i++];;){for(;p[i]>="0"&&p[i]<="9";)meter.top+=p[i++];if(")"==p[i]){if("/"!=p[i+1])break;i++}if("/"==p[i]){if(i++,p[i]<="0"||p[i]>"9")return void parse.line.error("Bad char '"+p[i]+"' in M:");for(meter.bot=p[i++];p[i]>="0"&&p[i]<="9";)meter.bot+=p[i++];break}if(" "!=p[i]&&"+"!=p[i])break;if(i>=text.length||"("==p[i+1])break;meter.top+=p[i++]}m1=parseInt(meter.top)}for(in_parenth||(meter.bot&&(m2=parseInt(meter.bot)),wmeasure+=m1*BASE_LEN/m2),s.a_meter.push(meter),meter={};" "==p[i];)i++;"+"==p[i]&&(meter.top=p[i++],s.a_meter.push(meter),meter={})}if("="==p[i]){if(val=p.substring(++i),!val.match(/^(\d|\/)+$/))return void parse.line.error("Bad duration '"+val+"' in M:");wmeasure=BASE_LEN*eval(val)}if(s.wmeasure=wmeasure,3!=parse.state){if(info.M=text,glovar.meter=s,parse.state>=1)for(glovar.ulen||(1>=wmeasure||wmeasure>=3*BASE_LEN/4?glovar.ulen=BASE_LEN/8:glovar.ulen=BASE_LEN/16),v=0;v<voice_tb.length;v++)voice_tb[v].meter=s,voice_tb[v].wmeasure=wmeasure}else curvoice.wmeasure=wmeasure,is_voice_sig()?(curvoice.meter=s,reset_gen()):sym_link(s)}function new_tempo(e){if(!(cfmt.writefields.indexOf("Q")<0)){var t,n,r,i=0,s={type:TEMPO,ctx:parse.ctx,istart:parse.istrt,iend:parse.iend};if('"'==e[0]){if(i=e.indexOf('"',1),0>i)return void parse.line.error("Unterminated string in Q:");for(s.tempo_str1=e.slice(1,i),i++;" "==e[i];)i++}for(r=new scanBuf,r.buffer=e,r.index=i;;){if(t=r["char"](),void 0==t||"0">=t||t>"9")break;for(n=parse_dur(r),s.tempo_notes||(s.tempo_notes=[]),s.tempo_notes.push(BASE_LEN*n[0]/n[1]);;){if(t=r["char"]()," "!=t)break;r.advance()}}if("="==t){for(t=r.next_char();" "==t;)t=r.next_char();for(s.tempo_value="";t&&'"'!=t;)s.tempo_value+=t,t=r.next_char();s.tempo_value=s.tempo_value.replace(/\s+$/,"")}if('"'==t){if(r.advance(),i=e.indexOf('"',r.index+1),0>i)return void parse.line.error("Unterminated string in Q:");s.tempo_str2=e.slice(r.index,i)}if(3!=parse.state){if(1==parse.state)return info.Q=e,void(glovar.tempo=s);goto_tune()}curvoice.v==par_sy.top_voice&&sym_link(s)}}function do_info(info_type,text){switch(info_type){case"I":do_pscom(text);break;case"L":if(text.match(/^\d*\/\d*$/))text=BASE_LEN*eval(text);else{if("auto"!=text){parse.line.error("Bad L: value");break}text=-1}2==parse.state&&goto_tune(),3!=parse.state?glovar.ulen=Number(text):curvoice.ulen=Number(text);break;case"M":new_meter(text);break;case"U":set_user(text);break;case"P":if(0==parse.state)break;if(1==parse.state){info.P=text;break}if(2==parse.state&&goto_tune(),cfmt.writefields.indexOf("P")<0)break;var s={type:PART,ctx:parse.ctx,istart:parse.istart,iend:parse.iend,text:text},p_voice=voice_tb[par_sy.top_voice];if(curvoice.v!=p_voice.v){if(curvoice.time!=p_voice.time)break;if(p_voice.last_sym&&p_voice.last_sym.type==PART)break;var curvoice_sav=curvoice;curvoice=p_voice,sym_link(s),curvoice=curvoice_sav}else sym_link(s);break;case"Q":if(0==parse.state)break;new_tempo(text);break;case"V":if(0==parse.state)break;2==parse.state&&goto_tune(),get_voice(text),!curvoice.last_sym&&parse.voice_opts&&voice_filter();break;case"K":get_key_clef(new_key(text));break;case"k":parse.line.error("k: is obsolete - use %%map instead"),get_map(text);break;case"N":case"R":info[info_type]?info[info_type]+="\n"+text:info[info_type]=text;break;default:parse.line.error("'"+info_type+":' line ignored")}}function adjust_dur(e){var t,n,r,i,s;if(t=curvoice.last_sym,t&&t.type!=MREST&&t.type!=BAR){for(;t.type!=BAR&&t.prev;)t=t.prev;
if(n=t.time,r=curvoice.time-n,0==n){for(;t&&!t.dur;)t=t.next;t&&t.type==REST&&t.invisible&&(n+=t.dur*curvoice.wmeasure/r,t.prev?t.prev.next=t.next:curvoice.sym=t.next,t.next&&(t.next.prev=t.prev),t=t.next)}if(curvoice.wmeasure!=r){for(;t;t=t.next)if(t.time=n,t.dur&&!t.grace&&(t.dur=t.dur*curvoice.wmeasure/r,t.dur_orig=t.dur_orig*curvoice.wmeasure/r,n+=t.dur,t.type==NOTE||t.type==REST)){for(i=0;i<=t.nhd;i++)t.notes[i].dur=t.notes[i].dur*curvoice.wmeasure/r;s=identify_note(t,t.dur_orig),t.head=s[0],t.dots=s[1],t.nflags=s[2],t.nflags<=-2?t.stemless=!0:delete t.stemless}curvoice.time=e.time=n}}}function new_bar(){var e,t,n,r=parse.line,i={type:BAR,ctx:parse.ctx,multi:0};for(i.istart=parse.bol+r.index,vover&&vover.bar&&get_vover("|"),glovar.new_nbar&&(i.bar_num=glovar.new_nbar,delete glovar.new_nbar),n=r["char"](),":"==n&&(i.rbstop=2);;){switch(t=r.next_char()){case"|":case"[":case"]":case":":n+=t;continue}break}if(gchord&&(gch_build(i),gchord=null),a_dcn&&(deco_cnv(a_dcn,i),a_dcn=null),t>"0"&&"9">=t){for(i.text=t;;){if(t=r.next_char(),"0123456789,.-".indexOf(t)<0)break;i.text+=t}i.rbstop=2,i.rbstart=2}else if('"'==t&&"["==n){for(i.text="";;){if(t=r.next_char(),!t)return void r.error("No end of repeat string");if('"'==t){r.advance();break}"\\"==t&&(t=r.next_char()),i.text+=t}i.text=cnv_escape(i.text),i.rbstop=2,i.rbstart=2}switch(n[n.length-1]){case"[":i.rbstart||(n=n.slice(0,-1),r.index--);break;case":":i.rbstop=2}if("]"==n[0]&&(i.rbstop=2,1!=n.length?n=n.slice(1):i.invisible=!0),i.iend=parse.bol+r.index,i.rbstart&&curvoice.norepbra&&!curvoice.second&&(i.norepbra=!0),curvoice.ulen<0&&adjust_dur(i),e=curvoice.last_sym,e&&e.type==BAR){if("["==n&&!e.text&&!e.a_gch&&(0==curvoice.st||par_sy.staves[curvoice.st-1].flags&STOP_BAR||i.norepbra))return i.text&&(e.text=i.text),i.a_gch&&(e.a_gch=i.a_gch),i.norepbra&&(e.norepbra=i.norepbra),i.rbstart&&(e.rbstart=i.rbstart),void(i.rbstop&&(e.rbstop=i.rbstop));if("|:"==n&&!i.text&&":|"==e.bar_type)return e.bar_type="::",void(e.rbstop=2)}switch(n){case"[":i.rbstop=2;case"[]":case"[|]":i.invisible=!0,n="[]";break;case":|:":case":||:":n="::"}i.bar_type=n,curvoice.lyric_restart||(curvoice.lyric_restart=i),e&&e.type==KEY?(curvoice.last_sym=e.prev,curvoice.last_sym||(curvoice.sym=null),sym_link(i),i.next=e,e.prev=i,curvoice.last_sym=e):sym_link(i),i.st=curvoice.st,i.rbstart&&!curvoice.norepbra&&curvoice.st>0&&!(par_sy.staves[curvoice.st-1].flags&STOP_BAR)&&(e={type:BAR,ctx:i.ctx,istart:i.istart,iend:i.iend,bar_type:"[",multi:0,invisible:!0,text:i.text,rbstart:2},sym_link(e),e.st=curvoice.st,i.text=void 0,i.rbstart=0)}function parse_staves(e){for(var t,n=[],r=!1,i=0,s=0,a=0,o=0,c=0,u=e,l=0;l<u.length;){switch(u[l]){case" ":case"	":break;case"[":if(o||s+a>=2){parse.line.error("Misplaced '[' in %%staves"),r=!0;break}i|=s+a==0?OPEN_BRACKET:OPEN_BRACKET2,a++,c<<=8,c|=OPEN_BRACKET;break;case"{":if(o||s||a>=2){parse.line.error("Misplaced '{' in %%staves"),r=!0;break}i|=0==a?OPEN_BRACE:OPEN_BRACE2,s++,c<<=8,c|=OPEN_BRACE;break;case"(":if(o){parse.line.error("Misplaced '(' in %%staves"),r=!0;break}i|=OPEN_PARENTH,o++,c<<=8,c|=OPEN_PARENTH;break;case"*":!s||o||i&(OPEN_BRACE|OPEN_BRACE2)||(i|=FL_VOICE);break;case"+":i|=MASTER_VOICE;break;default:if(!u[l].match(/\w/)){parse.line.error("Bad voice ID in %%staves"),r=!0;break}for(var f="";l<u.length&&!(" 	()[]{}|*".indexOf(u[l])>=0);)f+=u[l++];for(t={v:new_voice(f).v};l<u.length;l++){switch(u[l]){case" ":case"	":continue;case"]":if(!(c&OPEN_BRACKET)){parse.line.error("Misplaced ']' in %%staves"),r=!0;break}a--,i|=s+a==0?CLOSE_BRACKET:CLOSE_BRACKET2,c>>=8;continue;case"}":if(!(c&OPEN_BRACE)){parse.line.error("Misplaced '}' in %%staves"),r=!0;break}s--,i|=0==a?CLOSE_BRACE:CLOSE_BRACE2,i&=~FL_VOICE,c>>=8;continue;case")":if(!(c&OPEN_PARENTH)){parse.line.error("Misplaced ')' in %%staves"),r=!0;break}o--,i|=CLOSE_PARENTH,c>>=8;continue;case"|":i|=STOP_BAR;continue}break}t.flags=i,n.push(t),i=0;continue}l++}return 0!=c&&(parse.line.error("'}', ')' or ']' missing in %%staves"),r=!0),r&&(n=null),n}function info_split(e,t){var n,r,i=[],s="",a=e.length;for(n=0;a>n;n++)switch(e[n]){case"=":if(!s){s="=";break}if(s+="=",i.length<t)break;i.push(s),s="";break;case" ":case"	":if(!s)break;i.push(s),s="";break;case'"':for(s&&(i.push(s),s=""),r=++n;a>n&&'"'!=e[n];)"\\"==e[n]&&n++,n++;if('"'!=e[n]){parse.line.error("Unterminated string");break}i.push(e.slice(r,n));break;case"\\":s+=e[n++];default:s+=e[n]}return s&&i.push(s),i}function parse_voice(e){var t,n=info_split(e,1),r=n.shift();curvoice=new_voice(r),void 0==curvoice.time&&(curvoice.time=0,3==parse.state&&0>staves_found&&(t=curvoice.v,curvoice.st=curvoice.cst=++nstaff,par_sy.nstaff=nstaff,par_sy.voices[t].st=nstaff,par_sy.voices[t].range=t,par_sy.staves[nstaff]={stafflines:"|||||",staffscale:1}));for(var i=0;i<n.length;i++)switch(n[i]){case"name=":case"nm=":curvoice.nm=n[++i],curvoice.new_name=!0;break;case"subname=":case"sname=":case"snm=":curvoice.snm=n[++i];break;case"stem=":set_pos("stem",n[++i]);break;default:"="==n[i][n[i].length-1]&&i++}return parse_kv_args(n)}function identify_note(e,t){var n,r,i;for(t%12!=0&&parse.line.error("Invalid note duration "+t),t/=12,0==t&&parse.line.error("Note too short"),i=5;0!=t&&!(1&t);t>>=1,i--);switch(t>>=1){case 0:r=0;break;case 1:r=1;break;case 3:r=2;break;case 7:r=3;break;default:r=3}if(i-=r,i>=0)n="full";else switch(i){default:parse.line.error("Note too long"),i=-4;case-4:n="square";break;case-3:n=cfmt.squarebreve?"square":"oval";break;case-2:n="oval";break;case-1:n="empty"}return[n,r,i]}function parse_dur(e){var t,n;if(c=e["char"](),c>"0"&&c<="9"?(t=e.get_int(),c=e["char"]()):t=1,"/"==c)if(n=2,c=e.next_char(),"/"==c){do n*=2,c=e.next_char();while("/"==c)}else c>"0"&&c<="9"&&(n=e.get_int());else n=1;return[t,n]}function parse_acc_pit(e){var t,n,r,i,s=e["char"]();switch(s){case"^":s=e.next_char(),"^"==s?(t=2,s=e.next_char()):t=1;break;case"=":t=3,s=e.next_char();break;case"_":s=e.next_char(),"_"==s?(t=-2,s=e.next_char()):t=-1}if((t&&s>="1"&&"9">=s||"/"==s)&&(nd=parse_dur(e),n=nd[0],r=nd[1],1==r?r=curvoice.microscale:r*=2,s=e["char"]()),i="CDEFGABcdefgab".indexOf(s)+16,s=e.next_char(),16>i)return void e.error("'"+e.buffer[e.index-1]+"' is not a note");for(;"'"==s;)i+=7,s=e.next_char();for(;","==s;)i-=7,s=e.next_char();return note={pit:i,apit:i,shhd:0,shac:0,ti1:0},t&&(note.acc=t,n&&(note.micro_n=n,note.micro_d=r)),note}function set_map(e){var t,n,r,i,s=maps[curvoice.map];for(t="abcdefg"[(e.pit+77)%7],n=e.acc?["__","_","","^","^^","="][e.acc+2]:"",r=n+t,i=e.pit;i>=28;i-=7)r+="'";for(i=e.pit;21>i;i+=7)r+=",";if(s[r])e.map=s[r],e.map[1]&&(e.apit=e.pit=e.map[1].pit,e.acc=e.map[1].acc);else{if(r="octave,"+n+t,!s[r]&&(r="key,"+n+"abcdefg"[(e.pit+77-curvoice.ckey.k_delta)%7],!s[r]&&(r="all",!s[r])))return;e.map=s[r]}}function parse_basic_note(e,t){var n,r=parse_acc_pit(e);return r?("0"==e["char"]()&&(parse.stemless=!0,e.advance()),n=parse_dur(e),r.dur=t*n[0]/n[1],r):null}function parse_vpos(){var e,t=parse.line,n=0;return"."!=t.buffer[t.index-1]||a_dcn||(n=SL_DOTTED),e=t.next_char(),"'"==e?(n+=SL_ABOVE,t.index++):","==e?(n+=SL_BELOW,t.index++):n+=SL_AUTO,n}function sort_pitch(e){function t(e,t){return e.pit-t.pit}e.notes=e.notes.sort(t)}function new_note(e,t){var n,r,i,s,a,o,c,u,l,f,d,p,h=0,m=parse.line,v=a_dcn;switch(a_dcn=void 0,parse.stemless=!1,r={type:NOTE,ctx:parse.ctx,stem:0,multi:0,nhd:0,xmx:0},r.istart=parse.bol+m.index,e?r.grace=!0:gchord&&(gch_build(r),gchord=void 0),s=m["char"]()){case"X":r.invisible=!0;case"Z":if(r.type=MREST,s=m.next_char(),s>"0"&&"9">=s?r.nmes=m.get_int():r.nmes=1,r.dur=curvoice.wmeasure*r.nmes,curvoice.second)return curvoice.time+=r.dur,null;break;case"y":r.type=SPACE,r.invisible=!0,s=m.next_char(),s>="0"&&"9">=s?r.width=m.get_int():r.width=10;break;case"x":r.invisible=!0;case"z":r.type=REST,m.advance(),l=parse_dur(m),r.dur=r.dur_orig=(curvoice.ulen<0?BASE_LEN/4:curvoice.ulen)*l[0]/l[1],r.notes=[{pit:18,dur:r.dur}];break;case"[":i=!0,s=m.next_char();default:for(curvoice.microscale&&(r.microscale=curvoice.microscale),r.notes=[];;){if(i)for(;;){if(!s)break;if(o=s.charCodeAt(0),o>=128)return m.error(not_ascii),null;switch(type=char_tb[o],type[0]){case"(":h<<=4,h+=parse_vpos(),s=m["char"]();continue;case"!":if(a_dcn||(a_dcn=[]),type.length>1)a_dcn.push(type.slice(1,-1));else{for(a="";;){if(s=m.next_char(),"!"==s)break;a+=s}a_dcn.push(a)}s=m.next_char();continue}break}if(n=parse_basic_note(m,r.grace||curvoice.ulen<0?BASE_LEN/4:curvoice.ulen),!n)return null;if(curvoice.octave&&(n.apit=n.pit+=7*curvoice.octave),h&&(n.sl1=h,r.sl1?r.sl1++:r.sl1=1,h=0),a_dcn&&(n.a_dcn=a_dcn,a_dcn=null),r.notes.push(n),!i)break;for(s=m["char"]();;){switch(s){case")":n.sl2?n.sl2++:n.sl2=1,r.sl2?r.sl2++:r.sl2=1,s=m.next_char();continue;case"-":n.ti1=parse_vpos(),r.ti1=!0,s=m["char"]();continue;case".":if(s=m.next_char(),"-"!=s){m.error("Misplaced dot");break}continue}break}if("]"==s){for(m.advance(),l=parse_dur(m),r.nhd=r.notes.length-1,o=0;o<=r.nhd;o++)n=r.notes[o],n.dur=n.dur*l[0]/l[1];break}}r.dur=r.dur_orig=r.notes[0].dur}if(r.grace&&r.type!=NOTE)return m.error("Not a note in grace note sequence"),null;if(r.notes){if(r.type==NOTE&&curvoice.transpose&&note_transp(r),r.grace){var g=curvoice.key.k_bagpipe?8:4;for(o=0;o<=r.nhd;o++)r.notes[o].dur/=g;switch(r.dur/=g,r.dur_orig/=g,curvoice.pos.gst){case SL_ABOVE:r.stem=1;break;case SL_BELOW:r.stem=-1;break;case SL_HIDDEN:r.stem=2}}else{switch(curvoice.pos.ste){case SL_ABOVE:r.stem=1;break;case SL_BELOW:r.stem=-1}if(r.combine=curvoice.combine,t&&(r.dur*=t),d=curvoice.brk_rhythm){if(u=curvoice.last_note,d>0){for(c=2*d-1,r.dur=r.dur*c/d,r.dur_orig=r.dur_orig*c/d,o=0;o<=r.nhd;o++)r.notes[o].dur=r.notes[o].dur*c/d;for(u.dur/=d,u.dur_orig/=d,o=0;o<=u.nhd;o++)u.notes[o].dur/=d}else{for(d=-d,c=2*d-1,r.dur/=d,r.dur_orig/=d,o=0;o<=r.nhd;o++)r.notes[o].dur/=d;for(u.dur=u.dur*c/d,u.dur_orig=u.dur_orig*c/d,o=0;o<=u.nhd;o++)u.notes[o].dur=u.notes[o].dur*c/d}curvoice.time=u.time+u.dur,f=identify_note(u,u.dur_orig),u.head=f[0],u.dots=f[1],u.nflags=f[2],curvoice.brk_rhythm=0,u.nflags<=-2?u.stemless=!0:delete u.stemless}}if(r.type==NOTE){if(f=identify_note(r,r.dur_orig),r.head=f[0],r.dots=f[1],r.nflags=f[2],r.xstem&&(r.nflags=0),r.nflags<=-2&&(r.stemless=!0),curvoice.map&&maps[curvoice.map])for(o=0;o<=r.nhd;o++)set_map(r.notes[o])}else p=r.dur_orig,p==curvoice.wmeasure&&(p=p<2*BASE_LEN?BASE_LEN:p<4*BASE_LEN?2*BASE_LEN:4*BASE_LEN),f=identify_note(r,p),r.head=f[0],r.dots=f[1],r.nflags=f[2];curvoice.last_note=r}return sym_link(r),cfmt.shiftunison&&(r.shiftunison=cfmt.shiftunison),curvoice.lyric_restart||(curvoice.lyric_restart=r),v&&deco_cnv(v,r,r.prev),parse.stemless&&(r.stemless=!0),r.iend=parse.bol+m.index,r}function parse_music_line(){var e,t,n,r,i,s,a,o,c,u,l,f,d,p=0,h=1,m=parse.line;for(m.buffer=parse.file.slice(parse.bol,parse.eol),m.index=0;;){if(s=m["char"](),!s||"%"==s)break;if("."==s)switch(m.buffer[m.index+1]){case"(":case"-":case"|":s=m.next_char()}if(a=s.charCodeAt(0),a>=128)m.error(not_ascii),m.advance();else{switch(o=char_tb[a],o[0]){case" ":curvoice.last_note&&(curvoice.last_note.beam_end=!0);break;case"\n":if(cfmt.barsperstaff)break;0==par_sy.voices[curvoice.v].range&&curvoice.last_sym&&(curvoice.last_sym.eoln=!0);break;case"&":if(s=m.next_char(),")"==s){get_vover(")");break}get_vover("&");continue;case"(":if(s=m.next_char(),s>"0"&&"9">=s){var v=m.get_int(),g=[0,1,3,2,3,0,2,0,3,0][v],y=v,s=m["char"]();if(":"==s){if(s=m.next_char(),s>"0"&&"9">=s&&(g=m.get_int(),s=m["char"]()),":"==s){if(s=m.next_char(),!(s>"0"&&"9">=s)){m.error("Invalid 'r' in tuplet");continue}y=m.get_int(),s=m["char"]()}}else 0==g&&(g=curvoice.wmeasure%9==0?3:2);e={type:TUPLET,tuplet_p:v,tuplet_q:g,tuplet_r:y,tuplet_n:y,tuplet_f:clone(cfmt.tuplets)},sym_link(e),f=l,d=h,l=e,h*=g/v;continue}if("&"==s){get_vover("(");break}p<<=4,m.index--,p+=parse_vpos();continue;case")":if(curvoice.ignore)break;if(e=curvoice.last_sym)switch(e.type){case NOTE:case REST:case SPACE:break;default:e=null}if(!e){m.error("Bad character ')'");break}e.slur_end?e.slur_end++:e.slur_end=1;break;case"!":if(a_dcn||(a_dcn=[]),o.length>1){a_dcn.push(o.slice(1,-1));break}for(r="",i=m.index;;){if(s=m.next_char(),!s)break;if("!"==s)break;r+=s}if(!s){m.index=i,m.error("No end of decoration");break}a_dcn.push(r);break;case'"':parse_gchord(o);break;case"-":var _=0;if(!curvoice.last_note||curvoice.last_note.type!=NOTE){m.error("No note before '-'");break}for(_=parse_vpos(),e=curvoice.last_note,i=0;i<=e.nhd;i++)e.notes[i].ti1?0==e.nhd&&m.error("Too many ties"):e.notes[i].ti1=_;e.ti1=!0;continue;case"[":var b=m.buffer[m.index+1];if('|[]: "'.indexOf(b)>=0||b>="1"&&"9">=b){if(t){m.error("Cannot have a bar in grace notes");break}new_bar();continue}if(":"==m.buffer[m.index+2]){if(parse.istart=parse.bol+m.index,m.index++,i=m.buffer.indexOf("]",m.index),0>i){m.error("Lack of ']'");break}var x=m.buffer.slice(m.index+2,i).trim();m.index=i+1,parse.iend=parse.bol+m.index;var w=do_info(b,x);w&&m.error(w);continue}case"n":if(e=new_note(t,h),!e)continue;e.type==NOTE&&(e.slur_start=p,p=0,n&&(e.sappo=!0,n=!1)),t?l&&(e.in_tuplet=!0):l&&e.notes&&(e.in_tuplet=!0,l.tuplet_n--,f&&f.tuplet_n--,0==l.tuplet_n&&(l=f,h=d,l?(f=null,d=1,0==l.tuplet_n&&(l=null,h=1,curvoice.time=Math.round(curvoice.time),e.dur=curvoice.time-e.time)):(curvoice.time=Math.round(curvoice.time),e.dur=curvoice.time-e.time)));continue;case"<":if(!curvoice.last_note){m.error("No note before '"+s+"'");break}for(var k="<"==s?1:-1;"<"==s||">"==s;)k*=2,s=m.next_char();curvoice.brk_rhythm=k;continue;case"d":m.error("Bad character '"+s+"'");break;case"i":break;case"{":if(t){m.error("'{' in grace note");break}if(c=curvoice.last_note,curvoice.last_note=null,u=a_dcn,a_dcn=void 0,t=!0,s=m.next_char(),"/"==s){n=!0;break}continue;case"|":s=m.buffer[m.index-1],new_bar(),"."==s&&(curvoice.last_sym.bar_dotted=!0);continue;case"}":if(e=curvoice.last_note,!t||!e){m.error("Bad character '}'");break}if(e.gr_end=!0,t=!1,!(e.prev&&e.prev.grace||curvoice.key.k_bagpipe)){for(i=0;i<=e.nhd;i++)e.notes[i].dur*=2;e.dur*=2,e.dur_orig*=2;var E=identify_note(e,e.dur_orig);e.head=E[0],e.dots=E[1],e.nflags=E[2]}curvoice.last_note=c,a_dcn=u;break;case"\\":if(m.index==m.buffer.length-1)return;for(i=m.index+1;;i++){if(s=m.buffer[i],!s||"%"==s)return;if(" "!=s&&"	"!=s)break}default:m.error("Bad character '"+s+"'")}m.advance()}}cfmt.breakoneoln&&curvoice.last_note&&(curvoice.last_note.beam_end=!0),cfmt.barsperstaff||"\n"==char_tb["\n".charCodeAt(0)]&&0==par_sy.voices[curvoice.v].range&&curvoice.last_sym&&(curvoice.last_sym.eoln=!0)}function cwid(e){var t=e.charCodeAt(0);return t>=128&&(t=97),cw_tb[t]}function strw(e){var t,n,r,i=gene.curfont.swfac,s=0,a=e.length;for(t=0;a>t;t++){switch(r=e[t]){case"$":if(r=e[t+1],"0"==r)gene.curfont=gene.deffont;else{if(!(r>="1"&&"9">=r)){s+=cwid("$")*i;break}gene.curfont=get_font("u"+r)}t++,i=gene.curfont.swfac;continue;case"&":n=e.indexOf(";",t),n>0&&10>n-t&&(t=n,r="a")}s+=cwid(r)*i}return s}function set_font(e){gene.curfont=gene.deffont=get_font(e)}function out_str(e){var t,n,r,i=gene.curfont,s=i;for(t=0;t<e.length;t++){switch(n=e[t]){case"<":n="&lt;";break;case">":n="&gt;";break;case"'":n="&apos;";break;case'"':n="&quot;";break;case"&":if("#"==e[t+1])break;if("t"==e[t+2]&&";"==e[t+3]&&("l"==e[t+1]||"g"==e[t+1]))break;if("a"==e[t+1]&&"p"==e[t+2]&&"o"==e[t+3]&&"s"==e[t+4]&&";"==e[t+5])break;if("q"==e[t+1]&&"u"==e[t+2]&&"o"==e[t+3]&&"t"==e[t+4]&&";"==e[t+5])break;if("a"==e[t+1]&&"m"==e[t+2]&&"p"==e[t+3]&&";"==e[t+4])break;n="&amp;";break;case"$":if(n=e[++t],"0"==n)r=gene.deffont;else{if(!(n>="1"&&"9">=n)){output.push("$"+n);continue}if(r=get_font("u"+n),!r){output.push("$"+n);continue}}if(r==s)continue;if(s!=i&&output.push("</tspan>"),s=r,s==i)continue;n='<tspan\n	class="f'+r.fid+cfmt.fullsvg+'">'}output.push(n)}s!=i&&output.push("</tspan>")}function xy_str(e,t,n,r,i){output.push('<text class="f'+gene.curfont.fid+cfmt.fullsvg+'" x="'),out_sxsy(e,'" y="',t),"c"==r?output.push('" text-anchor="middle">'):"j"==r?output.push('" textLength="'+i.toFixed(2)+'">'):"r"==r?output.push('" text-anchor="end">'):output.push('">'),out_str(n),output.push("</text>\n")}function trim_title(e,t){var n;return cfmt.titletrim&&(n=e.lastIndexOf(", "),(0>n||e[n+2]<"A"||e[n+2]>"Z"||n<e.length-7||e.indexOf(" ",n+3)>=0)&&(n=0)),!t&&cfmt.writefields.indexOf("X")>=0&&(e=info.X+".  "+e),n&&(e=e.slice(n+2).trim()+" "+e.slice(0,n)),cfmt.titlecaps?e.toUpperCase():e}function write_title(e,t){var n;e&&(e=trim_title(e,t),t?(set_font("subtitle"),n=gene.curfont.size,vskip(cfmt.subtitlespace+n)):(set_font("title"),n=gene.curfont.size,vskip(cfmt.titlespace+n)),cfmt.titleleft?xy_str(0,.2*n,e):xy_str((cfmt.pagewidth-cfmt.leftmargin-cfmt.rightmargin)/2/cfmt.scale,.2*n,e,"c"))}function put_inf2r(e,t,n,r,i){n||(n=r,r=null),r?xy_str(e,t,n+" ("+r+")",i):xy_str(e,t,n,i)}function write_text(e,t){if("s"!=t){set_font("text");var n,r,i,s=(cfmt.pagewidth-cfmt.leftmargin-cfmt.rightmargin)/cfmt.scale,a=gene.curfont.size*cfmt.lineskipfac,o=gene.curfont.size*cfmt.parskipfac;switch(t){default:switch(t){case"c":i=s/2;break;case"r":i=s;break;default:i=0}for(r=0;;){if(n=e.indexOf("\n",r),0>n){vskip(a),xy_str(i,0,e.slice(r),t);break}if(n==r){for(vskip(o),blk_out();"\n"==e[n+1];)vskip(a),n++;if(n==e.length)break}else vskip(a),xy_str(i,0,e.slice(r,n),t);r=n+1}vskip(o),blk_out();break;case"f":case"j":var c;for(r=0;;){n=e.indexOf("\n\n",r),c=0>n?e.slice(r):e.slice(r,n),c=c.split(/\s+/);var u=0,l=0;for(r=0;r<c.length;r++)u+=strw(c[r]+" "),u>=s&&(vskip(a),xy_str(0,0,c.slice(l,r).join(" "),t,s),l=r,u=0);if(0!=u&&(vskip(a),xy_str(0,0,c.slice(l).join(" "))),vskip(o),blk_out(),0>n)break;for(;"\n"==e[n+2];)vskip(a),n++;if(n==e.length)break;r=n+2}}}}function put_wline(e,t,n){for(var r,i,s=0;" "==e[s];)s++;if("$"==e[s]&&e[s+1]>="0"&&e[s+1]<="9"&&(s+=2),i=0,r=s,e[s]>="0"&&e[s]<="9"||"."==e[s+1]){for(;s<e.length&&(s++," "!=e[s]&&":"!=e[s-1]&&"."!=e[s-1]););for(i=s;" "==e[s];)s++}return 0!=i&&xy_str(t,0,e.slice(r,i),"r"),s<e.length&&xy_str(t+5,0,e.slice(s),"l"),s>e.length&&0==i}function put_words(e){var t,n,r,i,s,a,o,c;blk_out(),set_font("words");var u=.5*(cfmt.pagewidth-cfmt.leftmargin-cfmt.rightmargin)/cfmt.scale,l=(u-45)/(cwid("a")*gene.curfont.swfac);for(i=0,e=e.split("\n"),s=e.length,n=0;s>n;n++){if(t=e[n],t.length>l){i=0;break}t?c=!0:c&&(i++,c=!1)}if(i>0){for(i++,i/=2,n=i,c=!1,o=0;s>o;o++){for(t=e[o],r=0;" "==t[r];)r++;if(r==t.length){if(c&&--n<=0)break;c=!1}else c=!0}a=o+1}else a=o=s;for(vskip(cfmt.wordsspace),n=0;o>n||s>a;n++){var f=.2*gene.curfont.size;o>n&&0==e[n].length&&blk_out(),vskip(cfmt.lineskipfac*gene.curfont.size-f),o>n&&put_wline(e[n],45,0),s>a&&(put_wline(e[a],20+u,1)&&0==--i&&(o>n?i++:a<e.length-1&&(u*=.6)),a++),vskip(f)}}function put_history(){var e,t,n,r,i,s,a,o=cfmt.infoname.split("\n"),c=o.length;for(e=0;c>e;e++)if(n=o[e][0],!(cfmt.writefields.indexOf(n)<0)&&(r=info[n])){for(i||(i=!0,set_font("history"),vskip(cfmt.textspace),s=gene.curfont.size*cfmt.lineskipfac),head=o[e].slice(2),(head[0]='"')&&(head=head.slice(1,-1)),vskip(s),xy_str(0,0,head),a=strw(head),r=r.split("\n"),xy_str(a,0,r[0]),t=1;t<r.length;t++)vskip(s),xy_str(a,0,r[t]);vskip(.3*s),blk_out()}}function write_headform(e){for(var t,n,r,i,s,a,o,c={},u=clone(info_font_init),l={A:cfmt.infospace,C:cfmt.composerspace,O:cfmt.composerspace,R:cfmt.infospace},f={},d="",p=cfmt.titleformat,h=0,m=0;;){for(;" "==p[m];)m++;if(m>=p.length)break;if(t=p[m++],"A">t||t>"Z")if("+"==t){if(0==d.lenth||"+"==d[d.length-1])continue;d=d.slice(0,-1)+"+"}else","==t&&("+"==d[d.length-1]&&(d=d.slice(0,-1)+"l"),d+="\n");else{if(c[t])f[t]++;else{if(!info[t])continue;c[t]=info[t].split("\n"),f[t]=1}switch(d+=t,p[m]){case"-":d+="l",m++;break;case"0":d+="c",m++;break;case"1":d+="r",m++;break;default:d+="c"}}}"+"==d[d.length-1]&&(d=d.slice(0,-1)+"l"),d+="\n";var v,g={l:cfmt.titlespace,c:cfmt.titlespace,r:cfmt.titlespace},y={l:0,c:.5*e,r:e},_={};for(p=d,m=0;;){for(_.l=_.c=_.r=a=0,h=m;;){if(t=p[h++],"\n"==t)break;if(i=p[h++],"+"==i)i=p[h+1];else if(0!=_[i])continue;v=c[t],v&&(r=u[t],r||(r="history"),n=get_font(r),o=1.1*n.size,l[t]&&(o+=l[t]),o>a&&(a=o),_[i]=o)}for(g.l+=a-_.l,g.c+=a-_.c,g.r+=a-_.r;;){if(t=p[m++],"\n"==t)break;if(i=p[m++],0!=c[t].length){if(v=c[t].shift(),"+"==i&&(f[t]--,t=p[m++],i=p[m++],c[t].length>0&&(v?v+=" "+c[t].shift():v=" "+c[t].shift())),r=u[t],r||(r="history"),n=get_font(r),o=1.1*n.size,l[t]&&(o+=l[t]),set_font(r),s=y[i],a=g[i]+o,"Q"==t){if("l"!=i){var b=tempo_width(glovar.tempo);"c"==i&&(b*=.5),s-=b}write_tempo(glovar.tempo,s,-a,.75),glovar.tempo.deleted=!0}else v&&xy_str(s,-a,v,i);if("T"==t&&(r=u.T="subtitle",l.T=cfmt.subtitlespace),f[t]<=1)for("T"==t&&(n=get_font(r),o=1.1*n.size,l[t]&&(o+=l[t]),set_font(r));c[t].length>0;)a+=o,v=c[t].shift(),xy_str(s,-a,v,i);f[t]--,g[i]=a}}if(g.c>g.l&&(g.l=g.c),g.r>g.l&&(g.l=g.r),m>=d.length)break;g.c=g.r=g.l}vskip(g.l)}function write_heading(){var e,t,n,r,i,s,a,o,c=(cfmt.pagewidth-cfmt.leftmargin-cfmt.rightmargin)/cfmt.scale;if(cfmt.titleformat&&cfmt.titleformat.length>0)return write_headform(c),void vskip(cfmt.musicspace);if(info.T&&cfmt.writefields.indexOf("T")>=0)for(e=0;;){if(t=info.T.indexOf("\n",e),0>t){write_title(info.T.substring(e),0!=e);break}write_title(info.T.slice(e,t),0!=e),e=t+1}if(set_font("composer"),a=cfmt.composerspace+gene.curfont.size,parse.ckey.k_bagpipe&&!cfmt.infoline&&cfmt.writefields.indexOf("R")>=0&&(s=info.R),s&&(xy_str(0,-cfmt.composerspace,s),a=cfmt.composerspace),n=info.A,cfmt.writefields.indexOf("C")>=0&&(r=info.C),cfmt.writefields.indexOf("O")>=0&&(i=info.O),r||i||cfmt.infoline){var u,l;if(vskip(cfmt.composerspace),cfmt.aligncomposer<0?(u=0,l=" "):0==cfmt.aligncomposer?(u=.5*c,l="c"):(u=c,l="r"),o=a,r||i){for(cfmt.aligncomposer>=0&&a!=o&&vskip(a-o),e=0;;){if(vskip(gene.curfont.size),t=r?r.indexOf("\n",e):-1,0>t){put_inf2r(u,0,r?r.substring(e):null,i,l);break}xy_str(u,0,r.slice(e,t),l),a+=gene.curfont.size,e=t+1}o>a&&vskip(o-a)}s=s?null:info.R,(s||n)&&cfmt.infoline&&(set_font("info"),vskip(gene.curfont.size+cfmt.infospace),put_inf2r(c,0,s,n,"r"),a+=gene.curfont.size+cfmt.infospace),o=0}else o=cfmt.composerspace;info.P&&cfmt.writefields.indexOf("P")>=0&&(set_font("parts"),a=cfmt.partsspace+gene.curfont.size-a,a>0&&(o+=a),o>.01&&vskip(o),xy_str(0,0,info.P),o=0),vskip(o+cfmt.musicspace)}function def_use(e){var t,n,r;if(!defined_glyph[e]){if(defined_glyph[e]=!0,r=glyphs[e],!r)return void error(1,null,"unknown glyph: "+e);for(n=0;;){if(t=r.indexOf('xlink:href="#',n),0>t)break;t+=13,n=r.indexOf('"',t),def_use(r.slice(t,n))}defs+="\n"+r}}function defs_add(e){for(var t,n,r,i,s,a=0;;){if(s=e.indexOf("<",a),0>s)break;if("<!--"!=e.slice(s,s+4)){if(t=e.indexOf('id="',s),0>t)break;if(t+=4,n=e.indexOf('"',t),0>n)break;if(r=e.slice(t,n),a=e.indexOf(">",n),0>a)break;if("/"==e[a-1])a++;else{if(t=e.indexOf(" ",s),0>t)break;if(i=e.slice(s+1,t),a=e.indexOf("</"+i+">",a),0>a)break;a+=3+i.length}glyphs[r]=e.slice(s,a)}else if(a=e.indexOf("-->",s+4),0>a)break}}function set_g(){stv_g.started&&(stv_g.started=!1,output.push("</g>\n")),(1!=stv_g.scale||stv_g.color)&&(output.push("<g "),1!=stv_g.scale&&(stv_g.st>=0?0==staff_tb[stv_g.st].y?output.push("!S"+stv_g.st+"!"):output.push(staff_tb[stv_g.st].scale_str):0==staff_tb[0].y?output.push("!V"+stv_g.v+"!"):output.push(voice_tb[stv_g.v].scale_str)),stv_g.color&&(1!=stv_g.scale&&output.push(" "),output.push('style="color:'+stv_g.color+'"')),output.push(">\n"),stv_g.started=!0)}function set_color(e){var t=stv_g.color;return e!=stv_g.color&&(stv_g.color=e,set_g()),t}function set_sscale(e){var t,n;e!=stv_g.st&&1!=stv_g.scale&&(stv_g.scale=0),t=e>=0?staff_tb[e].staffscale:1,n=e>=0&&1!=t?staff_tb[e].y:posy,(t!=stv_g.scale||n!=stv_g.dy)&&(stv_g.scale=t,stv_g.dy=n,stv_g.st=e,set_g())}function set_scale(e){var t=voice_tb[e.v].scale;return 1==t?void set_sscale(e.st):void((t!=stv_g.scale||stv_g.dy!=posy)&&(stv_g.scale=t,stv_g.dy=posy,stv_g.st=-1,stv_g.v=e.v,set_g()))}function set_dscale(e){output=staff_tb[e].output,stv_g.scale=staff_tb[e].staffscale,stv_g.st=-1}function delayed_update(){function e(e){for(var t,n,r,i=0;;){if(t=e.indexOf("!",i),0>t)break;output.push(e.slice(i,t)),"S"==e[t+1]?(n=e.indexOf("!",t+2),r=Number(e.slice(t+2,n)),output.push(staff_tb[r].scale_str),i=n+1):"V"==e[t+1]?(n=e.indexOf("!",t+2),r=Number(e.slice(t+2,n)),output.push(voice_tb[r].scale_str),i=n+1):(output.push("!"),i=t+1)}output.push(e.slice(i))}var t;for(t=0;t<=nstaff;t++)0!=staff_tb[t].output.length&&(output.push('<g transform="translate(0,'+(-staff_tb[t].y).toFixed(2)),1!=staff_tb[t].staffscale&&output.push(") scale("+staff_tb[t].staffscale.toFixed(2)),output.push(')">\n'),e(staff_tb[t].output.join("")),output.push("</g>\n"),staff_tb[t].output=[])}function anno_start(e){if(void 0!=e.istart){var t=e.type,n=e.ymx-e.ymn+4;e.grace&&(t=GRACE),stv_g.started&&(stv_g.started=!1,output.push("</g>\n")),user.anno_start(anno_type[e.type],e.istart,e.iend,e.x-e.wl-2,staff_tb[e.st].y+e.ymn+n-2,e.wl+e.wr+4,e.ymx-e.ymn+4),set_g()}}function anno_stop(e){if(void 0!=e.istart){var t=e.type,n=e.ymx-e.ymn+4;e.grace&&(t=GRACE),stv_g.started&&(stv_g.started=!1,output.push("</g>\n")),user.anno_stop(anno_type[e.type],e.istart,e.iend,e.x-e.wl-2,staff_tb[e.st].y+e.ymn+n-2,e.wl+e.wr+4,e.ymx-e.ymn+4),set_g()}}function out_svg(e){output.push(e)}function sx(e){return(e+posx)/stv_g.scale}function sy(e){return 1==stv_g.scale?posy-e:stv_g.st<0?(posy-e)/stv_g.scale:stv_g.dy-e}function out_sxsy(e,t,n){stv_g.trans||(e=(posx+e)/stv_g.scale,n=1!=stv_g.scale?stv_g.st<0?(posy-n)/stv_g.scale:stv_g.dy-n:posy-n),output.push(e.toFixed(2)+t+n.toFixed(2))}function xypath(e,t,n){n?output.push('<path class="fill" d="m'):output.push('<path class="stroke" d="m'),out_sxsy(e," ",t),output.push("\n")}function xybox(e,t,n,r){output.push('<rect class="stroke" stroke-width="0.6"\n	x="'),out_sxsy(e,'" y="',t),output.push('" width="'+n.toFixed(2)+'" height="'+r.toFixed(2)+'"/>\n')}function xygl(e,t,n){psxygl(e,t,n)||(def_use(n),output.push('<use x="'),out_sxsy(e,'" y="',t),output.push('" xlink:href="#'+n+'"/>\n'))}function out_acciac(e,t,n,r,i){i?(e-=1,t+=4):(e-=5,t-=4),output.push('<path class="stroke" d="m'),out_sxsy(e," ",t),output.push("l"+n.toFixed(2)+" "+(-r).toFixed(2)+'"/>\n')}function out_bar(e,t,n){e+=posx,t=posy-t,output.push('<path class="stroke" stroke-width="1" d="m'+e.toFixed(2)+" "+t.toFixed(2)+"v"+(-n).toFixed(2)+'"/>\n')}function out_bnum(e,t,n,r){if(n=n.toString(),r){var i,s=.6;for(i=0;i<n.length;i++)s+=cwid(n[i]);s*=12,output.push('<rect fill="white" x="'),out_sxsy(e-s/2,'" y="',t+10),output.push('" width="'+s.toFixed(2)+'" height="12"/>\n')}output.push('<text style="font:italic 12px serif"\n	x="'),out_sxsy(e,'" y="',t),output.push('" text-anchor="middle">'+n+'</text>\n"')}function out_brace(e,t,n){def_use("brace"),e+=posx-6,t=posy-t,n/=24,output.push('<use transform="translate('+e.toFixed(2)+","+t.toFixed(2)+") scale(2.5,"+n.toFixed(2)+')" xlink:href="#brace"/>')}function out_bracket(e,t,n){e+=posx-5,t=posy-t-3,n+=2,output.push('<path class="fill"\n	d="m'+e.toFixed(2)+" "+t.toFixed(2)+"\n	c10.5 1 12 -4.5 12 -3.5c0 1 -3.5 5.5 -8.5 5.5\n	v"+n.toFixed(2)+'\n	c5 0 8.5 4.5 8.5 5.5c0 1 -1.5 -4.5 -12 -3.5"/>\n')}function out_dot(e,t){output.push('<circle class="fill" cx="'),out_sxsy(e,'" cy="',t),output.push('" r="1.2"/>\n')}function out_dotbar(e,t,n){e+=posx,t=posy-t,output.push('<path class="stroke" stroke-dasharray="5,5"\n	d="m'+e.toFixed(2)+" "+t.toFixed(2)+"v"+(-n).toFixed(2)+'"/>\n')}function out_hyph(e,t,n){var r,i=25+3*Math.floor(n/20);r=n>15?Math.floor((n-15)/i):0,e+=(n-i*r-5)/2,output.push('<path class="stroke" stroke-width="1.2"\n	stroke-dasharray="5,'),output.push(Math.round((i-5)/stv_g.scale)),output.push('"\n	d="m'),out_sxsy(e," ",t+3),output.push("h"+(i*r+5).toFixed(2)+'"/>\n')}function out_stem(e,t,n,r,i,s){var a=r?GSTEM_XOFF:3.5,o=-n;if(0>n&&(a=-a),e+=a*stv_g.scale,output.push('<path class="stroke" d="m'),out_sxsy(e," ",t),stv_g.st<0&&(o/=stv_g.scale),output.push("v"+o.toFixed(2)+'"/>\n'),i){if(output.push('<path class="fill"\n	d="'),t+=n,n>0)if(s)if(r)for(;--i>=0;)output.push("M"),out_sxsy(e," ",t),output.push("l3 1.5 0 2 -3 -1.5z\n"),t-=3;else for(t+=1;--i>=0;)output.push("M"),out_sxsy(e," ",t),output.push("l7 3.2 0 3.2 -7 -3.2z\n"),t-=5.4;else if(r)if(1==i)output.push("M"),out_sxsy(e," ",t),output.push("c0.6 3.4 5.6 3.8 3 10\n	c1.2 -4.4 -1.4 -7 -3 -7\n");else for(;--i>=0;)output.push("M"),out_sxsy(e," ",t),output.push("c1 3.2 5.6 2.8 3.2 8\n	c1.4 -4.8 -2.4 -5.4 -3.2 -5.2\n"),t-=3.5;else if(1==i)output.push("M"),out_sxsy(e," ",t),output.push("c0.6 5.6 9.6 9 5.6 18.4\n	c1.6 -6 -1.3 -11.6 -5.6 -12.8\n");else for(;--i>=0;)output.push("M"),out_sxsy(e," ",t),output.push("c0.9 3.7 9.1 6.4 6 12.4\n	c1 -5.4 -4.2 -8.4 -6 -8.4\n"),t-=5.4;else if(s){if(!r)for(t+=1;--i>=0;)output.push("M"),out_sxsy(e," ",t),output.push("l7 -3.2 0 -3.2 -7 3.2z\n"),t+=5.4}else if(r)if(1==i)output.push("M"),out_sxsy(e," ",t),output.push("c0.6 -3.4 5.6 -3.8 3 -10\n	c1.2 4.4 -1.4 7 -3 7\n");else for(;--i>=0;)output.push("M"),out_sxsy(e," ",t),output.push("c1 -3.2 5.6 -2.8 3.2 -8\n	c1.4 4.8 -2.4 5.4 -3.2 5.2\n"),t+=3.5;else if(1==i)output.push("M"),out_sxsy(e," ",t),output.push("c0.6 -5.6 9.6 -9 5.6 -18.4\n	c1.6 6 -1.3 11.6 -5.6 12.8\n");else for(;--i>=0;)output.push("M"),out_sxsy(e," ",t),output.push("c0.9 -3.7 9.1 -6.4 6 -12.4\n	c1 5.4 -4.2 8.4 -6 8.4\n"),t+=5.4;output.push('"/>\n')}}function out_thbar(e,t,n){e+=posx+1.5,t=posy-t,output.push('<path class="stroke" stroke-width="3"\n	d="m'+e.toFixed(2)+" "+t.toFixed(2)+"v"+(-n).toFixed(2)+'"/>\n')}function out_trem(e,t,n){for(output.push('<path class="fill" d="m'),out_sxsy(e-4.5," ",t),output.push("\n	");;){if(output.push("l9 -3v3l-9 3z"),--n<=0)break;output.push("m0 5.4")}output.push('"/>\n')}function out_tubr(e,t,n,r,i){var s;i?(s=-3,t-=3):(s=3,t+=3),n/=stv_g.scale,output.push('<path class="stroke" d="m'),out_sxsy(e," ",t),output.push("v"+s.toFixed(2)+"l"+n.toFixed(2)+" "+(-r).toFixed(2)+"v"+(-s).toFixed(2)+'"/>\n')}function out_wln(e,t,n){output.push('<path class="stroke" stroke-width="0.8"\n	d="m'),out_sxsy(e," ",t),output.push("h"+n.toFixed(2)+'"/>\n')}function out_deco_str(e,t,n,r){var i=deco_str_style[n];i||(i={dx:0,dy:0,style:'style="font:14px serif"'}),e+=i.dx,t+=i.dy,output.push("<text "+i.style+'\n	x="'),out_sxsy(e,'" y="',t),output.push('">'),set_font("annotation"),out_str(r),output.push("</text>\n")}function out_arp(e,t,n){for(output.push('<g transform="translate('),out_sxsy(e,",",t),output.push(') rotate(270)">\n'),stv_g.trans=!0,e=0,t=-4,n=Math.ceil(n/6);--n>=0;)xygl(e,t,"ltr"),e+=6;stv_g.trans=!1,output.push("</g>\n")}function out_cresc(e,t,n,r){output.push('<path class="stroke" d="m'),r.nost?(out_sxsy(e," ",t+3.2),output.push("l"+n.toFixed(2)+" -2.2m0 8l"+(-n).toFixed(2)+' -2.2"/>\n')):(out_sxsy(e," ",t+5),output.push("l"+n.toFixed(2)+" -4m0 8l"+(-n).toFixed(2)+' -4"/>\n'))}function out_dim(e,t,n,r){output.push('<path class="stroke"\n	d="m'),out_sxsy(e," ",t+5),output.push("l"+n.toFixed(2)),r.noen?output.push(" -2.2m0 -3.6l"+(-n).toFixed(2)+' -2.2"/>\n'):output.push(" -4l"+(-n).toFixed(2)+' -4"/>\n')}function out_ltr(e,t,n){for(t+=4,n=Math.ceil(n/6);--n>=0;)xygl(e,t,"ltr"),e+=6}function out_deco_val(e,t,n,r,i){deco_val_tb[n]?deco_val_tb[n](e,t,r,i):error(1,null,"No function for decoration '"+n+"'")}function vskip(e){posy+=e}function svg_flush(){var e;!multicol&&output&&user.img_out&&(info.X?(e=info.X+".",info.T&&(e+=" "+info.T.split("\n")[0]),e=e.replace(/&/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;")):e="noname",posy*=cfmt.scale,user.imagesize?user.img_out('<svg xmlns="http://www.w3.org/2000/svg" version="1.1"\n	xmlns:xlink="http://www.w3.org/1999/xlink"\n	xml:space="preserve" color="black"\n'+user.imagesize+' viewBox="0 0 '+cfmt.pagewidth.toFixed(0)+" "+posy.toFixed(0)+'">\n<title>abc2svg - '+e+"</title>"):user.img_out('<svg xmlns="http://www.w3.org/2000/svg" version="1.1"\n	xmlns:xlink="http://www.w3.org/1999/xlink"\n	xml:space="preserve" color="black"\n	width="'+cfmt.pagewidth.toFixed(0)+'px" height="'+posy.toFixed(0)+'px">\n<title>abc2svg - '+e+"</title>"),
(style||font_style)&&user.img_out('<style type="text/css">'+style+font_style+"\n</style>"),defs&&user.img_out("<defs>"+defs+"\n</defs>"),cfmt.bgcolor&&user.img_out('<rect width="100%" height="100%" fill="'+cfmt.bgcolor+'"/>'),1==cfmt.scale?user.img_out('<g stroke-width=".7">'):user.img_out('<g stroke-width=".7"> transform="scale('+cfmt.scale.toFixed(2)+')">'),svgobj&&(svgobj.setg(0),output.push(svgbuf),svgbuf=""),user.img_out(output.join("")+"</g>\n</svg>"),output=[],font_style="",cfmt.fullsvg?(defined_glyph={},defined_font={}):(style="",defs=""),posy=0)}function blk_out(){!multicol&&output&&user.img_out&&(user.page_format&&!block.started&&(block.started=!0,block.newpage?(block.newpage=!1,user.img_out('<div class="nobrk newpage">')):user.img_out('<div class="nobrk">')),svg_flush())}function blk_flush(){block.started&&user.img_out&&(block.started=!1,user.img_out("</div>"))}function voice_filter(){var e,t,n;for(e in parse.voice_opts)if(t=new RegExp(e),t.test(curvoice.id)||t.test(curvoice.nm))for(n=0;n<parse.voice_opts[e].length;n++)do_pscom(parse.voice_opts[e][n])}function sym_link(e){curvoice.ignore||(parse.last_sym=e,e.prev=curvoice.last_sym,curvoice.last_sym?curvoice.last_sym.next=e:curvoice.sym=e,curvoice.last_sym=e),e.v=curvoice.v,e.st=curvoice.cst,e.time=curvoice.time,e.dur&&!e.grace&&(curvoice.time+=e.dur),e.pos=clone(curvoice.pos),curvoice.second&&(e.second=!0),curvoice.floating&&(e.floating=!0)}function sym_add(e){var t,n={},r=curvoice;return curvoice=e,sym_link(n),curvoice=r,t=n.prev,t||(t=n.next),t&&(n.ctx=t.ctx,n.istart=t.istart,n.iend=t.iend),n}function mrest_expand(e){var t,n,r,i=e.nmes,s=e.dur/i,a=e.a_dd;for(e.type=REST,e.dur=s,e.head="full",e.nflags=-2,r=e.next,t=voice_tb[e.v],t.last_sym=e,t.time=e.time+s,t.cst=e.st,n=e;--i>0;)n=sym_add(t),n.type=BAR,n.bar_type="|",n=sym_add(t),n.type=REST,e.invisible&&(n.invisible=!0),n.dur=s,n.head="full",n.nflags=-2,t.time+=s;n.next=r,r&&(r.prev=n),n.a_dd=a}function sort_all(){var e,t,n,r,i,s,a,o,c,u,l,f,d,p=voice_tb.length,h=[],m=[],v=-1;for(r=0;p>r;r++)h.push(voice_tb[r].sym);for(var g=cur_sy,y=!0;;){if(y)for(y=!1,f=1,c=-1,r=0;p>r;r++)g.voices[r]?(o=g.voices[r].range,0>o||(m[o]=r,c++)):g.voices[r]={range:-1};for(a=i=1e6,o=0;o<m.length&&(r=m[o],void 0!=r);o++)e=h[r],!e||e.time>i||(s=weight_tb[e.type],e.time<i?(i=e.time,a=s):a>s&&(a=s),e.type==MREST&&(1==e.nmes?mrest_expand(e):c>0&&(v=i)));if(a>127)break;if(i==v){for(d=0,o=0;o<m.length&&(r=m[o],void 0!=r);o++)if(e=h[r],e&&e.time==i&&weight_tb[e.type]==a){if(e.type!=MREST){v=-1;break}if(0==d)d=e.nmes;else if(d!=e.nmes){v=-1;break}}if(0>v)for(o=0;o<m.length&&(r=m[o],void 0!=r);o++)e=h[r],e&&e.type==MREST&&mrest_expand(e)}for(o=0;o<m.length&&(r=m[o],void 0!=r);o++)e=h[r],e&&e.time==i&&weight_tb[e.type]==a&&(e.type==STAVES?(g=g.next,y=l=!0,e.prev?e.prev.next=e.next:voice_tb[r].sym=e.next,e.next&&(e.next.prev=e.prev)):(f&&(f=0,e.seqst=!0),l&&(l=!1,e.new_sy=!0),e.ts_prev=u,u?u.ts_next=e:tsfirst=e,u=e),h[r]=e.next);f=a}if(u){if(u.type!=BAR&&u.type!=FORMAT||l)for(n=voice_tb[u.v],n.last_sym=u,e=sym_add(n),e.type=FORMAT,e.time=u.time+u.dur,e.seqst=!0,l&&(e.new_sy=!0),u.ts_next=e,e.ts_prev=u;;){if(delete u.eoln,u.seqst)break;u=u.ts_prev}if(t=glovar.tempo){for(e=tsfirst.extra;e;){if(e.type==TEMPO)return;e=e.next}e=tsfirst,t.v=e.v,t.st=e.st,t.time=e.time,e.extra&&(t.next=e.extra,t.next.prev=t),e.extra=t}}}function compr_voice(){function e(e){var t,n,r,i,s,a,o,i=e.dur,c=1;for(t=e;t&&(!t.beam_end&&t.next);t=t.next)c++;if(1>=c)return void delete e.feathered_beam;if(n=t,s=i/2,o=i/(c-1),r=e.time,e.feathered_beam>0)for(t=e,a=c-1;t!=n;t=t.next,a--)i=Math.floor(o*a)+s,t.dur=i,t.time=r,r+=i;else for(t=e,a=0;t!=n;t=t.next,a++)i=Math.floor(o*a)+s,t.dur=i,t.time=r,r+=i;t.dur=t.time+t.dur-r,t.time=r}var t,n,r,i,s;for(s=0;s<voice_tb.length;s++){for(t=voice_tb[s],t.ignore&&(t.ignore=!1),n=t.sym;n&&!(n.time>=staves_found);n=n.next);for(i=null;n;n=n.next){switch(n.type){case FORMAT:if(r=n.extra){if(i||(i=r),n.prev&&(n.prev.next=r,r.prev=n.prev),!n.next){i=null;break}for(;r.next;)r=r.next;n.next.prev=r,r.next=n.next}case TEMPO:case PART:case TUPLET:case BLOCK:i||(i=n);continue;case MREST:if(!i)continue;r={type:SPACE,width:-1,invisible:!0,v:n.v,st:n.st,time:n.time},r.next=n,r.prev=n.prev,r.prev.next=r,n.prev=r,n=r}if(n.feathered_beam&&e(n),n.grace){for(i||(i=n);!n.gr_end;)n=n.next;r=clone(n),r.type=GRACE,r.dur=0,delete r.notes,r.next=n.next,r.next?r.next.prev=r:t.last_sym=r,r.prev=n,n.next=r,n=r}i&&(n.extra=i,delete n.prev.next,n.prev=i.prev,n.prev?n.prev.next=n:t.sym=n,delete i.prev,i=null)}i&&(n=sym_add(t),n.type=FORMAT,n.extra=i,delete n.prev.next,n.prev=i.prev,n.prev?n.prev.next=n:t.sym=n,delete i.prev)}}function dupl_voice(){var e,t,n,r,i,s,a,o;for(a=0;a<voice_tb.length;a++)if(e=voice_tb[a],t=e.clone){for(e.clone=null,n=e.sym;n&&!(n.time>=staves_found);n=n.next);for(t.clef=clone(e.clef),curvoice=t;n;n=n.next){if(r=clone(n),n.notes)for(r.notes=[],o=0;o<=n.nhd;o++)r.notes.push(clone(n.notes[o]));if(sym_link(r),t.second?r.second=!0:delete r.second,t.floating?r.floating=!0:delete r.floating,delete r.a_ly,i=r.extra)for(s=clone(i),r.extra=s,r=s,r.v=a,r.st=t.st,i=i.next;i;i=i.next){if(s=clone(i),i.notes)for(s.notes=[],o=0;o<=i.nhd;o++)s.notes.push(clone(i.notes[o]));r.next=s,s.prev=r,r=s,r.v=a,r.st=t.st}}}}function new_system(){var e,t,n={voices:[],staves:[],top_voice:0};if(par_sy){for(t=0;t<voice_tb.length;t++){e=par_sy.voices[t].st;var r=par_sy.staves[e],i=voice_tb[t];void 0!=i.stafflines&&(r.stafflines=i.stafflines),i.staffscale&&(r.staffscale=i.staffscale),n.voices[t]=clone(par_sy.voices[t]),n.voices[t].range=-1,delete n.voices[t].second}for(e=0;e<par_sy.staves.length;e++)n.staves[e]=clone(par_sy.staves[e]),n.staves[e].flags=0;par_sy.next=n,par_sy=n}else cur_sy=par_sy=n}function go_global_time(e,t){var n,r,i;if(t.bar<=1){if(1==t.bar){for(n=e;n&&(n.type!=BAR||0==n.time);n=n.ts_next);n.time<voice_tb[cur_sy.top_voice].meter.wmeasure&&(e=n)}}else{for(;e&&!(e.type==BAR&&e.bar_num>=t.bar);e=e.ts_next);if(!e)return null;if(0!=t.seq){for(i=t.seq,e=e.ts_next;e&&(e.type!=BAR||e.bar_num!=t.bar||0!=--i);e=e.ts_next);if(!e)return null}}if(0==t.time)return e;for(r=e.time+t.time;e.time<r;)if(e=e.ts_next,!e)return e;do e=e.ts_prev;while(!e.seqst);return e}function do_clip(){var e,t,n,r,i;if(e=tsfirst,clip_start.bar>0||clip_start.time>0){if(e=go_global_time(e,clip_start),!e)return void(tsfirst=null);for(n=cur_sy,t=tsfirst;t!=e;t=t.ts_next)switch(t.new_sy&&(n=n.next),t.type){case CLEF:voice_tb[t.v].clef=t;break;case KEY:voice_tb[t.v].key=clone(t.as.u.key);break;case METER:voice_tb[t.v].meter=clone(t.as.u.meter)}for(cur_sy=n,i=0;i<voice_tb.length;i++){for(r=voice_tb[i],t=e;t;t=t.ts_next)if(t.v==i){delete t.prev;break}r.sym=t}tsfirst=e,delete e.ts_prev}if(e=go_global_time(e,clip_end)){do if(e=e.ts_next,!e)return;while(!e.seqst);for(i=0;i<voice_tb.length;i++){for(r=voice_tb[i],t=e.ts_prev;t;t=t.ts_prev)if(t.v==i){delete t.next;break}t||(r.sym=null)}delete e.ts_prev.ts_next}}function set_bar_num(){var e,t,n,r,i=cur_sy.top_voice,s=voice_tb[i].meter.wmeasure,a=gene.nbar;for(e=tsfirst;;e=e.ts_next){if(!e)return;switch(e.type){case METER:case CLEF:case KEY:case FORMAT:case STBRK:continue;case BAR:if(e.bar_num){gene.nbar=e.bar_num;break}e.text&&!cfmt.contbarnb&&("1"==e.text[0]?a=gene.nbar:(gene.nbar=a,e.bar_num=gene.nbar))}break}for(var o=e.time+s,c=gene.nbar;e;e=e.ts_next)switch(e.type){case CLEF:if(e.new_sy)break;for(t=e.ts_prev;t;t=t.ts_prev){if(t.new_sy){t=void 0;break}switch(t.type){case BAR:if(t.seqst)break;continue;case MREST:case NOTE:case REST:case SPACE:case STBRK:case TUPLET:t=void 0;break;default:continue}break}if(!t)break;if(e.next.prev=e.prev,e.prev.next=e.next,e.ts_next.ts_prev=e.ts_prev,e.ts_prev.ts_next=e.ts_next,e.next=t,e.prev=t.prev,e.prev.next=e,t.prev=e,e.ts_next=t,e.ts_prev=t.ts_prev,e.ts_prev.ts_next=e,t.ts_prev=e,n=e.extra){if(e.ts_next.extra){for(;n.next;)n=n.next;n.next=e.ts_next.extra,e.ts_next.extra=e.extra}else e.ts_next.extra=n;e.extra=void 0}e=t;break;case METER:s=e.wmeasure,e.time<o&&(o=e.time+s);break;case MREST:for(c+=e.nmes-1;e.ts_next&&e.ts_next.type!=BAR;)e=e.ts_next;break;case BAR:if(e.bar_num){if(c=e.bar_num,e.time<o){delete e.bar_num;break}}else{if(e.time<o)break;c++}r=e.time,t=e;do{if(t.type==BAR&&t.text&&!cfmt.contbarnb){"1"==t.text[0]?a=c:c=a;break}t=t.next}while(t&&t.time==r);e.bar_num=c,o=e.time+s}cfmt.measurenb<0&&(gene.nbar=c)}function generate(){var e,t;if(compr_voice(),dupl_voice(),sort_all(),tsfirst&&(set_bar_num(),tsfirst)){for(output_music(),e=0;e<voice_tb.length;e++)t=voice_tb[e],t.time=0,t.sym=t.last_sym=null,t.st=cur_sy.voices[e].st,t.second=cur_sy.voices[e].second,t.clef.time=0,delete t.have_ly,t.hy_st=0,delete t.bar_start,delete t.slur_st,delete t.s_tie,delete t.s_rtie;staves_found=0}}function gen_ly(e){generate(),info.W&&(put_words(info.W),delete info.W),e&&blk_out()}function key_transp(e,t){var n,r;switch(r=t>0?Math.floor(t/3):-Math.floor(-t/3),n=(-2&r)+7*(1&r)+e.k_sf,(t+210)%3){case 1:n=(n+4+48)%12-4;break;case 2:n=(n+7+48)%12-7;break;default:n=(n+5+48)%12-5}e.k_sf=n}function set_k_acc(e){var t,n,r,i,s,a=[],o=[];if(e.k_sf>0)for(i=0;i<e.k_sf;i++)a[i]=1,o[i]=[26,23,27,24,21,25,22][i];else for(i=0;i<-e.k_sf;i++)a[i]=-1,o[i]=[22,25,21,24,20,23,26][i];for(r=e.k_a_acc.length,t=0;r>t;t++){for(s=e.k_a_acc[t],n=0;i>n;n++)if(o[n]==s.pit){a[n]=s.acc;break}n==i&&(a[n]=s.acc,o[n]=s.pit,i++)}for(t=0;i>t;t++)s=e.k_a_acc[t],s||(s=e.k_a_acc[t]={}),s.acc=a[t],s.pit=o[t]}function acc_same_pitch(e){var t,n;if(s=curvoice.last_sym,s)for(n=s.time;s;s=s.prev)switch(s.type){case BAR:if(s.time<n)return;for(;;){if(s=s.prev,!s)return;if(s.type==NOTE){if(s.time+s.dur==n)break;return}if(s.time<n)return}for(t=0;t<=s.nhd;t++)if(s.notes[t].pit==e&&s.notes[t].ti1)return s.notes[t].acc;return;case NOTE:for(t=0;t<=s.nhd;t++)if(s.notes[t].pit==e)return s.notes[t].acc}}function note_transp(e){var t,n,r,i,s,a,o,c,u,l,f=e.nhd,d=curvoice.okey.k_sf,p=curvoice.ckey.k_sf-d,h=cgd2cde[(p+28)%7],m=curvoice.transpose;for(m>0?h+=7*Math.floor(m/3/12):(0!=h&&(h-=7),h-=7*Math.floor(-m/3/12)),t=0;f>=t;t++){if(l=e.notes[t],r=l.pit,l.pit+=h,l.apit=l.pit,o=cde2fcg[(r+5+112)%7],s=l.acc,!s)if(curvoice.okey.a_acc){for(n=0;n<curvoice.okey.a_acc.length;n++)if(a=curvoice.okey.a_acc[n],(r+112-a.pit)%7==0){s=a.acc;break}}else d>0?d-1>o&&(s=1):0>d&&o>=d+6&&(s=-1);if(c=o+p,s&&3!=s&&(c+=7*s),o=(Math.floor((c+1+21)/7)+2-3+160)%5,s=acc2[o],l.acc);else if(curvoice.ckey.k_none){if(3==s||acc_same_pitch(l.pit))continue}else{if(!curvoice.ckey.a_acc)continue;for(u=cgd2cde[(c+112)%7],n=0;n<curvoice.ckey.a_acc.length&&(u+112-curvoice.ckey.a_acc[n].pits)%7!=0;n++);if(n<curvoice.ckey.a_acc.length)continue}if(o=l.acc,i=l.micro_d,i&&o!=s)switch(r=l.micro_n,s){case 3:r>i/2?(r-=i/2,l.micro_n=r,s=o):s=-o;break;case 2:r>i/2?(l.pit+=1,l.apit=l.pit,r-=i/2):r+=i/2,s=o,l.micro_n=r;break;case-2:r>=i/2?(l.pit-=1,l.apit=l.pit,r-=i/2):r+=i/2,s=o,l.micro_n=r}l.acc=s}}function get_staves(e,t){var n,r,i,s,a,o,c,u,l,f;compr_voice(),dupl_voice();var d=0,p=!0;for(o=0;o<voice_tb.length;o++)r=voice_tb[o],r.time>d&&(d=r.time),r.sym&&(p=!1);if(p||0==d&&0>staves_found)for(o=0;o<par_sy.voices.length;o++)par_sy.voices[o].range=-1;else if(staves_found!=d){for(o=0;o<par_sy.voices.length;o++)if(par_sy.voices[o].range>=0){curvoice=voice_tb[o];break}curvoice.time=d,n={type:STAVES},sym_link(n),par_sy.nstaff=nstaff,new_system()}if(staves_found=d,l=parse_staves(t)){for(o=0;o<voice_tb.length;o++)r=voice_tb[o],delete r.second,delete r.ignore,r.time=d;for(f=0,par_sy.top_voice=l[0].v,s=0;s<l.length;s++){if(u=l[s],o=u.v,r=voice_tb[o],par_sy.voices[o].range>=0){for(i=clone(r),par_sy.voices[voice_tb.length]=clone(par_sy.voices[o]),o=voice_tb.length,i.v=o,i.sym=i.last_sym=null,i.time=d,voice_tb.push(i),delete i.clone;r.clone;)r=r.clone;r.clone=i,r=i,u.v=o}par_sy.voices[o].range=f++}if("t"==e[1])for(s=0;s<l.length;s++)u=l[s],a=u.flags,a&(OPEN_BRACE|OPEN_BRACE2)&&(a&(OPEN_BRACE|CLOSE_BRACE))!=(OPEN_BRACE|CLOSE_BRACE)&&(a&(OPEN_BRACE2|CLOSE_BRACE2))!=(OPEN_BRACE2|CLOSE_BRACE2)&&0==l[s+1].flags&&(a&OPEN_PARENTH||l[s+2].flags&OPEN_PARENTH||(l[s+2].flags&(CLOSE_BRACE|CLOSE_BRACE2)?l[s+1].flags|=FL_VOICE:0==l[s+2].flags&&l[s+3].flags&(CLOSE_BRACE|CLOSE_BRACE2)&&(u.flags|=OPEN_PARENTH,l[s+1].flags|=CLOSE_PARENTH,l[s+2].flags|=OPEN_PARENTH,l[s+3].flags|=CLOSE_PARENTH)));for(c=-1,s=0;s<l.length;s++)if(u=l[s],a=u.flags,(a&(OPEN_PARENTH|CLOSE_PARENTH))==(OPEN_PARENTH|CLOSE_PARENTH)&&(a&=~(OPEN_PARENTH|CLOSE_PARENTH),u.flags=a),o=u.v,r=voice_tb[o],a&FL_VOICE?(r.floating=!0,r.second=!0):(c++,par_sy.staves[c]||(par_sy.staves[c]={stafflines:"|||||",staffscale:1}),par_sy.staves[c].flags=0),r.st=r.cst=par_sy.voices[o].st=c,par_sy.staves[c].flags|=a,a&OPEN_PARENTH){for(i=r;s<l.length-1&&(u=l[++s],o=u.v,r=voice_tb[o],u.flags&MASTER_VOICE?(i.second=!0,i=r):r.second=!0,r.st=r.cst=par_sy.voices[o].st=c,!(u.flags&CLOSE_PARENTH)););par_sy.staves[c].flags|=u.flags}if(0>c&&(c=0),par_sy.nstaff=nstaff=c,"c"==e[1])for(c=0;c<=nstaff;c++)par_sy.staves[c].flags^=STOP_BAR;for(o=0;o<voice_tb.length;o++)par_sy.voices[o].range<0||(r=voice_tb[o],par_sy.voices[o].second=r.second,c=r.st,!(c>0)||r.norepbra||par_sy.staves[c-1].flags&STOP_BAR||(r.norepbra=!0));curvoice=voice_tb[par_sy.top_voice]}}function get_vover(e){function t(e){var t,n;for(t=0;t<voice_tb.length;t++)if(n=voice_tb[t],n.id==e)return n;return n=clone(curvoice),n.v=voice_tb.length,n.id=e,n.pos=clone(curvoice.pos),n.sym=n.last_sym=null,n.nm=null,n.snm=null,n.lyric_restart=n.lyric_restart=n.lyric_cont=null,voice_tb.push(n),n}var n,r,i,a,o,c,u=parse.line;if(!curvoice.ignore){if("|"==e||")"==e)return curvoice.last_sym.beam_end=!0,vover?(curvoice.time!=vover.mxtime&&u.error("Wrong duration in voice overlay"),curvoice=vover.p_voice,void(vover=null)):void u.error("Erroneous end of voice overlap");if("("==e)return vover?void u.error("Voice overlay already started"):void(vover={time:curvoice.time});if(!curvoice.last_note)return void u.error("No note before start of voice overlay");if(curvoice.last_note.beam_end=!0,n=curvoice.voice_down,!n){n=t(curvoice.id+"o"),curvoice.voice_down=n,n.time=0,n.second=!0,o=n.v,par_sy.voices[o]={st:curvoice.st,second:!0,scale:curvoice.scale,transpose:curvoice.transpose,key:curvoice.key,ckey:curvoice.ckey,okey:curvoice.okey,pos:n.pos};var l=void 0!=curvoice.clone?1:0;for(i=par_sy.voices[curvoice.v].range,a=0;a<par_sy.voices.length;a++)par_sy.voices[a].range>i&&(par_sy.voices[a].range+=l+1);par_sy.voices[o].range=i+1,l&&(r=t(n.id+"c"),r.second=!0,c=r.v,par_sy.voices[c]={second:!0,scale:curvoice.clone.scale,range:i+2},n.clone=r)}if(n.ulen=curvoice.ulen,curvoice.microscale&&(n.microscale=curvoice.microscale),vover)vover.p_voice?curvoice.time!=vover.mxtime&&u.error("Wrong duration in voice overlay"):(vover.mxtime=curvoice.time,vover.p_voice=curvoice);else{vover={bar:!0,mxtime:curvoice.time,p_voice:curvoice};var f=n.time;for(s=curvoice.last_sym;!(s.type==BAR||s.time<=f);s=s.prev);vover.time=s.time}n.time=vover.time,curvoice=n}}function is_voice_sig(){if(!curvoice.sym)return!0;if(0!=curvoice.time)return!1;for(s=curvoice.sym;s;s=s.next)switch(s.type){case TEMPO:case PART:case FORMAT:break;default:return!1}return!0}function get_clef(e){if(is_voice_sig())curvoice.clef=e;else{if(s2=curvoice.last_sym,s2&&s2.prev&&(s2.type==KEY&&!s2.k_none||s2.type==BAR)){for(s3=s2;s3.prev;s3=s3.prev){switch(s3.prev.type){case KEY:case BAR:continue}break}curvoice.last_sym=s3.prev,sym_link(e),e.next=s3,s3.prev=e,curvoice.last_sym=s2}else sym_link(e);e.clef_small=!0}}function set_voice_param(e){var t;cfmt.microscale&&(e.microscale=cfmt.microscale),void 0!=glovar.stafflines&&void 0==e.stafflines&&(e.stafflines=glovar.stafflines),glovar.staffscale&&(e.staffscale=glovar.staffscale),cfmt.transpose&&!e.transpose&&(e.transpose=cfmt.transpose);for(t in parse.voice_param)e[t]=parse.voice_param[t];e.wmeasure||(e.wmeasure=e.meter.wmeasure)}function get_key_clef(e){var t,n,r,i=e[0],s=clone(i),a=e[1];if(i.k_sf&&!i.k_exp&&i.k_a_acc&&set_k_acc(i),1==parse.state){for(void 0!=i.k_sf||i.k_a_acc||(i.k_sf=0),cfmt.transpose&&key_transp(i,cfmt.transpose),t=0;t<voice_tb.length;t++)n=voice_tb[t],n.ckey=i,n.key=clone(i),n.okey=s,n.clef=a||clone(glovar.clef),i.k_none&&(n.key.k_sf=0);return parse.okey=s,parse.ckey=i,a?glovar.clef=a:(glovar.clef.ctx=i.ctx,glovar.clef.istart=i.istart,glovar.clef.iend=i.iend),vskip(cfmt.topspace),write_heading(),reset_gen(),void(gene.nbar=cfmt.measurefirst)}return curvoice.transpose&&key_transp(i,curvoice.transpose),a&&get_clef(a),is_voice_sig()?((void 0!=i.k_sf||i.k_a_acc)&&(curvoice.ckey=i,curvoice.key=clone(i),i.k_none&&(curvoice.key.k_sf=0)),void(curvoice.okey=s)):void((void 0!=i.k_sf||i.k_a_acc)&&(i.k_old_sf=curvoice.ckey.k_sf,curvoice.okey=s,curvoice.ckey=i,r=curvoice.last_sym,r&&r.type==METER?(curvoice.last_sym=r.prev,curvoice.last_sym||(curvoice.sym=null),sym_link(i),i.next=r,r.prev=i,curvoice.last_sym=r):sym_link(i)))}function new_voice(e){var t,n,r=voice_tb.length;if(1==r&&voice_tb[0]["default"]&&(delete voice_tb[0]["default"],!voice_tb[0].last_sym))return t=voice_tb[0],t.id=e,t;for(n=0;r>n;n++)if(t=voice_tb[n],t.id==e)return t;return t={v:n,id:e,pos:clone(cfmt.pos),scale:cfmt.voicescale,combine:cfmt.voicecombine,ulen:glovar.ulen,key:clone(parse.ckey),ckey:clone(parse.ckey),okey:clone(parse.okey),meter:clone(glovar.meter),clef:clone(glovar.clef),hy_st:0},cfmt.voicemap&&(t.map=cfmt.voicemap),3==parse.state&&set_voice_param(t),voice_tb.push(t),par_sy.voices[n]={range:-1},t}function init_tune(){nstaff=-1,voice_tb=[],curvoice=null,par_sy=null,new_system(),staves_found=-1,parse.voice_param=null,gene={}}function get_voice(e){var t=parse_voice(e),n=curvoice.v;par_sy.voices[n].range<0&&(cfmt.alignbars&&parse.line.error("V: does not work with %%alignbars"),staves_found>=0&&(curvoice.ignore=!0)),t&&get_clef(t)}function goto_tune(){var e,t;for(0==voice_tb.length?(curvoice=new_voice("1"),curvoice.clef.istart=curvoice.key.istart,curvoice.clef.iend=curvoice.key.iend,nstaff=0,curvoice.time=0,curvoice["default"]=!0):curvoice=0>staves_found?voice_tb[0]:voice_tb[par_sy.top_voice],e=0;e<voice_tb.length;e++)t=voice_tb[e],t.ulen=glovar.ulen,t.key.k_bagpipe&&0==t.pos.ste&&(t.pos.ste=SL_BELOW),t.key.k_none&&(t.key.k_sf=0),set_voice_param(t);if(0>staves_found){for(nstaff=voice_tb.length-1,e=0;e<=nstaff;e++)t=voice_tb[e],t.st=t.cst=e,par_sy.voices[e].st=e,par_sy.voices[e].range=e,par_sy.staves[e]={stafflines:"|||||",staffscale:1};par_sy.nstaff=nstaff}parse.state=3,!curvoice.last_sym&&parse.voice_opts&&voice_filter()}function get_lyrics(e,t){var n,r,i,s,a;if(!curvoice.ignore){if(curvoice.pos.voc!=SL_HIDDEN&&(curvoice.have_ly=!0),t){if(n=curvoice.lyric_cont,!n)return void parse.line.error("+: lyric without music")}else if(set_font("vocal"),curvoice.lyric_restart?(curvoice.lyric_start=n=curvoice.lyric_restart,curvoice.lyric_restart=null,curvoice.lyric_line=0):(curvoice.lyric_line++,n=curvoice.lyric_start),n||(n=curvoice.sym),!n)return void parse.line.error("w: without music");for(i=e,s=0;;){for(;" "==i[s]||"	"==i[s];)s++;if(!i[s])break;switch(i[s]){case"|":for(;n&&n.type!=BAR;)n=n.next;if(!n)return void parse.line.error("Not enough bar lines for lyric line");n=n.next,s++;continue;case"-":r="-\n";break;case"_":r="_\n";break;case"*":r=null;break;default:if("\\"==i[s]&&s==i.length-1)return void(curvoice.lyric_cont=n);for(r="";;){if(!i[s])break;switch(i[s]){case"_":case"*":case"|":s--;case" ":case"	":break;case"~":r+=" ",s++;continue;case"-":r+="\n";break;case"\\":r+=i[++s],s++;continue;default:r+=i[s],s++;continue}break}}for(;n&&(n.type!=NOTE||n.grace);)n=n.next;if(!n)return void parse.line.error("Too many words in lyric line");r&&n.pos.voc!=SL_HIDDEN&&(r.match(/^\$\d/)&&(set_font("0"==r[1]?"vocal":"u"+r[1]),r=r.slice(2)),a={t:r,font:gene.curfont,w:strw(r)},n.a_ly||(n.a_ly=[]),n.a_ly[curvoice.lyric_line]=a),n=n.next,s++}curvoice.lyric_cont=n}}function ly_width(e,t){var n,r,i,s,a,o,c,u,l,f,d,p=e.a_ly;for(s=0,c=0;c<p.length;c++)if(n=p[c]){for(d=n.t,o=n.w,i=n.font.swfac,a=o+2*cwid(" ")*i,d[0]>="0"&&d[0]<="9"&&d.length>2||":"==d[1]||"("==d[0]||")"==d[0]?("("==d[0]?r=cwid("(")*i:(u=d.indexOf(" "),gene.curfont=gene.deffont=n.font,r=u>0?strw(d.slice(0,u)):o),f=.4*(o-r+2*cwid(" ")*i),f>20&&(f=20),f+=r,n.t[0]>="0"&&n.t[0]<="9"&&f>s&&(s=f)):"-\n"==d||"_\n"==d?f=0:(f=.4*a,f>20&&(f=20)),n.shift=f,f>t&&(t=f),a-=f,f=2*cwid(" ")*i,l=e.next;l;l=l.next){switch(l.type){case NOTE:case REST:if(l.a_ly&&l.a_ly[c]&&0!=l.a_ly[c].w){if("-\n"!=l.a_ly[c].t&&"_\n"!=l.a_ly[c].t)break;a-=f}else a-=9;if(0>=a)break;continue;case CLEF:case METER:case KEY:a-=10;continue;default:a-=5}break}a>e.wr&&(e.wr=a)}if(s>0)for(c=0;c<p.length;c++)n=p[c],n.t[0]>="0"&&n.t[0]<="9"&&(n.shift=s);return t}function draw_lyrics(e,t,n,r){var i,s,a,o,c,u,l,f,d,p,h,m,v,g,y,_;for(set_font("vocal"),g=gene.curfont,r>0?(i=0,n-=g.size,n>-cfmt.vocalspace&&(n=-cfmt.vocalspace)):(v=staff_tb[e.st].topbar,i=t-1,t=-1,n<v+cfmt.vocalspace-g.size&&(n=v+cfmt.vocalspace-g.size)),_=.25*g.size;i!=t;i+=r){for(m=n+_,e.hy_st&1<<i&&(d=!0,e.hy_st&=~(1<<i)),l=e.sym;l.type==CLEF||l.type==KEY||l.type==METER;l=l.next);for(l.prev?o=l.prev.x:tsfirst.x,h=0,u=1.1*g.size;l;l=l.next)if(f=l.a_ly?l.a_ly[i]:null)f.font!=g&&(gene.curfont=g=f.font,u<1.1*g.size&&(u=1.1*g.size)),a=f.t,c=f.w,y=f.shift,d&&("_\n"==a?a="-\n":"-\n"!=a&&(out_hyph(o,m,l.x-y-o),d=!1,o=l.x+l.wr)),p&&"_\n"!=a&&(out_wln(o+3,m,h-o+3),p=!1,o=l.x+l.wr),"-\n"!=a&&"_\n"!=a?(h=l.x-y,s=a.length-1,"\n"==a[s]&&(a=a.slice(0,s),d=!0),xy_str(h,m,a),o=h+c):(0==h&&o>l.x-18&&(o=l.x-18),"-"==a[0]?d=!0:p=!0,h=l.x-y);else switch(l.type){case REST:case MREST:p&&(out_wln(o+3,m,h-o),p=!1,o=l.x+l.wr)}for(d&&(d=!1,h=realwidth-10,o+10>h&&(h=o+10),out_hyph(o,m,h-o),cfmt.hyphencont&&(e.hy_st|=1<<i)),e.s_next;l;l=l.next)if(l.type==NOTE){if(!l.a_ly)break;f=l.a_ly[i],f&&"_\n"==f.t&&(p=!0,h=realwidth-15,o+12>h&&(h=o+12));break}p&&(out_wln(o+3,m,h-o+3),p=!1),r>0?n-=u:n+=u}return r>0&&(n+=u),n}function draw_all_lyrics(){var e,t,n,r,i,s,a,o,c=new Array(nstaff),u=new Array(voice_tb.length),l=new Array(voice_tb.length),f=new Array(voice_tb.length),d=0,p=0,h=-1;for(n=0;n<voice_tb.length;n++)if(e=voice_tb[n],e.sym){if(e.st!=h&&(d=0,p=0,h=e.st),r=0,e.have_ly)for(t=e.sym;t;t=t.next){var m=t.a_ly;m&&m[0]&&(s=t.x,0!=m[0].w?(s-=m[0].shift,o=m[0].w):o=10,a=y_get(e.st,1,s,o),a>d&&(d=a),a=y_get(e.st,0,s,o),p>a&&(p=a),r<m.length&&(r=m.length))}else a=y_get(e.st,1,0,realwidth),a>d&&(d=a),a=y_get(e.st,0,0,realwidth),p>a&&(p=a);c[h]||(c[h]={}),c[h].top=d,c[h].bot=p,u[n]=r,0!=r&&(0!=e.pos.voc?l[n]=e.pos.voc==SL_ABOVE:voice_tb[e.v+1]&&voice_tb[e.v+1].st==h&&voice_tb[e.v+1].have_ly?l[n]=!0:l[n]=!1,l[n]?c[h].a=!0:c[h].b=!0)}for(i=0,n=0;n<voice_tb.length;n++)e=voice_tb[n],e.sym&&e.have_ly&&(l[n]?f[i++]=n:(h=e.st,set_dscale(h),u[n]>0&&(c[h].bot=draw_lyrics(e,u[n],c[h].bot,1))));for(;--i>=0;)n=f[i],e=voice_tb[n],h=e.st,set_dscale(h),c[h].top=draw_lyrics(e,u[n],c[h].top,-1);for(n=0;n<voice_tb.length;n++)if(e=voice_tb[n],e.sym){if(h=e.st,c[h].a)for(d=c[h].top+2,t=e.sym.next;t;t=t.next)t.a_ly&&y_set(h,1,t.x-2,10,d);if(c[h].b)if(p=c[h].bot-2,u[e.v]>0)for(t=e.sym.next;t;t=t.next)t.a_ly&&y_set(h,0,t.x-2,10,p);else y_set(h,0,0,realwidth,p)}}function parse_gchord(e){var t,n,r=parse.line;if(e.length>1)n=e.slice(1,-1);else for(n="";;){if(t=r.next_char(),void 0==t)return void r.error("No end of guitar chord");if('"'==t)break;n+=t}gchord?gchord+="\n"+cnv_escape(n):gchord=cnv_escape(n)}function gch_acc(e,t,n){for(var r=1;;){if(r=e.indexOf(t,r),0>r)break;"\\"==e[r-1]?e=2==r||"/"==e[r-3]?e.slice(0,r-1)+e.slice(r):e.slice(0,r-1)+n+e.slice(r+1):(1==r||"/"==e[r-2])&&(e=e.slice(0,r)+n+e.slice(r+1)),r++}return e}function gch_tr1(e){var t,n,r,i,s,a,o,c,u,l;switch(n=0,e[0]){case"A":case"B":r=e.charCodeAt(0)-"A".charCodeAt(0)+5;break;case"C":case"E":case"G":r=e.charCodeAt(0)-"C".charCodeAt(0);break;case"D":if("o"==e[1]){n=1,r=0;break}r=1;break;case"F":"a"==e[1]&&(n=1),r=3;break;case"L":n=1,r=5;break;case"M":n=1,r=2;break;case"R":n=1,"e"!=e[1]&&n++,r=1;break;case"S":n=1,"o"==e[1]?(n++,r=4):r=6;break;default:return e}return c=0,u=n+1,"#"==e[u]?(c++,u++,"#"==e[u]&&(c++,u++)):"b"==e[u]?(c--,u++,"b"==e[u]&&(c--,u++)):"="==e[u]&&u++,s=curvoice.ckey.k_sf-curvoice.okey.k_sf,a=cde2fcg[r]+s+7*c,o=cgd2cde[(a+112)%7],i=(Math.floor((a+1+21)/7)+2-3+160)%5,t=n?latin_names[o]+acc_name[i]:note_names[o]+acc_name[i],l=e.indexOf("/",u),0>l?t+e.slice(u):(r=note_names.indexOf(e[++l]),0>r?t+e.slice(u):(t+=e.slice(u,l),"#"==e[++l]?(c=1,l++):"b"==e[l]?(c=-1,l++):c=0,a=cde2fcg[r]+s+7*c,o=cgd2cde[(a+112)%7],i=(Math.floor((a+1+21)/7)+2-3+160)%5,note_names[o]+acc_name[i]+e.slice(l)))}function gch_transp(e){for(var t,n,r=0;;){if(t=e.a_gch[r++],!t)return;if("g"==t.type)break}n=t.text,r=n.indexOf("	"),r>=0&&(r++,n=n.slice(0,r)+gch_tr1(n.slice(r))),t.text=gch_tr1(n,0)}function gch_build(e){if(curvoice.pos.gch!=SL_HIDDEN){var t,n,r,i,s,a,o,u,l=curvoice.pos.gch==SL_BELOW?-1:1,f=get_font("gchord"),d=get_font("annotation"),p=f.size,h=d.size,m=0,v=0,g=0,y=0,_=cfmt.gchordbox,b="\n";for(e.a_gch=[],t=new scanBuf,t.buffer=gchord,t.index=0;;){if(c=t["char"](),!c)break;switch(n={text:""},"n"!=b&&"^_<>@".indexOf(c)>=0?(antype=c,c=t.next_char(),"@"==antype&&(s=t.get_float(),c=t["char"](),","!=c?(error(1,e,'Error in annotation "@"'),a=0):(t.advance(),a=t.get_float(),c=t["char"]()," "==c&&(c=t.next_char())))):"\n"==b&&(antype="g"),"g"==antype?(n.font=f,n.box=_):n.font=d,n.type=antype,antype){default:if(0>l)break;m+=p,_&&(m+=2);break;case"^":m+=h;break;case"_":break;case"<":g+=.5*h;break;case">":y+=.5*h;break;case"@":n.x=s,n.y=a,a-=h}for(;;){switch(c){case"\\":if(c=t.next_char(),"n"==c)break;n.text+="\\";default:n.text+=c,c=t.next_char();continue;case"&":for(;;){switch(n.text+=c,c=t.next_char(),c){default:continue;case";":case void 0:case"\n":case"\\":}break}if(";"==c){n.text+=c,c=t.next_char();continue}break;case void 0:case";":case"\n":}break}if(e.a_gch.push(n),!c)break;b=c,t.advance()}curvoice.transpose&&gch_transp(e);const x=.4;for(u=e.a_gch.length,o=0;u>o;o++)if(n=e.a_gch[o],"g"==n.type&&(n.text.indexOf("#")&&(n.text=gch_acc(n.text,"#","")),n.text.indexOf("b")&&(n.text=gch_acc(n.text,"b","")),n.text.indexOf("=")&&(n.text=gch_acc(n.text,"=",""))),"@"!=n.type||user.anno_start)switch(gene.curfont=n.font,r=strw(n.text),n.w=r,n.type){case"@":break;case"_":i=r*x,i>8&&(i=8),n.x=-i,v-=h,n.y=v;break;case"^":i=r*x,i>8&&(i=8),n.x=-i,m-=h,n.y=m;break;default:i=r*x,i>8&&(i=8),n.x=-i,0>l?(v-=p,n.y=v,_&&(v-=2,n.y-=1)):(m-=p,n.y=m,_&&(m-=2,n.y-=1));break;case"<":n.x=-(r+6),g-=h,n.y=g;break;case">":n.x=6,y-=h,n.y=y}}}function draw_gchord(e,t,n){var r,i,s,a,o,c,u,l,f,d,p,m,v,g,y=e.a_gch[0].w,_=y_get(e.st,1,e.x-2,y),b=y_get(e.st,0,e.x-2,y),x=e.a_gch.length,w=e.yav||0;for(a=0;x>a&&(r=e.a_gch[a],!("g"==r.type&&(i=r,r.y<0)));a++);for(i&&(i.y>=0?n>_&&(_=n):b>t&&(b=t)),set_dscale(e.st),m=p=e.x,v=-100,g=100,f=0,a=0;x>a;a++){switch(r=e.a_gch[a],use_font(r.font),gene.curfont=gene.deffont=r.font,h=r.font.size,y=r.w,o=e.x+r.x,s=r.text,r.type){case"_":c=r.y+b,y_set(e.st,0,o,y,c-.2*h-2);break;case"^":c=r.y+_,y_set(e.st,1,o,y,c+.8*h+2);break;default:if(d=r.box?3:2,r.y>=0?(c=r.y+_,y_set(e.st,!0,o,y,c+h+d)):(c=r.y+b,y_set(e.st,!1,o,y,c-d)),r.box&&(p>o&&(p=o),y+=o,y>m&&(m=y),g>c&&(g=c),v<c+h&&(v=c+h),f++),u=s.indexOf("	"),u>=0){o=realwidth;for(var k=e.next;k;k=k.next){switch(k.type){default:continue;case NOTE:case REST:case BAR:o=k.x}break}for(l=2;u=s.indexOf("	",u+1),!(0>u);)l++;var E=(o-e.x)/l;for(o=e.x,user.anno_start&&user.anno_start("gchord",e.istart,e.iend,o-2,c+h+2,y+4,h+4),u=0,l=u;u=s.indexOf("	",l),!(0>u);)xy_str(o,c+.2*h,s.slice(l,u),"c"),o+=E,l=u+1;xy_str(o,c+.2*h,s.slice(l),"c"),user.anno_stop&&user.anno_stop("annot",e.istart,e.iend,e.x-2,c+h+2,y+4,h+4);continue}break;case"<":e.notes[0].acc&&(o-=e.notes[0].shac),c=r.y+w;break;case">":o+=e.xmx,e.dots>0&&(o+=1.5+3.5*e.dots),c=r.y+w;break;case"@":c=r.y+w,c>0?y_set(e.st,1,o,1,c+.8*h+3):y_set(e.st,0,o,1,c-.2*h)}user.anno_start&&user.anno_start("annot",e.istart,e.iend,o-2,c+h+2,y+4,h+4),xy_str(o,c+.2*h,s),user.anno_stop&&user.anno_stop("annot",e.istart,e.iend,o-2,c+h+2,y+4,h+4)}m!=p&&(p-=2,y=m-p,h=v-g+3,xybox(p,g-1+h,y,h))}function psdeco(e,t,n,r){return!1}function pshdeco(e,t,n,r){return!1}function psxygl(e,t,n){return!1}var wpsobj,svgobj;this.user=user;const BAR=0,CLEF=1,CUSTOS=2,FORMAT=3,GRACE=4,KEY=5,METER=6,MREST=7,NOTE=8,PART=9,REST=10,SPACE=11,STAVES=12,STBRK=13,TEMPO=14,TUPLET=15,BLOCK=16;SL_ABOVE=1,SL_BELOW=2,SL_AUTO=3,SL_HIDDEN=4,SL_DOTTED=8,OPEN_BRACE=1,CLOSE_BRACE=2,OPEN_BRACKET=4,CLOSE_BRACKET=8,OPEN_PARENTH=16,CLOSE_PARENTH=32,STOP_BAR=64,FL_VOICE=128,OPEN_BRACE2=256,CLOSE_BRACE2=512,OPEN_BRACKET2=1024,CLOSE_BRACKET2=2048,MASTER_VOICE=4096,BASE_LEN=1536,CM=37.8,IN=96,YSTEP=128;var glovar={clef:{type:CLEF,clef_auto:!0,clef_type:"a"},meter:{type:METER,wmeasure:1,a_meter:[]}},info={},parse={ctx:{},prefix:"%",state:0},dd_tb={},a_de=[];const std_deco_tb=["dot 0 stc 5 1 1","tenuto 0 emb 5 2 2","slide 1 sld 3 7 0","arpeggio 2 arp 12 10 0","roll 3 cpu 7 6 6","fermata 3 hld 12 7 7","emphasis 3 accent 7 4 4","lowermordent 3 lmrd 10 2 2","coda 3 coda 24 10 10","uppermordent 3 umrd 10 2 2","segno 3 sgno 20 4 4","trill 3 trl 14 4 4","upbow 3 upb 10 5 5","downbow 3 dnb 9 5 5","gmark 3 grm 6 5 5","wedge 3 wedge 8 1 1","turnx 3 turnx 10 0 5","breath 3 brth 0 1 20","longphrase 3 lphr 0 1 1","mediumphrase 3 mphr 0 1 1","shortphrase 3 sphr 0 1 1","invertedfermata 3 hld 12 7 7","invertedturn 3 turn 10 0 5","invertedturnx 3 turnx 10 0 5","0 3 fng 8 3 3 0","1 3 fng 8 3 3 1","2 3 fng 8 3 3 2","3 3 fng 8 3 3 3","4 3 fng 8 3 3 4","5 3 fng 8 3 3 5","plus 3 dplus 7 3 3","+ 3 dplus 7 3 3","accent 3 accent 6 4 4","> 3 accent 6 4 4","marcato 3 marcato 9 3 3","^ 3 marcato 9 3 3","mordent 3 lmrd 10 2 2","open 3 opend 10 2 2","snap 3 snap 14 3 3","thumb 3 thumb 14 2 2","D.C. 3 dacs 16 10 10 D.C.","D.S. 3 dacs 16 10 10 D.S.","fine 3 dacs 16 10 10 FINE","f 6 pf 18 1 7","ff 6 pf 18 2 10","fff 6 pf 18 4 13","ffff 6 pf 18 6 16","mf 6 pf 18 6 13","mp 6 pf 18 6 16","p 6 pf 18 2 8","pp 6 pf 18 5 14","ppp 6 pf 18 8 20","pppp 6 pf 18 10 25","pralltriller 3 umrd 10 2 2",'sfz 6 sfz 18 4 10 ""',"turn 3 turn 10 0 5","trill( 5 ltr 8 0 0","trill) 5 ltr 8 0 0","crescendo( 7 cresc 18 0 0","crescendo) 7 cresc 18 0 0","<( 7 cresc 18 0 0","<) 7 cresc 18 0 0","diminuendo( 7 dim 18 0 0","diminuendo) 7 dim 18 0 0",">( 7 dim 18 0 0",">) 7 dim 18 0 0","invisible 32 0 0 0 0","beamon 33 0 0 0 0","trem1 34 0 0 0 0","trem2 34 0 0 0 0","trem3 34 0 0 0 0","trem4 34 0 0 0 0","xstem 35 0 0 0 0","beambr1 36 0 0 0 0","beambr2 36 0 0 0 0","rbstop 37 0 0 0 0","/ 38 0 0 6 6","// 38 0 0 6 6","/// 38 0 0 6 6","beam-accel 39 0 0 0 0","beam-rall 39 0 0 0 0","stemless 40 0 0 0 0","rbend 41 0 0 0 0"];var user_deco_tb,first_note;const func_tb=[d_near,d_slide,d_arp,d_upstaff,d_upstaff,d_trill,d_pf,d_cresc],STEM_MIN=16,STEM_MIN2=14,STEM_MIN3=12,STEM_MIN4=10,STEM_CH_MIN=14,STEM_CH_MIN2=10,STEM_CH_MIN3=9,STEM_CH_MIN4=9,BEAM_DEPTH=3.2,BEAM_OFFSET=.25,BEAM_SHIFT=5,BEAM_FLATFAC=.6,BEAM_THRESH=.06,BEAM_SLOPE=.5,BEAM_STUB=6,SLUR_SLOPE=1,GSTEM=14,GSTEM_XOFF=1.6,min_tb=[[STEM_MIN,STEM_MIN,STEM_MIN2,STEM_MIN3,STEM_MIN4,STEM_MIN4],[STEM_CH_MIN,STEM_CH_MIN,STEM_CH_MIN2,STEM_CH_MIN3,STEM_CH_MIN4,STEM_CH_MIN4]],sharp_cl=[24,9,15,21,6,12,18],flat_cl=[12,18,24,9,15,21,6],sharp1=[-9,12,-9,-9,12,-9],sharp2=[12,-9,12,-9,12,-9],flat1=[9,-12,9,-12,9,-12],flat2=[-12,9,-12,9,-12,9],rest_tb=["r128","r64","r32","r16","r8","r4","r2","r1","r0","r00"];var defined_font={},font_tb={},fid=1,font_scale_tb={serif:1.05,serifBold:1.05,"sans-serif":1.1,"sans-serifBold":1.15,Palatino:1.1,Mono:1.35},lock={},cfmt={aligncomposer:1,breaklimit:.7,breakoneoln:!0,composerspace:6,dblrepbar:":][:",decoerr:!0,dynalign:!0,fullsvg:"",gracespace:[6.5,8,12],graceslurs:!0,hyphencont:!0,indent:0,infoname:'R "Rhythm: "\nB "Book: "\nS "Source: "\nD "Discography: "\nN "Notes: "\nZ "Transcription: "\nH "History: "',infospace:0,keywarn:!0,leftmargin:.7*IN,lineskipfac:1.1,linewarn:!0,maxshrink:.65,maxstaffsep:2e3,maxsysstaffsep:2e3,measurefirst:1,measurenb:-1,musicspace:6,parskipfac:.4,partsspace:8,pagewidth:21*CM,pos:{dyn:0,gch:0,gst:0,
orn:0,ste:0,voc:0,vol:0},rightmargin:.7*IN,rbmax:4,rbmin:2,scale:1,slurheight:1,staffnonote:1,staffsep:46,stemheight:21,stretchlast:.25,stretchstaff:!0,subtitlespace:3,sysstaffsep:34,textspace:14,titlespace:6,titletrim:!0,transpose:0,topspace:22,tuplets:[0,0,0],vocalspace:23,voicecombine:0,voicescale:1,writefields:"CMOPQTWw",wordsspace:5};const textopt={align:"j",center:"c",fill:"f",justify:"j",ragged:"f",right:"r",skip:"s"},posval={above:SL_ABOVE,below:SL_BELOW,down:SL_BELOW,hidden:SL_HIDDEN,opposite:SL_HIDDEN,up:SL_ABOVE};var abc_utf={"`A":"","`E":"","`I":"","`O":"","`U":"","`a":" ","`e":"","`i":"","`o":"","`u":"","'A":"","'E":"","'I":"","'O":"","'U":"","'Y":"","'a":"","'e":"","'i":"","'o":"","'u":"","'y":"","'S":"","'Z":"","'s":"","'z":"","'R":"","'L":"","'C":"","'N":"","'r":"","'l":"","'c":"","'n":"","^A":"","^E":"","^I":"","^O":"","^U":"","^a":"","^e":"","^i":"","^o":"","^u":"","^H":"","^J":"","^h":"","^j":"","^C":"","^G":"","^S":"","^c":"","^g":"","^s":"",",C":"",",c":"",",S":"",",s":"",",T":"",",t":"",",R":"",",L":"",",G":"",",r":"",",l":"",",g":"",",N":"",",K":"",",n":"",",k":"",'"A':"",'"E':"",'"I':"",'"O':"",'"U':"",'"Y':"",'"a':"",'"e':"",'"i':"",'"o':"",'"u':"",'"y':"","~A":"","~N":"","~O":"","~a":"","~n":"","~o":"","~I":"","~i":"","~U":"","~u":"",oA:"",oa:"",oU:"",ou:"","=A":"","=D":"","=E":"","=H":"","=I":"","=O":"","=T":"","=U":"","=a":"","=d":"","=e":"","=h":"","=i":"","=o":"","=t":"","=u":"","/O":"","/o":"","/D":"","/d":"","/L":"","/l":"",";A":"",";E":"",";I":"",";U":"",";a":"",";e":"",";i":"",";u":"",vL:"",vS:" ",vT:"",vZ:"",vl:"",vs:"",vt:"",vz:"",vC:"",vE:"",vD:"",vN:"",vR:"",vc:"",ve:"",vd:"",vn:"",vr:"",uA:"",ua:"",uE:"",ue:"",uG:"",ug:"",uI:"",ui:"",uO:"",uo:"",uU:"",uu:"",":O":"",":U":"",":o":"",":u":"",".Z":"",".z":"",".I":"",".i":"",".C":"",".c":"",".G":" ",".g":"",".E":"",".e":"",AA:"",aa:"",AE:"",ae:"",cc:"",cC:"",DH:"",dh:"",ng:"",OE:"",oe:"",ss:"",TH:"",th:""},include=2;Abc.prototype.tosvg=tosvg;var gene,staff_tb,tsnext,realwidth,insert_meter,beta_last,space_tb=[7,10,14.15,20,28.3,40,56.6,80,113,150],smallest_duration;const dx_tb={full:9,empty:10,oval:12,square:15.3},delta_tb={t:-4,c:0,b:4,p:-6},rest_sp=[[18,18],[12,18],[12,12],[8,12],[6,8],[10,10],[6,4],[10,0],[10,4],[10,10]],delpit=[0,-7,-14,0],w_note={full:3.5,empty:3.7,oval:5,square:7},MAXPIT=96;var gchord,a_dcn,multicol,maps;const not_ascii="Not an ASCII character";var pit_st=[0,2,4,5,7,9,11],nil="0",char_tb=[nil,nil,nil,nil,nil,nil,nil,nil,nil," ","\n",nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil," ","!",'"',nil,"\n",nil,"&",nil,"(",")",nil,nil,nil,"-","!dot!",nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,"|",nil,"<","n","<",nil,nil,"n","n","n","n","n","n","n","!fermata!","d","d","d","!emphasis!","!lowermordent!","d","!coda!","!uppermordent!","d","d","!segno!","!trill!","d","d","d","n","d","n","[","\\","|","n","n","i","n","n","n","n","n","n","n","d","d","d","d","d","d","d","d","d","d","d","d","d","!upbow!","!downbow!","d","n","n","n","{","|","}","!roll!",nil],cw_tb=[.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.25,.333,.408,.5,.5,.833,.778,.333,.333,.333,.5,.564,.25,.564,.25,.278,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.278,.278,.564,.564,.564,.444,.921,.722,.667,.667,.722,.611,.556,.722,.722,.333,.389,.722,.611,.889,.722,.722,.556,.722,.667,.556,.611,.722,.722,.944,.722,.722,.611,.333,.278,.333,.469,.5,.333,.444,.5,.444,.5,.444,.333,.5,.5,.278,.278,.5,.278,.778,.5,.5,.5,.5,.333,.389,.278,.5,.5,.722,.5,.5,.444,.48,.2,.48,.541,.5],info_font_init={A:"info",C:"composer",O:"composer",P:"parts",Q:"tempo",R:"info",T:"title",X:"title"},output=[],style="\n.fill {fill: currentColor}\n.stroke {stroke: currentColor; fill: none}",font_style="",posy=0,posx=cfmt.leftmargin/cfmt.scale,defined_glyph={},defs="",stv_g={scale:1,dy:0,st:-1,v:0},block={},glyphs={brace:'<path id="brace" class="fill" transform="scale(0.0235)"\n	d="M-20 -515v-2\n	c35 -16 53 -48 53 -91\n	c0 -34 -11 -84 -35 -150\n	c-13 -41 -18 -76 -18 -109\n	c0 -69 29 -121 87 -160\n	c-44 35 -63 77 -63 125\n	c0 26 8 56 21 91\n	c27 71 37 130 37 174\n	c0 62 -26 105 -77 121\n	c52 16 77 63 77 126\n	c0 46 -10 102 -37 172\n	c-13 35 -21 68 -21 94\n	c0 48 19 89 63 124\n	c-58 -39 -87 -91 -87 -160\n	c0 -33 5 -68 18 -109\n	c24 -66 35 -116 35 -150\n	c0 -44 -18 -80 -53 -96z"/>',utclef:'<path id="utclef" class="fill" transform="scale(0.045)"\n	d="m-50 44\n	c-72 -41 -72 -158 52 -188\n	150 -10 220 188 90 256\n	-114 52 -275 0 -293 -136\n	-15 -181 93 -229 220 -334\n	88 -87 79 -133 62 -210\n	-51 33 -94 105 -89 186\n	17 267 36 374 49 574\n	6 96 -19 134 -77 135\n	-80 1 -126 -93 -61 -133\n	85 -41 133 101 31 105\n	23 17 92 37 90 -92\n	-10 -223 -39 -342 -50 -617\n	0 -90 0 -162 96 -232\n	56 72 63 230 22 289\n	-74 106 -257 168 -255 316\n	9 153 148 185 252 133\n	86 -65 29 -192 -80 -176\n	-71 12 -105 67 -59 124"/>',tclef:'<use id="tclef" xlink:href="#utclef"/>',stclef:'<use id="stclef" transform="scale(0.8)"\n	xlink:href="#utclef"/>',ubclef:'<path id="ubclef" class="fill" transform="scale(0.045)"\n	d="m-200 312\n	c124 -35 222 -78 254 -236\n	43 -228 -167 -246 -192 -103\n	59 -80 157 22 92 78\n	-62 47 -115 -22 -106 -88\n	21 -141 270 -136 274 52\n	-1 175 -106 264 -322 297\n	m357 -250\n	c0 -36 51 -34 51 0\n	0 37 -51 36 -51 0\n	m-2 -129\n	c0 -36 51 -34 51 0\n	0 38 -51 37 -51 0"/>',bclef:'<use id="bclef" xlink:href="#ubclef"/>',sbclef:'<use id="sbclef" transform="scale(0.8)"\n	xlink:href="#ubclef"/>',ucclef:'<path id="ucclef" class="fill" transform="scale(0.045)"\n	d="m-51 3\n	v262\n	h-13\n	v-529\n	h13\n	v256\n	c25 -20 41 -36 63 -109\n	14 31 13 51 56 70\n	90 34 96 -266 -41 -185\n	52 19 27 80 -11 77\n	-90 -38 33 -176 139 -69\n	72 79 1 241 -134 186\n	l-16 39 16 38\n	c135 -55 206 107 134 186\n	-106 108 -229 -31 -139 -69\n	38 -3 63 58 11 77\n	137 81 131 -219 41 -185\n	-43 19 -45 30 -56 64\n	-22 -73 -38 -89 -63 -109\n	m-99 -267\n	h57\n	v529\n	h-57\n	v-529"/>',cclef:'<use id="cclef" xlink:href="#ucclef"/>',scclef:'<use id="scclef" transform="scale(0.8)"\n	xlink:href="#ucclef"/>',pclef:'<path id="pclef" class="stroke" stroke-width="1.4"\n	d="m-4 10h5.4v-20h-5.4v20"/>',hd:'<ellipse id="hd" rx="4.1" ry="2.9"\n	transform="rotate(-20)" class="fill"/>',Hd:'<path id="Hd" class="fill" d="m3 -1.6\n	c-1 -1.8 -7 1.4 -6 3.2\n	1 1.8 7 -1.4 6 -3.2\n	m0.5 -0.3\n	c2 3.8 -5 7.6 -7 3.8\n	-2 -3.8 5 -7.6 7 -3.8"/>',HD:'<path id="HD" class="fill" d="m-2.7 -1.4\n	c1.5 -2.8 6.9 0 5.3 2.7\n	-1.5 2.8 -6.9 0 -5.3 -2.7\n	m8.3 1.4\n	c0 -1.5 -2.2 -3 -5.6 -3\n	-3.4 0 -5.6 1.5 -5.6 3\n	0 1.5 2.2 3 5.6 3\n	3.4 0 5.6 -1.5 5.6 -3"/>',HDD:'<g id="HDD">\n	<use xlink:href="#HD"/>\n	<path d="m-6 -4v8m12 0v-8" class="stroke"/>\n</g>',breve:'<g id="breve" class="stroke">\n	<path d="m-6 -2.7h12m0 5.4h-12" stroke-width="2.5"/>\n	<path d="m-6 -5v10m12 0v-10"/>\n</g>',longa:'<g id="longa" class="stroke">\n	<path d="m-6 2.7h12m0 -5.4h-12" stroke-width="2.5"/>\n	<path d="m-6 5v-10m12 0v16"/>\n</g>',ghd:'<use id="ghd" transform="translate(4.5,0) scale(0.5)" xlink:href="#hd"/>',r00:'<rect id="r00" class="fill"\n	x="-1.6" y="-6" width="3" height="12"/>',r0:'<rect id="r0" class="fill"\n	x="-1.6" y="-6" width="3" height="6"/>',r1:'<rect id="r1" class="fill"\n	x="-3.5" y="-6" width="7" height="3"/>',r2:'<rect id="r2" class="fill"\n	x="-3.5" y="-3" width="7" height="3"/>',r4:'<path id="r4" class="fill" d="m-1 -8.5\n	l3.6 5.1 -2.1 5.2 2.2 4.3\n	c-2.6 -2.3 -5.1 0 -2.4 2.6\n	-4.8 -3 -1.5 -6.9 1.4 -4.1\n	l-3.1 -4.5 1.9 -5.1 -1.5 -3.5"/>',r8e:'<path id="r8e" class="fill" d="m 0 0\n	c-1.5 1.5 -2.4 2 -3.6 2\n	2.4 -2.8 -2.8 -4 -2.8 -1.2\n	0 2.7 4.3 2.4 5.9 0.6"/>',r8:'<g id="r8">\n	<path d="m3.3 -4l-3.4 9.6" class="stroke"/>\n	<use x="3.4" y="-4" xlink:href="#r8e"/>\n</g>',r16:'<g id="r16">\n	<path d="m3.3 -4l-4 15.6" class="stroke"/>\n	<use x="3.4" y="-4" xlink:href="#r8e"/>\n	<use x="1.9" y="2" xlink:href="#r8e"/>\n</g>',r32:'<g id="r32">\n	<path d="m4.8 -10l-5.5 21.6" class="stroke"/>\n	<use x="4.9" y="-10" xlink:href="#r8e"/>\n	<use x="3.4" y="-4" xlink:href="#r8e"/>\n	<use x="1.9" y="2" xlink:href="#r8e"/>\n</g>',r64:'<g id="r64">\n	<path d="m4.8 -10 l-7 27.6" class="stroke"/>\n	<use x="4.9" y="-10" xlink:href="#r8e"/>\n	<use x="3.4" y="-4" xlink:href="#r8e"/>\n	<use x="1.9" y="2" xlink:href="#r8e"/>\n	<use x="0.4" y="8" xlink:href="#r8e"/>\n</g>',r128:'<g id="r128">\n	<path d="m5.8 -16 l-8.5 33.6" class="stroke"/>\n	<use x="5.9" y="-16" xlink:href="#r8e"/>\n	<use x="4.4" y="-10" xlink:href="#r8e"/>\n	<use x="2.9" y="-4" xlink:href="#r8e"/>\n	<use x="1.4" y="2" xlink:href="#r8e"/>\n	<use x="0.1" y="8" xlink:href="#r8e"/>\n</g>',mrest:'<g id="mrest" class="stroke">\n	<path d="m-10 6v-12m20 0v12"/>\n	<path d="m-10 0h20" stroke-width="5"/>\n</g>',usharp:'<path id="usharp" class="fill" d="m136 -702\n	v890\n	h32\n	v-890\n	m128 840\n	h32\n	v-888\n	h-32\n	m-232 286\n	v116\n	l338 -96\n	v-116\n	m-338 442\n	v116\n	l338 -98\n	v-114"/>',uflat:'<path id="uflat" class="fill" d="m100 -746\n	h32\n	v734\n	l-32 4\n	m32 -332\n	c46 -72 152 -90 208 -20\n	100 110 -120 326 -208 348\n	m0 -28\n	c54 0 200 -206 130 -290\n	-50 -60 -130 -4 -130 34"/>',unat:'<path id="unat" class="fill" d="m96 -750\n	h-32\n	v716\n	l32 -8\n	l182 -54\n	v282\n	h32\n	v-706\n	l-34 10\n	l-180 50\n	v-290\n	m0 592\n	v-190\n	l182 -52\n	v188"/>',udblesharp:'<path id="udblesharp" class="fill" d="m240 -282\n	c40 -38 74 -68 158 -68\n	v-96\n	h-96\n	c0 84 -30 118 -68 156\n	-40 -38 -70 -72 -70 -156\n	h-96\n	v96\n	c86 0 120 30 158 68\n	-38 38 -72 68 -158 68\n	v96\n	h96\n	c0 -84 30 -118 70 -156\n	38 38 68 72 68 156\n	h96\n	v-96\n	c-84 0 -118 -30 -158 -68"/>',udbleflat:'<path id="udbleflat" class="fill" d="m20 -746\n	h24\n	v734\n	l-24 4\n	m24 -332\n	c34 -72 114 -90 156 -20\n	75 110 -98 326 -156 348\n	m0 -28\n	c40 0 150 -206 97 -290\n	-37 -60 -97 -4 -97 34\n	m226 -450\n	h24\n	v734\n	l-24 4\n	m24 -332\n	c34 -72 114 -90 156 -20\n	75 110 -98 326 -156 348\n	m0 -28\n	c40 0 150 -206 97 -290\n	-37 -60 -97 -4 -97 34"/>',acc1:'<use id="acc1" transform="translate(-4,5) scale(0.018)" xlink:href="#usharp"/>',"acc-1":'<use id="acc-1" transform="translate(-3.5,3.5) scale(0.018)" xlink:href="#uflat"/>',acc3:'<use id="acc3" transform="translate(-3,5) scale(0.018)" xlink:href="#unat"/>',acc2:'<use id="acc2" transform="translate(-4,5) scale(0.018)"\n	xlink:href="#udblesharp"/>',"acc-2":'<use id="acc-2" transform="translate(-4,3.5) scale(0.018)"\n	xlink:href="#udbleflat"/>',acc1_1_4:'<g id="acc1_1_4">\n	<path d="m0 7.8v-15.4" class="stroke"/>\n	<path class="fill" d="M-1.8 2.7l3.6 -1.1v2.2l-3.6 1.1v-2.2z\n		M-1.8 -3.7l3.6 -1.1v2.2l-3.6 1.1v-2.2"/>\n</g>',acc1_3_4:'<g id="acc1_3_4">\n	<path d="m-2.5 8.7v-15.4M0 7.8v-15.4M2.5 6.9v-15.4" class="stroke"/>\n	<path class="fill" d="m-3.7 3.1l7.4 -2.2v2.2l-7.4 2.2v-2.2z\n		M-3.7 -3.2l7.4 -2.2v2.2l-7.4 2.2v-2.2"/>\n</g>',"acc-1_1_4":'<g id="acc-1_1_4" transform="scale(-1,1)">\n	<use xlink:href="#acc-1"/>\n</g>',"acc-1_3_4":'<g id="acc-1_3_4">\n    <path class="fill" d="m0.6 -2.7\n	c-5.7 -3.1 -5.7 3.6 0 6.7c-3.9 -4 -4 -7.6 0 -5.8\n	M1 -2.7c5.7 -3.1 5.7 3.6 0 6.7c3.9 -4 4 -7.6 0 -5.8"/>\n    <path d="m1.6 3.5v-13M0 3.5v-13" class="stroke" stroke-width=".6"/>\n</g>',pshhd:'<use id="pshhd" xlink:href="#acc2"/>',pfthd:'<g id="pfthd">\n	<use xlink:href="#acc2"/>\n	<circle r="4" class="stroke"/>\n</g>',csig:'<path id="csig" class="fill" transform="scale(0.0235, 0.0235)"\n	d="M303 -161\n	c8 1 12 2 18 3\n	c3 -4 4 -9 4 -13\n	c0 -28 -52 -54 -91 -54\n	c-61 2 -115 58 -115 210\n	c0 76 7 151 39 193\n	c23 29 49 42 81 42\n	c26 0 55 -10 83 -34\n	s47 -64 70 -112\n	c0 3 18 6 17 9\n	c-33 103 -76 164 -198 166\n	c-50 0 -100 -20 -138 -57\n	c-39 -38 -60 -91 -63 -159\n	c0 -4 -1 -43 -1 -47\n	c0 -168 88 -231 219 -232\n	c52 0 97 27 117 50\n	s34 49 34 75\n	c0 47 -25 94 -64 94\n	c-45 0 -73 -39 -73 -74\n	c2 -26 23 -60 60 -60h1z"/>',ctsig:'<g id="ctsig">\n	<use xlink:href="#csig"/>\n	<path d="m5 8v-16" class="stroke"/>\n</g>',pmsig:'<path id="pmsig" class="stroke" stroke-width="0.8"\n	d="m0 -7a5 5 0 0 1 0 -10a5 5 0 0 1 0 10"/>',pMsig:'<g id="pMsig">\n	<use xlink:href="#pmsig"/>\n	<path class="fill" d="m0 -10a2 2 0 0 1 0 -4a2 2 0 0 1 0 4"/>\n</g>',imsig:'<path id="imsig" class="stroke" stroke-width="0.8"\n	d="m0 -7a5 5 0 1 1 0 -10"/>',iMsig:'<g id="iMsig">\n	<use xlink:href="#imsig"/>\n	<path class="fill" d="m0 -10a2 2 0 0 1 0 -4a2 2 0 0 1 0 4"/>\n</g>',hl:'<path id="hl" class="stroke" d="m-6 0h12"/>',hl1:'<path id="hl1" class="stroke" d="m-7 0h14"/>',hl2:'<path id="hl2" class="stroke" d="m-9 0h18"/>',ghl:'<path id="ghl" class="stroke" d="m-3 0h6"/>',rdots:'<g id="rdots" class="fill">\n	<circle cx="0" cy="-9" r="1.2"/>\n	<circle cx="0" cy="-15" r="1.2"/>\n</g>',srep:'<path id="srep" class="fill" d="m-1 -6l11 -12h3l-11 12h-3"/>',mrep:'<path id="mrep" class="fill"\n    d="m-5 -16.5a1.5 1.5 0 0 1 0 3a1.5 1.5 0 0 1 0 -3\n	M4.5 -10a1.5 1.5 0 0 1 0 3a1.5 1.5 0 0 1 0 -3\n	M-7 -6l11 -12h3l-11 12h-3"/>',mrep2:'<g id="mrep2">\n    <path d="m-5.5 -19.5a1.5 1.5 0 0 1 0 3a1.5 1.5 0 0 1 0 -3\n	M5 -7.5a1.5 1.5 0 0 1 0 3a1.5 1.5 0 0 1 0 -3" class="fill"/>\n    <path d="m-7 -4l14 -10m-14 4l14 -10" class="stroke" stroke-width="1.8"/>\n</g>',accent:'<g id="accent" class="stroke">\n	<path d="m-4 0l8 -2l-8 -2" stroke-width="1.2"/>\n</g>',marcato:'<path id="marcato" d="m-3 0l3 -7l3 7l-1.5 0l-1.8 -4.2l-1.7 4.2"/>',umrd:'<path id="umrd" class="fill" d="m0 -4\n	l2.2 -2.2 2.1 2.9 0.7 -0.7 0.2 0.2\n	-2.2 2.2 -2.1 -2.9 -0.7 0.7\n	-2.2 2.2 -2.1 -2.9 -0.7 0.7 -0.2 -0.2\n	2.2 -2.2 2.1 2.9 0.7 -0.7"/>',lmrd:'<g id="lmrd">\n	<use xlink:href="#umrd"/>\n	<line x1="0" y1="0" x2="0" y2="-8" class="stroke" stroke-width=".6"/>\n</g>',grm:'<path id="grm" class="fill" d="m-5 -2.5\n	c5 -8.5 5.5 4.5 10 -2\n	-5 8.5 -5.5 -4.5 -10 2"/>',stc:'<circle id="stc" class="fill" cx="0" cy="-3" r="1.2"/>',sld:'<path id="sld" class="fill" d="m-7.2 4.8\n	c1.8 0.7 4.5 -0.2 7.2 -4.8\n	-2.1 5 -5.4 6.8 -7.6 6"/>',emb:'<path id="emb" class="stroke" stroke-width="1.2" stroke-linecap="round"\n	d="m-2.5 -3h5"/>',hld:'<g id="hld" class="fill">\n    <circle cx="0" cy="-3" r="1.3"/>\n    <path d="m-7.5 -1.5\n	c0 -11.5 15 -11.5 15 0\n	h-0.25\n	c-1.25 -9 -13.25 -9 -14.5 0"/>\n</g>',brth:'<text id="brth" y="-6" style="font:bold italic 30px serif">,</text>',cpu:'<path id="cpu" class="fill" d="m-6 0\n	c0.4 -7.3 11.3 -7.3 11.7 0\n	-1.3 -6 -10.4 -6 -11.7 0"/>',upb:'<path id="upb" class="stroke" d="m-2.6 -9.4\n	l2.6 8.8\n	l2.6 -8.8"/>',dnb:'<g id="dnb">\n	<path d="M-3.2 -2v-7.2m6.4 0v7.2" class="stroke"/>\n	<path d="M-3.2 -6.8v-2.4l6.4 0v2.4" class="fill"/>\n</g>',sgno:'<g id="sgno">\n    <path class="fill" d="m0 -3\n	c1.5 1.7 6.4 -0.3 3 -3.7\n	-10.4 -7.8 -8 -10.6 -6.5 -11.9\n	4 -1.9 5.9 1.7 4.2 2.6\n	-1.3 0.7 -2.9 -1.3 -0.7 -2\n	-1.5 -1.7 -6.4 0.3 -3 3.7\n	10.4 7.8 8 10.6 6.5 11.9\n	-4 1.9 -5.9 -1.7 -4.2 -2.6\n	1.3 -0.7 2.9 1.3 0.7 2"/>\n    <line x1="-6" y1="-4.2" x2="6.6" y2="-16.8" class="stroke"/>\n    <circle cx="-6" cy="-10" r="1.2"/>\n    <circle cx="6" cy="-11" r="1.2"/>\n</g>',coda:'<g id="coda" class="stroke">\n	<path d="m0 -2v-20m-10 10h20"/>\n	<circle cx="0" cy="-12" r="6" stroke-width="1.7"/>\n</g>',dplus:'<path id="dplus" class="stroke" stroke-width="1.7"\n	d="m0 -0.5v-6m-3 3h6"/>',lphr:'<path id="lphr" class="stroke" stroke-width="1.2"\n	d="m0 0v18"/>',mphr:'<path id="mphr" class="stroke" stroke-width="1.2"\n	d="m0 0v12"/>',sphr:'<path id="sphr" class="stroke" stroke-width="1.2"\n	d="m0 0v6"/>',sfz:'<text id="sfz" x="-5" y="-7" style="font:italic 14px serif">\n	s<tspan font-size="16" font-weight="bold">f</tspan>z</text>',trl:'<text id="trl" x="-2" y="-4"\n	style="font:bold italic 16px serif">tr</text>',opend:'<circle id="opend" class="stroke"\n	cx="0" cy="-3" r="2.5"/>',snap:'<path id="snap" class="stroke" d="m-3 -6\n	c0 -5 6 -5 6 0\n	0 5 -6 5 -6 0\n	M0 -5v6"/>',thumb:'<path id="thumb" class="stroke" d="m-2.5 -7\n	c0 -6 5 -6 5 0\n	0 6 -5 6 -5 0\n	M-2.5 -9v4"/>',turn:'<path id="turn" class="fill" d="m5.2 -8\n	c1.4 0.5 0.9 4.8 -2.2 2.8\n	l-4.8 -3.5\n	c-3 -2 -5.8 1.8 -3.6 4.4\n	1 1.1 2 0.8 2.1 -0.1\n	0.1 -0.9 -0.7 -1.2 -1.9 -0.6\n	-1.4 -0.5 -0.9 -4.8 2.2 -2.8\n	l4.8 3.5\n	c3 2 5.8 -1.8 3.6 -4.4\n	-1 -1.1 -2 -0.8 -2.1 0.1\n	-0.1 0.9 0.7 1.2 1.9 0.6"/>',turnx:'<g id="turnx">\n	<use xlink:href="#turn"/>\n	<path d="m0 -1.5v-9" class="stroke"/>\n</g>',wedge:'<path id="wedge" class="fill" d="m0 -1l-1.5 -5h3l-1.5 5"/>',ltr:'<path id="ltr" class="fill"\n	d="m0 -0.4c2 -1.5 3.4 -1.9 3.9 0.4\n	c0.2 0.8 0.7 0.7 2.1 -0.4\n	v0.8c-2 1.5 -3.4 1.9 -3.9 -0.4\n	c-0.2 -0.8 -0.7 -0.7 -2.1 0.4z"/>',custos:'<g id="custos">\n	<path d="m-4 0l2 2.5 2 -2.5 2 2.5 2 -2.5\n		-2 -2.5 -2 2.5 -2 -2.5 -2 2.5" class="fill"/>\n	<path d="m3.5 0l5 -7" class="stroke"/>\n</g>',oct:'<text id="oct" style="font:12px serif">8</text>i'},anno_type=["bar","clef","custos","format","grace","key","meter","Zrest","note","part","rest","yspace","staves","Break","tempo","tuplet","block"];Abc.prototype.out_svg=out_svg,Abc.prototype.sx=sx,Abc.prototype.sy=sy,Abc.prototype.out_sxsy=out_sxsy,Abc.prototype.xypath=xypath;const deco_str_style={crdc:{dx:0,dy:5,style:'style="font:italic 14px serif"'},dacs:{dx:0,dy:3,style:'style="font:16px serif" text-anchor="middle"'},fng:{dx:-3,dy:1,style:'style="font:8px Bookman"'},pf:{dx:0,dy:5,style:'style="font:bold italic 16px serif"'}};var deco_val_tb={arp:out_arp,cresc:out_cresc,dim:out_dim,ltr:out_ltr},block_started;Abc.prototype.blk_out=blk_out,Abc.prototype.blk_flush=blk_flush;var par_sy,cur_sy,voice_tb,curvoice,staves_found,vover,tsfirst;const weight_tb=[3,1,6,0,2,4,5,9,9,0,9,2,0,6,0,7,0],cde2fcg=[0,2,4,-1,1,3,5],cgd2cde=[0,4,1,5,2,6,3],acc2=[-2,-1,3,1,2],note_names="CDEFGAB",latin_names=["Do","R","Mi","Fa","Sol","La","Si"],acc_name=["bb","b","","#","##"];return abc2svg_init(),this}/** @license
 *
 * Copyright (c) 2015, 2016 David A. Randolph.
 *
 * Permission is hereby granted, free of charge, to any person
 * obtaining a copy of this software and associated documentation
 * files (the "Software"), to deal in the Software without
 * restriction, including without limitation the rights to use,
 * copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the
 * Software is furnished to do so, subject to the following
 * conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS," WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
 * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
 * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
 * OTHER DEALINGS IN THE SOFTWARE.
 *
 * ****************************************************************************
 * Created by David A. Randolph on 8/18/15, on top of the abc2svg
 * example script by Jef Moine.
 */
function AbcDE(){"use strict";function t(){fn&&clearInterval(fn),rn=[],sn=[],dn="",on=!1,pn="noname.abc",Kt=void 0,Yt="",Zt=void 0,mn=[],vn=!1,gn=[],en=void 0,yn=0,_n=[],bn=[],xn={},wn={},kn=[],En=!1,Cn={},Tn={},Sn=[],On=0,tn=void 0,nn=void 0,Nn=[]}function n(e){var t,n=Cn[e],r=[];for(t in n)n.hasOwnProperty(t)&&r.push(t);return r.sort(function(e,t){return parseInt(e)-parseInt(t)}),r}function r(e,t){if(!e)return console.log("MISSING fingers have no hands."),"";if("x"===e)return e;for(var n=t,r=[],i=e.split(""),s=0;s<i.length;s++){var a=i[s];"<"===a||">"===a?n=a:a.match(/\d/)?r.push(n+a):r.push(a)}return r.join("")}function i(){return"undefined"==typeof Storage?!1:!0}function s(e,t){dn||(dn=md5(Yt));var n=e+"_"+t+"_"+dn;return n}function a(e){if(!i())return{};var t={sequence:""},n=s("sequence",e),r=localStorage.getItem(n)||"";r.match(/[^x&@]/)&&(t.sequence=r),n=s("authority",e);var a=localStorage.getItem(n)||"";t.authority=a,n=s("authority_year",e);var o=localStorage.getItem(n)||"";t.authority_year=o,n=s("transcriber",e);var c=localStorage.getItem(n)||"";t.transcriber=c,n=s("comments",e);var u=localStorage.getItem(n)||"";return t.comments=u,t}function o(e){var t=document.getElementById(e);return t.value?t.value:""}function c(e){var t=new Date,n=t.getFullYear()+"-"+sprintf("%02d",t.getMonth()+1)+"-"+sprintf("%02d",t.getDate())+" "+sprintf("%02d",t.getHours())+":"+sprintf("%02d",t.getMinutes())+":"+sprintf("%02d",t.getSeconds()),r="",i="";(e||h("include_pii"))&&(r=o("authority"),i=o("transcriber"));var s={sequence:Ht(),authority:r,authority_year:o("authority_year"),transcriber:i,transcription_date:n,comments:o("comments")};return s}function u(e,t){var n=document.getElementById(e),r=n.value,i=s(e,t);localStorage.setItem(i,r)}function l(e){for(var t=document.getElementsByName(e),n=0;n<t.length;n++){var r=t[n];if(r.checked)return r.id}}function f(e){var t="";if("preset"===e||"output"===e||"keypad"===e||"restore"==e)t=l(e);else{var n=document.getElementById(e);t=n.value}un[e]=t,localStorage.setItem(e,t)}function d(){var e=document.getElementById("sequence_spinner");return e?e.value:(alert("Sequence DOM element has gone missing."),"1")}function p(){if(!i())return void clearInterval(fn);var e=document.getElementById("sequence_spinner");if(!e)return void clearInterval(fn);var t=d(),n=s("sequence",t),r=Ht();localStorage.setItem(n,r),u("authority",t),u("authority_year",t),u("transcriber",t),u("comments",t)}function h(e){if(Xt&&Xt[e])return Xt[e];if("measure_number_interval"===e){var t=document.getElementById(e);return t.value}var n=l(e);return n?n:""}function m(){var e=h("preset"),t=1;return"last"===e&&(t=ln.length||1),t}function v(){var e={};return e.authority=o("default_authority"),e.authority_year=o("default_authority_year"),e.transcriber=o("default_transcriber"),e.sequence="x",e.comments="",e}function g(e){for(var t,n=e.split("\n"),r=!1,i={},s=[],a="",o=0;o<n.length;o++){var c=n[o];if(!a&&(t=Qn.exec(c),t&&t[1]))a=t[1],r=!0;else if(r)if(t=Wn.exec(c),t&&t[1]&&t[2])i={sequence:t[2],comments:""},s.push(i);else{if(t=Jn.exec(c))break;if(t=Xn.exec(c),t&&t[1]){i.authority=t[1],t[2]&&(i.authority_year=t[2]);continue}if(t=Kn.exec(c),t&&t[1]){i.transcriber=t[1];continue}if(t=Gn.exec(c),t&&t[1]){i.transcription_date=t[1];continue}t=Yn.exec(c),t&&t[1]&&(i.comments+=t[1]+"\n")}}return s}function y(){var e=document.getElementById("sequence_spinner");e.min=1,e.max=ln.length||1;var t=m();e.value=t}function _(){var e=h("preset");return e&&"none"!==e?"first"===e?ln[0]:"last"===e?ln[ln.length-1]:"":v()}function b(e){if(e){var t=e-1;return parseInt(e)<=ln.length?ln[t]:v()}return _()}function x(e,t){for(var n=document.getElementsByName(e),r=0;r<n.length;r++){var i=n[r];i.id===t&&(i.checked=!0)}}function w(e,t){var n=document.getElementById(e);void 0!==t?n.value=t:n.value=""}function k(){x("preset",localStorage.getItem("preset")),x("output",localStorage.getItem("output")),x("restore",localStorage.getItem("restore")),x("keypad",localStorage.getItem("keypad"));var e=localStorage.getItem("measure_number_interval");(void 0===e||""===e)&&(e=jn),w("measure_number_interval",e),w("default_authority",localStorage.getItem("default_authority")),w("default_authority_year",localStorage.getItem("default_authority_year")),w("default_transcriber",localStorage.getItem("default_transcriber"))}function E(e){w("authority",e.authority),w("authority_year",e.authority_year),w("transcriber",e.transcriber),w("comments",e.comments)}function C(){var e=o("authority"),t=o("default_authority");!e&&t&&w("authority",t);var n=o("authority_year"),r=o("default_authority_year");!n&&r&&w("authority_year",r);var i=o("transcriber"),s=o("default_transcriber");!i&&s&&w("transcriber",s)}function T(e,t){if(e){console.log("Setting fingers: ",e);var i,s,a,o={},c=e.split("@");for(i=0;i<c.length;i++){var u=We(i);o=[];var l=c[i].split("&");for(s=0;s<l.length;s++){var f=l[s];o=o.concat(R(Fn,f))}for(var d=n(i),p=0;p<d.length;p++){var h=d[p],m=Cn[i][h];m.sort(be);for(var v=0;m[v].grace;){m[v][t]="";for(var g=0;g<m[v].size;g++)a=o.shift(),a||(console.log("Preset fingering MISSING for note:"),me("preset grace note",m[v])),a=r(a,u),u=Pt(a,u),m[v][t]+=a;v++}var y=Ae(m),_=Oe(y);for(g=0;g<_.length;g++)for(var b=_[g],x=0;x<y[b].length;x++){var w=y[b][x];w[t]=""}for(g=0;g<_.length;g++)for(var b=_[g],x=0;x<y[b].length;x++){var w=y[b][x];w.grace||(w[t]||(w[t]=""),a=o.shift(),a||(console.log("Preset fingering MISSING for note:"),me("preset pit note",w)),a=r(a,u),u=Pt(a,u),w[t]+=a)}}}}}function S(e,t){var n=t.sequence,r=t.sequence,i=!0,s=h("preset");s&&"none"!==s||(i=!1,n="");var a=!1;if(e&&e.sequence&&e.sequence!==n){var o=h("restore");a="always"===o?!0:"never"===o?!1:confirm("You have previously entered data for this piece. Do you want to restore them?"),a&&(n=e.sequence)}a?E(e):i&&E(t),T(n,"fingering"),T(r,"preset_fingering"),fn=setInterval(function(){p()},er)}function O(){var e=d(),t=a(e),n=b(e);S(t,n),C()}function A(e){var t=Lt();return t}function N(){var e="Please enter a fingering string for the current piece.",t=window.prompt(e,"");null!==t&&(T(t,"fingering"),Fe())}function B(){if(Yt){var e=confirm("All changes you have made to this fingering sequence will be discarded, and the initial sequence will be restored. Are you sure you want to proceed?");if(e){var t=d(),n=b(t);S(void 0,n),Fe(),en=bn[0][0][0],St(en)}}}function R(e,t){if(!t)return[];for(var n,r=[],i=0,s=0;null!=(n=e.exec(t));){s=e.lastIndex;var a;a=i===s?t.substr(i):t.substr(i,s-i),r.push(a),i=e.lastIndex}var o=t.substr(i);if(o){var c="";r.length>0&&(c=r.pop()),c+=o,r.push(c)}return r}function P(){var e=window.open(In,"_blank");e.focus()}function L(e){dt();var t=document.getElementById("prefs_modal_wrapper"),n=document.getElementById("prefs_modal_window");t.className="overlay";var r=n.offsetHeight-document.documentElement.clientHeight;r>0&&(n.style.maxHeight=parseInt(window.getComputedStyle(n).height)-r+"px"),n.style.marginTop=-n.offsetHeight/2+"px",n.style.marginLeft=-n.offsetWidth/2+"px",e.preventDefault?e.preventDefault():e.returnValue=!1}function I(e){dt();var t=document.getElementById("metadata_modal_wrapper"),n=document.getElementById("metadata_modal_window");t.className="overlay";var r=n.offsetHeight-document.documentElement.clientHeight;r>0&&(n.style.maxHeight=parseInt(window.getComputedStyle(n).height)-r+"px"),n.style.marginTop=-n.offsetHeight/2+"px",n.style.marginLeft=-n.offsetWidth/2+"px",e.preventDefault?e.preventDefault():e.returnValue=!1}function M(e){var t=document.getElementById("metadata_modal_wrapper");t.className="",p(),Y(),ft(),e.preventDefault?e.preventDefault():e.returnValue=!1}function D(){cn>pr&&(cn-=fr,Fe())}function j(){dr>cn&&(cn+=fr,Fe())}function V(e){f("preset"),f("output"),f("restore"),f("keypad"),f("measure_number_interval"),f("default_authority"),f("default_authority_year"),f("default_transcriber");var t=document.getElementById("prefs_modal_wrapper");t.className="",Yt&&(Fe(),St(en)),Y(),ft(),e.preventDefault?e.preventDefault():e.returnValue=!1}function F(e){var t=e.slice(0,100);if(-1==t.indexOf("<?xml"))return!1;var n=t.match(/encoding="([^"]+)"/),r="utf-8";return n&&2==n.length&&(r=n[1]),r}function q(e){var t={},n=$.parseXML(e),r=vertaal(n,t),i=r[0],s=r[1];return s&&console.log("xml2abc ERROR: "+s),i||alert("Unable to open MusicXML file: "+s),i}function z(e,t){var n=new XMLHttpRequest;return"withCredentials"in n?n.open(e,t,!0):"undefined"!=typeof XDomainRequest?(n=new XDomainRequest,n.open(e,t)):n=null,n}function H(e){var t=e.split(".");return t[t.length-1]}function U(e){var t="";try{var n=new JSZip(e);$.each(n.files,function(e,n){t=n.asText()})}catch(r){return alert("Could not open compressed MusicXML file: "+r.message),""}var i=F(t);return"UTF-8"!==i?(alert("Input mxl is not UTF-8 encoded. Cannot open."),""):t=q(t)}function Q(e){var t=H(e),n='The server hosting file does not allow access from this domain. Please download the file outside abcDE and then "Choose file" to work with it.',r=z("GET",e);return r?("mxl"===t&&(r.responseType="arraybuffer"),r.onload=function(){console.log("File has been retrieved.");var n="";if("mxl"===t){if(n=U(r.response),!n)return}else{n=r.responseText;var i=F(n);if(i){if(!/^utf/i.test(i))return void alert("Input xml is not UTF-8 encoded. Cannot open.");n=q(n)}}n&&(an=e,document.getElementById(nr).value=n,ht())},r.onerror=function(){alert(n)},void r.send()):void alert(n)}function W(){var e="Please enter URL to open.",t=Pn+"/wtc/prelude02.abc";if(an)t=an;else{var n=h("default_url");n&&(t=n)}var r=window.prompt(e,t);r&&Q(r)}function J(e){var t=new FileReader,n="";t.onload=function(e){try{var t=new JSZip(e.target.result);$.each(t.files,function(e,t){n=t.asText()})}catch(e){return void alert("Could not open compressed MusicXML file: "+e.message)}var r=F(n);return"UTF-8"!==r?void alert("Input xml is not UTF-8 encoded. Cannot open."):(n=q(n),document.getElementById(nr).value=n,ht(),void 0)},t.readAsArrayBuffer(e)}function X(){var e=document.getElementById("file_input"),t=e.files;if(!t.length)return void alert("Please select a valid abc file.");var n=t[0],r=H(n.name);if("mxl"===r)return void J(n);var i=!1,s=new FileReader;s.onload=function(e){var t=F(s.result),r=new FileReader;t?i=!0:t="UTF-8",r.onload=function(e){var t="";t=i?q(r.result):e.target.result,document.getElementById(nr).value=t,ht()},r.readAsText(n,t)},s.readAsText(n,"UTF-8")}function K(){Bn=Bn?!1:!0}function G(e,t){for(var n=e.children,r=0;r<n.length;r++)n[r].style.display=t}function Y(){var e=document.getElementById(or),t=document.getElementById("number_div"),n=document.getElementById("symbol_div"),r=h("keypad");if("show"===r)e.style.display="block",t.style.display="block",n.style.display="block",G(t,"inline"),G(n,"inline");else{G(n,"none"),G(t,"none");var i=h("qualtrics"),s=h("submit_button_id");if(i){var a=document.getElementById("q_next");a.style.display="inline";var o=document.getElementById("q_back");o&&(o.style.display="inline")}else if(s){var c=document.getElementById(s);c.style.display="inline"}else t.style.display="block",n.style.display="block",e.style.display="none"}}function Z(e){var t=e.keyCode||e.which;t=String.fromCharCode(t);var n=/[0-9]/;n.test(t)||(e.returnValue=!1,e.preventDefault&&e.preventDefault())}function ee(e,t,n,r,i,s){var a=document.createElement("input");a.type="text",a["class"]=r,a.id=t,i&&(a.onkeypress=i),"year"===r&&(a.size="4");var o=document.createElement("label");o.htmlFor=t,o.appendChild(document.createTextNode(n)),e.appendChild(o),e.appendChild(a),s&&e.appendChild(document.createElement("br"))}function te(e,t,n,r,i,s){var a=document.createElement("textarea");a["class"]=r,a.id=t,a.rows=i,a.cols=s;var o=document.createElement("label");o.htmlFor=t,o.appendChild(document.createTextNode(n)),e.appendChild(o),e.appendChild(a)}function ne(e,t,n){var r=document.createElement("label");r["class"]=n;var i=document.createTextNode(t);r.appendChild(i),e.appendChild(r)}function re(e,t,n,r,i,s,a){var o=document.createElement("div");o["class"]="radio_div",ne(e,t,"prompt");for(var c=0;c<r.length;c++){var u=document.createElement("input");u.type="radio",u.id=r[c],u.id===s&&(u.checked=!0),u.name=n,o.appendChild(u),ne(o,i[c],"radio_label");var l=document.createElement("span");l.innerHTML="&nbsp;&nbsp",o.appendChild(l)}return e.appendChild(o),a&&e.appendChild(document.createElement("br")),o}function ie(e,t,n,r,i,s,a,o){var c=document.createElement("div");c["class"]="spinner_div",ne(c,t,"prompt");var u=document.createElement("input");return u.id=n,u.min=r,u.max=i,u.size=s,u.type="number",u.value=a,c.appendChild(u),e.appendChild(c),o&&e.appendChild(document.createElement("br")),c}function se(){var e=document.getElementById(ar),t=document.createElement("div");t.id="metadata_modal_wrapper",e.appendChild(t);var n=document.createElement("div");n.id="metadata_modal_window",t.appendChild(n);var r=document.createElement("div");r.style.textAlign="right";var i=document.createElement("a");i.id="metadata_modal_close",i.href="#",i.innerHTML="Close <b>X</b>",r.appendChild(i),i.addEventListener("click",M,!1),n.appendChild(r),ee(n,"authority","Authority","name",void 0,!1),ee(n,"authority_year","Year","year",Z,!0),ee(n,"transcriber","Transcriber","name",void 0,!0),te(n,"comments","Comments","comments",10,50)}function ae(){var e=document.getElementById(ir),t=document.createElement("div");t.id="prefs_modal_wrapper",e.appendChild(t);var n=document.createElement("div");n.id="prefs_modal_window",t.appendChild(n);var r=document.createElement("div");r.style.textAlign="right";var i=document.createElement("a");i.id="prefs_modal_close",i.href="#",i.innerHTML="Close <b>X</b>",r.appendChild(i),i.addEventListener("click",V,!1),n.appendChild(r);var s=document.createElement("h3");s.innerText="Preferences",n.appendChild(s);var a="restore",o=["always","never","ask"],c=["Always","Never","Ask"];Xt&&Xt[a]||re(n,"Restore Data",a,o,c,"ask",!0),a="output",Xt&&Xt[a]||(o=["append","replace"],c=["Append","Replace"],re(n,"Output",a,o,c,"append",!0)),a="preset",Xt&&Xt[a]||(o=["first","last","none"],c=["First","Last","None"],re(n,"Preset",a,o,c,"first",!0)),a="keypad",o=["show","hide"],c=["Show","Hide"];var u="hide",l="ontouchstart"in window;l&&(u="show"),re(n,"Keypad",a,o,c,u,!0),ie(n,"Measure Number Interval","measure_number_interval",0,20,2,5,!0),ee(n,"default_authority","Default Authority","name",void 0,!0),ee(n,"default_authority_year","Year","year",Z,!0),ee(n,"default_transcriber","Transcriber Name","name",void 0,!0)}function oe(e,t,n){var r=document.createElement("input");r.type="button",r["class"]="keypad-button",r.id=t,r.value=n,r.onclick=function(){it(n)},e.appendChild(r)}function ce(){for(var e=document.getElementById(tr);e.firstChild;)e.removeChild(e.firstChild);e.remove(),Rn=!1,fn&&clearInterval(fn)}function ue(e){var n=h("qualtrics"),r=Ot(Yt),i="abcDF_"+r,s="abcD_"+r,a=Ht();Qualtrics.SurveyEngine.setEmbeddedData(i,a);var o=Wt();Qualtrics.SurveyEngine.setEmbeddedData(s,o),p(),"q_next"===e?(t(),Fe(),ce(),on=!1,n.enableNextButton(),n.enablePreviousButton(),n.clickNextButton()):(n.enableNextButton(),n.enablePreviousButton(),n.clickPreviousButton())}function le(e,t,n){var r=document.createElement("input");r.type="button",r["class"]="keypad-button",r.id=t,r.value=n,r.onclick=function(){ue(t)},e.appendChild(r)}function fe(e,t,n){var r=document.createElement("input");r.type="button",r["class"]="keypad-button",r.id=t,r.value=n,e.appendChild(r)}function de(e,t,n,r){var i=document.createElement("input");i.id=t,i["class"]="keypad_button",i.type="image",i.src=Mn+"/"+n,i.alt=r,i.onclick=function(){Ue(t)},e.appendChild(i)}function pe(){var e=document.getElementById(or),t=document.createElement("number_div");t.id="number_div";var n=document.createElement("symbol_div");n.id="symbol_div",e.appendChild(n),e.appendChild(document.createElement("br")),e.appendChild(t),de(t,"undo","action-undo.svg","undo"),de(t,"redo","action-redo.svg","redo"),oe(t,"one","1"),oe(t,"two","2"),oe(t,"three","3"),oe(t,"four","4"),oe(t,"five","5"),oe(t,"toggle","T"),de(t,"pencil","target.svg","...");var r=h("qualtrics");r&&(h("qualtrics_back")&&le(t,"q_back","BACK"),le(t,"q_next","NEXT"));var i=h("submit_button_id");if(i){var s=h("submit_button_label");s||(s="NEXT"),fe(t,i,s)}de(n,"previous","arrow-circle-left.svg","<-"),de(n,"next","arrow-circle-right.svg","->"),oe(n,"hyphen","-"),oe(n,"slash","/"),oe(n,"open_paren","("),oe(n,"close_paren",")");var a=h("phrasing");a&&(oe(n,"short_phrase","S"),oe(n,"medium_phrase","M"),oe(n,"long_phrase","L")),de(n,"backspace","delete.svg","<]")}function he(){if(!Rn){ae(),se();var e=Mn+"/download_36_x4.png",t="36",n=document.getElementById(sr),r=document.createElement("table"),i=document.createElement("tbody"),s=document.createElement("tr");n.appendChild(r),r.appendChild(i),r.style.backgroundColor="LightGray",r.align="center",i.appendChild(s);var a=document.createElement("p");a.setAttribute("id","downloadify");var o=document.createElement("td");o.appendChild(a),s.appendChild(o);var c=document.createElement("input");c.id="sequence_spinner",c.min="1",c.max="999",c.size=3,c.type="number",c.alt="fingering_number",c.value=1,c.onchange=Mt,o=document.createElement("td"),ne(o,"Sequence","sequence_prompt"),o.appendChild(c),s.appendChild(o),Xt.preset_select||(o.style.display="none");var u=document.createElement("input");u.type="image",u.src=Mn+"/eye.svg",u.width=t,u.alt="View",u.onclick=jt,o=document.createElement("td"),o.appendChild(u),s.appendChild(o);var l=document.createElement("input");l.type="image",l.src=Mn+"/print.svg",l.width=t,l.alt="Print...",l.onclick=It;var o=document.createElement("td");o.appendChild(l),s.appendChild(o),o=document.createElement("td");var f=document.createElement("input");f.type="checkbox",f.value="annotated",f.checked=Bn,f.id="view_annotated",f.onclick=K;var d=document.createElement("label");d.htmlFor="view_annotated",d.appendChild(document.createTextNode("Annotated")),o.appendChild(f),o.appendChild(d),s.appendChild(o);var p=document.createElement("input");p.type="image",p.src=Mn+"/reload.svg",p.width=t,p.alt="reset",p.onclick=B,o=document.createElement("td"),o.appendChild(p),s.appendChild(o);var h=document.createElement("input");h.id="copy_fingerings_button",h.type="image",h.src=Mn+"/clipboard.svg",h.width=t,h.alt="copy",o=document.createElement("td"),o.appendChild(h),s.appendChild(o),Xt.hide_copy?h.style.display="none":new Clipboard("#copy_fingerings_button",{text:A});var m=document.createElement("input");m.type="image",m.src=Mn+"/paperclip.svg",m.width=t,m.alt="paste",m.onclick=N,o=document.createElement("td"),o.appendChild(m),s.appendChild(o),Xt.hide_paste&&(m.style.display="none");var v=document.createElement("input");v.type="image",v.src=Mn+"/globe.svg",v.width=t,v.alt="URL",v.onclick=W,o=document.createElement("td"),o.appendChild(v),s.appendChild(o),Xt.url_input||(v.style.display="none");var g=document.createElement("input");g.setAttribute("type","file"),g.setAttribute("accept","text/vnd.abc"),g.onchange=X,g.setAttribute("id","file_input"),o=document.createElement("td"),o.appendChild(g),s.appendChild(o),Xt.file_input||(g.style.display="none");var y=document.createElement("input");y.type="image",y.src=Mn+"/tags.svg",y.alt="Metadata...",y.width=t,y.onclick=I,o=document.createElement("td"),o.appendChild(y),s.appendChild(o);var _=document.createElement("input");_.type="image",_.src=Mn+"/zoom-out.svg",_.alt="Zoom In",_.width=t,_.onclick=D,o=document.createElement("td"),o.appendChild(_),s.appendChild(o);var b=document.createElement("input");b.type="image",b.src=Mn+"/zoom-in.svg",b.alt="Zoom In",b.width=t,b.onclick=j,o=document.createElement("td"),o.appendChild(b),s.appendChild(o);var x=document.createElement("input");x.type="image",x.src=Mn+"/cog.svg",x.alt="Preferences...",x.width=t,x.onclick=L,o=document.createElement("td"),o.appendChild(x),s.appendChild(o);var w=document.createElement("input");w.type="image",w.src=Mn+"/info.svg",w.alt="Help",w.width=t,w.onclick=P,o=document.createElement("td"),o.appendChild(w),s.appendChild(o),Downloadify.create("downloadify",{filename:function(){return pn},data:Dt,onComplete:function(){alert("Your file has been saved.")},onCancel:function(){alert("File save has been cancelled.")},onError:function(){alert("File save failed!")},transparent:!1,swf:Dn+"/downloadify.swf",downloadImage:e,width:t,height:t,append:!1}),pe(),Rn=!0}}function me(e,t){console.log(e+" Line: "+t.line+" Start: "+t.start+" Time: "+t.time+" String: "+t.string+" Size: "+t.size+" Pitch: "+t.pitches.join(",")+" Voice: "+t.voice+" Staff: "+t.staff+" Grace: "+t.grace)}function ve(){for(var e=0;e<_n.length;e++){var t=_n[e];t.undone_fingerings=[]}rn=[]}function ge(e,t){if("note"!=e[t.type]&&"grace"!=e[t.type])return{};if(this.line=-1,this.grace=!1,this.anno_start=t.istart,this.size=0,this.pitches=[],this.start=-1,this.end=-1,this.starts=[],this.stops=[],this.phrase_break="X","note"===e[t.type]){this.size=t.notes.length;for(var n=0;n<this.size;n++)this.pitches.push(t.notes[n].pit);this.pitches.sort(function(e,t){return parseInt(e)-parseInt(t)}),this.start=t.istart,this.end=t.iend}else{this.grace=!0,this.start=t.extra.istart,this.size=1;var r=t.extra;if(!r.notes)return alert("Who turned off the notes?!"),{};for(;;){if(r.notes.length>1&&alert('Chords not supported in a grace "note."'),this.starts.push(r.istart),this.stops.push(r.iend),this.pitches.push(r.notes[0].pit),!r.next){this.end=r.iend;break}r=r.next,this.size++}}return this.istart=t.istart,this.time=t.time,this.string=Yt.substring(this.start,this.end),this.voice=t.v,this.staff=t.st,this.prior_fingerings=[],this.undone_fingerings=[],this.init_fingering=function(){this.fingering="";for(var e=0;e<this.size;e++)this.fingering+="x"},this.init_fingering(),this.set_fingering=function(e){ve(),this.fingering&&this.prior_fingerings.push(this.fingering),e?this.fingering=e:this.init_fingering(),sn.push(this)},this.undo_fingering_change=function(){this.prior_fingerings.length>0&&(this.undone_fingerings.push(this.fingering),this.fingering=this.prior_fingerings.pop()),rn.push(this)},this.redo_fingering_change=function(){this.undone_fingerings.length>0&&(this.fingering&&this.prior_fingerings.push(this.fingering),this.fingering=this.undone_fingerings.pop()),sn.push(this)},this.get_fingering=function(){return this.fingering?this.fingering:void 0},this}function ye(){var e=8.5;1!==cn&&(e*=cn);var t='width="'+e+'in"';return t}function _e(){this.read_file=function(e){return""},this.errmsg=function(e,t,n){var r=document.getElementById(lr);t?r.innerHTML+='<b onclick="gotoabc('+t+","+n+')" style="cursor: pointer; display: inline-block">'+e+"</b><br/>\n":r.innerHTML+=e+"<br/>\n"},this.img_out=function(e){var t=/<svg /;e.match(t)&&(e=e.replace(t,'<svg id="line_'+yn+'" '),yn++),Gt+=e},this.anno_start=function(e,t,n,r,i,s,a){!En&&t in xn?xn[t].line=yn:"grace"===e&&console.log(e+" ANNO_START start: "+t+" stop: "+n),Sn.push([t,n]),Zt.out_svg('<g class="e_'+t+'">\n')},this.anno_stop=function(e,t,n,r,i,s,a){"grace"===e&&console.log(e+" ANNO_STOP start: "+t+" stop: "+n),Zt.out_svg("</g>\n"),Zt.out_svg('<rect class="abcr _'+t+'" x="'),Zt.out_sxsy(r,'" y="',i),Zt.out_svg('" width="'+s.toFixed(2)+'" height="'+a.toFixed(2)+'"/>\n')},this.get_abcmodel=function(e,t,n){if(!En){console.log(n);for(var r=0;r<t.length;r++){console.log("Voice: "+r);var i=t[r].st;Tn[r]=i}for(var s=e;s;){var a=new ge(n,s);a.istart&&(_n.push(a),xn[a.istart]=a,a.staff in Cn||(Cn[a.staff]={}),a.time in Cn[a.staff]||(Cn[a.staff][a.time]=[]),Cn[a.staff][a.time].push(a)),s=s.ts_next}}},this.page_format=!1,this.imagesize=ye()}function be(e,t){var n=parseInt(e.time)-parseInt(t.time);return 0!==n?n:e.grace&&!t.grace?-1:t.grace&&!e.grace?1:e.pitches[e.pitches.length-1]<t.pitches[0]?-1:e.pitches[0]>t.pitches[t.pitches.length-1]?1:e.voice<t.voice?(console.log("NOTES SORTED BY VOICE!"),-1):1}function xe(){for(var e,t,n,r=0;r<_n.length;r++)e=_n[r],t=e.line,n=e.staff,t in bn||(bn[t]=[],bn[t][0]=[],bn[t][1]=[]),bn[t][n].push(e);for(t=0;t<bn.length;t++)for(n=0;2>n;n++){var i=bn[t][n];i.sort(be)}var s,a;for(n=0;2>n;n++)for(t=0;t<bn.length;t++){var i=bn[t][n];for(r=0;r<i.length;r++)s=i[r],a?(a.next_note=s,s.prior_note=a,a=s):(a=s,s.prior_note=void 0)}s.next_note=void 0}function we(){var e;for(e in xn)xn.hasOwnProperty(e)&&kn.push(e);kn.sort(function(e,t){return parseInt(e)-parseInt(t)})}function ke(e){var t="$1";return e.match(Hn)&&(t="$1"),e.match(zn)&&(t="$2"),t}function Ee(e){var t="^";return/^</.test(e)&&(t="_"),t}function Ce(e,t){for(var n=ke("<"),r=ke(">"),i=e.replace(/[\)\(]/g,""),s=R(Vn,i),a="",o=0;o<s.length;o++)s[o]=s[o].replace(zn,n),s[o]=s[o].replace(Hn,r),a+=s[o];a+='"';var c=Ee(i);return a='"'+c+a}function Te(e,t,n){for(var r=!1,i=ke("<"),s=ke(">"),a=[],o=0;o<e.length;o++){var c="",u="x";if(e[o]&&"x"!==e[o])r=!0,u=e[o];else{if(!n)break;if(!e[o]||e[o]&&"x"===e[o])continue}if(u.match(/^\(/))c=Ce(u,t);else{var l=Ee(u);u=u.replace(zn,i),u=u.replace(Hn,s),c='"'+l+u+'"'}a.unshift(c)}var f="";return r&&(f=a.join("")),f}function Se(e){var t=e.fingering;if("x"===t)return"";t=t.replace(qn,"");var n=R(Vn,t),r=Te(n,e.staff,!1);return r}function Oe(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t.sort(function(e,t){return parseInt(e)-parseInt(t)}),t}function Ae(e){for(var t=[],n={},r=0;r<e.length;r++){var i=e[r];if(!i.grace)for(var s=0;s<i.pitches.length;s++){var a=i.pitches[s];t.push(a),a in n||(n[a]=[]),n[a].push(i)}}for(r=0;r<n.length;r++)n[r].sort(be);return n}function Ne(e){for(var t=Ae(e),n=Oe(t),r=[],i=0;i<n.length;i++)for(var s=n[i],a=0;a<t[s].length;a++)for(var o=t[s][a],c=o.fingering,u=R(Vn,c),l=0;l<o.pitches.length;l++){var f=o.pitches[l];f===parseInt(s)&&("x"!==u[l]?r.push(u[l]):r.push(""))}return r}function Be(e){for(var t=0,n=0;n<e.length;n++)e[n].grace&&t++;return t}function Re(e){if(e.size>1&&console.log("BIGGIE"),e.grace)return Se(e);var t=Cn[e.staff][e.time],n=Be(t),r=t.length-n;if(2>r)return Se(e);t.sort(be);for(var i=0,s=t[0];s.grace;)i++,s=t[i];if(e!==s)return"";var a=Ne(t);return Te(a,e.staff,!0)}function Pe(e){for(var t=[],n=e.string,r=e.starts,i=e.stops,s=[],a=[],o=0;o<r.length;o++)s.push(r[o]-r[0]),a.push(i[o]-r[0]);for(var c=0;c<s.length;c++){var u=n.substring(s[c],a[c]);t.push(u)}return t}function Le(e){var t="{",n=Pe(e),r=[];e.fingering&&(r=R(Vn,e.fingering));for(var i=0;i<n.length;i++){if(r[i]){var s=r[i];s=s.replace(Un,""),"x"!==s&&(t+="!"+s+"!")}t+=n[i]}return t+="}"}function Ie(e){if(e.fingering)return!0;for(var t=Cn[e.staff][e.time],n=0;n<t.length;n++)if(!t[n].grace&&t[n].fingering)return!0;return!1}function Me(){if(void 0!==tn)return tn;tn=!1;for(var e=!1,t=!1,n=Yt.split("\n"),r=0;r<n.length;r++){var i=n[r];if(i.match(/^%%setfont-1/)&&(e=!0),i.match(/^%%setfont-2/)&&(t=!0),e&&t){tn=!0;break}}return tn}function De(){if(void 0!==nn)return nn;nn=!1;for(var e=Yt.split("\n"),t=0;t<e.length;t++){var n=e[t];if(n.match(/^%%measurenb\s+\d+/)){nn=!0;break}}return nn}function je(){if(void 0!==Kt)return Kt;Kt=!1;for(var e=0;e<kn.length;e++){var t=kn[e],n=xn[t];if(n.grace){Kt=!0;break}}return Kt}function Ve(){var e="";if(Me()||(e+=xr+"\n",je()&&(e+=wr+"\n")),!De()){var t=h("measure_number_interval");t&&(e+="%%measurenb "+t+"\n")}for(var n=0,r=0;r<kn.length;r++){var i=kn[r],s=xn[i],a="";if(s.grace){if(a=Yt.substring(parseInt(n),parseInt(s.start-1)),n=s.end+1,e+=a,s.fingered_start=e.length+s.anno_start-s.start+1,s.fingering&&"x"!==s.fingering){var o=R(Vn,s.fingering);s.fingered_start+=3*o.length}e+=Le(s)}else{var c=parseInt(s.start),u=parseInt(s.end);a=Yt.substring(parseInt(n),c),e+=a,n=u,Ie(s)&&(e+=Re(s)),s.fingered_start=e.length,e+=s.string}wn[s.fingered_start]=s}return e+=Yt.substring(n)}function Fe(){on=!0,On++,console.log("RERENDERING NUMBER "+On);var e=(new Date).getTime(),t=document.getElementById(ur),n=document.getElementById(lr),r=new _e;Zt=new Abc(r);var i=Ve(),s=(new Date).getTime(),a=s-e;console.log("MY LAG: "+a),document.getElementById(nr).value=i,e=(new Date).getTime(),Gt="",Zt.tosvg("edit",'%%bgcolor white\n%%beginsvg\n<style type="text/css">\n	rect.abcr {fill:#a08000; fill-opacity:0}\n	rect.abcr:hover {fill-opacity:0.3}\n</style>\n%%endsvg\n'),yn=0,n.innerHTML="",Sn=[];try{Zt.tosvg(pn,document.getElementById(nr).value)}catch(o){return void alert(o.message+"\nabc2svg tosvg bug - stack:\n"+o.stack)}try{t.innerHTML=Gt}catch(o){return void alert(o.message+"\nabc2svg image bug - abort:\n"+o.stack)}setTimeout(function(){for(var e,t=document.getElementsByClassName("abcr"),n=t.length;--n>=0;)e=t[n],e.onclick=function(){gt(this)},e.ondblclick=function(){wt(this)}},300),s=(new Date).getTime(),a=s-e,console.log("LIB LAG: "+a),Y()}function qe(e){return null==e.which?String.fromCharCode(e.keyCode):0!=e.which&&0!=e.charCode?String.fromCharCode(e.which):null}function ze(e){if(console.log(String.fromCharCode(e)+" --> "+e),e===gr){Ye();var t=Ze();t.length>0&&t[0]?(en.set_fingering(""),Fe()):en.prior_note&&(en=en.prior_note,en.set_fingering(""),Fe()),St(en)}else if(e==yr||e==br)nt(),gn=[],en.next_note&&(en=en.next_note);else if(e==_r)nt(),gn=[],en.prior_note&&(en=en.prior_note);else if(e==vr)xt();else if(e==hr)_t();else{if(e!=mr)return!1;bt()}return St(en),!0}function He(e){var t=e.keyCode,n=ze(t);return n&&e.preventDefault(),n}function Ue(t){var n=yr;switch(t){case"previous":n=_r;break;case"next":n=br;break;case"backspace":n=gr;break;case"pencil":n=vr;break;case"undo":n=hr;break;case"redo":n=mr}var r=ze(n);return r&&e.preventDefault(),r}function $e(){An?(An=!1,on&&(document.body.style.backgroundColor="white")):(An=!0,on&&(document.body.style.backgroundColor="black")),St(en)}function Qe(e){return An?0==e.staff?"<":">":We(e.staff)}function We(e){return 0==e?">":"<"}function Je(e,t){var n=Qe(t);if(!e.fingering.strike)return"x";var r=e.fingering.strike.hand||n,i=r+e.fingering.strike.digit;return e.fingering.release&&(r=e.fingering.release.hand||n,i+="-"+r+e.fingering.release.digit),i}function Xe(e,t){var n,r,i="",s=[];if(e.first.ornaments){for(s=e.first.ornaments[0],i+="(",r=0;r<s.length;r++)n=s[r],i+=Je(n,t);i+=")"}else i+=Je(e.first,t);if(e.last&&e.last.ornaments){for(s=e.last.ornaments[0],i+="(",r=0;r<s.length;r++)n=e.last.ornaments[r],i+="/"+Je(n,t);i+=")"}else e.last&&(i+="/"+Je(e.last,t));return i}function Ke(e){for(var t="",n=0;n<en.size;){var r=e.shift(),i=Xe(r,en);if(t+=i,n++,0===e.length)break}if(n===en.size)return en.set_fingering(t),!0;for(;n<en.size;n++)t+="x";return en.set_fingering(t),!1}function Ge(e){for(var t=e.upper.score_fingerings;t.length>0;)Ke(t)&&en.next_note&&(en=en.next_note);vn&&(en=en.prior_note)}function Ye(){vn=!1,mn=[],gn=[],Fe(),St(en)}function Ze(){for(var e=[],t=en.get_fingering(),n=t.split(""),r=0;r<n.length;r++){var i=n[r];"x"===i?e.push(""):e.push(i)}return e}function et(){for(var e=Ze();e.length;){var t=e.pop();t&&mn.unshift(t)}}function tt(){for(var e=0;e<gn.length;e++)if("("===gn[e])return!0;return!1}function nt(){var e=!1;gn.length>0&&(Array.prototype.unshift.apply(mn,gn),tt()||(e=!0)),gn=[];for(var t=mn.length-1;t>=0&&/[\-\/\(]/.test(mn[t]);t--)gn.unshift(mn.pop());if(0!==mn.length){if(/[\-\/]/.test(mn[0])&&(e=!0),vn){var n=Ze();")"===n[n.length-1]?n.pop():(alert("Something wonky with parentheses."),Ye()),Array.prototype.unshift.apply(mn,n),vn=!1}e?en.prior_note?(en=en.prior_note,et()):mn.pop():en.fingering&&en.fingering.match(/x/)&&et();for(var r=mn.join(""),i=0,s=1;;)try{var a=Abcdf_Parser.parse(r);vn=!1,2===s&&(vn=!0),Ge(a);break}catch(o){if(1===s?mn.push(")"):2===s?(mn.pop(),mn.pop(),i++):3===s&&(s=0),0==mn.length)break;r=mn.join(""),s++}mn=[],Fe(),St(en)}}function rt(e){en.phrase_break=e.toUpperCase()}function it(e){clearTimeout(hn);var t=!1;return/[\(\)\/\-1-5]/.test(e)&&(mn.push(e),t=!0),("t"===e||"T"===e)&&(nt(),$e(),t=!0),("s"===e||"S"===e||"m"===e||"M"===e||"l"===e||"L"===e)&&(nt(),rt(e),t=!0),hn=setTimeout(nt,Zn),console.log("Done "+hn),t}function st(e){var t=qe(e).toLowerCase();return it(t)}function at(e){Xt||(Xt=e)}function ot(){return 5}function ct(){var e="% abcDidactyl v"+ot();return e}function ut(e){var t="% abcD fingering "+e+": ";return t;
}function lt(e,t){var n=[],r=[];r.push(ct());for(var i,s=g(e),a=e.split("\n"),o="",u=!1,l=0;l<a.length;l++){var f=a[l];o?u?n.push(f):(i=Jn.exec(f),i&&(u=!0)):(i=Qn.exec(f),i&&i[1]?o=i[1]:n.push(f))}var p=d(),m=c(t);if("replace"===h("output")){var v=p-1;s[v]=m}else s.push(m);for(var y,_,b,x,w,l=0;l<s.length;l++){var k=l+1;try{Abcdf_Parser.parse(s[l].sequence)}catch(E){alert("Bad abcDF parse of fingering string: "+E.message)}y=ut(k)+s[l].sequence,r.push(y),s[l].authority&&(_="% Authority: "+s[l].authority,s[l].authority_year&&(_+=" ("+s[l].authority_year+")"),r.push(_)),s[l].transcriber&&(b="% Transcriber: "+s[l].transcriber,r.push(b)),s[l].transcription_date&&(x="% Transcription date: "+s[l].transcription_date,r.push(x)),w=s[l].comments.split("\n");for(var C=0;C<w.length;C++)(C!==w.length-1||w[C])&&r.push("% "+w[C])}r.push("% abcDidactyl END");var T=r.join("\n"),S=n.join("\n");return T+"\n"+S}function ft(){document.body.addEventListener("keydown",He),document.body.addEventListener("keypress",st)}function dt(){document.body.removeEventListener("keydown",He),document.body.removeEventListener("keypress",st)}function pt(){if(!Rn){var e=document.getElementById(tr);e.align="center";var t=document.getElementById(nr);t||(t=document.createElement("div"),t.id=nr,t.style.display="none",e.appendChild(t)),t["class"]=rr;var n=document.createElement(ir);n.id=ir,e.appendChild(n);var r=document.createElement(sr);r.id=sr,e.appendChild(r);var i=document.createElement(ar);i.id=ar,e.appendChild(i);var s=document.createElement(cr);s.id=cr,e.appendChild(s);var a=document.createElement(ur);a.id=ur,s.appendChild(a);var o=document.createElement(lr);o.id=lr,s.appendChild(o);for(var c=0;7>c;c++)s.appendChild(document.createElement("br"));var u=document.createElement(or);u.id=or,e.appendChild(u)}}function ht(){if(pt(),t(),he(),k(),Yt=document.getElementById(nr).value,!Yt){var e=h("default_url");e&&(Q(e),Yt=document.getElementById(nr).value)}on=!0,Yt&&(ln=g(Yt),y(),kt(),en=bn[0][0][0],St(en),ft()),Y(),$(function(){FastClick.attach(document.body)})}function mt(e){at(e),ht();var t=h("qualtrics");t&&(t.disableNextButton(),t.disablePreviousButton())}function vt(){t(),Yt=document.getElementById(nr).value,kt(),en=bn[0][0][0],St(en),ft()}function gt(e){console.log("Processing note click....");var t=e.getAttribute("class");console.log("Click "+t);var n=t.split("_"),r=n[1];if(r in wn){var i=wn[r];me("process_note_click",i),St(i),en=i}}function yt(e){en=bn[0][0][0];var t=d(),n=c(!0);n.sequence=e;var r=a(t);S(r,n),Fe(),St(en)}function _t(){Ye();var e=sn.pop();e&&(e.undo_fingering_change(),en=e,Fe(),St(en))}function bt(){Ye();var e=rn.pop();e&&(e.redo_fingering_change(),en=e.next_note?e.next_note:e,Fe(),St(en))}function xt(){Ye();var e="";en.preset_fingering&&(e+="Preset (recommended) fingering: "+en.preset_fingering+"\n\n"),e+="Please enter a fingering string for the selected note.";var t=en.fingering,n=window.prompt(e,t);try{if(null===n)return;var r=Abcdf_Parser.parse(n);Ge(r),Fe(),St(en)}catch(i){alert("Bad abcDF parse of fingering string: "+i.message+i.stack)}}function wt(e){console.log("Processing note double-click...."),gt(e),xt()}function kt(){var e=new _e,t=document.getElementById(ur),n=document.getElementById(lr);t.align="center",Zt=new Abc(e),Gt="",Zt.tosvg("edit",'%%bgcolor white\n%%beginsvg\n<style type="text/css">\n	rect.abcr {fill:#a08000; fill-opacity:0}\n	rect.abcr:hover {fill-opacity:0.3}\n</style>\n%%endsvg\n'),n.innerHTML="",Sn=[];try{Yt&&Zt.tosvg(pn,Yt)}catch(r){return void alert(r.message+"\nabc2svg tosvg bug - stack:\n"+r.stack)}try{Yt&&(t.innerHTML=Gt,xe(),we(),En=!0,yn=0,O(),Fe())}catch(r){return void alert(r.message+"\nabc2svg image bug - abort:\n"+r.stack)}}function Et(e,t){for(var n,r=document.getElementsByClassName(e),i=r.length;--i>=0;)n=r[i],n.setAttribute("color",t)}function Ct(e){var t,n=Nn.length;for(t=0;n>t;t++)Et(Nn[t],e)}function Tt(e){var t=$(e),n=$(window),r=document.getElementById(or),i=n.scrollTop(),s=i+n.height()-r.offsetHeight,a=t.offset().top,o=a+t.height();return s>=o&&a>=i}function St(e){var t=e.fingered_start;0!=Nn.length&&(Ct("black"),Nn=[]),Nn.push("e_"+t),Ct(An?0===e.staff?"blue":"red":1===e.staff?"blue":"red");var n="line_"+e.line,r=document.getElementById(n);if(!Tt(r)){r.scrollIntoView(!1);var i=document.getElementById(or),s=document.body.scrollTop;window.scrollTo(0,s+i.offsetHeight)}}function Ot(e){e||(e=Yt);for(var t=e.split("\n"),n=0;n<t.length;n++){var r=t[n];if(/^\s*X:/.test(r)){var i=r.split(":");if(2!=i.length)return"";var s=i[1].trim();return s}}return""}function At(e,t){var n=[];if(e.fingering)n=R(Vn,e.fingering);else if(t)return"";if(t&&n.length!=e.size)return"";for(var r=e.fingering||"",i=n.length;i<e.size;i++)r+="x";return r}function Nt(e,t){if(e.grace)return At(e,t);var n=Cn[e.staff][e.time],r=Be(n),i=n.length-r;if(2>i)return At(e,t);n.sort(be);for(var s=0,a=n[0];a.grace;)s++,a=n[s];if(e!==a)return"";for(var o=Ne(n),c="",s=0;s<o.length;s++)c+=o[s]?o[s]:"x";return c}function Bt(e,t){for(var n=[],r=t,i=e.split(""),s=0;s<i.length;s++){var a=i[s];a.match(Un)?a!==r&&(n.push(a),r=a):n.push(a)}return n.join("")}function Rt(e,t,n){for(var r=bn[t][e],i="",s=0;s<r.length;s++){var a=r[s],o=Nt(a,!1);i+=o}return i}function Pt(e,t){var n=$n.exec(e);return n&&n[1]?n[1]:t}function Lt(){for(var e="",t="",n=We(0),r=We(1),i=0;i<bn.length;i++){var s=Rt(0,i);if(s&&(s=Bt(s,n),n=Pt(s,n),e+=s,i<bn.length-1&&(e+="&")),bn[i][1]){var a=Rt(1,i);a&&(a=Bt(a,r),r=Pt(a,r),t+=a,i<bn.length-1&&(t+="&"))}}var o=e+"@"+t;return o}function It(){console.log("Print that score.");var e=window.open("","print_window");e.document.write(Gt),e.document.close(),e.focus(),e.print(),e.close()}function Mt(){var e=document.getElementById(nr);e.value=Yt,vt()}function Dt(){var e,t;return Bn?(e=Ve(),t=lt(e,!0)):t=lt(Yt,!0),t}function jt(){var e=Dt();window.open("data:text/vnd.abc;charset=utf-8,"+encodeURI(e),"view_window")}function Vt(){return h("include_pii")?o("authority"):""}function Ft(){return o("authority_year")}function qt(){return h("include_pii")?o("transcriber"):""}function zt(){return o("comments")}function Ht(){return Lt()}function Ut(e){try{Abcdf_Parser.parse(e)}catch(t){return"Bad abcDF parse of fingering string: "+t.message+t.stack}var n=0,r=h("validate");if("complete"===r)n=e.split("x").length-1;else if("none"===r)n=0;else if("auto"===r)return"Validation of autofill is not yet implemented.";return 1===n?"One note is missing a fingering annotation.":n>1?n+" notes are missing fingering annotations.":""}function $t(e){var t=Ut(e);return t?(alert(t),!1):!0}function Qt(){var e=Lt();return $t(e)?e:""}function Wt(){var e="",t=Bn;return Bn=!1,e=Dt(),Bn=t,e}function Jt(){var e=Lt();if($t(e)){var t=Dt();return/^\s*X:/m.test(t)?/^% abcDidactyl/m.test(t)?t:(alert("File is not valid abcD."),""):(alert("File is not valid abc."),"")}return""}var Xt,Kt,Gt,Yt,Zt,en,tn,nn,rn=[],sn=[],an="",on=!1,cn=1,un={},ln=[],fn=void 0,dn="",pn="noname.abc",hn=0,mn=[],vn=!1,gn=[],yn=0,_n=[],bn=[],xn={},wn={},kn=[],En=!1,Cn={},Tn={},Sn=[],On=0,An=!1,Nn=[],Bn=!0,Rn=!1,Pn="https://dvdrndlph.github.io/didactyl",Ln=Pn+"/abcde",In=Ln+"/view/abcde_help.html",Mn=Ln+"/image",Dn=Ln+"/lib/media",jn=5,Vn=/\(([<>]\d)+\)|[<>]\d-[<>]\d\/[<>]\d-[<>]\d|[<>]\d\/[<>]\d-[<>]\d|[<>]\d-[<>]\d\/[<>]\d|[<>]\d-[<>]\d|[<>]\d\/[<>]\d|[<>]\d|x/g,Fn=/\(([<>]?\d)+\)|[<>]?\d-[<>]?\d\/[<>]?\d-[<>]?\d|[<>]?\d\/[<>]?\d-[<>]?\d|[<>]?\d-[<>]?\d\/[<>]?\d|[<>]?\d-[<>]?\d|[<>]?\d\/[<>]?\d|[<>]?\d|x/g,qn=/\s/g,zn=/</g,Hn=/>/g,Un=/[><]/g,$n=/.*([<>])[^<>]+$/,Qn=/^% abcDidactyl v([\d\.]+)$/,Wn=/^% abcD fingering (\d+): ([<>1-5\-\/\(\)@&x]+)$/,Jn=/^% abcDidactyl END$/,Xn=/^% Authority: (.*)\s+\((\d\d\d\d)\)$/,Kn=/^% Transcriber: (.*)$/,Gn=/^% Transcription date: ((\d\d\d\d\-[01]\d\-[0-3]\d)\s?([0-2]\d:[0-5]\d:[0-5]\d)?)$/,Yn=/^% (.*)$/,Zn=300,er=4e3,tr="abcde",nr="abc_source",rr="source",ir="abcde_prefs",sr="abcde_controls",ar="abcde_metadata",or="abcde_keypad",cr="abcde_rendering",ur="abcde_target",lr="abcde_error",fr=.1,dr=3,pr=.3,hr=90,mr=89,vr=13,gr=8,yr=9,_r=37,br=39,xr="%%setfont-1 Bookman 11\n%%setfont-2 Helvetica-Bold 11",wr="%%deco 1 3 fng 8 1 1 1\n%%deco 2 3 fng 8 1 1 2\n%%deco 3 3 fng 8 1 1 3\n%%deco 4 3 fng 8 1 1 4\n%%deco 5 3 fng 8 1 1 5";return this.renderUI=mt,this.getXValue=Ot,this.getAuthority=Vt,this.getAuthorityYear=Ft,this.getTranscriber=qt,this.getComments=zt,this.getEnteredCollection=Ht,this.getEnteredAbcDF=Ht,this.getEnteredAbcD=Wt,this.getValidatedCollection=Qt,this.getValidatedAbcD=Jt,this.setEnteredCollection=yt,this.handleKeys=ft,this.unhandleKeys=dt,this}!function(e,t){"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(e,t){function n(e){var t=!!e&&"length"in e&&e.length,n=pe.type(e);return"function"===n||pe.isWindow(e)?!1:"array"===n||0===t||"number"==typeof t&&t>0&&t-1 in e}function r(e,t,n){if(pe.isFunction(t))return pe.grep(e,function(e,r){return!!t.call(e,r,e)!==n});if(t.nodeType)return pe.grep(e,function(e){return e===t!==n});if("string"==typeof t){if(ke.test(t))return pe.filter(t,e,n);t=pe.filter(t,e)}return pe.grep(e,function(e){return pe.inArray(e,t)>-1!==n})}function i(e,t){do e=e[t];while(e&&1!==e.nodeType);return e}function s(e){var t={};return pe.each(e.match(Ae)||[],function(e,n){t[n]=!0}),t}function a(){re.addEventListener?(re.removeEventListener("DOMContentLoaded",o),e.removeEventListener("load",o)):(re.detachEvent("onreadystatechange",o),e.detachEvent("onload",o))}function o(){(re.addEventListener||"load"===e.event.type||"complete"===re.readyState)&&(a(),pe.ready())}function c(e,t,n){if(void 0===n&&1===e.nodeType){var r="data-"+t.replace(Le,"-$1").toLowerCase();if(n=e.getAttribute(r),"string"==typeof n){try{n="true"===n?!0:"false"===n?!1:"null"===n?null:+n+""===n?+n:Pe.test(n)?pe.parseJSON(n):n}catch(i){}pe.data(e,t,n)}else n=void 0}return n}function u(e){var t;for(t in e)if(("data"!==t||!pe.isEmptyObject(e[t]))&&"toJSON"!==t)return!1;return!0}function l(e,t,n,r){if(Re(e)){var i,s,a=pe.expando,o=e.nodeType,c=o?pe.cache:e,u=o?e[a]:e[a]&&a;if(u&&c[u]&&(r||c[u].data)||void 0!==n||"string"!=typeof t)return u||(u=o?e[a]=ne.pop()||pe.guid++:a),c[u]||(c[u]=o?{}:{toJSON:pe.noop}),("object"==typeof t||"function"==typeof t)&&(r?c[u]=pe.extend(c[u],t):c[u].data=pe.extend(c[u].data,t)),s=c[u],r||(s.data||(s.data={}),s=s.data),void 0!==n&&(s[pe.camelCase(t)]=n),"string"==typeof t?(i=s[t],null==i&&(i=s[pe.camelCase(t)])):i=s,i}}function f(e,t,n){if(Re(e)){var r,i,s=e.nodeType,a=s?pe.cache:e,o=s?e[pe.expando]:pe.expando;if(a[o]){if(t&&(r=n?a[o]:a[o].data)){pe.isArray(t)?t=t.concat(pe.map(t,pe.camelCase)):t in r?t=[t]:(t=pe.camelCase(t),t=t in r?[t]:t.split(" ")),i=t.length;for(;i--;)delete r[t[i]];if(n?!u(r):!pe.isEmptyObject(r))return}(n||(delete a[o].data,u(a[o])))&&(s?pe.cleanData([e],!0):fe.deleteExpando||a!=a.window?delete a[o]:a[o]=void 0)}}}function d(e,t,n,r){var i,s=1,a=20,o=r?function(){return r.cur()}:function(){return pe.css(e,t,"")},c=o(),u=n&&n[3]||(pe.cssNumber[t]?"":"px"),l=(pe.cssNumber[t]||"px"!==u&&+c)&&Me.exec(pe.css(e,t));if(l&&l[3]!==u){u=u||l[3],n=n||[],l=+c||1;do s=s||".5",l/=s,pe.style(e,t,l+u);while(s!==(s=o()/c)&&1!==s&&--a)}return n&&(l=+l||+c||0,i=n[1]?l+(n[1]+1)*n[2]:+n[2],r&&(r.unit=u,r.start=l,r.end=i)),i}function p(e){var t=Ue.split("|"),n=e.createDocumentFragment();if(n.createElement)for(;t.length;)n.createElement(t.pop());return n}function h(e,t){var n,r,i=0,s="undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName(t||"*"):"undefined"!=typeof e.querySelectorAll?e.querySelectorAll(t||"*"):void 0;if(!s)for(s=[],n=e.childNodes||e;null!=(r=n[i]);i++)!t||pe.nodeName(r,t)?s.push(r):pe.merge(s,h(r,t));return void 0===t||t&&pe.nodeName(e,t)?pe.merge([e],s):s}function m(e,t){for(var n,r=0;null!=(n=e[r]);r++)pe._data(n,"globalEval",!t||pe._data(t[r],"globalEval"))}function v(e){Fe.test(e.type)&&(e.defaultChecked=e.checked)}function g(e,t,n,r,i){for(var s,a,o,c,u,l,f,d=e.length,g=p(t),y=[],_=0;d>_;_++)if(a=e[_],a||0===a)if("object"===pe.type(a))pe.merge(y,a.nodeType?[a]:a);else if(Qe.test(a)){for(c=c||g.appendChild(t.createElement("div")),u=(qe.exec(a)||["",""])[1].toLowerCase(),f=$e[u]||$e._default,c.innerHTML=f[1]+pe.htmlPrefilter(a)+f[2],s=f[0];s--;)c=c.lastChild;if(!fe.leadingWhitespace&&He.test(a)&&y.push(t.createTextNode(He.exec(a)[0])),!fe.tbody)for(a="table"!==u||We.test(a)?"<table>"!==f[1]||We.test(a)?0:c:c.firstChild,s=a&&a.childNodes.length;s--;)pe.nodeName(l=a.childNodes[s],"tbody")&&!l.childNodes.length&&a.removeChild(l);for(pe.merge(y,c.childNodes),c.textContent="";c.firstChild;)c.removeChild(c.firstChild);c=g.lastChild}else y.push(t.createTextNode(a));for(c&&g.removeChild(c),fe.appendChecked||pe.grep(h(y,"input"),v),_=0;a=y[_++];)if(r&&pe.inArray(a,r)>-1)i&&i.push(a);else if(o=pe.contains(a.ownerDocument,a),c=h(g.appendChild(a),"script"),o&&m(c),n)for(s=0;a=c[s++];)ze.test(a.type||"")&&n.push(a);return c=null,g}function y(){return!0}function _(){return!1}function b(){try{return re.activeElement}catch(e){}}function x(e,t,n,r,i,s){var a,o;if("object"==typeof t){"string"!=typeof n&&(r=r||n,n=void 0);for(o in t)x(e,o,n,r,t[o],s);return e}if(null==r&&null==i?(i=n,r=n=void 0):null==i&&("string"==typeof n?(i=r,r=void 0):(i=r,r=n,n=void 0)),i===!1)i=_;else if(!i)return e;return 1===s&&(a=i,i=function(e){return pe().off(e),a.apply(this,arguments)},i.guid=a.guid||(a.guid=pe.guid++)),e.each(function(){pe.event.add(this,t,i,r,n)})}function w(e,t){return pe.nodeName(e,"table")&&pe.nodeName(11!==t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function k(e){return e.type=(null!==pe.find.attr(e,"type"))+"/"+e.type,e}function E(e){var t=it.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function C(e,t){if(1===t.nodeType&&pe.hasData(e)){var n,r,i,s=pe._data(e),a=pe._data(t,s),o=s.events;if(o){delete a.handle,a.events={};for(n in o)for(r=0,i=o[n].length;i>r;r++)pe.event.add(t,n,o[n][r])}a.data&&(a.data=pe.extend({},a.data))}}function T(e,t){var n,r,i;if(1===t.nodeType){if(n=t.nodeName.toLowerCase(),!fe.noCloneEvent&&t[pe.expando]){i=pe._data(t);for(r in i.events)pe.removeEvent(t,r,i.handle);t.removeAttribute(pe.expando)}"script"===n&&t.text!==e.text?(k(t).text=e.text,E(t)):"object"===n?(t.parentNode&&(t.outerHTML=e.outerHTML),fe.html5Clone&&e.innerHTML&&!pe.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):"input"===n&&Fe.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):"option"===n?t.defaultSelected=t.selected=e.defaultSelected:("input"===n||"textarea"===n)&&(t.defaultValue=e.defaultValue)}}function S(e,t,n,r){t=se.apply([],t);var i,s,a,o,c,u,l=0,f=e.length,d=f-1,p=t[0],m=pe.isFunction(p);if(m||f>1&&"string"==typeof p&&!fe.checkClone&&rt.test(p))return e.each(function(i){var s=e.eq(i);m&&(t[0]=p.call(this,i,s.html())),S(s,t,n,r)});if(f&&(u=g(t,e[0].ownerDocument,!1,e,r),i=u.firstChild,1===u.childNodes.length&&(u=i),i||r)){for(o=pe.map(h(u,"script"),k),a=o.length;f>l;l++)s=u,l!==d&&(s=pe.clone(s,!0,!0),a&&pe.merge(o,h(s,"script"))),n.call(e[l],s,l);if(a)for(c=o[o.length-1].ownerDocument,pe.map(o,E),l=0;a>l;l++)s=o[l],ze.test(s.type||"")&&!pe._data(s,"globalEval")&&pe.contains(c,s)&&(s.src?pe._evalUrl&&pe._evalUrl(s.src):pe.globalEval((s.text||s.textContent||s.innerHTML||"").replace(st,"")));u=i=null}return e}function O(e,t,n){for(var r,i=t?pe.filter(t,e):e,s=0;null!=(r=i[s]);s++)n||1!==r.nodeType||pe.cleanData(h(r)),r.parentNode&&(n&&pe.contains(r.ownerDocument,r)&&m(h(r,"script")),r.parentNode.removeChild(r));return e}function A(e,t){var n=pe(t.createElement(e)).appendTo(t.body),r=pe.css(n[0],"display");return n.detach(),r}function N(e){var t=re,n=ut[e];return n||(n=A(e,t),"none"!==n&&n||(ct=(ct||pe("<iframe frameborder='0' width='0' height='0'/>")).appendTo(t.documentElement),t=(ct[0].contentWindow||ct[0].contentDocument).document,t.write(),t.close(),n=A(e,t),ct.detach()),ut[e]=n),n}function B(e,t){return{get:function(){return e()?void delete this.get:(this.get=t).apply(this,arguments)}}}function R(e){if(e in Et)return e;for(var t=e.charAt(0).toUpperCase()+e.slice(1),n=kt.length;n--;)if(e=kt[n]+t,e in Et)return e}function P(e,t){for(var n,r,i,s=[],a=0,o=e.length;o>a;a++)r=e[a],r.style&&(s[a]=pe._data(r,"olddisplay"),n=r.style.display,t?(s[a]||"none"!==n||(r.style.display=""),""===r.style.display&&je(r)&&(s[a]=pe._data(r,"olddisplay",N(r.nodeName)))):(i=je(r),(n&&"none"!==n||!i)&&pe._data(r,"olddisplay",i?n:pe.css(r,"display"))));for(a=0;o>a;a++)r=e[a],r.style&&(t&&"none"!==r.style.display&&""!==r.style.display||(r.style.display=t?s[a]||"":"none"));return e}function L(e,t,n){var r=bt.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function I(e,t,n,r,i){for(var s=n===(r?"border":"content")?4:"width"===t?1:0,a=0;4>s;s+=2)"margin"===n&&(a+=pe.css(e,n+De[s],!0,i)),r?("content"===n&&(a-=pe.css(e,"padding"+De[s],!0,i)),"margin"!==n&&(a-=pe.css(e,"border"+De[s]+"Width",!0,i))):(a+=pe.css(e,"padding"+De[s],!0,i),"padding"!==n&&(a+=pe.css(e,"border"+De[s]+"Width",!0,i)));return a}function M(t,n,r){var i=!0,s="width"===n?t.offsetWidth:t.offsetHeight,a=ht(t),o=fe.boxSizing&&"border-box"===pe.css(t,"boxSizing",!1,a);if(re.msFullscreenElement&&e.top!==e&&t.getClientRects().length&&(s=Math.round(100*t.getBoundingClientRect()[n])),0>=s||null==s){if(s=mt(t,n,a),(0>s||null==s)&&(s=t.style[n]),ft.test(s))return s;i=o&&(fe.boxSizingReliable()||s===t.style[n]),s=parseFloat(s)||0}return s+I(t,n,r||(o?"border":"content"),i,a)+"px"}function D(e,t,n,r,i){return new D.prototype.init(e,t,n,r,i)}function j(){return e.setTimeout(function(){Ct=void 0}),Ct=pe.now()}function V(e,t){var n,r={height:e},i=0;for(t=t?1:0;4>i;i+=2-t)n=De[i],r["margin"+n]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}function F(e,t,n){for(var r,i=(H.tweeners[t]||[]).concat(H.tweeners["*"]),s=0,a=i.length;a>s;s++)if(r=i[s].call(n,t,e))return r}function q(e,t,n){var r,i,s,a,o,c,u,l,f=this,d={},p=e.style,h=e.nodeType&&je(e),m=pe._data(e,"fxshow");n.queue||(o=pe._queueHooks(e,"fx"),null==o.unqueued&&(o.unqueued=0,c=o.empty.fire,o.empty.fire=function(){o.unqueued||c()}),o.unqueued++,f.always(function(){f.always(function(){o.unqueued--,pe.queue(e,"fx").length||o.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(n.overflow=[p.overflow,p.overflowX,p.overflowY],u=pe.css(e,"display"),l="none"===u?pe._data(e,"olddisplay")||N(e.nodeName):u,"inline"===l&&"none"===pe.css(e,"float")&&(fe.inlineBlockNeedsLayout&&"inline"!==N(e.nodeName)?p.zoom=1:p.display="inline-block")),n.overflow&&(p.overflow="hidden",fe.shrinkWrapBlocks()||f.always(function(){p.overflow=n.overflow[0],p.overflowX=n.overflow[1],p.overflowY=n.overflow[2]}));for(r in t)if(i=t[r],St.exec(i)){if(delete t[r],s=s||"toggle"===i,i===(h?"hide":"show")){if("show"!==i||!m||void 0===m[r])continue;h=!0}d[r]=m&&m[r]||pe.style(e,r)}else u=void 0;if(pe.isEmptyObject(d))"inline"===("none"===u?N(e.nodeName):u)&&(p.display=u);else{m?"hidden"in m&&(h=m.hidden):m=pe._data(e,"fxshow",{}),s&&(m.hidden=!h),h?pe(e).show():f.done(function(){pe(e).hide()}),f.done(function(){var t;pe._removeData(e,"fxshow");for(t in d)pe.style(e,t,d[t])});for(r in d)a=F(h?m[r]:0,r,f),r in m||(m[r]=a.start,h&&(a.end=a.start,a.start="width"===r||"height"===r?1:0))}}function z(e,t){var n,r,i,s,a;for(n in e)if(r=pe.camelCase(n),i=t[r],s=e[n],pe.isArray(s)&&(i=s[1],s=e[n]=s[0]),n!==r&&(e[r]=s,delete e[n]),a=pe.cssHooks[r],a&&"expand"in a){s=a.expand(s),delete e[r];for(n in s)n in e||(e[n]=s[n],t[n]=i)}else t[r]=i}function H(e,t,n){var r,i,s=0,a=H.prefilters.length,o=pe.Deferred().always(function(){delete c.elem}),c=function(){if(i)return!1;for(var t=Ct||j(),n=Math.max(0,u.startTime+u.duration-t),r=n/u.duration||0,s=1-r,a=0,c=u.tweens.length;c>a;a++)u.tweens[a].run(s);return o.notifyWith(e,[u,s,n]),1>s&&c?n:(o.resolveWith(e,[u]),!1)},u=o.promise({elem:e,props:pe.extend({},t),opts:pe.extend(!0,{specialEasing:{},easing:pe.easing._default},n),originalProperties:t,originalOptions:n,startTime:Ct||j(),duration:n.duration,tweens:[],createTween:function(t,n){var r=pe.Tween(e,u.opts,t,n,u.opts.specialEasing[t]||u.opts.easing);return u.tweens.push(r),r},stop:function(t){var n=0,r=t?u.tweens.length:0;if(i)return this;for(i=!0;r>n;n++)u.tweens[n].run(1);return t?(o.notifyWith(e,[u,1,0]),o.resolveWith(e,[u,t])):o.rejectWith(e,[u,t]),this}}),l=u.props;for(z(l,u.opts.specialEasing);a>s;s++)if(r=H.prefilters[s].call(u,e,l,u.opts))return pe.isFunction(r.stop)&&(pe._queueHooks(u.elem,u.opts.queue).stop=pe.proxy(r.stop,r)),r;return pe.map(l,F,u),pe.isFunction(u.opts.start)&&u.opts.start.call(e,u),pe.fx.timer(pe.extend(c,{elem:e,anim:u,queue:u.opts.queue})),u.progress(u.opts.progress).done(u.opts.done,u.opts.complete).fail(u.opts.fail).always(u.opts.always)}function U(e){return pe.attr(e,"class")||""}function $(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var r,i=0,s=t.toLowerCase().match(Ae)||[];if(pe.isFunction(n))for(;r=s[i++];)"+"===r.charAt(0)?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function Q(e,t,n,r){function i(o){var c;return s[o]=!0,pe.each(e[o]||[],function(e,o){var u=o(t,n,r);return"string"!=typeof u||a||s[u]?a?!(c=u):void 0:(t.dataTypes.unshift(u),i(u),!1)}),c}var s={},a=e===Gt;return i(t.dataTypes[0])||!s["*"]&&i("*")}function W(e,t){var n,r,i=pe.ajaxSettings.flatOptions||{};for(r in t)void 0!==t[r]&&((i[r]?e:n||(n={}))[r]=t[r]);return n&&pe.extend(!0,e,n),e}function J(e,t,n){for(var r,i,s,a,o=e.contents,c=e.dataTypes;"*"===c[0];)c.shift(),void 0===i&&(i=e.mimeType||t.getResponseHeader("Content-Type"));if(i)for(a in o)if(o[a]&&o[a].test(i)){c.unshift(a);break}if(c[0]in n)s=c[0];else{for(a in n){if(!c[0]||e.converters[a+" "+c[0]]){s=a;break}r||(r=a)}s=s||r}return s?(s!==c[0]&&c.unshift(s),n[s]):void 0}function X(e,t,n,r){var i,s,a,o,c,u={},l=e.dataTypes.slice();if(l[1])for(a in e.converters)u[a.toLowerCase()]=e.converters[a];for(s=l.shift();s;)if(e.responseFields[s]&&(n[e.responseFields[s]]=t),!c&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),c=s,s=l.shift())if("*"===s)s=c;else if("*"!==c&&c!==s){if(a=u[c+" "+s]||u["* "+s],!a)for(i in u)if(o=i.split(" "),o[1]===s&&(a=u[c+" "+o[0]]||u["* "+o[0]])){a===!0?a=u[i]:u[i]!==!0&&(s=o[0],l.unshift(o[1]));break}if(a!==!0)if(a&&e["throws"])t=a(t);else try{t=a(t)}catch(f){return{state:"parsererror",error:a?f:"No conversion from "+c+" to "+s}}}return{state:"success",data:t}}function K(e){return e.style&&e.style.display||pe.css(e,"display")}function G(e){for(;e&&1===e.nodeType;){if("none"===K(e)||"hidden"===e.type)return!0;e=e.parentNode}return!1}function Y(e,t,n,r){var i;if(pe.isArray(t))pe.each(t,function(t,i){n||nn.test(e)?r(e,i):Y(e+"["+("object"==typeof i&&null!=i?t:"")+"]",i,n,r)});else if(n||"object"!==pe.type(t))r(e,t);else for(i in t)Y(e+"["+i+"]",t[i],n,r)}function Z(){try{return new e.XMLHttpRequest}catch(t){}}function ee(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function te(e){return pe.isWindow(e)?e:9===e.nodeType?e.defaultView||e.parentWindow:!1}var ne=[],re=e.document,ie=ne.slice,se=ne.concat,ae=ne.push,oe=ne.indexOf,ce={},ue=ce.toString,le=ce.hasOwnProperty,fe={},de="1.12.0",pe=function(e,t){return new pe.fn.init(e,t)},he=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,me=/^-ms-/,ve=/-([\da-z])/gi,ge=function(e,t){return t.toUpperCase()};pe.fn=pe.prototype={jquery:de,constructor:pe,selector:"",length:0,toArray:function(){return ie.call(this)},get:function(e){return null!=e?0>e?this[e+this.length]:this[e]:ie.call(this)},pushStack:function(e){var t=pe.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e){return pe.each(this,e)},map:function(e){return this.pushStack(pe.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return this.pushStack(ie.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(0>e?t:0);return this.pushStack(n>=0&&t>n?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:ae,sort:ne.sort,splice:ne.splice},pe.extend=pe.fn.extend=function(){var e,t,n,r,i,s,a=arguments[0]||{},o=1,c=arguments.length,u=!1;for("boolean"==typeof a&&(u=a,a=arguments[o]||{},o++),"object"==typeof a||pe.isFunction(a)||(a={}),o===c&&(a=this,o--);c>o;o++)if(null!=(i=arguments[o]))for(r in i)e=a[r],n=i[r],a!==n&&(u&&n&&(pe.isPlainObject(n)||(t=pe.isArray(n)))?(t?(t=!1,s=e&&pe.isArray(e)?e:[]):s=e&&pe.isPlainObject(e)?e:{},a[r]=pe.extend(u,s,n)):void 0!==n&&(a[r]=n));return a},pe.extend({expando:"jQuery"+(de+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return"function"===pe.type(e)},isArray:Array.isArray||function(e){return"array"===pe.type(e)},isWindow:function(e){return null!=e&&e==e.window},isNumeric:function(e){var t=e&&e.toString();return!pe.isArray(e)&&t-parseFloat(t)+1>=0},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},isPlainObject:function(e){var t;if(!e||"object"!==pe.type(e)||e.nodeType||pe.isWindow(e))return!1;try{if(e.constructor&&!le.call(e,"constructor")&&!le.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(n){return!1}if(!fe.ownFirst)for(t in e)return le.call(e,t);for(t in e);return void 0===t||le.call(e,t)},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?ce[ue.call(e)]||"object":typeof e},globalEval:function(t){t&&pe.trim(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(me,"ms-").replace(ve,ge)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t){var r,i=0;if(n(e))for(r=e.length;r>i&&t.call(e[i],i,e[i])!==!1;i++);else for(i in e)if(t.call(e[i],i,e[i])===!1)break;return e},trim:function(e){return null==e?"":(e+"").replace(he,"")},makeArray:function(e,t){var r=t||[];return null!=e&&(n(Object(e))?pe.merge(r,"string"==typeof e?[e]:e):ae.call(r,e)),r},inArray:function(e,t,n){var r;if(t){if(oe)return oe.call(t,e,n);for(r=t.length,n=n?0>n?Math.max(0,r+n):n:0;r>n;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;n>r;)e[i++]=t[r++];if(n!==n)for(;void 0!==t[r];)e[i++]=t[r++];return e.length=i,e},grep:function(e,t,n){for(var r,i=[],s=0,a=e.length,o=!n;a>s;s++)r=!t(e[s],s),r!==o&&i.push(e[s]);return i},map:function(e,t,r){var i,s,a=0,o=[];if(n(e))for(i=e.length;i>a;a++)s=t(e[a],a,r),null!=s&&o.push(s);else for(a in e)s=t(e[a],a,r),null!=s&&o.push(s);return se.apply([],o)},guid:1,proxy:function(e,t){var n,r,i;return"string"==typeof t&&(i=e[t],t=e,e=i),pe.isFunction(e)?(n=ie.call(arguments,2),r=function(){return e.apply(t||this,n.concat(ie.call(arguments)))},r.guid=e.guid=e.guid||pe.guid++,r):void 0},now:function(){return+new Date},support:fe}),"function"==typeof Symbol&&(pe.fn[Symbol.iterator]=ne[Symbol.iterator]),pe.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){ce["[object "+t+"]"]=t.toLowerCase()});var ye=function(e){function t(e,t,n,r){var i,s,a,o,c,u,f,p,h=t&&t.ownerDocument,m=t?t.nodeType:9;if(n=n||[],"string"!=typeof e||!e||1!==m&&9!==m&&11!==m)return n;if(!r&&((t?t.ownerDocument||t:F)!==R&&B(t),t=t||R,L)){if(11!==m&&(u=ge.exec(e)))if(i=u[1]){if(9===m){if(!(a=t.getElementById(i)))return n;if(a.id===i)return n.push(a),n}else if(h&&(a=h.getElementById(i))&&j(t,a)&&a.id===i)return n.push(a),n}else{if(u[2])return Y.apply(n,t.getElementsByTagName(e)),n;if((i=u[3])&&x.getElementsByClassName&&t.getElementsByClassName)return Y.apply(n,t.getElementsByClassName(i)),n}if(x.qsa&&!$[e+" "]&&(!I||!I.test(e))){if(1!==m)h=t,p=e;else if("object"!==t.nodeName.toLowerCase()){for((o=t.getAttribute("id"))?o=o.replace(_e,"\\$&"):t.setAttribute("id",o=V),f=C(e),s=f.length,c=de.test(o)?"#"+o:"[id='"+o+"']";s--;)f[s]=c+" "+d(f[s]);p=f.join(","),h=ye.test(e)&&l(t.parentNode)||t}if(p)try{return Y.apply(n,h.querySelectorAll(p)),n}catch(v){}finally{o===V&&t.removeAttribute("id")}}}return S(e.replace(oe,"$1"),t,n,r)}function n(){function e(n,r){return t.push(n+" ")>w.cacheLength&&delete e[t.shift()],e[n+" "]=r}var t=[];return e}function r(e){return e[V]=!0,e}function i(e){var t=R.createElement("div");try{return!!e(t)}catch(n){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function s(e,t){for(var n=e.split("|"),r=n.length;r--;)w.attrHandle[n[r]]=t}function a(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||W)-(~e.sourceIndex||W);if(r)return r;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function o(e){return function(t){var n=t.nodeName.toLowerCase();return"input"===n&&t.type===e}}function c(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function u(e){return r(function(t){return t=+t,r(function(n,r){for(var i,s=e([],n.length,t),a=s.length;a--;)n[i=s[a]]&&(n[i]=!(r[i]=n[i]))})})}function l(e){return e&&"undefined"!=typeof e.getElementsByTagName&&e}function f(){}function d(e){for(var t=0,n=e.length,r="";n>t;t++)r+=e[t].value;return r}function p(e,t,n){var r=t.dir,i=n&&"parentNode"===r,s=z++;return t.first?function(t,n,s){for(;t=t[r];)if(1===t.nodeType||i)return e(t,n,s)}:function(t,n,a){var o,c,u,l=[q,s];if(a){for(;t=t[r];)if((1===t.nodeType||i)&&e(t,n,a))return!0}else for(;t=t[r];)if(1===t.nodeType||i){if(u=t[V]||(t[V]={}),c=u[t.uniqueID]||(u[t.uniqueID]={}),(o=c[r])&&o[0]===q&&o[1]===s)return l[2]=o[2];if(c[r]=l,l[2]=e(t,n,a))return!0}}}function h(e){return e.length>1?function(t,n,r){for(var i=e.length;i--;)if(!e[i](t,n,r))return!1;return!0}:e[0]}function m(e,n,r){for(var i=0,s=n.length;s>i;i++)t(e,n[i],r);return r}function v(e,t,n,r,i){for(var s,a=[],o=0,c=e.length,u=null!=t;c>o;o++)(s=e[o])&&(!n||n(s,r,i))&&(a.push(s),u&&t.push(o));return a}function g(e,t,n,i,s,a){return i&&!i[V]&&(i=g(i)),s&&!s[V]&&(s=g(s,a)),r(function(r,a,o,c){var u,l,f,d=[],p=[],h=a.length,g=r||m(t||"*",o.nodeType?[o]:o,[]),y=!e||!r&&t?g:v(g,d,e,o,c),_=n?s||(r?e:h||i)?[]:a:y;if(n&&n(y,_,o,c),i)for(u=v(_,p),i(u,[],o,c),l=u.length;l--;)(f=u[l])&&(_[p[l]]=!(y[p[l]]=f));if(r){if(s||e){if(s){for(u=[],l=_.length;l--;)(f=_[l])&&u.push(y[l]=f);s(null,_=[],u,c)}for(l=_.length;l--;)(f=_[l])&&(u=s?ee(r,f):d[l])>-1&&(r[u]=!(a[u]=f))}}else _=v(_===a?_.splice(h,_.length):_),s?s(null,a,_,c):Y.apply(a,_)})}function y(e){for(var t,n,r,i=e.length,s=w.relative[e[0].type],a=s||w.relative[" "],o=s?1:0,c=p(function(e){return e===t},a,!0),u=p(function(e){return ee(t,e)>-1},a,!0),l=[function(e,n,r){var i=!s&&(r||n!==O)||((t=n).nodeType?c(e,n,r):u(e,n,r));return t=null,i}];i>o;o++)if(n=w.relative[e[o].type])l=[p(h(l),n)];else{if(n=w.filter[e[o].type].apply(null,e[o].matches),n[V]){for(r=++o;i>r&&!w.relative[e[r].type];r++);return g(o>1&&h(l),o>1&&d(e.slice(0,o-1).concat({value:" "===e[o-2].type?"*":""})).replace(oe,"$1"),n,r>o&&y(e.slice(o,r)),i>r&&y(e=e.slice(r)),i>r&&d(e))}l.push(n)}return h(l)}function _(e,n){var i=n.length>0,s=e.length>0,a=function(r,a,o,c,u){var l,f,d,p=0,h="0",m=r&&[],g=[],y=O,_=r||s&&w.find.TAG("*",u),b=q+=null==y?1:Math.random()||.1,x=_.length;for(u&&(O=a===R||a||u);h!==x&&null!=(l=_[h]);h++){if(s&&l){for(f=0,a||l.ownerDocument===R||(B(l),o=!L);d=e[f++];)if(d(l,a||R,o)){c.push(l);break}u&&(q=b)}i&&((l=!d&&l)&&p--,r&&m.push(l))}if(p+=h,i&&h!==p){for(f=0;d=n[f++];)d(m,g,a,o);if(r){if(p>0)for(;h--;)m[h]||g[h]||(g[h]=K.call(c));g=v(g)}Y.apply(c,g),u&&!r&&g.length>0&&p+n.length>1&&t.uniqueSort(c)}return u&&(q=b,O=y),m};return i?r(a):a}var b,x,w,k,E,C,T,S,O,A,N,B,R,P,L,I,M,D,j,V="sizzle"+1*new Date,F=e.document,q=0,z=0,H=n(),U=n(),$=n(),Q=function(e,t){return e===t&&(N=!0),0},W=1<<31,J={}.hasOwnProperty,X=[],K=X.pop,G=X.push,Y=X.push,Z=X.slice,ee=function(e,t){for(var n=0,r=e.length;r>n;n++)if(e[n]===t)return n;return-1},te="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",ne="[\\x20\\t\\r\\n\\f]",re="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",ie="\\["+ne+"*("+re+")(?:"+ne+"*([*^$|!~]?=)"+ne+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+re+"))|)"+ne+"*\\]",se=":("+re+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+ie+")*)|.*)\\)|)",ae=new RegExp(ne+"+","g"),oe=new RegExp("^"+ne+"+|((?:^|[^\\\\])(?:\\\\.)*)"+ne+"+$","g"),ce=new RegExp("^"+ne+"*,"+ne+"*"),ue=new RegExp("^"+ne+"*([>+~]|"+ne+")"+ne+"*"),le=new RegExp("="+ne+"*([^\\]'\"]*?)"+ne+"*\\]","g"),fe=new RegExp(se),de=new RegExp("^"+re+"$"),pe={
ID:new RegExp("^#("+re+")"),CLASS:new RegExp("^\\.("+re+")"),TAG:new RegExp("^("+re+"|[*])"),ATTR:new RegExp("^"+ie),PSEUDO:new RegExp("^"+se),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+ne+"*(even|odd|(([+-]|)(\\d*)n|)"+ne+"*(?:([+-]|)"+ne+"*(\\d+)|))"+ne+"*\\)|)","i"),bool:new RegExp("^(?:"+te+")$","i"),needsContext:new RegExp("^"+ne+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+ne+"*((?:-\\d)?\\d*)"+ne+"*\\)|)(?=[^-]|$)","i")},he=/^(?:input|select|textarea|button)$/i,me=/^h\d$/i,ve=/^[^{]+\{\s*\[native \w/,ge=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ye=/[+~]/,_e=/'|\\/g,be=new RegExp("\\\\([\\da-f]{1,6}"+ne+"?|("+ne+")|.)","ig"),xe=function(e,t,n){var r="0x"+t-65536;return r!==r||n?t:0>r?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,1023&r|56320)},we=function(){B()};try{Y.apply(X=Z.call(F.childNodes),F.childNodes),X[F.childNodes.length].nodeType}catch(ke){Y={apply:X.length?function(e,t){G.apply(e,Z.call(t))}:function(e,t){for(var n=e.length,r=0;e[n++]=t[r++];);e.length=n-1}}}x=t.support={},E=t.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1},B=t.setDocument=function(e){var t,n,r=e?e.ownerDocument||e:F;return r!==R&&9===r.nodeType&&r.documentElement?(R=r,P=R.documentElement,L=!E(R),(n=R.defaultView)&&n.top!==n&&(n.addEventListener?n.addEventListener("unload",we,!1):n.attachEvent&&n.attachEvent("onunload",we)),x.attributes=i(function(e){return e.className="i",!e.getAttribute("className")}),x.getElementsByTagName=i(function(e){return e.appendChild(R.createComment("")),!e.getElementsByTagName("*").length}),x.getElementsByClassName=ve.test(R.getElementsByClassName),x.getById=i(function(e){return P.appendChild(e).id=V,!R.getElementsByName||!R.getElementsByName(V).length}),x.getById?(w.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&L){var n=t.getElementById(e);return n?[n]:[]}},w.filter.ID=function(e){var t=e.replace(be,xe);return function(e){return e.getAttribute("id")===t}}):(delete w.find.ID,w.filter.ID=function(e){var t=e.replace(be,xe);return function(e){var n="undefined"!=typeof e.getAttributeNode&&e.getAttributeNode("id");return n&&n.value===t}}),w.find.TAG=x.getElementsByTagName?function(e,t){return"undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e):x.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,r=[],i=0,s=t.getElementsByTagName(e);if("*"===e){for(;n=s[i++];)1===n.nodeType&&r.push(n);return r}return s},w.find.CLASS=x.getElementsByClassName&&function(e,t){return"undefined"!=typeof t.getElementsByClassName&&L?t.getElementsByClassName(e):void 0},M=[],I=[],(x.qsa=ve.test(R.querySelectorAll))&&(i(function(e){P.appendChild(e).innerHTML="<a id='"+V+"'></a><select id='"+V+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&I.push("[*^$]="+ne+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||I.push("\\["+ne+"*(?:value|"+te+")"),e.querySelectorAll("[id~="+V+"-]").length||I.push("~="),e.querySelectorAll(":checked").length||I.push(":checked"),e.querySelectorAll("a#"+V+"+*").length||I.push(".#.+[+~]")}),i(function(e){var t=R.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&I.push("name"+ne+"*[*^$|!~]?="),e.querySelectorAll(":enabled").length||I.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),I.push(",.*:")})),(x.matchesSelector=ve.test(D=P.matches||P.webkitMatchesSelector||P.mozMatchesSelector||P.oMatchesSelector||P.msMatchesSelector))&&i(function(e){x.disconnectedMatch=D.call(e,"div"),D.call(e,"[s!='']:x"),M.push("!=",se)}),I=I.length&&new RegExp(I.join("|")),M=M.length&&new RegExp(M.join("|")),t=ve.test(P.compareDocumentPosition),j=t||ve.test(P.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},Q=t?function(e,t){if(e===t)return N=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n?n:(n=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1,1&n||!x.sortDetached&&t.compareDocumentPosition(e)===n?e===R||e.ownerDocument===F&&j(F,e)?-1:t===R||t.ownerDocument===F&&j(F,t)?1:A?ee(A,e)-ee(A,t):0:4&n?-1:1)}:function(e,t){if(e===t)return N=!0,0;var n,r=0,i=e.parentNode,s=t.parentNode,o=[e],c=[t];if(!i||!s)return e===R?-1:t===R?1:i?-1:s?1:A?ee(A,e)-ee(A,t):0;if(i===s)return a(e,t);for(n=e;n=n.parentNode;)o.unshift(n);for(n=t;n=n.parentNode;)c.unshift(n);for(;o[r]===c[r];)r++;return r?a(o[r],c[r]):o[r]===F?-1:c[r]===F?1:0},R):R},t.matches=function(e,n){return t(e,null,null,n)},t.matchesSelector=function(e,n){if((e.ownerDocument||e)!==R&&B(e),n=n.replace(le,"='$1']"),x.matchesSelector&&L&&!$[n+" "]&&(!M||!M.test(n))&&(!I||!I.test(n)))try{var r=D.call(e,n);if(r||x.disconnectedMatch||e.document&&11!==e.document.nodeType)return r}catch(i){}return t(n,R,null,[e]).length>0},t.contains=function(e,t){return(e.ownerDocument||e)!==R&&B(e),j(e,t)},t.attr=function(e,t){(e.ownerDocument||e)!==R&&B(e);var n=w.attrHandle[t.toLowerCase()],r=n&&J.call(w.attrHandle,t.toLowerCase())?n(e,t,!L):void 0;return void 0!==r?r:x.attributes||!L?e.getAttribute(t):(r=e.getAttributeNode(t))&&r.specified?r.value:null},t.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},t.uniqueSort=function(e){var t,n=[],r=0,i=0;if(N=!x.detectDuplicates,A=!x.sortStable&&e.slice(0),e.sort(Q),N){for(;t=e[i++];)t===e[i]&&(r=n.push(i));for(;r--;)e.splice(n[r],1)}return A=null,e},k=t.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=k(e)}else if(3===i||4===i)return e.nodeValue}else for(;t=e[r++];)n+=k(t);return n},w=t.selectors={cacheLength:50,createPseudo:r,match:pe,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(be,xe),e[3]=(e[3]||e[4]||e[5]||"").replace(be,xe),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||t.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&t.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return pe.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&fe.test(n)&&(t=C(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(be,xe).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=H[e+" "];return t||(t=new RegExp("(^|"+ne+")"+e+"("+ne+"|$)"))&&H(e,function(e){return t.test("string"==typeof e.className&&e.className||"undefined"!=typeof e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(e,n,r){return function(i){var s=t.attr(i,e);return null==s?"!="===n:n?(s+="","="===n?s===r:"!="===n?s!==r:"^="===n?r&&0===s.indexOf(r):"*="===n?r&&s.indexOf(r)>-1:"$="===n?r&&s.slice(-r.length)===r:"~="===n?(" "+s.replace(ae," ")+" ").indexOf(r)>-1:"|="===n?s===r||s.slice(0,r.length+1)===r+"-":!1):!0}},CHILD:function(e,t,n,r,i){var s="nth"!==e.slice(0,3),a="last"!==e.slice(-4),o="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,c){var u,l,f,d,p,h,m=s!==a?"nextSibling":"previousSibling",v=t.parentNode,g=o&&t.nodeName.toLowerCase(),y=!c&&!o,_=!1;if(v){if(s){for(;m;){for(d=t;d=d[m];)if(o?d.nodeName.toLowerCase()===g:1===d.nodeType)return!1;h=m="only"===e&&!h&&"nextSibling"}return!0}if(h=[a?v.firstChild:v.lastChild],a&&y){for(d=v,f=d[V]||(d[V]={}),l=f[d.uniqueID]||(f[d.uniqueID]={}),u=l[e]||[],p=u[0]===q&&u[1],_=p&&u[2],d=p&&v.childNodes[p];d=++p&&d&&d[m]||(_=p=0)||h.pop();)if(1===d.nodeType&&++_&&d===t){l[e]=[q,p,_];break}}else if(y&&(d=t,f=d[V]||(d[V]={}),l=f[d.uniqueID]||(f[d.uniqueID]={}),u=l[e]||[],p=u[0]===q&&u[1],_=p),_===!1)for(;(d=++p&&d&&d[m]||(_=p=0)||h.pop())&&((o?d.nodeName.toLowerCase()!==g:1!==d.nodeType)||!++_||(y&&(f=d[V]||(d[V]={}),l=f[d.uniqueID]||(f[d.uniqueID]={}),l[e]=[q,_]),d!==t)););return _-=i,_===r||_%r===0&&_/r>=0}}},PSEUDO:function(e,n){var i,s=w.pseudos[e]||w.setFilters[e.toLowerCase()]||t.error("unsupported pseudo: "+e);return s[V]?s(n):s.length>1?(i=[e,e,"",n],w.setFilters.hasOwnProperty(e.toLowerCase())?r(function(e,t){for(var r,i=s(e,n),a=i.length;a--;)r=ee(e,i[a]),e[r]=!(t[r]=i[a])}):function(e){return s(e,0,i)}):s}},pseudos:{not:r(function(e){var t=[],n=[],i=T(e.replace(oe,"$1"));return i[V]?r(function(e,t,n,r){for(var s,a=i(e,null,r,[]),o=e.length;o--;)(s=a[o])&&(e[o]=!(t[o]=s))}):function(e,r,s){return t[0]=e,i(t,null,s,n),t[0]=null,!n.pop()}}),has:r(function(e){return function(n){return t(e,n).length>0}}),contains:r(function(e){return e=e.replace(be,xe),function(t){return(t.textContent||t.innerText||k(t)).indexOf(e)>-1}}),lang:r(function(e){return de.test(e||"")||t.error("unsupported lang: "+e),e=e.replace(be,xe).toLowerCase(),function(t){var n;do if(n=L?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return n=n.toLowerCase(),n===e||0===n.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===P},focus:function(e){return e===R.activeElement&&(!R.hasFocus||R.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!w.pseudos.empty(e)},header:function(e){return me.test(e.nodeName)},input:function(e){return he.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:u(function(){return[0]}),last:u(function(e,t){return[t-1]}),eq:u(function(e,t,n){return[0>n?n+t:n]}),even:u(function(e,t){for(var n=0;t>n;n+=2)e.push(n);return e}),odd:u(function(e,t){for(var n=1;t>n;n+=2)e.push(n);return e}),lt:u(function(e,t,n){for(var r=0>n?n+t:n;--r>=0;)e.push(r);return e}),gt:u(function(e,t,n){for(var r=0>n?n+t:n;++r<t;)e.push(r);return e})}},w.pseudos.nth=w.pseudos.eq;for(b in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})w.pseudos[b]=o(b);for(b in{submit:!0,reset:!0})w.pseudos[b]=c(b);return f.prototype=w.filters=w.pseudos,w.setFilters=new f,C=t.tokenize=function(e,n){var r,i,s,a,o,c,u,l=U[e+" "];if(l)return n?0:l.slice(0);for(o=e,c=[],u=w.preFilter;o;){(!r||(i=ce.exec(o)))&&(i&&(o=o.slice(i[0].length)||o),c.push(s=[])),r=!1,(i=ue.exec(o))&&(r=i.shift(),s.push({value:r,type:i[0].replace(oe," ")}),o=o.slice(r.length));for(a in w.filter)!(i=pe[a].exec(o))||u[a]&&!(i=u[a](i))||(r=i.shift(),s.push({value:r,type:a,matches:i}),o=o.slice(r.length));if(!r)break}return n?o.length:o?t.error(e):U(e,c).slice(0)},T=t.compile=function(e,t){var n,r=[],i=[],s=$[e+" "];if(!s){for(t||(t=C(e)),n=t.length;n--;)s=y(t[n]),s[V]?r.push(s):i.push(s);s=$(e,_(i,r)),s.selector=e}return s},S=t.select=function(e,t,n,r){var i,s,a,o,c,u="function"==typeof e&&e,f=!r&&C(e=u.selector||e);if(n=n||[],1===f.length){if(s=f[0]=f[0].slice(0),s.length>2&&"ID"===(a=s[0]).type&&x.getById&&9===t.nodeType&&L&&w.relative[s[1].type]){if(t=(w.find.ID(a.matches[0].replace(be,xe),t)||[])[0],!t)return n;u&&(t=t.parentNode),e=e.slice(s.shift().value.length)}for(i=pe.needsContext.test(e)?0:s.length;i--&&(a=s[i],!w.relative[o=a.type]);)if((c=w.find[o])&&(r=c(a.matches[0].replace(be,xe),ye.test(s[0].type)&&l(t.parentNode)||t))){if(s.splice(i,1),e=r.length&&d(s),!e)return Y.apply(n,r),n;break}}return(u||T(e,f))(r,t,!L,n,!t||ye.test(e)&&l(t.parentNode)||t),n},x.sortStable=V.split("").sort(Q).join("")===V,x.detectDuplicates=!!N,B(),x.sortDetached=i(function(e){return 1&e.compareDocumentPosition(R.createElement("div"))}),i(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||s("type|href|height|width",function(e,t,n){return n?void 0:e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),x.attributes&&i(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||s("value",function(e,t,n){return n||"input"!==e.nodeName.toLowerCase()?void 0:e.defaultValue}),i(function(e){return null==e.getAttribute("disabled")})||s(te,function(e,t,n){var r;return n?void 0:e[t]===!0?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),t}(e);pe.find=ye,pe.expr=ye.selectors,pe.expr[":"]=pe.expr.pseudos,pe.uniqueSort=pe.unique=ye.uniqueSort,pe.text=ye.getText,pe.isXMLDoc=ye.isXML,pe.contains=ye.contains;var _e=function(e,t,n){for(var r=[],i=void 0!==n;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(i&&pe(e).is(n))break;r.push(e)}return r},be=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},xe=pe.expr.match.needsContext,we=/^<([\w-]+)\s*\/?>(?:<\/\1>|)$/,ke=/^.[^:#\[\.,]*$/;pe.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?pe.find.matchesSelector(r,e)?[r]:[]:pe.find.matches(e,pe.grep(t,function(e){return 1===e.nodeType}))},pe.fn.extend({find:function(e){var t,n=[],r=this,i=r.length;if("string"!=typeof e)return this.pushStack(pe(e).filter(function(){for(t=0;i>t;t++)if(pe.contains(r[t],this))return!0}));for(t=0;i>t;t++)pe.find(e,r[t],n);return n=this.pushStack(i>1?pe.unique(n):n),n.selector=this.selector?this.selector+" "+e:e,n},filter:function(e){return this.pushStack(r(this,e||[],!1))},not:function(e){return this.pushStack(r(this,e||[],!0))},is:function(e){return!!r(this,"string"==typeof e&&xe.test(e)?pe(e):e||[],!1).length}});var Ee,Ce=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,Te=pe.fn.init=function(e,t,n){var r,i;if(!e)return this;if(n=n||Ee,"string"==typeof e){if(r="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:Ce.exec(e),!r||!r[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof pe?t[0]:t,pe.merge(this,pe.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:re,!0)),we.test(r[1])&&pe.isPlainObject(t))for(r in t)pe.isFunction(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}if(i=re.getElementById(r[2]),i&&i.parentNode){if(i.id!==r[2])return Ee.find(e);this.length=1,this[0]=i}return this.context=re,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):pe.isFunction(e)?"undefined"!=typeof n.ready?n.ready(e):e(pe):(void 0!==e.selector&&(this.selector=e.selector,this.context=e.context),pe.makeArray(e,this))};Te.prototype=pe.fn,Ee=pe(re);var Se=/^(?:parents|prev(?:Until|All))/,Oe={children:!0,contents:!0,next:!0,prev:!0};pe.fn.extend({has:function(e){var t,n=pe(e,this),r=n.length;return this.filter(function(){for(t=0;r>t;t++)if(pe.contains(this,n[t]))return!0})},closest:function(e,t){for(var n,r=0,i=this.length,s=[],a=xe.test(e)||"string"!=typeof e?pe(e,t||this.context):0;i>r;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(a?a.index(n)>-1:1===n.nodeType&&pe.find.matchesSelector(n,e))){s.push(n);break}return this.pushStack(s.length>1?pe.uniqueSort(s):s)},index:function(e){return e?"string"==typeof e?pe.inArray(this[0],pe(e)):pe.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(pe.uniqueSort(pe.merge(this.get(),pe(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),pe.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return _e(e,"parentNode")},parentsUntil:function(e,t,n){return _e(e,"parentNode",n)},next:function(e){return i(e,"nextSibling")},prev:function(e){return i(e,"previousSibling")},nextAll:function(e){return _e(e,"nextSibling")},prevAll:function(e){return _e(e,"previousSibling")},nextUntil:function(e,t,n){return _e(e,"nextSibling",n)},prevUntil:function(e,t,n){return _e(e,"previousSibling",n)},siblings:function(e){return be((e.parentNode||{}).firstChild,e)},children:function(e){return be(e.firstChild)},contents:function(e){return pe.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:pe.merge([],e.childNodes)}},function(e,t){pe.fn[e]=function(n,r){var i=pe.map(this,t,n);return"Until"!==e.slice(-5)&&(r=n),r&&"string"==typeof r&&(i=pe.filter(r,i)),this.length>1&&(Oe[e]||(i=pe.uniqueSort(i)),Se.test(e)&&(i=i.reverse())),this.pushStack(i)}});var Ae=/\S+/g;pe.Callbacks=function(e){e="string"==typeof e?s(e):pe.extend({},e);var t,n,r,i,a=[],o=[],c=-1,u=function(){for(i=e.once,r=t=!0;o.length;c=-1)for(n=o.shift();++c<a.length;)a[c].apply(n[0],n[1])===!1&&e.stopOnFalse&&(c=a.length,n=!1);e.memory||(n=!1),t=!1,i&&(a=n?[]:"")},l={add:function(){return a&&(n&&!t&&(c=a.length-1,o.push(n)),function r(t){pe.each(t,function(t,n){pe.isFunction(n)?e.unique&&l.has(n)||a.push(n):n&&n.length&&"string"!==pe.type(n)&&r(n)})}(arguments),n&&!t&&u()),this},remove:function(){return pe.each(arguments,function(e,t){for(var n;(n=pe.inArray(t,a,n))>-1;)a.splice(n,1),c>=n&&c--}),this},has:function(e){return e?pe.inArray(e,a)>-1:a.length>0},empty:function(){return a&&(a=[]),this},disable:function(){return i=o=[],a=n="",this},disabled:function(){return!a},lock:function(){return i=!0,n||l.disable(),this},locked:function(){return!!i},fireWith:function(e,n){return i||(n=n||[],n=[e,n.slice?n.slice():n],o.push(n),t||u()),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!r}};return l},pe.extend({Deferred:function(e){var t=[["resolve","done",pe.Callbacks("once memory"),"resolved"],["reject","fail",pe.Callbacks("once memory"),"rejected"],["notify","progress",pe.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return pe.Deferred(function(n){pe.each(t,function(t,s){var a=pe.isFunction(e[t])&&e[t];i[s[1]](function(){var e=a&&a.apply(this,arguments);e&&pe.isFunction(e.promise)?e.promise().progress(n.notify).done(n.resolve).fail(n.reject):n[s[0]+"With"](this===r?n.promise():this,a?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?pe.extend(e,r):r}},i={};return r.pipe=r.then,pe.each(t,function(e,s){var a=s[2],o=s[3];r[s[1]]=a.add,o&&a.add(function(){n=o},t[1^e][2].disable,t[2][2].lock),i[s[0]]=function(){return i[s[0]+"With"](this===i?r:this,arguments),this},i[s[0]+"With"]=a.fireWith}),r.promise(i),e&&e.call(i,i),i},when:function(e){var t,n,r,i=0,s=ie.call(arguments),a=s.length,o=1!==a||e&&pe.isFunction(e.promise)?a:0,c=1===o?e:pe.Deferred(),u=function(e,n,r){return function(i){n[e]=this,r[e]=arguments.length>1?ie.call(arguments):i,r===t?c.notifyWith(n,r):--o||c.resolveWith(n,r)}};if(a>1)for(t=new Array(a),n=new Array(a),r=new Array(a);a>i;i++)s[i]&&pe.isFunction(s[i].promise)?s[i].promise().progress(u(i,n,t)).done(u(i,r,s)).fail(c.reject):--o;return o||c.resolveWith(r,s),c.promise()}});var Ne;pe.fn.ready=function(e){return pe.ready.promise().done(e),this},pe.extend({isReady:!1,readyWait:1,holdReady:function(e){e?pe.readyWait++:pe.ready(!0)},ready:function(e){(e===!0?--pe.readyWait:pe.isReady)||(pe.isReady=!0,e!==!0&&--pe.readyWait>0||(Ne.resolveWith(re,[pe]),pe.fn.triggerHandler&&(pe(re).triggerHandler("ready"),pe(re).off("ready"))))}}),pe.ready.promise=function(t){if(!Ne)if(Ne=pe.Deferred(),"complete"===re.readyState)e.setTimeout(pe.ready);else if(re.addEventListener)re.addEventListener("DOMContentLoaded",o),e.addEventListener("load",o);else{re.attachEvent("onreadystatechange",o),e.attachEvent("onload",o);var n=!1;try{n=null==e.frameElement&&re.documentElement}catch(r){}n&&n.doScroll&&!function i(){if(!pe.isReady){try{n.doScroll("left")}catch(t){return e.setTimeout(i,50)}a(),pe.ready()}}()}return Ne.promise(t)},pe.ready.promise();var Be;for(Be in pe(fe))break;fe.ownFirst="0"===Be,fe.inlineBlockNeedsLayout=!1,pe(function(){var e,t,n,r;n=re.getElementsByTagName("body")[0],n&&n.style&&(t=re.createElement("div"),r=re.createElement("div"),r.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",n.appendChild(r).appendChild(t),"undefined"!=typeof t.style.zoom&&(t.style.cssText="display:inline;margin:0;border:0;padding:1px;width:1px;zoom:1",fe.inlineBlockNeedsLayout=e=3===t.offsetWidth,e&&(n.style.zoom=1)),n.removeChild(r))}),function(){var e=re.createElement("div");fe.deleteExpando=!0;try{delete e.test}catch(t){fe.deleteExpando=!1}e=null}();var Re=function(e){var t=pe.noData[(e.nodeName+" ").toLowerCase()],n=+e.nodeType||1;return 1!==n&&9!==n?!1:!t||t!==!0&&e.getAttribute("classid")===t},Pe=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Le=/([A-Z])/g;pe.extend({cache:{},noData:{"applet ":!0,"embed ":!0,"object ":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(e){return e=e.nodeType?pe.cache[e[pe.expando]]:e[pe.expando],!!e&&!u(e)},data:function(e,t,n){return l(e,t,n)},removeData:function(e,t){return f(e,t)},_data:function(e,t,n){return l(e,t,n,!0)},_removeData:function(e,t){return f(e,t,!0)}}),pe.fn.extend({data:function(e,t){var n,r,i,s=this[0],a=s&&s.attributes;if(void 0===e){if(this.length&&(i=pe.data(s),1===s.nodeType&&!pe._data(s,"parsedAttrs"))){for(n=a.length;n--;)a[n]&&(r=a[n].name,0===r.indexOf("data-")&&(r=pe.camelCase(r.slice(5)),c(s,r,i[r])));pe._data(s,"parsedAttrs",!0)}return i}return"object"==typeof e?this.each(function(){pe.data(this,e)}):arguments.length>1?this.each(function(){pe.data(this,e,t)}):s?c(s,e,pe.data(s,e)):void 0},removeData:function(e){return this.each(function(){pe.removeData(this,e)})}}),pe.extend({queue:function(e,t,n){var r;return e?(t=(t||"fx")+"queue",r=pe._data(e,t),n&&(!r||pe.isArray(n)?r=pe._data(e,t,pe.makeArray(n)):r.push(n)),r||[]):void 0},dequeue:function(e,t){t=t||"fx";var n=pe.queue(e,t),r=n.length,i=n.shift(),s=pe._queueHooks(e,t),a=function(){pe.dequeue(e,t)};"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete s.stop,i.call(e,a,s)),!r&&s&&s.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return pe._data(e,n)||pe._data(e,n,{empty:pe.Callbacks("once memory").add(function(){pe._removeData(e,t+"queue"),pe._removeData(e,n)})})}}),pe.fn.extend({queue:function(e,t){var n=2;return"string"!=typeof e&&(t=e,e="fx",n--),arguments.length<n?pe.queue(this[0],e):void 0===t?this:this.each(function(){var n=pe.queue(this,e,t);pe._queueHooks(this,e),"fx"===e&&"inprogress"!==n[0]&&pe.dequeue(this,e)})},dequeue:function(e){return this.each(function(){pe.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=pe.Deferred(),s=this,a=this.length,o=function(){--r||i.resolveWith(s,[s])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";a--;)n=pe._data(s[a],e+"queueHooks"),n&&n.empty&&(r++,n.empty.add(o));return o(),i.promise(t)}}),function(){var e;fe.shrinkWrapBlocks=function(){if(null!=e)return e;e=!1;var t,n,r;return n=re.getElementsByTagName("body")[0],n&&n.style?(t=re.createElement("div"),r=re.createElement("div"),r.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",n.appendChild(r).appendChild(t),"undefined"!=typeof t.style.zoom&&(t.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:1px;width:1px;zoom:1",t.appendChild(re.createElement("div")).style.width="5px",e=3!==t.offsetWidth),n.removeChild(r),e):void 0}}();var Ie=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Me=new RegExp("^(?:([+-])=|)("+Ie+")([a-z%]*)$","i"),De=["Top","Right","Bottom","Left"],je=function(e,t){return e=t||e,"none"===pe.css(e,"display")||!pe.contains(e.ownerDocument,e)},Ve=function(e,t,n,r,i,s,a){var o=0,c=e.length,u=null==n;if("object"===pe.type(n)){i=!0;for(o in n)Ve(e,t,o,n[o],!0,s,a)}else if(void 0!==r&&(i=!0,pe.isFunction(r)||(a=!0),u&&(a?(t.call(e,r),t=null):(u=t,t=function(e,t,n){return u.call(pe(e),n)})),t))for(;c>o;o++)t(e[o],n,a?r:r.call(e[o],o,t(e[o],n)));return i?e:u?t.call(e):c?t(e[0],n):s},Fe=/^(?:checkbox|radio)$/i,qe=/<([\w:-]+)/,ze=/^$|\/(?:java|ecma)script/i,He=/^\s+/,Ue="abbr|article|aside|audio|bdi|canvas|data|datalist|details|dialog|figcaption|figure|footer|header|hgroup|main|mark|meter|nav|output|picture|progress|section|summary|template|time|video";!function(){var e=re.createElement("div"),t=re.createDocumentFragment(),n=re.createElement("input");e.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",fe.leadingWhitespace=3===e.firstChild.nodeType,fe.tbody=!e.getElementsByTagName("tbody").length,fe.htmlSerialize=!!e.getElementsByTagName("link").length,fe.html5Clone="<:nav></:nav>"!==re.createElement("nav").cloneNode(!0).outerHTML,n.type="checkbox",n.checked=!0,t.appendChild(n),fe.appendChecked=n.checked,e.innerHTML="<textarea>x</textarea>",fe.noCloneChecked=!!e.cloneNode(!0).lastChild.defaultValue,t.appendChild(e),n=re.createElement("input"),n.setAttribute("type","radio"),n.setAttribute("checked","checked"),n.setAttribute("name","t"),e.appendChild(n),fe.checkClone=e.cloneNode(!0).cloneNode(!0).lastChild.checked,fe.noCloneEvent=!!e.addEventListener,e[pe.expando]=1,fe.attributes=!e.getAttribute(pe.expando)}();var $e={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:fe.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]};$e.optgroup=$e.option,$e.tbody=$e.tfoot=$e.colgroup=$e.caption=$e.thead,$e.th=$e.td;var Qe=/<|&#?\w+;/,We=/<tbody/i;!function(){var t,n,r=re.createElement("div");for(t in{submit:!0,change:!0,focusin:!0})n="on"+t,(fe[t]=n in e)||(r.setAttribute(n,"t"),fe[t]=r.attributes[n].expando===!1);r=null}();var Je=/^(?:input|select|textarea)$/i,Xe=/^key/,Ke=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Ge=/^(?:focusinfocus|focusoutblur)$/,Ye=/^([^.]*)(?:\.(.+)|)/;pe.event={global:{},add:function(e,t,n,r,i){var s,a,o,c,u,l,f,d,p,h,m,v=pe._data(e);if(v){for(n.handler&&(c=n,n=c.handler,i=c.selector),n.guid||(n.guid=pe.guid++),(a=v.events)||(a=v.events={}),(l=v.handle)||(l=v.handle=function(e){return"undefined"==typeof pe||e&&pe.event.triggered===e.type?void 0:pe.event.dispatch.apply(l.elem,arguments)},l.elem=e),t=(t||"").match(Ae)||[""],o=t.length;o--;)s=Ye.exec(t[o])||[],p=m=s[1],h=(s[2]||"").split(".").sort(),p&&(u=pe.event.special[p]||{},p=(i?u.delegateType:u.bindType)||p,u=pe.event.special[p]||{},f=pe.extend({type:p,origType:m,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&pe.expr.match.needsContext.test(i),namespace:h.join(".")},c),(d=a[p])||(d=a[p]=[],d.delegateCount=0,u.setup&&u.setup.call(e,r,h,l)!==!1||(e.addEventListener?e.addEventListener(p,l,!1):e.attachEvent&&e.attachEvent("on"+p,l))),u.add&&(u.add.call(e,f),f.handler.guid||(f.handler.guid=n.guid)),i?d.splice(d.delegateCount++,0,f):d.push(f),pe.event.global[p]=!0);e=null}},remove:function(e,t,n,r,i){var s,a,o,c,u,l,f,d,p,h,m,v=pe.hasData(e)&&pe._data(e);if(v&&(l=v.events)){for(t=(t||"").match(Ae)||[""],u=t.length;u--;)if(o=Ye.exec(t[u])||[],p=m=o[1],h=(o[2]||"").split(".").sort(),p){for(f=pe.event.special[p]||{},p=(r?f.delegateType:f.bindType)||p,d=l[p]||[],o=o[2]&&new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),c=s=d.length;s--;)a=d[s],!i&&m!==a.origType||n&&n.guid!==a.guid||o&&!o.test(a.namespace)||r&&r!==a.selector&&("**"!==r||!a.selector)||(d.splice(s,1),a.selector&&d.delegateCount--,f.remove&&f.remove.call(e,a));c&&!d.length&&(f.teardown&&f.teardown.call(e,h,v.handle)!==!1||pe.removeEvent(e,p,v.handle),delete l[p])}else for(p in l)pe.event.remove(e,p+t[u],n,r,!0);pe.isEmptyObject(l)&&(delete v.handle,pe._removeData(e,"events"))}},trigger:function(t,n,r,i){var s,a,o,c,u,l,f,d=[r||re],p=le.call(t,"type")?t.type:t,h=le.call(t,"namespace")?t.namespace.split("."):[];if(o=l=r=r||re,3!==r.nodeType&&8!==r.nodeType&&!Ge.test(p+pe.event.triggered)&&(p.indexOf(".")>-1&&(h=p.split("."),p=h.shift(),h.sort()),a=p.indexOf(":")<0&&"on"+p,t=t[pe.expando]?t:new pe.Event(p,"object"==typeof t&&t),t.isTrigger=i?2:3,t.namespace=h.join("."),t.rnamespace=t.namespace?new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=r),n=null==n?[t]:pe.makeArray(n,[t]),u=pe.event.special[p]||{},i||!u.trigger||u.trigger.apply(r,n)!==!1)){if(!i&&!u.noBubble&&!pe.isWindow(r)){for(c=u.delegateType||p,Ge.test(c+p)||(o=o.parentNode);o;o=o.parentNode)d.push(o),l=o;l===(r.ownerDocument||re)&&d.push(l.defaultView||l.parentWindow||e)}for(f=0;(o=d[f++])&&!t.isPropagationStopped();)t.type=f>1?c:u.bindType||p,s=(pe._data(o,"events")||{})[t.type]&&pe._data(o,"handle"),s&&s.apply(o,n),s=a&&o[a],s&&s.apply&&Re(o)&&(t.result=s.apply(o,n),t.result===!1&&t.preventDefault());if(t.type=p,!i&&!t.isDefaultPrevented()&&(!u._default||u._default.apply(d.pop(),n)===!1)&&Re(r)&&a&&r[p]&&!pe.isWindow(r)){l=r[a],l&&(r[a]=null),pe.event.triggered=p;try{r[p]()}catch(m){}pe.event.triggered=void 0,l&&(r[a]=l)}return t.result}},dispatch:function(e){e=pe.event.fix(e);var t,n,r,i,s,a=[],o=ie.call(arguments),c=(pe._data(this,"events")||{})[e.type]||[],u=pe.event.special[e.type]||{};if(o[0]=e,e.delegateTarget=this,!u.preDispatch||u.preDispatch.call(this,e)!==!1){for(a=pe.event.handlers.call(this,e,c),t=0;(i=a[t++])&&!e.isPropagationStopped();)for(e.currentTarget=i.elem,n=0;(s=i.handlers[n++])&&!e.isImmediatePropagationStopped();)(!e.rnamespace||e.rnamespace.test(s.namespace))&&(e.handleObj=s,e.data=s.data,r=((pe.event.special[s.origType]||{}).handle||s.handler).apply(i.elem,o),void 0!==r&&(e.result=r)===!1&&(e.preventDefault(),e.stopPropagation()));return u.postDispatch&&u.postDispatch.call(this,e),e.result}},handlers:function(e,t){var n,r,i,s,a=[],o=t.delegateCount,c=e.target;if(o&&c.nodeType&&("click"!==e.type||isNaN(e.button)||e.button<1))for(;c!=this;c=c.parentNode||this)if(1===c.nodeType&&(c.disabled!==!0||"click"!==e.type)){for(r=[],n=0;o>n;n++)s=t[n],i=s.selector+" ",void 0===r[i]&&(r[i]=s.needsContext?pe(i,this).index(c)>-1:pe.find(i,this,null,[c]).length),r[i]&&r.push(s);r.length&&a.push({elem:c,handlers:r})}return o<t.length&&a.push({elem:this,handlers:t.slice(o)}),a},fix:function(e){if(e[pe.expando])return e;var t,n,r,i=e.type,s=e,a=this.fixHooks[i];for(a||(this.fixHooks[i]=a=Ke.test(i)?this.mouseHooks:Xe.test(i)?this.keyHooks:{}),r=a.props?this.props.concat(a.props):this.props,e=new pe.Event(s),t=r.length;t--;)n=r[t],e[n]=s[n];return e.target||(e.target=s.srcElement||re),3===e.target.nodeType&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,a.filter?a.filter(e,s):e},props:"altKey bubbles cancelable ctrlKey currentTarget detail eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var n,r,i,s=t.button,a=t.fromElement;return null==e.pageX&&null!=t.clientX&&(r=e.target.ownerDocument||re,i=r.documentElement,n=r.body,e.pageX=t.clientX+(i&&i.scrollLeft||n&&n.scrollLeft||0)-(i&&i.clientLeft||n&&n.clientLeft||0),e.pageY=t.clientY+(i&&i.scrollTop||n&&n.scrollTop||0)-(i&&i.clientTop||n&&n.clientTop||0)),
!e.relatedTarget&&a&&(e.relatedTarget=a===e.target?t.toElement:a),e.which||void 0===s||(e.which=1&s?1:2&s?3:4&s?2:0),e}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==b()&&this.focus)try{return this.focus(),!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){return this===b()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return pe.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):void 0},_default:function(e){return pe.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n){var r=pe.extend(new pe.Event,n,{type:e,isSimulated:!0});pe.event.trigger(r,null,t),r.isDefaultPrevented()&&n.preventDefault()}},pe.removeEvent=re.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)}:function(e,t,n){var r="on"+t;e.detachEvent&&("undefined"==typeof e[r]&&(e[r]=null),e.detachEvent(r,n))},pe.Event=function(e,t){return this instanceof pe.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&e.returnValue===!1?y:_):this.type=e,t&&pe.extend(this,t),this.timeStamp=e&&e.timeStamp||pe.now(),void(this[pe.expando]=!0)):new pe.Event(e,t)},pe.Event.prototype={constructor:pe.Event,isDefaultPrevented:_,isPropagationStopped:_,isImmediatePropagationStopped:_,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=y,e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=y,e&&!this.isSimulated&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=y,e&&e.stopImmediatePropagation&&e.stopImmediatePropagation(),this.stopPropagation()}},pe.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){pe.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,s=e.handleObj;return(!i||i!==r&&!pe.contains(r,i))&&(e.type=s.origType,n=s.handler.apply(this,arguments),e.type=t),n}}}),fe.submit||(pe.event.special.submit={setup:function(){return pe.nodeName(this,"form")?!1:void pe.event.add(this,"click._submit keypress._submit",function(e){var t=e.target,n=pe.nodeName(t,"input")||pe.nodeName(t,"button")?pe.prop(t,"form"):void 0;n&&!pe._data(n,"submit")&&(pe.event.add(n,"submit._submit",function(e){e._submitBubble=!0}),pe._data(n,"submit",!0))})},postDispatch:function(e){e._submitBubble&&(delete e._submitBubble,this.parentNode&&!e.isTrigger&&pe.event.simulate("submit",this.parentNode,e))},teardown:function(){return pe.nodeName(this,"form")?!1:void pe.event.remove(this,"._submit")}}),fe.change||(pe.event.special.change={setup:function(){return Je.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(pe.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._justChanged=!0)}),pe.event.add(this,"click._change",function(e){this._justChanged&&!e.isTrigger&&(this._justChanged=!1),pe.event.simulate("change",this,e)})),!1):void pe.event.add(this,"beforeactivate._change",function(e){var t=e.target;Je.test(t.nodeName)&&!pe._data(t,"change")&&(pe.event.add(t,"change._change",function(e){!this.parentNode||e.isSimulated||e.isTrigger||pe.event.simulate("change",this.parentNode,e)}),pe._data(t,"change",!0))})},handle:function(e){var t=e.target;return this!==t||e.isSimulated||e.isTrigger||"radio"!==t.type&&"checkbox"!==t.type?e.handleObj.handler.apply(this,arguments):void 0},teardown:function(){return pe.event.remove(this,"._change"),!Je.test(this.nodeName)}}),fe.focusin||pe.each({focus:"focusin",blur:"focusout"},function(e,t){var n=function(e){pe.event.simulate(t,e.target,pe.event.fix(e))};pe.event.special[t]={setup:function(){var r=this.ownerDocument||this,i=pe._data(r,t);i||r.addEventListener(e,n,!0),pe._data(r,t,(i||0)+1)},teardown:function(){var r=this.ownerDocument||this,i=pe._data(r,t)-1;i?pe._data(r,t,i):(r.removeEventListener(e,n,!0),pe._removeData(r,t))}}}),pe.fn.extend({on:function(e,t,n,r){return x(this,e,t,n,r)},one:function(e,t,n,r){return x(this,e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,pe(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(i in e)this.off(i,t,e[i]);return this}return(t===!1||"function"==typeof t)&&(n=t,t=void 0),n===!1&&(n=_),this.each(function(){pe.event.remove(this,e,n,t)})},trigger:function(e,t){return this.each(function(){pe.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];return n?pe.event.trigger(e,t,n,!0):void 0}});var Ze=/ jQuery\d+="(?:null|\d+)"/g,et=new RegExp("<(?:"+Ue+")[\\s/>]","i"),tt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:-]+)[^>]*)\/>/gi,nt=/<script|<style|<link/i,rt=/checked\s*(?:[^=]|=\s*.checked.)/i,it=/^true\/(.*)/,st=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,at=p(re),ot=at.appendChild(re.createElement("div"));pe.extend({htmlPrefilter:function(e){return e.replace(tt,"<$1></$2>")},clone:function(e,t,n){var r,i,s,a,o,c=pe.contains(e.ownerDocument,e);if(fe.html5Clone||pe.isXMLDoc(e)||!et.test("<"+e.nodeName+">")?s=e.cloneNode(!0):(ot.innerHTML=e.outerHTML,ot.removeChild(s=ot.firstChild)),!(fe.noCloneEvent&&fe.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||pe.isXMLDoc(e)))for(r=h(s),o=h(e),a=0;null!=(i=o[a]);++a)r[a]&&T(i,r[a]);if(t)if(n)for(o=o||h(e),r=r||h(s),a=0;null!=(i=o[a]);a++)C(i,r[a]);else C(e,s);return r=h(s,"script"),r.length>0&&m(r,!c&&h(e,"script")),r=o=i=null,s},cleanData:function(e,t){for(var n,r,i,s,a=0,o=pe.expando,c=pe.cache,u=fe.attributes,l=pe.event.special;null!=(n=e[a]);a++)if((t||Re(n))&&(i=n[o],s=i&&c[i])){if(s.events)for(r in s.events)l[r]?pe.event.remove(n,r):pe.removeEvent(n,r,s.handle);c[i]&&(delete c[i],u||"undefined"==typeof n.removeAttribute?n[o]=void 0:n.removeAttribute(o),ne.push(i))}}}),pe.fn.extend({domManip:S,detach:function(e){return O(this,e,!0)},remove:function(e){return O(this,e)},text:function(e){return Ve(this,function(e){return void 0===e?pe.text(this):this.empty().append((this[0]&&this[0].ownerDocument||re).createTextNode(e))},null,e,arguments.length)},append:function(){return S(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=w(this,e);t.appendChild(e)}})},prepend:function(){return S(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=w(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return S(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return S(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++){for(1===e.nodeType&&pe.cleanData(h(e,!1));e.firstChild;)e.removeChild(e.firstChild);e.options&&pe.nodeName(e,"select")&&(e.options.length=0)}return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return pe.clone(this,e,t)})},html:function(e){return Ve(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e)return 1===t.nodeType?t.innerHTML.replace(Ze,""):void 0;if("string"==typeof e&&!nt.test(e)&&(fe.htmlSerialize||!et.test(e))&&(fe.leadingWhitespace||!He.test(e))&&!$e[(qe.exec(e)||["",""])[1].toLowerCase()]){e=pe.htmlPrefilter(e);try{for(;r>n;n++)t=this[n]||{},1===t.nodeType&&(pe.cleanData(h(t,!1)),t.innerHTML=e);t=0}catch(i){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=[];return S(this,arguments,function(t){var n=this.parentNode;pe.inArray(this,e)<0&&(pe.cleanData(h(this)),n&&n.replaceChild(t,this))},e)}}),pe.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){pe.fn[e]=function(e){for(var n,r=0,i=[],s=pe(e),a=s.length-1;a>=r;r++)n=r===a?this:this.clone(!0),pe(s[r])[t](n),ae.apply(i,n.get());return this.pushStack(i)}});var ct,ut={HTML:"block",BODY:"block"},lt=/^margin/,ft=new RegExp("^("+Ie+")(?!px)[a-z%]+$","i"),dt=function(e,t,n,r){var i,s,a={};for(s in t)a[s]=e.style[s],e.style[s]=t[s];i=n.apply(e,r||[]);for(s in t)e.style[s]=a[s];return i},pt=re.documentElement;!function(){function t(){var t,l,f=re.documentElement;f.appendChild(c),u.style.cssText="-webkit-box-sizing:border-box;box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",n=i=o=!1,r=a=!0,e.getComputedStyle&&(l=e.getComputedStyle(u),n="1%"!==(l||{}).top,o="2px"===(l||{}).marginLeft,i="4px"===(l||{width:"4px"}).width,u.style.marginRight="50%",r="4px"===(l||{marginRight:"4px"}).marginRight,t=u.appendChild(re.createElement("div")),t.style.cssText=u.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",t.style.marginRight=t.style.width="0",u.style.width="1px",a=!parseFloat((e.getComputedStyle(t)||{}).marginRight),u.removeChild(t)),u.style.display="none",s=0===u.getClientRects().length,s&&(u.style.display="",u.innerHTML="<table><tr><td></td><td>t</td></tr></table>",t=u.getElementsByTagName("td"),t[0].style.cssText="margin:0;border:0;padding:0;display:none",s=0===t[0].offsetHeight,s&&(t[0].style.display="",t[1].style.display="none",s=0===t[0].offsetHeight)),f.removeChild(c)}var n,r,i,s,a,o,c=re.createElement("div"),u=re.createElement("div");u.style&&(u.style.cssText="float:left;opacity:.5",fe.opacity="0.5"===u.style.opacity,fe.cssFloat=!!u.style.cssFloat,u.style.backgroundClip="content-box",u.cloneNode(!0).style.backgroundClip="",fe.clearCloneStyle="content-box"===u.style.backgroundClip,c=re.createElement("div"),c.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",u.innerHTML="",c.appendChild(u),fe.boxSizing=""===u.style.boxSizing||""===u.style.MozBoxSizing||""===u.style.WebkitBoxSizing,pe.extend(fe,{reliableHiddenOffsets:function(){return null==n&&t(),s},boxSizingReliable:function(){return null==n&&t(),i},pixelMarginRight:function(){return null==n&&t(),r},pixelPosition:function(){return null==n&&t(),n},reliableMarginRight:function(){return null==n&&t(),a},reliableMarginLeft:function(){return null==n&&t(),o}}))}();var ht,mt,vt=/^(top|right|bottom|left)$/;e.getComputedStyle?(ht=function(t){var n=t.ownerDocument.defaultView;return n.opener||(n=e),n.getComputedStyle(t)},mt=function(e,t,n){var r,i,s,a,o=e.style;return n=n||ht(e),a=n?n.getPropertyValue(t)||n[t]:void 0,n&&(""!==a||pe.contains(e.ownerDocument,e)||(a=pe.style(e,t)),!fe.pixelMarginRight()&&ft.test(a)&&lt.test(t)&&(r=o.width,i=o.minWidth,s=o.maxWidth,o.minWidth=o.maxWidth=o.width=a,a=n.width,o.width=r,o.minWidth=i,o.maxWidth=s)),void 0===a?a:a+""}):pt.currentStyle&&(ht=function(e){return e.currentStyle},mt=function(e,t,n){var r,i,s,a,o=e.style;return n=n||ht(e),a=n?n[t]:void 0,null==a&&o&&o[t]&&(a=o[t]),ft.test(a)&&!vt.test(t)&&(r=o.left,i=e.runtimeStyle,s=i&&i.left,s&&(i.left=e.currentStyle.left),o.left="fontSize"===t?"1em":a,a=o.pixelLeft+"px",o.left=r,s&&(i.left=s)),void 0===a?a:a+""||"auto"});var gt=/alpha\([^)]*\)/i,yt=/opacity\s*=\s*([^)]*)/i,_t=/^(none|table(?!-c[ea]).+)/,bt=new RegExp("^("+Ie+")(.*)$","i"),xt={position:"absolute",visibility:"hidden",display:"block"},wt={letterSpacing:"0",fontWeight:"400"},kt=["Webkit","O","Moz","ms"],Et=re.createElement("div").style;pe.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=mt(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":fe.cssFloat?"cssFloat":"styleFloat"},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,s,a,o=pe.camelCase(t),c=e.style;if(t=pe.cssProps[o]||(pe.cssProps[o]=R(o)||o),a=pe.cssHooks[t]||pe.cssHooks[o],void 0===n)return a&&"get"in a&&void 0!==(i=a.get(e,!1,r))?i:c[t];if(s=typeof n,"string"===s&&(i=Me.exec(n))&&i[1]&&(n=d(e,t,i),s="number"),null!=n&&n===n&&("number"===s&&(n+=i&&i[3]||(pe.cssNumber[o]?"":"px")),fe.clearCloneStyle||""!==n||0!==t.indexOf("background")||(c[t]="inherit"),!(a&&"set"in a&&void 0===(n=a.set(e,n,r)))))try{c[t]=n}catch(u){}}},css:function(e,t,n,r){var i,s,a,o=pe.camelCase(t);return t=pe.cssProps[o]||(pe.cssProps[o]=R(o)||o),a=pe.cssHooks[t]||pe.cssHooks[o],a&&"get"in a&&(s=a.get(e,!0,n)),void 0===s&&(s=mt(e,t,r)),"normal"===s&&t in wt&&(s=wt[t]),""===n||n?(i=parseFloat(s),n===!0||isFinite(i)?i||0:s):s}}),pe.each(["height","width"],function(e,t){pe.cssHooks[t]={get:function(e,n,r){return n?_t.test(pe.css(e,"display"))&&0===e.offsetWidth?dt(e,xt,function(){return M(e,t,r)}):M(e,t,r):void 0},set:function(e,n,r){var i=r&&ht(e);return L(e,n,r?I(e,t,r,fe.boxSizing&&"border-box"===pe.css(e,"boxSizing",!1,i),i):0)}}}),fe.opacity||(pe.cssHooks.opacity={get:function(e,t){return yt.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,i=pe.isNumeric(t)?"alpha(opacity="+100*t+")":"",s=r&&r.filter||n.filter||"";n.zoom=1,(t>=1||""===t)&&""===pe.trim(s.replace(gt,""))&&n.removeAttribute&&(n.removeAttribute("filter"),""===t||r&&!r.filter)||(n.filter=gt.test(s)?s.replace(gt,i):s+" "+i)}}),pe.cssHooks.marginRight=B(fe.reliableMarginRight,function(e,t){return t?dt(e,{display:"inline-block"},mt,[e,"marginRight"]):void 0}),pe.cssHooks.marginLeft=B(fe.reliableMarginLeft,function(e,t){return t?(parseFloat(mt(e,"marginLeft"))||(pe.contains(e.ownerDocument,e)?e.getBoundingClientRect().left-dt(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}):0))+"px":void 0}),pe.each({margin:"",padding:"",border:"Width"},function(e,t){pe.cssHooks[e+t]={expand:function(n){for(var r=0,i={},s="string"==typeof n?n.split(" "):[n];4>r;r++)i[e+De[r]+t]=s[r]||s[r-2]||s[0];return i}},lt.test(e)||(pe.cssHooks[e+t].set=L)}),pe.fn.extend({css:function(e,t){return Ve(this,function(e,t,n){var r,i,s={},a=0;if(pe.isArray(t)){for(r=ht(e),i=t.length;i>a;a++)s[t[a]]=pe.css(e,t[a],!1,r);return s}return void 0!==n?pe.style(e,t,n):pe.css(e,t)},e,t,arguments.length>1)},show:function(){return P(this,!0)},hide:function(){return P(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){je(this)?pe(this).show():pe(this).hide()})}}),pe.Tween=D,D.prototype={constructor:D,init:function(e,t,n,r,i,s){this.elem=e,this.prop=n,this.easing=i||pe.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=s||(pe.cssNumber[n]?"":"px")},cur:function(){var e=D.propHooks[this.prop];return e&&e.get?e.get(this):D.propHooks._default.get(this)},run:function(e){var t,n=D.propHooks[this.prop];return this.options.duration?this.pos=t=pe.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):D.propHooks._default.set(this),this}},D.prototype.init.prototype=D.prototype,D.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=pe.css(e.elem,e.prop,""),t&&"auto"!==t?t:0)},set:function(e){pe.fx.step[e.prop]?pe.fx.step[e.prop](e):1!==e.elem.nodeType||null==e.elem.style[pe.cssProps[e.prop]]&&!pe.cssHooks[e.prop]?e.elem[e.prop]=e.now:pe.style(e.elem,e.prop,e.now+e.unit)}}},D.propHooks.scrollTop=D.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},pe.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},pe.fx=D.prototype.init,pe.fx.step={};var Ct,Tt,St=/^(?:toggle|show|hide)$/,Ot=/queueHooks$/;pe.Animation=pe.extend(H,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return d(n.elem,e,Me.exec(t),n),n}]},tweener:function(e,t){pe.isFunction(e)?(t=e,e=["*"]):e=e.match(Ae);for(var n,r=0,i=e.length;i>r;r++)n=e[r],H.tweeners[n]=H.tweeners[n]||[],H.tweeners[n].unshift(t)},prefilters:[q],prefilter:function(e,t){t?H.prefilters.unshift(e):H.prefilters.push(e)}}),pe.speed=function(e,t,n){var r=e&&"object"==typeof e?pe.extend({},e):{complete:n||!n&&t||pe.isFunction(e)&&e,duration:e,easing:n&&t||t&&!pe.isFunction(t)&&t};return r.duration=pe.fx.off?0:"number"==typeof r.duration?r.duration:r.duration in pe.fx.speeds?pe.fx.speeds[r.duration]:pe.fx.speeds._default,(null==r.queue||r.queue===!0)&&(r.queue="fx"),r.old=r.complete,r.complete=function(){pe.isFunction(r.old)&&r.old.call(this),r.queue&&pe.dequeue(this,r.queue)},r},pe.fn.extend({fadeTo:function(e,t,n,r){return this.filter(je).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=pe.isEmptyObject(e),s=pe.speed(t,n,r),a=function(){var t=H(this,pe.extend({},e),s);(i||pe._data(this,"finish"))&&t.stop(!0)};return a.finish=a,i||s.queue===!1?this.each(a):this.queue(s.queue,a)},stop:function(e,t,n){var r=function(e){var t=e.stop;delete e.stop,t(n)};return"string"!=typeof e&&(n=t,t=e,e=void 0),t&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,i=null!=e&&e+"queueHooks",s=pe.timers,a=pe._data(this);if(i)a[i]&&a[i].stop&&r(a[i]);else for(i in a)a[i]&&a[i].stop&&Ot.test(i)&&r(a[i]);for(i=s.length;i--;)s[i].elem!==this||null!=e&&s[i].queue!==e||(s[i].anim.stop(n),t=!1,s.splice(i,1));(t||!n)&&pe.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=pe._data(this),r=n[e+"queue"],i=n[e+"queueHooks"],s=pe.timers,a=r?r.length:0;for(n.finish=!0,pe.queue(this,e,[]),i&&i.stop&&i.stop.call(this,!0),t=s.length;t--;)s[t].elem===this&&s[t].queue===e&&(s[t].anim.stop(!0),s.splice(t,1));for(t=0;a>t;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}}),pe.each(["toggle","show","hide"],function(e,t){var n=pe.fn[t];pe.fn[t]=function(e,r,i){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(V(t,!0),e,r,i)}}),pe.each({slideDown:V("show"),slideUp:V("hide"),slideToggle:V("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){pe.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),pe.timers=[],pe.fx.tick=function(){var e,t=pe.timers,n=0;for(Ct=pe.now();n<t.length;n++)e=t[n],e()||t[n]!==e||t.splice(n--,1);t.length||pe.fx.stop(),Ct=void 0},pe.fx.timer=function(e){pe.timers.push(e),e()?pe.fx.start():pe.timers.pop()},pe.fx.interval=13,pe.fx.start=function(){Tt||(Tt=e.setInterval(pe.fx.tick,pe.fx.interval))},pe.fx.stop=function(){e.clearInterval(Tt),Tt=null},pe.fx.speeds={slow:600,fast:200,_default:400},pe.fn.delay=function(t,n){return t=pe.fx?pe.fx.speeds[t]||t:t,n=n||"fx",this.queue(n,function(n,r){var i=e.setTimeout(n,t);r.stop=function(){e.clearTimeout(i)}})},function(){var e,t=re.createElement("input"),n=re.createElement("div"),r=re.createElement("select"),i=r.appendChild(re.createElement("option"));n=re.createElement("div"),n.setAttribute("className","t"),n.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",e=n.getElementsByTagName("a")[0],t.setAttribute("type","checkbox"),n.appendChild(t),e=n.getElementsByTagName("a")[0],e.style.cssText="top:1px",fe.getSetAttribute="t"!==n.className,fe.style=/top/.test(e.getAttribute("style")),fe.hrefNormalized="/a"===e.getAttribute("href"),fe.checkOn=!!t.value,fe.optSelected=i.selected,fe.enctype=!!re.createElement("form").enctype,r.disabled=!0,fe.optDisabled=!i.disabled,t=re.createElement("input"),t.setAttribute("value",""),fe.input=""===t.getAttribute("value"),t.value="t",t.setAttribute("type","radio"),fe.radioValue="t"===t.value}();var At=/\r/g;pe.fn.extend({val:function(e){var t,n,r,i=this[0];return arguments.length?(r=pe.isFunction(e),this.each(function(n){var i;1===this.nodeType&&(i=r?e.call(this,n,pe(this).val()):e,null==i?i="":"number"==typeof i?i+="":pe.isArray(i)&&(i=pe.map(i,function(e){return null==e?"":e+""})),t=pe.valHooks[this.type]||pe.valHooks[this.nodeName.toLowerCase()],t&&"set"in t&&void 0!==t.set(this,i,"value")||(this.value=i))})):i?(t=pe.valHooks[i.type]||pe.valHooks[i.nodeName.toLowerCase()],t&&"get"in t&&void 0!==(n=t.get(i,"value"))?n:(n=i.value,"string"==typeof n?n.replace(At,""):null==n?"":n)):void 0}}),pe.extend({valHooks:{option:{get:function(e){var t=pe.find.attr(e,"value");return null!=t?t:pe.trim(pe.text(e))}},select:{get:function(e){for(var t,n,r=e.options,i=e.selectedIndex,s="select-one"===e.type||0>i,a=s?null:[],o=s?i+1:r.length,c=0>i?o:s?i:0;o>c;c++)if(n=r[c],(n.selected||c===i)&&(fe.optDisabled?!n.disabled:null===n.getAttribute("disabled"))&&(!n.parentNode.disabled||!pe.nodeName(n.parentNode,"optgroup"))){if(t=pe(n).val(),s)return t;a.push(t)}return a},set:function(e,t){for(var n,r,i=e.options,s=pe.makeArray(t),a=i.length;a--;)if(r=i[a],pe.inArray(pe.valHooks.option.get(r),s)>=0)try{r.selected=n=!0}catch(o){r.scrollHeight}else r.selected=!1;return n||(e.selectedIndex=-1),i}}}}),pe.each(["radio","checkbox"],function(){pe.valHooks[this]={set:function(e,t){return pe.isArray(t)?e.checked=pe.inArray(pe(e).val(),t)>-1:void 0}},fe.checkOn||(pe.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var Nt,Bt,Rt=pe.expr.attrHandle,Pt=/^(?:checked|selected)$/i,Lt=fe.getSetAttribute,It=fe.input;pe.fn.extend({attr:function(e,t){return Ve(this,pe.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){pe.removeAttr(this,e)})}}),pe.extend({attr:function(e,t,n){var r,i,s=e.nodeType;return 3!==s&&8!==s&&2!==s?"undefined"==typeof e.getAttribute?pe.prop(e,t,n):(1===s&&pe.isXMLDoc(e)||(t=t.toLowerCase(),i=pe.attrHooks[t]||(pe.expr.match.bool.test(t)?Bt:Nt)),void 0!==n?null===n?void pe.removeAttr(e,t):i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:(e.setAttribute(t,n+""),n):i&&"get"in i&&null!==(r=i.get(e,t))?r:(r=pe.find.attr(e,t),null==r?void 0:r)):void 0},attrHooks:{type:{set:function(e,t){if(!fe.radioValue&&"radio"===t&&pe.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r,i=0,s=t&&t.match(Ae);if(s&&1===e.nodeType)for(;n=s[i++];)r=pe.propFix[n]||n,pe.expr.match.bool.test(n)?It&&Lt||!Pt.test(n)?e[r]=!1:e[pe.camelCase("default-"+n)]=e[r]=!1:pe.attr(e,n,""),e.removeAttribute(Lt?n:r)}}),Bt={set:function(e,t,n){return t===!1?pe.removeAttr(e,n):It&&Lt||!Pt.test(n)?e.setAttribute(!Lt&&pe.propFix[n]||n,n):e[pe.camelCase("default-"+n)]=e[n]=!0,n}},pe.each(pe.expr.match.bool.source.match(/\w+/g),function(e,t){var n=Rt[t]||pe.find.attr;It&&Lt||!Pt.test(t)?Rt[t]=function(e,t,r){var i,s;return r||(s=Rt[t],Rt[t]=i,i=null!=n(e,t,r)?t.toLowerCase():null,Rt[t]=s),i}:Rt[t]=function(e,t,n){return n?void 0:e[pe.camelCase("default-"+t)]?t.toLowerCase():null}}),It&&Lt||(pe.attrHooks.value={set:function(e,t,n){return pe.nodeName(e,"input")?void(e.defaultValue=t):Nt&&Nt.set(e,t,n)}}),Lt||(Nt={set:function(e,t,n){var r=e.getAttributeNode(n);return r||e.setAttributeNode(r=e.ownerDocument.createAttribute(n)),r.value=t+="","value"===n||t===e.getAttribute(n)?t:void 0}},Rt.id=Rt.name=Rt.coords=function(e,t,n){var r;return n?void 0:(r=e.getAttributeNode(t))&&""!==r.value?r.value:null},pe.valHooks.button={get:function(e,t){var n=e.getAttributeNode(t);return n&&n.specified?n.value:void 0},set:Nt.set},pe.attrHooks.contenteditable={set:function(e,t,n){Nt.set(e,""===t?!1:t,n)}},pe.each(["width","height"],function(e,t){pe.attrHooks[t]={set:function(e,n){return""===n?(e.setAttribute(t,"auto"),n):void 0}}})),fe.style||(pe.attrHooks.style={get:function(e){return e.style.cssText||void 0},set:function(e,t){return e.style.cssText=t+""}});var Mt=/^(?:input|select|textarea|button|object)$/i,Dt=/^(?:a|area)$/i;pe.fn.extend({prop:function(e,t){return Ve(this,pe.prop,e,t,arguments.length>1)},removeProp:function(e){return e=pe.propFix[e]||e,this.each(function(){try{this[e]=void 0,delete this[e]}catch(t){}})}}),pe.extend({prop:function(e,t,n){var r,i,s=e.nodeType;return 3!==s&&8!==s&&2!==s?(1===s&&pe.isXMLDoc(e)||(t=pe.propFix[t]||t,i=pe.propHooks[t]),void 0!==n?i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:e[t]=n:i&&"get"in i&&null!==(r=i.get(e,t))?r:e[t]):void 0},propHooks:{tabIndex:{get:function(e){var t=pe.find.attr(e,"tabindex");return t?parseInt(t,10):Mt.test(e.nodeName)||Dt.test(e.nodeName)&&e.href?0:-1}}},propFix:{"for":"htmlFor","class":"className"}}),fe.hrefNormalized||pe.each(["href","src"],function(e,t){pe.propHooks[t]={get:function(e){return e.getAttribute(t,4)}}}),fe.optSelected||(pe.propHooks.selected={get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}}),pe.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){pe.propFix[this.toLowerCase()]=this}),fe.enctype||(pe.propFix.enctype="encoding");var jt=/[\t\r\n\f]/g;pe.fn.extend({addClass:function(e){var t,n,r,i,s,a,o,c=0;if(pe.isFunction(e))return this.each(function(t){pe(this).addClass(e.call(this,t,U(this)))});if("string"==typeof e&&e)for(t=e.match(Ae)||[];n=this[c++];)if(i=U(n),r=1===n.nodeType&&(" "+i+" ").replace(jt," ")){for(a=0;s=t[a++];)r.indexOf(" "+s+" ")<0&&(r+=s+" ");o=pe.trim(r),i!==o&&pe.attr(n,"class",o)}return this},removeClass:function(e){var t,n,r,i,s,a,o,c=0;if(pe.isFunction(e))return this.each(function(t){pe(this).removeClass(e.call(this,t,U(this)))});if(!arguments.length)return this.attr("class","");if("string"==typeof e&&e)for(t=e.match(Ae)||[];n=this[c++];)if(i=U(n),r=1===n.nodeType&&(" "+i+" ").replace(jt," ")){for(a=0;s=t[a++];)for(;r.indexOf(" "+s+" ")>-1;)r=r.replace(" "+s+" "," ");o=pe.trim(r),i!==o&&pe.attr(n,"class",o)}return this},toggleClass:function(e,t){var n=typeof e;return"boolean"==typeof t&&"string"===n?t?this.addClass(e):this.removeClass(e):pe.isFunction(e)?this.each(function(n){pe(this).toggleClass(e.call(this,n,U(this),t),t)}):this.each(function(){var t,r,i,s;if("string"===n)for(r=0,i=pe(this),s=e.match(Ae)||[];t=s[r++];)i.hasClass(t)?i.removeClass(t):i.addClass(t);else(void 0===e||"boolean"===n)&&(t=U(this),t&&pe._data(this,"__className__",t),pe.attr(this,"class",t||e===!1?"":pe._data(this,"__className__")||""))})},hasClass:function(e){var t,n,r=0;for(t=" "+e+" ";n=this[r++];)if(1===n.nodeType&&(" "+U(n)+" ").replace(jt," ").indexOf(t)>-1)return!0;return!1}}),pe.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){pe.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),pe.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}});var Vt=e.location,Ft=pe.now(),qt=/\?/,zt=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;pe.parseJSON=function(t){if(e.JSON&&e.JSON.parse)return e.JSON.parse(t+"");var n,r=null,i=pe.trim(t+"");return i&&!pe.trim(i.replace(zt,function(e,t,i,s){return n&&t&&(r=0),0===r?e:(n=i||t,r+=!s-!i,"")}))?Function("return "+i)():pe.error("Invalid JSON: "+t)},pe.parseXML=function(t){var n,r;if(!t||"string"!=typeof t)return null;try{e.DOMParser?(r=new e.DOMParser,n=r.parseFromString(t,"text/xml")):(n=new e.ActiveXObject("Microsoft.XMLDOM"),n.async="false",n.loadXML(t))}catch(i){n=void 0}return n&&n.documentElement&&!n.getElementsByTagName("parsererror").length||pe.error("Invalid XML: "+t),n};var Ht=/#.*$/,Ut=/([?&])_=[^&]*/,$t=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Qt=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Wt=/^(?:GET|HEAD)$/,Jt=/^\/\//,Xt=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,Kt={},Gt={},Yt="*/".concat("*"),Zt=Vt.href,en=Xt.exec(Zt.toLowerCase())||[];pe.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Zt,type:"GET",isLocal:Qt.test(en[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Yt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":pe.parseJSON,"text xml":pe.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?W(W(e,pe.ajaxSettings),t):W(pe.ajaxSettings,e)},ajaxPrefilter:$(Kt),ajaxTransport:$(Gt),ajax:function(t,n){function r(t,n,r,i){var s,f,y,_,x,k=n;2!==b&&(b=2,c&&e.clearTimeout(c),l=void 0,o=i||"",w.readyState=t>0?4:0,s=t>=200&&300>t||304===t,r&&(_=J(d,w,r)),_=X(d,_,w,s),s?(d.ifModified&&(x=w.getResponseHeader("Last-Modified"),x&&(pe.lastModified[a]=x),x=w.getResponseHeader("etag"),x&&(pe.etag[a]=x)),204===t||"HEAD"===d.type?k="nocontent":304===t?k="notmodified":(k=_.state,f=_.data,y=_.error,s=!y)):(y=k,(t||!k)&&(k="error",0>t&&(t=0))),w.status=t,w.statusText=(n||k)+"",s?m.resolveWith(p,[f,k,w]):m.rejectWith(p,[w,k,y]),w.statusCode(g),g=void 0,u&&h.trigger(s?"ajaxSuccess":"ajaxError",[w,d,s?f:y]),v.fireWith(p,[w,k]),u&&(h.trigger("ajaxComplete",[w,d]),--pe.active||pe.event.trigger("ajaxStop")))}"object"==typeof t&&(n=t,t=void 0),n=n||{};var i,s,a,o,c,u,l,f,d=pe.ajaxSetup({},n),p=d.context||d,h=d.context&&(p.nodeType||p.jquery)?pe(p):pe.event,m=pe.Deferred(),v=pe.Callbacks("once memory"),g=d.statusCode||{},y={},_={},b=0,x="canceled",w={readyState:0,getResponseHeader:function(e){var t;if(2===b){if(!f)for(f={};t=$t.exec(o);)f[t[1].toLowerCase()]=t[2];t=f[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===b?o:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return b||(e=_[n]=_[n]||e,y[e]=t),this},overrideMimeType:function(e){return b||(d.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>b)for(t in e)g[t]=[g[t],e[t]];else w.always(e[w.status]);return this},abort:function(e){var t=e||x;return l&&l.abort(t),r(0,t),this}};if(m.promise(w).complete=v.add,w.success=w.done,w.error=w.fail,d.url=((t||d.url||Zt)+"").replace(Ht,"").replace(Jt,en[1]+"//"),d.type=n.method||n.type||d.method||d.type,d.dataTypes=pe.trim(d.dataType||"*").toLowerCase().match(Ae)||[""],null==d.crossDomain&&(i=Xt.exec(d.url.toLowerCase()),d.crossDomain=!(!i||i[1]===en[1]&&i[2]===en[2]&&(i[3]||("http:"===i[1]?"80":"443"))===(en[3]||("http:"===en[1]?"80":"443")))),d.data&&d.processData&&"string"!=typeof d.data&&(d.data=pe.param(d.data,d.traditional)),Q(Kt,d,n,w),2===b)return w;u=pe.event&&d.global,u&&0===pe.active++&&pe.event.trigger("ajaxStart"),d.type=d.type.toUpperCase(),d.hasContent=!Wt.test(d.type),a=d.url,d.hasContent||(d.data&&(a=d.url+=(qt.test(a)?"&":"?")+d.data,delete d.data),d.cache===!1&&(d.url=Ut.test(a)?a.replace(Ut,"$1_="+Ft++):a+(qt.test(a)?"&":"?")+"_="+Ft++)),d.ifModified&&(pe.lastModified[a]&&w.setRequestHeader("If-Modified-Since",pe.lastModified[a]),pe.etag[a]&&w.setRequestHeader("If-None-Match",pe.etag[a])),(d.data&&d.hasContent&&d.contentType!==!1||n.contentType)&&w.setRequestHeader("Content-Type",d.contentType),w.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+("*"!==d.dataTypes[0]?", "+Yt+"; q=0.01":""):d.accepts["*"]);for(s in d.headers)w.setRequestHeader(s,d.headers[s]);if(d.beforeSend&&(d.beforeSend.call(p,w,d)===!1||2===b))return w.abort();x="abort";for(s in{success:1,error:1,complete:1})w[s](d[s]);if(l=Q(Gt,d,n,w)){if(w.readyState=1,u&&h.trigger("ajaxSend",[w,d]),2===b)return w;d.async&&d.timeout>0&&(c=e.setTimeout(function(){w.abort("timeout")},d.timeout));try{b=1,l.send(y,r)}catch(k){if(!(2>b))throw k;r(-1,k)}}else r(-1,"No Transport");
return w},getJSON:function(e,t,n){return pe.get(e,t,n,"json")},getScript:function(e,t){return pe.get(e,void 0,t,"script")}}),pe.each(["get","post"],function(e,t){pe[t]=function(e,n,r,i){return pe.isFunction(n)&&(i=i||r,r=n,n=void 0),pe.ajax(pe.extend({url:e,type:t,dataType:i,data:n,success:r},pe.isPlainObject(e)&&e))}}),pe._evalUrl=function(e){return pe.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,"throws":!0})},pe.fn.extend({wrapAll:function(e){if(pe.isFunction(e))return this.each(function(t){pe(this).wrapAll(e.call(this,t))});if(this[0]){var t=pe(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstChild&&1===e.firstChild.nodeType;)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return pe.isFunction(e)?this.each(function(t){pe(this).wrapInner(e.call(this,t))}):this.each(function(){var t=pe(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=pe.isFunction(e);return this.each(function(n){pe(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){pe.nodeName(this,"body")||pe(this).replaceWith(this.childNodes)}).end()}}),pe.expr.filters.hidden=function(e){return fe.reliableHiddenOffsets()?e.offsetWidth<=0&&e.offsetHeight<=0&&!e.getClientRects().length:G(e)},pe.expr.filters.visible=function(e){return!pe.expr.filters.hidden(e)};var tn=/%20/g,nn=/\[\]$/,rn=/\r?\n/g,sn=/^(?:submit|button|image|reset|file)$/i,an=/^(?:input|select|textarea|keygen)/i;pe.param=function(e,t){var n,r=[],i=function(e,t){t=pe.isFunction(t)?t():null==t?"":t,r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(void 0===t&&(t=pe.ajaxSettings&&pe.ajaxSettings.traditional),pe.isArray(e)||e.jquery&&!pe.isPlainObject(e))pe.each(e,function(){i(this.name,this.value)});else for(n in e)Y(n,e[n],t,i);return r.join("&").replace(tn,"+")},pe.fn.extend({serialize:function(){return pe.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=pe.prop(this,"elements");return e?pe.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!pe(this).is(":disabled")&&an.test(this.nodeName)&&!sn.test(e)&&(this.checked||!Fe.test(e))}).map(function(e,t){var n=pe(this).val();return null==n?null:pe.isArray(n)?pe.map(n,function(e){return{name:t.name,value:e.replace(rn,"\r\n")}}):{name:t.name,value:n.replace(rn,"\r\n")}}).get()}}),pe.ajaxSettings.xhr=void 0!==e.ActiveXObject?function(){return this.isLocal?ee():re.documentMode>8?Z():/^(get|post|head|put|delete|options)$/i.test(this.type)&&Z()||ee()}:Z;var on=0,cn={},un=pe.ajaxSettings.xhr();e.attachEvent&&e.attachEvent("onunload",function(){for(var e in cn)cn[e](void 0,!0)}),fe.cors=!!un&&"withCredentials"in un,un=fe.ajax=!!un,un&&pe.ajaxTransport(function(t){if(!t.crossDomain||fe.cors){var n;return{send:function(r,i){var s,a=t.xhr(),o=++on;if(a.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(s in t.xhrFields)a[s]=t.xhrFields[s];t.mimeType&&a.overrideMimeType&&a.overrideMimeType(t.mimeType),t.crossDomain||r["X-Requested-With"]||(r["X-Requested-With"]="XMLHttpRequest");for(s in r)void 0!==r[s]&&a.setRequestHeader(s,r[s]+"");a.send(t.hasContent&&t.data||null),n=function(e,r){var s,c,u;if(n&&(r||4===a.readyState))if(delete cn[o],n=void 0,a.onreadystatechange=pe.noop,r)4!==a.readyState&&a.abort();else{u={},s=a.status,"string"==typeof a.responseText&&(u.text=a.responseText);try{c=a.statusText}catch(l){c=""}s||!t.isLocal||t.crossDomain?1223===s&&(s=204):s=u.text?200:404}u&&i(s,c,u,a.getAllResponseHeaders())},t.async?4===a.readyState?e.setTimeout(n):a.onreadystatechange=cn[o]=n:n()},abort:function(){n&&n(void 0,!0)}}}}),pe.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),pe.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return pe.globalEval(e),e}}}),pe.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),pe.ajaxTransport("script",function(e){if(e.crossDomain){var t,n=re.head||pe("head")[0]||re.documentElement;return{send:function(r,i){t=re.createElement("script"),t.async=!0,e.scriptCharset&&(t.charset=e.scriptCharset),t.src=e.url,t.onload=t.onreadystatechange=function(e,n){(n||!t.readyState||/loaded|complete/.test(t.readyState))&&(t.onload=t.onreadystatechange=null,t.parentNode&&t.parentNode.removeChild(t),t=null,n||i(200,"success"))},n.insertBefore(t,n.firstChild)},abort:function(){t&&t.onload(void 0,!0)}}}});var ln=[],fn=/(=)\?(?=&|$)|\?\?/;pe.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=ln.pop()||pe.expando+"_"+Ft++;return this[e]=!0,e}}),pe.ajaxPrefilter("json jsonp",function(t,n,r){var i,s,a,o=t.jsonp!==!1&&(fn.test(t.url)?"url":"string"==typeof t.data&&0===(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&fn.test(t.data)&&"data");return o||"jsonp"===t.dataTypes[0]?(i=t.jsonpCallback=pe.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,o?t[o]=t[o].replace(fn,"$1"+i):t.jsonp!==!1&&(t.url+=(qt.test(t.url)?"&":"?")+t.jsonp+"="+i),t.converters["script json"]=function(){return a||pe.error(i+" was not called"),a[0]},t.dataTypes[0]="json",s=e[i],e[i]=function(){a=arguments},r.always(function(){void 0===s?pe(e).removeProp(i):e[i]=s,t[i]&&(t.jsonpCallback=n.jsonpCallback,ln.push(i)),a&&pe.isFunction(s)&&s(a[0]),a=s=void 0}),"script"):void 0}),fe.createHTMLDocument=function(){if(!re.implementation.createHTMLDocument)return!1;var e=re.implementation.createHTMLDocument("");return e.body.innerHTML="<form></form><form></form>",2===e.body.childNodes.length}(),pe.parseHTML=function(e,t,n){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(n=t,t=!1),t=t||(fe.createHTMLDocument?re.implementation.createHTMLDocument(""):re);var r=we.exec(e),i=!n&&[];return r?[t.createElement(r[1])]:(r=g([e],t,i),i&&i.length&&pe(i).remove(),pe.merge([],r.childNodes))};var dn=pe.fn.load;pe.fn.load=function(e,t,n){if("string"!=typeof e&&dn)return dn.apply(this,arguments);var r,i,s,a=this,o=e.indexOf(" ");return o>-1&&(r=pe.trim(e.slice(o,e.length)),e=e.slice(0,o)),pe.isFunction(t)?(n=t,t=void 0):t&&"object"==typeof t&&(i="POST"),a.length>0&&pe.ajax({url:e,type:i||"GET",dataType:"html",data:t}).done(function(e){s=arguments,a.html(r?pe("<div>").append(pe.parseHTML(e)).find(r):e)}).always(n&&function(e,t){a.each(function(){n.apply(a,s||[e.responseText,t,e])})}),this},pe.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){pe.fn[t]=function(e){return this.on(t,e)}}),pe.expr.filters.animated=function(e){return pe.grep(pe.timers,function(t){return e===t.elem}).length},pe.offset={setOffset:function(e,t,n){var r,i,s,a,o,c,u,l=pe.css(e,"position"),f=pe(e),d={};"static"===l&&(e.style.position="relative"),o=f.offset(),s=pe.css(e,"top"),c=pe.css(e,"left"),u=("absolute"===l||"fixed"===l)&&pe.inArray("auto",[s,c])>-1,u?(r=f.position(),a=r.top,i=r.left):(a=parseFloat(s)||0,i=parseFloat(c)||0),pe.isFunction(t)&&(t=t.call(e,n,pe.extend({},o))),null!=t.top&&(d.top=t.top-o.top+a),null!=t.left&&(d.left=t.left-o.left+i),"using"in t?t.using.call(e,d):f.css(d)}},pe.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){pe.offset.setOffset(this,e,t)});var t,n,r={top:0,left:0},i=this[0],s=i&&i.ownerDocument;return s?(t=s.documentElement,pe.contains(t,i)?("undefined"!=typeof i.getBoundingClientRect&&(r=i.getBoundingClientRect()),n=te(s),{top:r.top+(n.pageYOffset||t.scrollTop)-(t.clientTop||0),left:r.left+(n.pageXOffset||t.scrollLeft)-(t.clientLeft||0)}):r):void 0},position:function(){if(this[0]){var e,t,n={top:0,left:0},r=this[0];return"fixed"===pe.css(r,"position")?t=r.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),pe.nodeName(e[0],"html")||(n=e.offset()),n.top+=pe.css(e[0],"borderTopWidth",!0)-e.scrollTop(),n.left+=pe.css(e[0],"borderLeftWidth",!0)-e.scrollLeft()),{top:t.top-n.top-pe.css(r,"marginTop",!0),left:t.left-n.left-pe.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent;e&&!pe.nodeName(e,"html")&&"static"===pe.css(e,"position");)e=e.offsetParent;return e||pt})}}),pe.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var n=/Y/.test(t);pe.fn[e]=function(r){return Ve(this,function(e,r,i){var s=te(e);return void 0===i?s?t in s?s[t]:s.document.documentElement[r]:e[r]:void(s?s.scrollTo(n?pe(s).scrollLeft():i,n?i:pe(s).scrollTop()):e[r]=i)},e,r,arguments.length,null)}}),pe.each(["top","left"],function(e,t){pe.cssHooks[t]=B(fe.pixelPosition,function(e,n){return n?(n=mt(e,t),ft.test(n)?pe(e).position()[t]+"px":n):void 0})}),pe.each({Height:"height",Width:"width"},function(e,t){pe.each({padding:"inner"+e,content:t,"":"outer"+e},function(n,r){pe.fn[r]=function(r,i){var s=arguments.length&&(n||"boolean"!=typeof r),a=n||(r===!0||i===!0?"margin":"border");return Ve(this,function(t,n,r){var i;return pe.isWindow(t)?t.document.documentElement["client"+e]:9===t.nodeType?(i=t.documentElement,Math.max(t.body["scroll"+e],i["scroll"+e],t.body["offset"+e],i["offset"+e],i["client"+e])):void 0===r?pe.css(t,n,a):pe.style(t,n,r,a)},t,s?r:void 0,s,null)}})}),pe.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)}}),pe.fn.size=function(){return this.length},pe.fn.andSelf=pe.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return pe});var pn=e.jQuery,hn=e.$;return pe.noConflict=function(t){return e.$===pe&&(e.$=hn),t&&e.jQuery===pe&&(e.jQuery=pn),pe},t||(e.jQuery=e.$=pe),pe}),function(){"use strict";/**
     * @preserve FastClick: polyfill to remove click delays on browsers with touch UIs.
     *
     * @codingstandard ftlabs-jsv2
     * @copyright The Financial Times Limited [All Rights Reserved]
     * @license MIT License (see LICENSE.txt)
     */
function e(t,r){function i(e,t){return function(){return e.apply(t,arguments)}}var s;if(r=r||{},this.trackingClick=!1,this.trackingClickStart=0,this.targetElement=null,this.touchStartX=0,this.touchStartY=0,this.lastTouchIdentifier=0,this.touchBoundary=r.touchBoundary||10,this.layer=t,this.tapDelay=r.tapDelay||200,this.tapTimeout=r.tapTimeout||700,!e.notNeeded(t)){for(var a=["onMouse","onClick","onTouchStart","onTouchMove","onTouchEnd","onTouchCancel"],o=this,c=0,u=a.length;u>c;c++)o[a[c]]=i(o[a[c]],o);n&&(t.addEventListener("mouseover",this.onMouse,!0),t.addEventListener("mousedown",this.onMouse,!0),t.addEventListener("mouseup",this.onMouse,!0)),t.addEventListener("click",this.onClick,!0),t.addEventListener("touchstart",this.onTouchStart,!1),t.addEventListener("touchmove",this.onTouchMove,!1),t.addEventListener("touchend",this.onTouchEnd,!1),t.addEventListener("touchcancel",this.onTouchCancel,!1),Event.prototype.stopImmediatePropagation||(t.removeEventListener=function(e,n,r){var i=Node.prototype.removeEventListener;"click"===e?i.call(t,e,n.hijacked||n,r):i.call(t,e,n,r)},t.addEventListener=function(e,n,r){var i=Node.prototype.addEventListener;"click"===e?i.call(t,e,n.hijacked||(n.hijacked=function(e){e.propagationStopped||n(e)}),r):i.call(t,e,n,r)}),"function"==typeof t.onclick&&(s=t.onclick,t.addEventListener("click",function(e){s(e)},!1),t.onclick=null)}}var t=navigator.userAgent.indexOf("Windows Phone")>=0,n=navigator.userAgent.indexOf("Android")>0&&!t,r=/iP(ad|hone|od)/.test(navigator.userAgent)&&!t,i=r&&/OS 4_\d(_\d)?/.test(navigator.userAgent),s=r&&/OS [6-7]_\d/.test(navigator.userAgent),a=navigator.userAgent.indexOf("BB10")>0;e.prototype.needsClick=function(e){switch(e.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(e.disabled)return!0;break;case"input":if(r&&"file"===e.type||e.disabled)return!0;break;case"label":case"iframe":case"video":return!0}return/\bneedsclick\b/.test(e.className)},e.prototype.needsFocus=function(e){switch(e.nodeName.toLowerCase()){case"textarea":return!0;case"select":return!n;case"input":switch(e.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!e.disabled&&!e.readOnly;default:return/\bneedsfocus\b/.test(e.className)}},e.prototype.sendClick=function(e,t){var n,r;document.activeElement&&document.activeElement!==e&&document.activeElement.blur(),r=t.changedTouches[0],n=document.createEvent("MouseEvents"),n.initMouseEvent(this.determineEventType(e),!0,!0,window,1,r.screenX,r.screenY,r.clientX,r.clientY,!1,!1,!1,!1,0,null),n.forwardedTouchEvent=!0,e.dispatchEvent(n)},e.prototype.determineEventType=function(e){return n&&"select"===e.tagName.toLowerCase()?"mousedown":"click"},e.prototype.focus=function(e){var t;r&&e.setSelectionRange&&0!==e.type.indexOf("date")&&"time"!==e.type&&"month"!==e.type?(t=e.value.length,e.setSelectionRange(t,t)):e.focus()},e.prototype.updateScrollParent=function(e){var t,n;if(t=e.fastClickScrollParent,!t||!t.contains(e)){n=e;do{if(n.scrollHeight>n.offsetHeight){t=n,e.fastClickScrollParent=n;break}n=n.parentElement}while(n)}t&&(t.fastClickLastScrollTop=t.scrollTop)},e.prototype.getTargetElementFromEventTarget=function(e){return e.nodeType===Node.TEXT_NODE?e.parentNode:e},e.prototype.onTouchStart=function(e){var t,n,s;if(e.targetTouches.length>1)return!0;if(t=this.getTargetElementFromEventTarget(e.target),n=e.targetTouches[0],r){if(s=window.getSelection(),s.rangeCount&&!s.isCollapsed)return!0;if(!i){if(n.identifier&&n.identifier===this.lastTouchIdentifier)return e.preventDefault(),!1;this.lastTouchIdentifier=n.identifier,this.updateScrollParent(t)}}return this.trackingClick=!0,this.trackingClickStart=e.timeStamp,this.targetElement=t,this.touchStartX=n.pageX,this.touchStartY=n.pageY,e.timeStamp-this.lastClickTime<this.tapDelay&&e.preventDefault(),!0},e.prototype.touchHasMoved=function(e){var t=e.changedTouches[0],n=this.touchBoundary;return Math.abs(t.pageX-this.touchStartX)>n||Math.abs(t.pageY-this.touchStartY)>n?!0:!1},e.prototype.onTouchMove=function(e){return this.trackingClick?((this.targetElement!==this.getTargetElementFromEventTarget(e.target)||this.touchHasMoved(e))&&(this.trackingClick=!1,this.targetElement=null),!0):!0},e.prototype.findControl=function(e){return void 0!==e.control?e.control:e.htmlFor?document.getElementById(e.htmlFor):e.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")},e.prototype.onTouchEnd=function(e){var t,a,o,c,u,l=this.targetElement;if(!this.trackingClick)return!0;if(e.timeStamp-this.lastClickTime<this.tapDelay)return this.cancelNextClick=!0,!0;if(e.timeStamp-this.trackingClickStart>this.tapTimeout)return!0;if(this.cancelNextClick=!1,this.lastClickTime=e.timeStamp,a=this.trackingClickStart,this.trackingClick=!1,this.trackingClickStart=0,s&&(u=e.changedTouches[0],l=document.elementFromPoint(u.pageX-window.pageXOffset,u.pageY-window.pageYOffset)||l,l.fastClickScrollParent=this.targetElement.fastClickScrollParent),o=l.tagName.toLowerCase(),"label"===o){if(t=this.findControl(l)){if(this.focus(l),n)return!1;l=t}}else if(this.needsFocus(l))return e.timeStamp-a>100||r&&window.top!==window&&"input"===o?(this.targetElement=null,!1):(this.focus(l),this.sendClick(l,e),r&&"select"===o||(this.targetElement=null,e.preventDefault()),!1);return r&&!i&&(c=l.fastClickScrollParent,c&&c.fastClickLastScrollTop!==c.scrollTop)?!0:(this.needsClick(l)||(e.preventDefault(),this.sendClick(l,e)),!1)},e.prototype.onTouchCancel=function(){this.trackingClick=!1,this.targetElement=null},e.prototype.onMouse=function(e){return this.targetElement?e.forwardedTouchEvent?!0:e.cancelable&&(!this.needsClick(this.targetElement)||this.cancelNextClick)?(e.stopImmediatePropagation?e.stopImmediatePropagation():e.propagationStopped=!0,e.stopPropagation(),e.preventDefault(),!1):!0:!0},e.prototype.onClick=function(e){var t;return this.trackingClick?(this.targetElement=null,this.trackingClick=!1,!0):"submit"===e.target.type&&0===e.detail?!0:(t=this.onMouse(e),t||(this.targetElement=null),t)},e.prototype.destroy=function(){var e=this.layer;n&&(e.removeEventListener("mouseover",this.onMouse,!0),e.removeEventListener("mousedown",this.onMouse,!0),e.removeEventListener("mouseup",this.onMouse,!0)),e.removeEventListener("click",this.onClick,!0),e.removeEventListener("touchstart",this.onTouchStart,!1),e.removeEventListener("touchmove",this.onTouchMove,!1),e.removeEventListener("touchend",this.onTouchEnd,!1),e.removeEventListener("touchcancel",this.onTouchCancel,!1)},e.notNeeded=function(e){var t,r,i,s;if("undefined"==typeof window.ontouchstart)return!0;if(r=+(/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1]){if(!n)return!0;if(t=document.querySelector("meta[name=viewport]")){if(-1!==t.content.indexOf("user-scalable=no"))return!0;if(r>31&&document.documentElement.scrollWidth<=window.outerWidth)return!0}}if(a&&(i=navigator.userAgent.match(/Version\/([0-9]*)\.([0-9]*)/),i[1]>=10&&i[2]>=3&&(t=document.querySelector("meta[name=viewport]")))){if(-1!==t.content.indexOf("user-scalable=no"))return!0;if(document.documentElement.scrollWidth<=window.outerWidth)return!0}return"none"===e.style.msTouchAction||"manipulation"===e.style.touchAction?!0:(s=+(/Firefox\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1],s>=27&&(t=document.querySelector("meta[name=viewport]"),t&&(-1!==t.content.indexOf("user-scalable=no")||document.documentElement.scrollWidth<=window.outerWidth))?!0:"none"===e.style.touchAction||"manipulation"===e.style.touchAction?!0:!1)},e.attach=function(t,n){return new e(t,n)},"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return e}):"undefined"!=typeof module&&module.exports?(module.exports=e.attach,module.exports.FastClick=e):window.FastClick=e}();const abc2svg={version:"1.4.9",vdate:"2016-01-18"};var Abcdf_Parser=function(){"use strict";function e(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n}function t(e,n,r,i){this.message=e,this.expected=n,this.found=r,this.location=i,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,t)}function n(e){function n(t){var n,r,i=se[t];if(i)return i;for(n=t-1;!se[n];)n--;for(i=se[n],i={line:i.line,column:i.column,seenCR:i.seenCR};t>n;)r=e.charAt(n),"\n"===r?(i.seenCR||i.line++,i.column=1,i.seenCR=!1):"\r"===r||"\u2028"===r||"\u2029"===r?(i.line++,i.column=1,i.seenCR=!0):(i.column++,i.seenCR=!1),n++;return se[t]=i,i}function r(e,t){var r=n(e),i=n(t);return{start:{offset:e,line:r.line,column:r.column},end:{offset:t,line:i.line,column:i.column}}}function i(e){ae>re||(re>ae&&(ae=re,oe=[]),oe.push(e))}function s(e,n,r,i){function s(e){var t=1;for(e.sort(function(e,t){return e.description<t.description?-1:e.description>t.description?1:0});t<e.length;)e[t-1]===e[t]?e.splice(t,1):t++}function a(e,t){function n(e){function t(e){return e.charCodeAt(0).toString(16).toUpperCase()}return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(e){return"\\x0"+t(e)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(e){return"\\x"+t(e)}).replace(/[\u0100-\u0FFF]/g,function(e){return"\\u0"+t(e)}).replace(/[\u1000-\uFFFF]/g,function(e){return"\\u"+t(e)})}var r,i,s,a=new Array(e.length);for(s=0;s<e.length;s++)a[s]=e[s].description;return r=e.length>1?a.slice(0,-1).join(", ")+" or "+a[e.length-1]:a[0],i=t?'"'+n(t)+'"':"end of input","Expected "+r+" but "+i+" found."}return null!==n&&s(n),new t(null!==e?e:a(n,r),n,r,i)}function a(){var t,n,r,s,a;return t=re,n=o(),n!==x?(r=re,64===e.charCodeAt(re)?(s=E,re++):(s=x,0===ce&&i(C)),s!==x?(a=o(),a!==x?(s=[s,a],r=s):(re=r,r=x)):(re=r,r=x),r===x&&(r=null),r!==x?(ie=t,n=T(n,r),t=n):(re=t,t=x)):(re=t,t=x),t}function o(){var t,n,r,s;return t=re,n=c(),n!==x?(38===e.charCodeAt(re)?(r=S,re++):(r=x,0===ce&&i(O)),r!==x?(s=o(),s!==x?(n=[n,r,s],t=n):(re=t,t=x)):(re=t,t=x)):(re=t,t=x),t===x&&(t=c(),t===x&&(t=A)),t}function c(){var e,t,n;for(e=re,t=[],n=u();n!==x;)t.push(n),n=u();return t!==x&&(ie=e,t=N(t)),e=t}function u(){var t,n,r,s,a;return t=re,n=l(),n!==x?(r=re,47===e.charCodeAt(re)?(s=B,re++):(s=x,0===ce&&i(R)),s!==x?(a=l(),a!==x?(s=[s,a],r=s):(re=r,r=x)):(re=r,r=x),r===x&&(r=null),r!==x?(ie=t,n=P(n,r),t=n):(re=t,t=x)):(re=t,t=x),t===x&&(t=re,n=f(),n!==x?(r=re,47===e.charCodeAt(re)?(s=B,re++):(s=x,0===ce&&i(R)),s!==x?(a=f(),a!==x?(s=[s,a],r=s):(re=r,r=x)):(re=r,r=x),r===x&&(r=null),r!==x?(ie=t,n=L(n,r),t=n):(re=t,t=x)):(re=t,t=x),t===x&&(t=re,n=d(),n!==x?(r=re,47===e.charCodeAt(re)?(s=B,re++):(s=x,0===ce&&i(R)),s!==x?(a=d(),a!==x?(s=[s,a],r=s):(re=r,r=x)):(re=r,r=x),r===x&&(r=null),r!==x?(ie=t,n=I(n,r),t=n):(re=t,t=x)):(re=t,t=x))),t}function l(){var t,n,r,s,a;if(t=re,n=re,40===e.charCodeAt(re)?(r=M,re++):(r=x,0===ce&&i(D)),r!==x){if(s=[],a=f(),a!==x)for(;a!==x;)s.push(a),a=f();else s=x;s!==x?(41===e.charCodeAt(re)?(a=j,re++):(a=x,0===ce&&i(V)),a!==x?(r=[r,s,a],n=r):(re=n,n=x)):(re=n,n=x)}else re=n,n=x;return n!==x&&(ie=t,n=F(n)),t=n}function f(){var e,t,n,r;return e=re,t=v(),t===x&&(t=null),t!==x?(n=p(),n!==x?(r=m(),r===x&&(r=null),r!==x?(ie=e,t=q(t,n,r),e=t):(re=e,e=x)):(re=e,e=x)):(re=e,e=x),e}function d(){var t,n,r,s;return t=re,n=v(),n===x&&(n=null),n!==x?(120===e.charCodeAt(re)?(r=z,re++):(r=x,0===ce&&i(H)),r!==x?(s=m(),s===x&&(s=null),s!==x?(ie=t,n=U(n,s),t=n):(re=t,t=x)):(re=t,t=x)):(re=t,t=x),t}function p(){var t,n,r,s,a;return t=re,n=h(),n!==x?(r=re,45===e.charCodeAt(re)?(s=$,re++):(s=x,0===ce&&i(Q)),s!==x?(a=h(),a!==x?(s=[s,a],r=s):(re=r,r=x)):(re=r,r=x),r===x&&(r=null),r!==x?(ie=t,n=W(n,r),t=n):(re=t,t=x)):(re=t,t=x),t}function h(){var e,t,n;return e=re,t=g(),t===x&&(t=null),t!==x?(n=y(),n!==x?(ie=e,t=J(t,n),e=t):(re=e,e=x)):(re=e,e=x),e}function m(){var t;return X.test(e.charAt(re))?(t=e.charAt(re),re++):(t=x,0===ce&&i(K)),t}function v(){var t;return G.test(e.charAt(re))?(t=e.charAt(re),re++):(t=x,0===ce&&i(Y)),t}function g(){var t;return Z.test(e.charAt(re))?(t=e.charAt(re),re++):(t=x,0===ce&&i(ee)),t}function y(){var t;return te.test(e.charAt(re))?(t=e.charAt(re),re++):(t=x,0===ce&&i(ne)),t}var _,b=arguments.length>1?arguments[1]:{},x={},w={sequence:a},k=a,E="@",C={type:"literal",value:"@",description:'"@"'},T=function(e,t){var n={upper:e};return t&&(n.lower=t[1]),n},S="&",O={type:"literal",value:"&",description:'"&"'},A="",N=function(e){return{score_fingerings:e}},B="/",R={type:"literal",value:"/",description:'"/"'},P=function(e,t){var n={first:e,last:null};return t&&(n.last=t[1]),n},L=function(e,t){var n={first:e,last:null};return t&&(n.last=t[1]),n},I=function(e,t){var n={first:e,last:null};return t&&(n.last=t[1]),n},M="(",D={type:"literal",value:"(",description:'"("'},j=")",V={type:"literal",value:")",description:'")"'},F=function(e){return e.pop(),e.shift(),{ornaments:e}},q=function(e,t,n){return{soft:e,fingering:t,damper:n}},z="x",H={type:"literal",value:"x",description:'"x"'},U=function(e,t){var n={strike:null,release:null};return{soft:e,fingering:n,damper:t}},$="-",Q={type:"literal",value:"-",description:'"-"'},W=function(e,t){var n={strike:e,release:null};return t&&(n.release=t[1]),n},J=function(e,t){return{hand:e,digit:t}},X=/^[_\^]/,K={type:"class",value:"[_^]",description:"[_^]"},G=/^[pf]/,Y={type:"class",value:"[pf]",description:"[pf]"},Z=/^[<>]/,ee={type:"class",value:"[<>]",description:"[<>]"},te=/^[1-5]/,ne={type:"class",value:"[1-5]",description:"[1-5]"},re=0,ie=0,se=[{line:1,column:1,seenCR:!1}],ae=0,oe=[],ce=0;if("startRule"in b){if(!(b.startRule in w))throw new Error("Can't start parsing from rule \""+b.startRule+'".');k=w[b.startRule]}if(_=k(),_!==x&&re===e.length)return _;throw _!==x&&re<e.length&&i({type:"end",description:"end of input"}),s(null,oe,ae<e.length?e.charAt(ae):null,ae<e.length?r(ae,ae+1):r(ae,ae))}return e(t,Error),{SyntaxError:t,parse:n}}();!function(){Downloadify=window.Downloadify={queue:{},uid:(new Date).getTime(),getTextForSave:function(e){var t=Downloadify.queue[e];return t?t.getData():""},getFileNameForSave:function(e){var t=Downloadify.queue[e];return t?t.getFilename():""},getDataTypeForSave:function(e){var t=Downloadify.queue[e];return t?t.getDataType():""},saveComplete:function(e){var t=Downloadify.queue[e];return t&&t.complete(),!0},saveCancel:function(e){var t=Downloadify.queue[e];return t&&t.cancel(),!0},saveError:function(e){var t=Downloadify.queue[e];return t&&t.error(),!0},addToQueue:function(e){Downloadify.queue[e.queue_name]=e},getUID:function(e){return""==e.id&&(e.id="downloadify_"+Downloadify.uid++),e.id}},Downloadify.create=function(e,t){var n="string"==typeof e?document.getElementById(e):e;return new Downloadify.Container(n,t)},Downloadify.Container=function(e,t){var n=this;n.el=e,n.enabled=!0,n.dataCallback=null,n.filenameCallback=null,n.data=null,n.filename=null;var r=function(){n.options=t,n.options.append||(n.el.innerHTML=""),n.flashContainer=document.createElement("span"),n.el.appendChild(n.flashContainer),n.queue_name=Downloadify.getUID(n.flashContainer),"function"==typeof n.options.filename?n.filenameCallback=n.options.filename:n.options.filename&&(n.filename=n.options.filename),"function"==typeof n.options.data?n.dataCallback=n.options.data:n.options.data&&(n.data=n.options.data);var e={queue_name:n.queue_name,width:n.options.width,height:n.options.height},r={allowScriptAccess:"always"},i={id:n.flashContainer.id,name:n.flashContainer.id};n.options.enabled===!1&&(n.enabled=!1),n.options.transparent===!0&&(r.wmode="transparent"),n.options.downloadImage&&(e.downloadImage=n.options.downloadImage),swfobject.embedSWF(n.options.swf,n.flashContainer.id,n.options.width,n.options.height,"10",null,e,r,i),Downloadify.addToQueue(n)};n.enable=function(){var e=document.getElementById(n.flashContainer.id);e.setEnabled(!0),n.enabled=!0},n.disable=function(){var e=document.getElementById(n.flashContainer.id);e.setEnabled(!1),n.enabled=!1},n.getData=function(){return n.enabled?n.dataCallback?n.dataCallback():n.data?n.data:"":""},n.getFilename=function(){return n.filenameCallback?n.filenameCallback():n.filename?n.filename:""},n.getDataType=function(){return n.options.dataType?n.options.dataType:"string"},n.complete=function(){"function"==typeof n.options.onComplete&&n.options.onComplete()},n.cancel=function(){"function"==typeof n.options.onCancel&&n.options.onCancel()},n.error=function(){"function"==typeof n.options.onError&&n.options.onError()},r()},Downloadify.defaultOptions={swf:"media/downloadify.swf",downloadImage:"images/download.png",width:100,height:30,transparent:!0,append:!1,dataType:"string"}}(),"undefined"!=typeof jQuery&&!function(e){e.fn.downloadify=function(t){return this.each(function(){t=e.extend({},Downloadify.defaultOptions,t);var n=Downloadify.create(this,t);e(this).data("Downloadify",n)})}}(jQuery),"undefined"!=typeof MooTools&&Element.implement({downloadify:function(e){return e=$merge(Downloadify.defaultOptions,e),this.store("Downloadify",Downloadify.create(this,e))}}),!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.JSZip=e()}}(function(){return function e(t,n,r){function i(a,o){if(!n[a]){if(!t[a]){var c="function"==typeof require&&require;if(!o&&c)return c(a,!0);if(s)return s(a,!0);throw new Error("Cannot find module '"+a+"'")}var u=n[a]={exports:{}};t[a][0].call(u.exports,function(e){var n=t[a][1][e];return i(n?n:e)},u,u.exports,e,t,n,r)}return n[a].exports}for(var s="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){"use strict";var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.encode=function(e,t){for(var n,i,s,a,o,c,u,l="",f=0;f<e.length;)n=e.charCodeAt(f++),i=e.charCodeAt(f++),s=e.charCodeAt(f++),a=n>>2,o=(3&n)<<4|i>>4,c=(15&i)<<2|s>>6,u=63&s,isNaN(i)?c=u=64:isNaN(s)&&(u=64),l=l+r.charAt(a)+r.charAt(o)+r.charAt(c)+r.charAt(u);return l},n.decode=function(e,t){var n,i,s,a,o,c,u,l="",f=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");f<e.length;)a=r.indexOf(e.charAt(f++)),o=r.indexOf(e.charAt(f++)),c=r.indexOf(e.charAt(f++)),u=r.indexOf(e.charAt(f++)),n=a<<2|o>>4,i=(15&o)<<4|c>>2,s=(3&c)<<6|u,l+=String.fromCharCode(n),64!=c&&(l+=String.fromCharCode(i)),64!=u&&(l+=String.fromCharCode(s));return l}},{}],2:[function(e,t,n){"use strict";function r(){this.compressedSize=0,this.uncompressedSize=0,this.crc32=0,this.compressionMethod=null,this.compressedContent=null}r.prototype={getContent:function(){return null},getCompressedContent:function(){return null}},t.exports=r},{}],3:[function(e,t,n){"use strict";n.STORE={magic:"\x00\x00",compress:function(e,t){return e},uncompress:function(e){return e},compressInputType:null,uncompressInputType:null},n.DEFLATE=e("./flate")},{"./flate":8}],4:[function(e,t,n){"use strict";var r=e("./utils"),i=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];t.exports=function(e,t){if("undefined"==typeof e||!e.length)return 0;var n="string"!==r.getTypeOf(e);"undefined"==typeof t&&(t=0);var s=0,a=0,o=0;t=-1^t;for(var c=0,u=e.length;u>c;c++)o=n?e[c]:e.charCodeAt(c),a=255&(t^o),s=i[a],t=t>>>8^s;return-1^t}},{"./utils":21}],5:[function(e,t,n){"use strict";function r(e){this.data=null,this.length=0,this.index=0}var i=e("./utils");r.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<e||0>e)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(e){},readInt:function(e){var t,n=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)n=(n<<8)+this.byteAt(t);return this.index+=e,n},readString:function(e){return i.transformTo("string",this.readData(e))},readData:function(e){},lastIndexOfSignature:function(e){},readDate:function(){var e=this.readInt(4);return new Date((e>>25&127)+1980,(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1)}},t.exports=r},{"./utils":21}],6:[function(e,t,n){"use strict";n.base64=!1,n.binary=!1,n.dir=!1,n.createFolders=!1,n.date=null,n.compression=null,n.compressionOptions=null,n.comment=null,n.unixPermissions=null,n.dosPermissions=null},{}],7:[function(e,t,n){"use strict";var r=e("./utils");n.string2binary=function(e){return r.string2binary(e)},n.string2Uint8Array=function(e){return r.transformTo("uint8array",e)},n.uint8Array2String=function(e){return r.transformTo("string",e)},n.string2Blob=function(e){var t=r.transformTo("arraybuffer",e);return r.arrayBuffer2Blob(t)},n.arrayBuffer2Blob=function(e){return r.arrayBuffer2Blob(e)},n.transformTo=function(e,t){return r.transformTo(e,t)},n.getTypeOf=function(e){return r.getTypeOf(e)},n.checkSupport=function(e){return r.checkSupport(e)},n.MAX_VALUE_16BITS=r.MAX_VALUE_16BITS,n.MAX_VALUE_32BITS=r.MAX_VALUE_32BITS,n.pretty=function(e){return r.pretty(e)},n.findCompression=function(e){return r.findCompression(e)},n.isRegExp=function(e){return r.isRegExp(e)}},{"./utils":21}],8:[function(e,t,n){"use strict";var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,i=e("pako");n.uncompressInputType=r?"uint8array":"array",n.compressInputType=r?"uint8array":"array",n.magic="\b\x00",n.compress=function(e,t){return i.deflateRaw(e,{level:t.level||-1})},n.uncompress=function(e){return i.inflateRaw(e)}},{pako:24}],9:[function(e,t,n){"use strict";function r(e,t){return this instanceof r?(this.files={},this.comment=null,this.root="",e&&this.load(e,t),void(this.clone=function(){var e=new r;for(var t in this)"function"!=typeof this[t]&&(e[t]=this[t]);return e})):new r(e,t)}var i=e("./base64");r.prototype=e("./object"),r.prototype.load=e("./load"),r.support=e("./support"),r.defaults=e("./defaults"),r.utils=e("./deprecatedPublicUtils"),r.base64={encode:function(e){return i.encode(e)},decode:function(e){return i.decode(e)}},r.compressions=e("./compressions"),t.exports=r},{"./base64":1,"./compressions":3,"./defaults":6,"./deprecatedPublicUtils":7,"./load":10,"./object":13,"./support":17}],10:[function(e,t,n){"use strict";var r=e("./base64"),i=e("./zipEntries");t.exports=function(e,t){var n,s,a,o;for(t=t||{},t.base64&&(e=r.decode(e)),s=new i(e,t),n=s.files,a=0;a<n.length;a++)o=n[a],this.file(o.fileName,o.decompressed,{binary:!0,optimizedBinaryString:!0,date:o.date,dir:o.dir,comment:o.fileComment.length?o.fileComment:null,unixPermissions:o.unixPermissions,dosPermissions:o.dosPermissions,createFolders:t.createFolders});return s.zipComment.length&&(this.comment=s.zipComment),this}},{"./base64":1,"./zipEntries":22}],11:[function(e,t,n){(function(e){"use strict";t.exports=function(t,n){return new e(t,n)},t.exports.test=function(t){return e.isBuffer(t)}}).call(this,"undefined"!=typeof Buffer?Buffer:void 0)},{}],12:[function(e,t,n){"use strict";function r(e){this.data=e,this.length=this.data.length,this.index=0}var i=e("./uint8ArrayReader");r.prototype=new i,r.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.index,this.index+e);return this.index+=e,t},t.exports=r},{"./uint8ArrayReader":18}],13:[function(e,t,n){"use strict";var r=e("./support"),i=e("./utils"),s=e("./crc32"),a=e("./signature"),o=e("./defaults"),c=e("./base64"),u=e("./compressions"),l=e("./compressedObject"),f=e("./nodeBuffer"),d=e("./utf8"),p=e("./stringWriter"),h=e("./uint8ArrayWriter"),m=function(e){if(e._data instanceof l&&(e._data=e._data.getContent(),e.options.binary=!0,e.options.base64=!1,"uint8array"===i.getTypeOf(e._data))){var t=e._data;e._data=new Uint8Array(t.length),0!==t.length&&e._data.set(t,0)}return e._data},v=function(e){var t=m(e),n=i.getTypeOf(t);return"string"===n?!e.options.binary&&r.nodebuffer?f(t,"utf-8"):e.asBinary():t},g=function(e){var t=m(this);return null===t||"undefined"==typeof t?"":(this.options.base64&&(t=c.decode(t)),t=e&&this.options.binary?N.utf8decode(t):i.transformTo("string",t),e||this.options.binary||(t=i.transformTo("string",N.utf8encode(t))),t)},y=function(e,t,n){this.name=e,this.dir=n.dir,this.date=n.date,this.comment=n.comment,this.unixPermissions=n.unixPermissions,this.dosPermissions=n.dosPermissions,this._data=t,this.options=n,this._initialMetadata={dir:n.dir,date:n.date}};y.prototype={asText:function(){return g.call(this,!0)},asBinary:function(){return g.call(this,!1)},asNodeBuffer:function(){var e=v(this);return i.transformTo("nodebuffer",e)},asUint8Array:function(){var e=v(this);return i.transformTo("uint8array",e)},asArrayBuffer:function(){return this.asUint8Array().buffer}};var _=function(e,t){var n,r="";for(n=0;t>n;n++)r+=String.fromCharCode(255&e),e>>>=8;return r},b=function(){var e,t,n={};for(e=0;e<arguments.length;e++)for(t in arguments[e])arguments[e].hasOwnProperty(t)&&"undefined"==typeof n[t]&&(n[t]=arguments[e][t]);return n},x=function(e){return e=e||{},e.base64!==!0||null!==e.binary&&void 0!==e.binary||(e.binary=!0),e=b(e,o),e.date=e.date||new Date,null!==e.compression&&(e.compression=e.compression.toUpperCase()),e},w=function(e,t,n){var r,s=i.getTypeOf(t);if(n=x(n),"string"==typeof n.unixPermissions&&(n.unixPermissions=parseInt(n.unixPermissions,8)),n.unixPermissions&&16384&n.unixPermissions&&(n.dir=!0),n.dosPermissions&&16&n.dosPermissions&&(n.dir=!0),n.dir&&(e=E(e)),n.createFolders&&(r=k(e))&&C.call(this,r,!0),n.dir||null===t||"undefined"==typeof t)n.base64=!1,n.binary=!1,t=null,s=null;else if("string"===s)n.binary&&!n.base64&&n.optimizedBinaryString!==!0&&(t=i.string2binary(t));else{if(n.base64=!1,n.binary=!0,!(s||t instanceof l))throw new Error("The data of '"+e+"' is in an unsupported format !");"arraybuffer"===s&&(t=i.transformTo("uint8array",t))}var a=new y(e,t,n);return this.files[e]=a,a},k=function(e){"/"==e.slice(-1)&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return t>0?e.substring(0,t):""},E=function(e){return"/"!=e.slice(-1)&&(e+="/"),e},C=function(e,t){return t="undefined"!=typeof t?t:!1,e=E(e),this.files[e]||w.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]},T=function(e,t,n){var r,a=new l;return e._data instanceof l?(a.uncompressedSize=e._data.uncompressedSize,a.crc32=e._data.crc32,0===a.uncompressedSize||e.dir?(t=u.STORE,a.compressedContent="",a.crc32=0):e._data.compressionMethod===t.magic?a.compressedContent=e._data.getCompressedContent():(r=e._data.getContent(),a.compressedContent=t.compress(i.transformTo(t.compressInputType,r),n))):(r=v(e),(!r||0===r.length||e.dir)&&(t=u.STORE,r=""),a.uncompressedSize=r.length,a.crc32=s(r),a.compressedContent=t.compress(i.transformTo(t.compressInputType,r),n)),a.compressedSize=a.compressedContent.length,a.compressionMethod=t.magic,a},S=function(e,t){var n=e;return e||(n=t?16893:33204),(65535&n)<<16},O=function(e,t){return 63&(e||0)},A=function(e,t,n,r,o){var c,u,l,f,p=(n.compressedContent,i.transformTo("string",d.utf8encode(t.name))),h=t.comment||"",m=i.transformTo("string",d.utf8encode(h)),v=p.length!==t.name.length,g=m.length!==h.length,y=t.options,b="",x="",w="";l=t._initialMetadata.dir!==t.dir?t.dir:y.dir,f=t._initialMetadata.date!==t.date?t.date:y.date;var k=0,E=0;l&&(k|=16),"UNIX"===o?(E=798,k|=S(t.unixPermissions,l)):(E=20,k|=O(t.dosPermissions,l)),c=f.getHours(),c<<=6,c|=f.getMinutes(),c<<=5,c|=f.getSeconds()/2,u=f.getFullYear()-1980,u<<=4,u|=f.getMonth()+1,u<<=5,u|=f.getDate(),v&&(x=_(1,1)+_(s(p),4)+p,b+="up"+_(x.length,2)+x),g&&(w=_(1,1)+_(this.crc32(m),4)+m,b+="uc"+_(w.length,2)+w);var C="";C+="\n\x00",C+=v||g?"\x00\b":"\x00\x00",C+=n.compressionMethod,C+=_(c,2),C+=_(u,2),C+=_(n.crc32,4),C+=_(n.compressedSize,4),C+=_(n.uncompressedSize,4),C+=_(p.length,2),C+=_(b.length,2);var T=a.LOCAL_FILE_HEADER+C+p+b,A=a.CENTRAL_FILE_HEADER+_(E,2)+C+_(m.length,2)+"\x00\x00\x00\x00"+_(k,4)+_(r,4)+p+b+m;return{fileRecord:T,dirRecord:A,compressedObject:n}},N={load:function(e,t){throw new Error("Load method is not defined. Is the file jszip-load.js included ?")},filter:function(e){var t,n,r,i,s=[];for(t in this.files)this.files.hasOwnProperty(t)&&(r=this.files[t],i=new y(r.name,r._data,b(r.options)),n=t.slice(this.root.length,t.length),t.slice(0,this.root.length)===this.root&&e(n,i)&&s.push(i));return s},file:function(e,t,n){if(1===arguments.length){if(i.isRegExp(e)){var r=e;return this.filter(function(e,t){return!t.dir&&r.test(e)})}return this.filter(function(t,n){return!n.dir&&t===e})[0]||null}return e=this.root+e,w.call(this,e,t,n),this},folder:function(e){if(!e)return this;if(i.isRegExp(e))return this.filter(function(t,n){return n.dir&&e.test(t)});var t=this.root+e,n=C.call(this,t),r=this.clone();return r.root=n.name,r},remove:function(e){e=this.root+e;var t=this.files[e];if(t||("/"!=e.slice(-1)&&(e+="/"),t=this.files[e]),t&&!t.dir)delete this.files[e];else for(var n=this.filter(function(t,n){return n.name.slice(0,e.length)===e}),r=0;r<n.length;r++)delete this.files[n[r].name];return this},generate:function(e){e=b(e||{},{base64:!0,compression:"STORE",compressionOptions:null,type:"base64",platform:"DOS",comment:null,mimeType:"application/zip"}),i.checkSupport(e.type),("darwin"===e.platform||"freebsd"===e.platform||"linux"===e.platform||"sunos"===e.platform)&&(e.platform="UNIX"),"win32"===e.platform&&(e.platform="DOS");
var t,n,r=[],s=0,o=0,l=i.transformTo("string",this.utf8encode(e.comment||this.comment||""));for(var f in this.files)if(this.files.hasOwnProperty(f)){var d=this.files[f],m=d.options.compression||e.compression.toUpperCase(),v=u[m];if(!v)throw new Error(m+" is not a valid compression method !");var g=d.options.compressionOptions||e.compressionOptions||{},y=T.call(this,d,v,g),x=A.call(this,f,d,y,s,e.platform);s+=x.fileRecord.length+y.compressedSize,o+=x.dirRecord.length,r.push(x)}var w="";w=a.CENTRAL_DIRECTORY_END+"\x00\x00\x00\x00"+_(r.length,2)+_(r.length,2)+_(o,4)+_(s,4)+_(l.length,2)+l;var k=e.type.toLowerCase();for(t="uint8array"===k||"arraybuffer"===k||"blob"===k||"nodebuffer"===k?new h(s+o+w.length):new p(s+o+w.length),n=0;n<r.length;n++)t.append(r[n].fileRecord),t.append(r[n].compressedObject.compressedContent);for(n=0;n<r.length;n++)t.append(r[n].dirRecord);t.append(w);var E=t.finalize();switch(e.type.toLowerCase()){case"uint8array":case"arraybuffer":case"nodebuffer":return i.transformTo(e.type.toLowerCase(),E);case"blob":return i.arrayBuffer2Blob(i.transformTo("arraybuffer",E),e.mimeType);case"base64":return e.base64?c.encode(E):E;default:return E}},crc32:function(e,t){return s(e,t)},utf8encode:function(e){return i.transformTo("string",d.utf8encode(e))},utf8decode:function(e){return d.utf8decode(e)}};t.exports=N},{"./base64":1,"./compressedObject":2,"./compressions":3,"./crc32":4,"./defaults":6,"./nodeBuffer":11,"./signature":14,"./stringWriter":16,"./support":17,"./uint8ArrayWriter":19,"./utf8":20,"./utils":21}],14:[function(e,t,n){"use strict";n.LOCAL_FILE_HEADER="PK",n.CENTRAL_FILE_HEADER="PK",n.CENTRAL_DIRECTORY_END="PK",n.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",n.ZIP64_CENTRAL_DIRECTORY_END="PK",n.DATA_DESCRIPTOR="PK\b"},{}],15:[function(e,t,n){"use strict";function r(e,t){this.data=e,t||(this.data=s.string2binary(this.data)),this.length=this.data.length,this.index=0}var i=e("./dataReader"),s=e("./utils");r.prototype=new i,r.prototype.byteAt=function(e){return this.data.charCodeAt(e)},r.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)},r.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.index,this.index+e);return this.index+=e,t},t.exports=r},{"./dataReader":5,"./utils":21}],16:[function(e,t,n){"use strict";var r=e("./utils"),i=function(){this.data=[]};i.prototype={append:function(e){e=r.transformTo("string",e),this.data.push(e)},finalize:function(){return this.data.join("")}},t.exports=i},{"./utils":21}],17:[function(e,t,n){(function(e){"use strict";if(n.base64=!0,n.array=!0,n.string=!0,n.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,n.nodebuffer="undefined"!=typeof e,n.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)n.blob=!1;else{var t=new ArrayBuffer(0);try{n.blob=0===new Blob([t],{type:"application/zip"}).size}catch(r){try{var i=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,s=new i;s.append(t),n.blob=0===s.getBlob("application/zip").size}catch(r){n.blob=!1}}}}).call(this,"undefined"!=typeof Buffer?Buffer:void 0)},{}],18:[function(e,t,n){"use strict";function r(e){e&&(this.data=e,this.length=this.data.length,this.index=0)}var i=e("./dataReader");r.prototype=new i,r.prototype.byteAt=function(e){return this.data[e]},r.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),n=e.charCodeAt(1),r=e.charCodeAt(2),i=e.charCodeAt(3),s=this.length-4;s>=0;--s)if(this.data[s]===t&&this.data[s+1]===n&&this.data[s+2]===r&&this.data[s+3]===i)return s;return-1},r.prototype.readData=function(e){if(this.checkOffset(e),0===e)return new Uint8Array(0);var t=this.data.subarray(this.index,this.index+e);return this.index+=e,t},t.exports=r},{"./dataReader":5}],19:[function(e,t,n){"use strict";var r=e("./utils"),i=function(e){this.data=new Uint8Array(e),this.index=0};i.prototype={append:function(e){0!==e.length&&(e=r.transformTo("uint8array",e),this.data.set(e,this.index),this.index+=e.length)},finalize:function(){return this.data}},t.exports=i},{"./utils":21}],20:[function(e,t,n){"use strict";for(var r=e("./utils"),i=e("./support"),s=e("./nodeBuffer"),a=new Array(256),o=0;256>o;o++)a[o]=o>=252?6:o>=248?5:o>=240?4:o>=224?3:o>=192?2:1;a[254]=a[254]=1;var c=function(e){var t,n,r,s,a,o=e.length,c=0;for(s=0;o>s;s++)n=e.charCodeAt(s),55296===(64512&n)&&o>s+1&&(r=e.charCodeAt(s+1),56320===(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),s++)),c+=128>n?1:2048>n?2:65536>n?3:4;for(t=i.uint8array?new Uint8Array(c):new Array(c),a=0,s=0;c>a;s++)n=e.charCodeAt(s),55296===(64512&n)&&o>s+1&&(r=e.charCodeAt(s+1),56320===(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),s++)),128>n?t[a++]=n:2048>n?(t[a++]=192|n>>>6,t[a++]=128|63&n):65536>n?(t[a++]=224|n>>>12,t[a++]=128|n>>>6&63,t[a++]=128|63&n):(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63,t[a++]=128|n>>>6&63,t[a++]=128|63&n);return t},u=function(e,t){var n;for(t=t||e.length,t>e.length&&(t=e.length),n=t-1;n>=0&&128===(192&e[n]);)n--;return 0>n?t:0===n?t:n+a[e[n]]>t?n:t},l=function(e){var t,n,i,s,o=e.length,c=new Array(2*o);for(n=0,t=0;o>t;)if(i=e[t++],128>i)c[n++]=i;else if(s=a[i],s>4)c[n++]=65533,t+=s-1;else{for(i&=2===s?31:3===s?15:7;s>1&&o>t;)i=i<<6|63&e[t++],s--;s>1?c[n++]=65533:65536>i?c[n++]=i:(i-=65536,c[n++]=55296|i>>10&1023,c[n++]=56320|1023&i)}return c.length!==n&&(c.subarray?c=c.subarray(0,n):c.length=n),r.applyFromCharCode(c)};n.utf8encode=function(e){return i.nodebuffer?s(e,"utf-8"):c(e)},n.utf8decode=function(e){if(i.nodebuffer)return r.transformTo("nodebuffer",e).toString("utf-8");e=r.transformTo(i.uint8array?"uint8array":"array",e);for(var t=[],n=0,s=e.length,a=65536;s>n;){var o=u(e,Math.min(n+a,s));i.uint8array?t.push(l(e.subarray(n,o))):t.push(l(e.slice(n,o))),n=o}return t.join("")}},{"./nodeBuffer":11,"./support":17,"./utils":21}],21:[function(e,t,n){"use strict";function r(e){return e}function i(e,t){for(var n=0;n<e.length;++n)t[n]=255&e.charCodeAt(n);return t}function s(e){var t=65536,r=[],i=e.length,s=n.getTypeOf(e),a=0,o=!0;try{switch(s){case"uint8array":String.fromCharCode.apply(null,new Uint8Array(0));break;case"nodebuffer":String.fromCharCode.apply(null,u(0))}}catch(c){o=!1}if(!o){for(var l="",f=0;f<e.length;f++)l+=String.fromCharCode(e[f]);return l}for(;i>a&&t>1;)try{"array"===s||"nodebuffer"===s?r.push(String.fromCharCode.apply(null,e.slice(a,Math.min(a+t,i)))):r.push(String.fromCharCode.apply(null,e.subarray(a,Math.min(a+t,i)))),a+=t}catch(c){t=Math.floor(t/2)}return r.join("")}function a(e,t){for(var n=0;n<e.length;n++)t[n]=e[n];return t}var o=e("./support"),c=e("./compressions"),u=e("./nodeBuffer");n.string2binary=function(e){for(var t="",n=0;n<e.length;n++)t+=String.fromCharCode(255&e.charCodeAt(n));return t},n.arrayBuffer2Blob=function(e,t){n.checkSupport("blob"),t=t||"application/zip";try{return new Blob([e],{type:t})}catch(r){try{var i=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,s=new i;return s.append(e),s.getBlob(t)}catch(r){throw new Error("Bug : can't construct the Blob.")}}},n.applyFromCharCode=s;var l={};l.string={string:r,array:function(e){return i(e,new Array(e.length))},arraybuffer:function(e){return l.string.uint8array(e).buffer},uint8array:function(e){return i(e,new Uint8Array(e.length))},nodebuffer:function(e){return i(e,u(e.length))}},l.array={string:s,array:r,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return u(e)}},l.arraybuffer={string:function(e){return s(new Uint8Array(e))},array:function(e){return a(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:r,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return u(new Uint8Array(e))}},l.uint8array={string:s,array:function(e){return a(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:r,nodebuffer:function(e){return u(e)}},l.nodebuffer={string:s,array:function(e){return a(e,new Array(e.length))},arraybuffer:function(e){return l.nodebuffer.uint8array(e).buffer},uint8array:function(e){return a(e,new Uint8Array(e.length))},nodebuffer:r},n.transformTo=function(e,t){if(t||(t=""),!e)return t;n.checkSupport(e);var r=n.getTypeOf(t),i=l[r][e](t);return i},n.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":o.nodebuffer&&u.test(e)?"nodebuffer":o.uint8array&&e instanceof Uint8Array?"uint8array":o.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},n.checkSupport=function(e){var t=o[e.toLowerCase()];if(!t)throw new Error(e+" is not supported by this browser")},n.MAX_VALUE_16BITS=65535,n.MAX_VALUE_32BITS=-1,n.pretty=function(e){var t,n,r="";for(n=0;n<(e||"").length;n++)t=e.charCodeAt(n),r+="\\x"+(16>t?"0":"")+t.toString(16).toUpperCase();return r},n.findCompression=function(e){for(var t in c)if(c.hasOwnProperty(t)&&c[t].magic===e)return c[t];return null},n.isRegExp=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)}},{"./compressions":3,"./nodeBuffer":11,"./support":17}],22:[function(e,t,n){"use strict";function r(e,t){this.files=[],this.loadOptions=t,e&&this.load(e)}var i=e("./stringReader"),s=e("./nodeBufferReader"),a=e("./uint8ArrayReader"),o=e("./utils"),c=e("./signature"),u=e("./zipEntry"),l=e("./support"),f=e("./object");r.prototype={checkSignature:function(e){var t=this.reader.readString(4);if(t!==e)throw new Error("Corrupted zip or bug : unexpected signature ("+o.pretty(t)+", expected "+o.pretty(e)+")")},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2),this.zipComment=this.reader.readString(this.zipCommentLength),this.zipComment=f.utf8decode(this.zipComment)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.versionMadeBy=this.reader.readString(2),this.versionNeeded=this.reader.readInt(2),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,n,r=this.zip64EndOfCentralSize-44,i=0;r>i;)e=this.reader.readInt(2),t=this.reader.readInt(4),n=this.reader.readString(t),this.zip64ExtensibleData[e]={id:e,length:t,value:n}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(c.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8(),t.processAttributes()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readString(4)===c.CENTRAL_FILE_HEADER;)e=new u({zip64:this.zip64},this.loadOptions),e.readCentralPart(this.reader),this.files.push(e)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(c.CENTRAL_DIRECTORY_END);if(-1===e){var t=!0;try{this.reader.setIndex(0),this.checkSignature(c.LOCAL_FILE_HEADER),t=!1}catch(n){}throw t?new Error("Can't find end of central directory : is this a zip file ? If it is, see http://stuk.github.io/jszip/documentation/howto/read_zip.html"):new Error("Corrupted zip : can't find end of central directory")}if(this.reader.setIndex(e),this.checkSignature(c.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,e=this.reader.lastIndexOfSignature(c.ZIP64_CENTRAL_DIRECTORY_LOCATOR),-1===e)throw new Error("Corrupted zip : can't find the ZIP64 end of central directory locator");this.reader.setIndex(e),this.checkSignature(c.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(c.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}},prepareReader:function(e){var t=o.getTypeOf(e);"string"!==t||l.uint8array?"nodebuffer"===t?this.reader=new s(e):this.reader=new a(o.transformTo("uint8array",e)):this.reader=new i(e,this.loadOptions.optimizedBinaryString)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=r},{"./nodeBufferReader":12,"./object":13,"./signature":14,"./stringReader":15,"./support":17,"./uint8ArrayReader":18,"./utils":21,"./zipEntry":23}],23:[function(e,t,n){"use strict";function r(e,t){this.options=e,this.loadOptions=t}var i=e("./stringReader"),s=e("./utils"),a=e("./compressedObject"),o=e("./object"),c=0,u=3;r.prototype={isEncrypted:function(){return 1===(1&this.bitFlag)},useUTF8:function(){return 2048===(2048&this.bitFlag)},prepareCompressedContent:function(e,t,n){return function(){var r=e.index;e.setIndex(t);var i=e.readData(n);return e.setIndex(r),i}},prepareContent:function(e,t,n,r,i){return function(){var e=s.transformTo(r.uncompressInputType,this.getCompressedContent()),t=r.uncompress(e);if(t.length!==i)throw new Error("Bug : uncompressed data size mismatch");return t}},readLocalPart:function(e){var t,n;if(e.skip(22),this.fileNameLength=e.readInt(2),n=e.readInt(2),this.fileName=e.readString(this.fileNameLength),e.skip(n),-1==this.compressedSize||-1==this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize == -1 || uncompressedSize == -1)");if(t=s.findCompression(this.compressionMethod),null===t)throw new Error("Corrupted zip : compression "+s.pretty(this.compressionMethod)+" unknown (inner file : "+this.fileName+")");if(this.decompressed=new a,this.decompressed.compressedSize=this.compressedSize,this.decompressed.uncompressedSize=this.uncompressedSize,this.decompressed.crc32=this.crc32,this.decompressed.compressionMethod=this.compressionMethod,this.decompressed.getCompressedContent=this.prepareCompressedContent(e,e.index,this.compressedSize,t),this.decompressed.getContent=this.prepareContent(e,e.index,this.compressedSize,t,this.uncompressedSize),this.loadOptions.checkCRC32&&(this.decompressed=s.transformTo("string",this.decompressed.getContent()),o.crc32(this.decompressed)!==this.crc32))throw new Error("Corrupted zip : CRC32 mismatch")},readCentralPart:function(e){if(this.versionMadeBy=e.readInt(2),this.versionNeeded=e.readInt(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4),this.fileNameLength=e.readInt(2),this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");this.fileName=e.readString(this.fileNameLength),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readString(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=16&this.externalFileAttributes?!0:!1,e===c&&(this.dosPermissions=63&this.externalFileAttributes),e===u&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileName.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(e){if(this.extraFields[1]){var t=new i(this.extraFields[1].value);this.uncompressedSize===s.MAX_VALUE_32BITS&&(this.uncompressedSize=t.readInt(8)),this.compressedSize===s.MAX_VALUE_32BITS&&(this.compressedSize=t.readInt(8)),this.localHeaderOffset===s.MAX_VALUE_32BITS&&(this.localHeaderOffset=t.readInt(8)),this.diskNumberStart===s.MAX_VALUE_32BITS&&(this.diskNumberStart=t.readInt(4))}},readExtraFields:function(e){var t,n,r,i=e.index;for(this.extraFields=this.extraFields||{};e.index<i+this.extraFieldsLength;)t=e.readInt(2),n=e.readInt(2),r=e.readString(n),this.extraFields[t]={id:t,length:n,value:r}},handleUTF8:function(){if(this.useUTF8())this.fileName=o.utf8decode(this.fileName),this.fileComment=o.utf8decode(this.fileComment);else{var e=this.findExtraFieldUnicodePath();null!==e&&(this.fileName=e);var t=this.findExtraFieldUnicodeComment();null!==t&&(this.fileComment=t)}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=new i(e.value);return 1!==t.readInt(1)?null:o.crc32(this.fileName)!==t.readInt(4)?null:o.utf8decode(t.readString(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=new i(e.value);return 1!==t.readInt(1)?null:o.crc32(this.fileComment)!==t.readInt(4)?null:o.utf8decode(t.readString(e.length-5))}return null}},t.exports=r},{"./compressedObject":2,"./object":13,"./stringReader":15,"./utils":21}],24:[function(e,t,n){"use strict";var r=e("./lib/utils/common").assign,i=e("./lib/deflate"),s=e("./lib/inflate"),a=e("./lib/zlib/constants"),o={};r(o,i,s,a),t.exports=o},{"./lib/deflate":25,"./lib/inflate":26,"./lib/utils/common":27,"./lib/zlib/constants":30}],25:[function(e,t,n){"use strict";function r(e,t){var n=new y(t);if(n.push(e,!0),n.err)throw n.msg;return n.result}function i(e,t){return t=t||{},t.raw=!0,r(e,t)}function s(e,t){return t=t||{},t.gzip=!0,r(e,t)}var a=e("./zlib/deflate.js"),o=e("./utils/common"),c=e("./utils/strings"),u=e("./zlib/messages"),l=e("./zlib/zstream"),f=0,d=4,p=0,h=1,m=-1,v=0,g=8,y=function(e){this.options=o.assign({level:m,method:g,chunkSize:16384,windowBits:15,memLevel:8,strategy:v,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var n=a.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==p)throw new Error(u[n]);t.header&&a.deflateSetHeader(this.strm,t.header)};y.prototype.push=function(e,t){var n,r,i=this.strm,s=this.options.chunkSize;if(this.ended)return!1;r=t===~~t?t:t===!0?d:f,"string"==typeof e?i.input=c.string2buf(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;do{if(0===i.avail_out&&(i.output=new o.Buf8(s),i.next_out=0,i.avail_out=s),n=a.deflate(i,r),n!==h&&n!==p)return this.onEnd(n),this.ended=!0,!1;(0===i.avail_out||0===i.avail_in&&r===d)&&("string"===this.options.to?this.onData(c.buf2binstring(o.shrinkBuf(i.output,i.next_out))):this.onData(o.shrinkBuf(i.output,i.next_out)))}while((i.avail_in>0||0===i.avail_out)&&n!==h);return r===d?(n=a.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===p):!0},y.prototype.onData=function(e){this.chunks.push(e)},y.prototype.onEnd=function(e){e===p&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Deflate=y,n.deflate=r,n.deflateRaw=i,n.gzip=s},{"./utils/common":27,"./utils/strings":28,"./zlib/deflate.js":32,"./zlib/messages":37,"./zlib/zstream":39}],26:[function(e,t,n){"use strict";function r(e,t){var n=new d(t);if(n.push(e,!0),n.err)throw n.msg;return n.result}function i(e,t){return t=t||{},t.raw=!0,r(e,t)}var s=e("./zlib/inflate.js"),a=e("./utils/common"),o=e("./utils/strings"),c=e("./zlib/constants"),u=e("./zlib/messages"),l=e("./zlib/zstream"),f=e("./zlib/gzheader"),d=function(e){this.options=a.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0===(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var n=s.inflateInit2(this.strm,t.windowBits);if(n!==c.Z_OK)throw new Error(u[n]);this.header=new f,s.inflateGetHeader(this.strm,this.header)};d.prototype.push=function(e,t){var n,r,i,u,l,f=this.strm,d=this.options.chunkSize;if(this.ended)return!1;r=t===~~t?t:t===!0?c.Z_FINISH:c.Z_NO_FLUSH,"string"==typeof e?f.input=o.binstring2buf(e):f.input=e,f.next_in=0,f.avail_in=f.input.length;do{if(0===f.avail_out&&(f.output=new a.Buf8(d),f.next_out=0,f.avail_out=d),n=s.inflate(f,c.Z_NO_FLUSH),n!==c.Z_STREAM_END&&n!==c.Z_OK)return this.onEnd(n),this.ended=!0,!1;f.next_out&&(0===f.avail_out||n===c.Z_STREAM_END||0===f.avail_in&&r===c.Z_FINISH)&&("string"===this.options.to?(i=o.utf8border(f.output,f.next_out),u=f.next_out-i,l=o.buf2string(f.output,i),f.next_out=u,f.avail_out=d-u,u&&a.arraySet(f.output,f.output,i,u,0),this.onData(l)):this.onData(a.shrinkBuf(f.output,f.next_out)))}while(f.avail_in>0&&n!==c.Z_STREAM_END);return n===c.Z_STREAM_END&&(r=c.Z_FINISH),r===c.Z_FINISH?(n=s.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===c.Z_OK):!0},d.prototype.onData=function(e){this.chunks.push(e)},d.prototype.onEnd=function(e){e===c.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Inflate=d,n.inflate=r,n.inflateRaw=i,n.ungzip=r},{"./utils/common":27,"./utils/strings":28,"./zlib/constants":30,"./zlib/gzheader":33,"./zlib/inflate.js":35,"./zlib/messages":37,"./zlib/zstream":39}],27:[function(e,t,n){"use strict";var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;n.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])}}return e},n.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var i={arraySet:function(e,t,n,r,i){if(t.subarray&&e.subarray)return void e.set(t.subarray(n,n+r),i);for(var s=0;r>s;s++)e[i+s]=t[n+s]},flattenChunks:function(e){var t,n,r,i,s,a;for(r=0,t=0,n=e.length;n>t;t++)r+=e[t].length;for(a=new Uint8Array(r),i=0,t=0,n=e.length;n>t;t++)s=e[t],a.set(s,i),i+=s.length;return a}},s={arraySet:function(e,t,n,r,i){for(var s=0;r>s;s++)e[i+s]=t[n+s]},flattenChunks:function(e){return[].concat.apply([],e)}};n.setTyped=function(e){e?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,i)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,s))},n.setTyped(r)},{}],28:[function(e,t,n){"use strict";function r(e,t){if(65537>t&&(e.subarray&&a||!e.subarray&&s))return String.fromCharCode.apply(null,i.shrinkBuf(e,t));for(var n="",r=0;t>r;r++)n+=String.fromCharCode(e[r]);return n}var i=e("./common"),s=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch(o){s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(o){a=!1}for(var c=new i.Buf8(256),u=0;256>u;u++)c[u]=u>=252?6:u>=248?5:u>=240?4:u>=224?3:u>=192?2:1;c[254]=c[254]=1,n.string2buf=function(e){var t,n,r,s,a,o=e.length,c=0;for(s=0;o>s;s++)n=e.charCodeAt(s),55296===(64512&n)&&o>s+1&&(r=e.charCodeAt(s+1),56320===(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),s++)),c+=128>n?1:2048>n?2:65536>n?3:4;for(t=new i.Buf8(c),a=0,s=0;c>a;s++)n=e.charCodeAt(s),55296===(64512&n)&&o>s+1&&(r=e.charCodeAt(s+1),56320===(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),s++)),128>n?t[a++]=n:2048>n?(t[a++]=192|n>>>6,t[a++]=128|63&n):65536>n?(t[a++]=224|n>>>12,t[a++]=128|n>>>6&63,t[a++]=128|63&n):(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63,t[a++]=128|n>>>6&63,t[a++]=128|63&n);return t},n.buf2binstring=function(e){return r(e,e.length)},n.binstring2buf=function(e){for(var t=new i.Buf8(e.length),n=0,r=t.length;r>n;n++)t[n]=e.charCodeAt(n);return t},n.buf2string=function(e,t){var n,i,s,a,o=t||e.length,u=new Array(2*o);for(i=0,n=0;o>n;)if(s=e[n++],128>s)u[i++]=s;else if(a=c[s],a>4)u[i++]=65533,n+=a-1;else{for(s&=2===a?31:3===a?15:7;a>1&&o>n;)s=s<<6|63&e[n++],a--;a>1?u[i++]=65533:65536>s?u[i++]=s:(s-=65536,u[i++]=55296|s>>10&1023,u[i++]=56320|1023&s)}return r(u,i)},n.utf8border=function(e,t){var n;for(t=t||e.length,t>e.length&&(t=e.length),n=t-1;n>=0&&128===(192&e[n]);)n--;return 0>n?t:0===n?t:n+c[e[n]]>t?n:t}},{"./common":27}],29:[function(e,t,n){"use strict";function r(e,t,n,r){for(var i=65535&e|0,s=e>>>16&65535|0,a=0;0!==n;){a=n>2e3?2e3:n,n-=a;do i=i+t[r++]|0,s=s+i|0;while(--a);i%=65521,s%=65521}return i|s<<16|0}t.exports=r},{}],30:[function(e,t,n){t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],31:[function(e,t,n){"use strict";function r(){for(var e,t=[],n=0;256>n;n++){e=n;for(var r=0;8>r;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}function i(e,t,n,r){var i=s,a=r+n;e=-1^e;for(var o=r;a>o;o++)e=e>>>8^i[255&(e^t[o])];return-1^e}var s=r();t.exports=i},{}],32:[function(e,t,n){"use strict";function r(e,t){return e.msg=R[t],t}function i(e){return(e<<1)-(e>4?9:0)}function s(e){for(var t=e.length;--t>=0;)e[t]=0}function a(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(O.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function o(e,t){A._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,a(e.strm)}function c(e,t){e.pending_buf[e.pending++]=t}function u(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function l(e,t,n,r){var i=e.avail_in;return i>r&&(i=r),0===i?0:(e.avail_in-=i,O.arraySet(t,e.input,e.next_in,i,n),1===e.state.wrap?e.adler=N(e.adler,t,i,n):2===e.state.wrap&&(e.adler=B(e.adler,t,i,n)),e.next_in+=i,e.total_in+=i,i)}function f(e,t){var n,r,i=e.max_chain_length,s=e.strstart,a=e.prev_length,o=e.nice_match,c=e.strstart>e.w_size-ue?e.strstart-(e.w_size-ue):0,u=e.window,l=e.w_mask,f=e.prev,d=e.strstart+ce,p=u[s+a-1],h=u[s+a];e.prev_length>=e.good_match&&(i>>=2),o>e.lookahead&&(o=e.lookahead);do if(n=t,u[n+a]===h&&u[n+a-1]===p&&u[n]===u[s]&&u[++n]===u[s+1]){s+=2,n++;do;while(u[++s]===u[++n]&&u[++s]===u[++n]&&u[++s]===u[++n]&&u[++s]===u[++n]&&u[++s]===u[++n]&&u[++s]===u[++n]&&u[++s]===u[++n]&&u[++s]===u[++n]&&d>s);if(r=ce-(d-s),s=d-ce,r>a){if(e.match_start=t,a=r,r>=o)break;p=u[s+a-1],h=u[s+a]}}while((t=f[t&l])>c&&0!==--i);return a<=e.lookahead?a:e.lookahead}function d(e){var t,n,r,i,s,a=e.w_size;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=a+(a-ue)){O.arraySet(e.window,e.window,a,a,0),e.match_start-=a,e.strstart-=a,e.block_start-=a,n=e.hash_size,t=n;do r=e.head[--t],e.head[t]=r>=a?r-a:0;while(--n);n=a,t=n;do r=e.prev[--t],e.prev[t]=r>=a?r-a:0;while(--n);i+=a}if(0===e.strm.avail_in)break;if(n=l(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=n,e.lookahead+e.insert>=oe)for(s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+oe-1])&e.hash_mask,e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,!(e.lookahead+e.insert<oe)););}while(e.lookahead<ue&&0!==e.strm.avail_in)}function p(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(d(e),0===e.lookahead&&t===P)return ye;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var r=e.block_start+n;if((0===e.strstart||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,o(e,!1),0===e.strm.avail_out))return ye;if(e.strstart-e.block_start>=e.w_size-ue&&(o(e,!1),0===e.strm.avail_out))return ye}return e.insert=0,t===M?(o(e,!0),0===e.strm.avail_out?be:xe):e.strstart>e.block_start&&(o(e,!1),0===e.strm.avail_out)?ye:ye}function h(e,t){for(var n,r;;){if(e.lookahead<ue){if(d(e),e.lookahead<ue&&t===P)return ye;if(0===e.lookahead)break}if(n=0,e.lookahead>=oe&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+oe-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-ue&&(e.match_length=f(e,n)),e.match_length>=oe)if(r=A._tr_tally(e,e.strstart-e.match_start,e.match_length-oe),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=oe){e.match_length--;do e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+oe-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(0!==--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else r=A._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(o(e,!1),0===e.strm.avail_out))return ye}return e.insert=e.strstart<oe-1?e.strstart:oe-1,t===M?(o(e,!0),0===e.strm.avail_out?be:xe):e.last_lit&&(o(e,!1),0===e.strm.avail_out)?ye:_e}function m(e,t){for(var n,r,i;;){if(e.lookahead<ue){if(d(e),e.lookahead<ue&&t===P)return ye;if(0===e.lookahead)break}if(n=0,e.lookahead>=oe&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+oe-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=oe-1,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-ue&&(e.match_length=f(e,n),e.match_length<=5&&(e.strategy===U||e.match_length===oe&&e.strstart-e.match_start>4096)&&(e.match_length=oe-1)),e.prev_length>=oe&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-oe,r=A._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-oe),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+oe-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(0!==--e.prev_length);if(e.match_available=0,e.match_length=oe-1,e.strstart++,r&&(o(e,!1),0===e.strm.avail_out))return ye}else if(e.match_available){if(r=A._tr_tally(e,0,e.window[e.strstart-1]),r&&o(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return ye}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=A._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<oe-1?e.strstart:oe-1,t===M?(o(e,!0),0===e.strm.avail_out?be:xe):e.last_lit&&(o(e,!1),0===e.strm.avail_out)?ye:_e}function v(e,t){for(var n,r,i,s,a=e.window;;){if(e.lookahead<=ce){if(d(e),e.lookahead<=ce&&t===P)return ye;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=oe&&e.strstart>0&&(i=e.strstart-1,r=a[i],r===a[++i]&&r===a[++i]&&r===a[++i])){s=e.strstart+ce;do;while(r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&s>i);e.match_length=ce-(s-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=oe?(n=A._tr_tally(e,1,e.match_length-oe),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=A._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(o(e,!1),0===e.strm.avail_out))return ye}return e.insert=0,t===M?(o(e,!0),0===e.strm.avail_out?be:xe):e.last_lit&&(o(e,!1),0===e.strm.avail_out)?ye:_e}function g(e,t){for(var n;;){if(0===e.lookahead&&(d(e),0===e.lookahead)){if(t===P)return ye;break}if(e.match_length=0,n=A._tr_tally(e,0,e.window[e.strstart]),
e.lookahead--,e.strstart++,n&&(o(e,!1),0===e.strm.avail_out))return ye}return e.insert=0,t===M?(o(e,!0),0===e.strm.avail_out?be:xe):e.last_lit&&(o(e,!1),0===e.strm.avail_out)?ye:_e}function y(e){e.window_size=2*e.w_size,s(e.head),e.max_lazy_match=S[e.level].max_lazy,e.good_match=S[e.level].good_length,e.nice_match=S[e.level].nice_length,e.max_chain_length=S[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=oe-1,e.match_available=0,e.ins_h=0}function _(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=K,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new O.Buf16(2*se),this.dyn_dtree=new O.Buf16(2*(2*re+1)),this.bl_tree=new O.Buf16(2*(2*ie+1)),s(this.dyn_ltree),s(this.dyn_dtree),s(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new O.Buf16(ae+1),this.heap=new O.Buf16(2*ne+1),s(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new O.Buf16(2*ne+1),s(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function b(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=X,t=e.state,t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?fe:ve,e.adler=2===t.wrap?0:1,t.last_flush=P,A._tr_init(t),j):r(e,F)}function x(e){var t=b(e);return t===j&&y(e.state),t}function w(e,t){return e&&e.state?2!==e.state.wrap?F:(e.state.gzhead=t,j):F}function k(e,t,n,i,s,a){if(!e)return F;var o=1;if(t===H&&(t=6),0>i?(o=0,i=-i):i>15&&(o=2,i-=16),1>s||s>G||n!==K||8>i||i>15||0>t||t>9||0>a||a>W)return r(e,F);8===i&&(i=9);var c=new _;return e.state=c,c.strm=e,c.wrap=o,c.gzhead=null,c.w_bits=i,c.w_size=1<<c.w_bits,c.w_mask=c.w_size-1,c.hash_bits=s+7,c.hash_size=1<<c.hash_bits,c.hash_mask=c.hash_size-1,c.hash_shift=~~((c.hash_bits+oe-1)/oe),c.window=new O.Buf8(2*c.w_size),c.head=new O.Buf16(c.hash_size),c.prev=new O.Buf16(c.w_size),c.lit_bufsize=1<<s+6,c.pending_buf_size=4*c.lit_bufsize,c.pending_buf=new O.Buf8(c.pending_buf_size),c.d_buf=c.lit_bufsize>>1,c.l_buf=3*c.lit_bufsize,c.level=t,c.strategy=a,c.method=n,x(e)}function E(e,t){return k(e,t,K,Y,Z,J)}function C(e,t){var n,o,l,f;if(!e||!e.state||t>D||0>t)return e?r(e,F):F;if(o=e.state,!e.output||!e.input&&0!==e.avail_in||o.status===ge&&t!==M)return r(e,0===e.avail_out?z:F);if(o.strm=e,n=o.last_flush,o.last_flush=t,o.status===fe)if(2===o.wrap)e.adler=0,c(o,31),c(o,139),c(o,8),o.gzhead?(c(o,(o.gzhead.text?1:0)+(o.gzhead.hcrc?2:0)+(o.gzhead.extra?4:0)+(o.gzhead.name?8:0)+(o.gzhead.comment?16:0)),c(o,255&o.gzhead.time),c(o,o.gzhead.time>>8&255),c(o,o.gzhead.time>>16&255),c(o,o.gzhead.time>>24&255),c(o,9===o.level?2:o.strategy>=$||o.level<2?4:0),c(o,255&o.gzhead.os),o.gzhead.extra&&o.gzhead.extra.length&&(c(o,255&o.gzhead.extra.length),c(o,o.gzhead.extra.length>>8&255)),o.gzhead.hcrc&&(e.adler=B(e.adler,o.pending_buf,o.pending,0)),o.gzindex=0,o.status=de):(c(o,0),c(o,0),c(o,0),c(o,0),c(o,0),c(o,9===o.level?2:o.strategy>=$||o.level<2?4:0),c(o,we),o.status=ve);else{var d=K+(o.w_bits-8<<4)<<8,p=-1;p=o.strategy>=$||o.level<2?0:o.level<6?1:6===o.level?2:3,d|=p<<6,0!==o.strstart&&(d|=le),d+=31-d%31,o.status=ve,u(o,d),0!==o.strstart&&(u(o,e.adler>>>16),u(o,65535&e.adler)),e.adler=1}if(o.status===de)if(o.gzhead.extra){for(l=o.pending;o.gzindex<(65535&o.gzhead.extra.length)&&(o.pending!==o.pending_buf_size||(o.gzhead.hcrc&&o.pending>l&&(e.adler=B(e.adler,o.pending_buf,o.pending-l,l)),a(e),l=o.pending,o.pending!==o.pending_buf_size));)c(o,255&o.gzhead.extra[o.gzindex]),o.gzindex++;o.gzhead.hcrc&&o.pending>l&&(e.adler=B(e.adler,o.pending_buf,o.pending-l,l)),o.gzindex===o.gzhead.extra.length&&(o.gzindex=0,o.status=pe)}else o.status=pe;if(o.status===pe)if(o.gzhead.name){l=o.pending;do{if(o.pending===o.pending_buf_size&&(o.gzhead.hcrc&&o.pending>l&&(e.adler=B(e.adler,o.pending_buf,o.pending-l,l)),a(e),l=o.pending,o.pending===o.pending_buf_size)){f=1;break}f=o.gzindex<o.gzhead.name.length?255&o.gzhead.name.charCodeAt(o.gzindex++):0,c(o,f)}while(0!==f);o.gzhead.hcrc&&o.pending>l&&(e.adler=B(e.adler,o.pending_buf,o.pending-l,l)),0===f&&(o.gzindex=0,o.status=he)}else o.status=he;if(o.status===he)if(o.gzhead.comment){l=o.pending;do{if(o.pending===o.pending_buf_size&&(o.gzhead.hcrc&&o.pending>l&&(e.adler=B(e.adler,o.pending_buf,o.pending-l,l)),a(e),l=o.pending,o.pending===o.pending_buf_size)){f=1;break}f=o.gzindex<o.gzhead.comment.length?255&o.gzhead.comment.charCodeAt(o.gzindex++):0,c(o,f)}while(0!==f);o.gzhead.hcrc&&o.pending>l&&(e.adler=B(e.adler,o.pending_buf,o.pending-l,l)),0===f&&(o.status=me)}else o.status=me;if(o.status===me&&(o.gzhead.hcrc?(o.pending+2>o.pending_buf_size&&a(e),o.pending+2<=o.pending_buf_size&&(c(o,255&e.adler),c(o,e.adler>>8&255),e.adler=0,o.status=ve)):o.status=ve),0!==o.pending){if(a(e),0===e.avail_out)return o.last_flush=-1,j}else if(0===e.avail_in&&i(t)<=i(n)&&t!==M)return r(e,z);if(o.status===ge&&0!==e.avail_in)return r(e,z);if(0!==e.avail_in||0!==o.lookahead||t!==P&&o.status!==ge){var h=o.strategy===$?g(o,t):o.strategy===Q?v(o,t):S[o.level].func(o,t);if((h===be||h===xe)&&(o.status=ge),h===ye||h===be)return 0===e.avail_out&&(o.last_flush=-1),j;if(h===_e&&(t===L?A._tr_align(o):t!==D&&(A._tr_stored_block(o,0,0,!1),t===I&&(s(o.head),0===o.lookahead&&(o.strstart=0,o.block_start=0,o.insert=0))),a(e),0===e.avail_out))return o.last_flush=-1,j}return t!==M?j:o.wrap<=0?V:(2===o.wrap?(c(o,255&e.adler),c(o,e.adler>>8&255),c(o,e.adler>>16&255),c(o,e.adler>>24&255),c(o,255&e.total_in),c(o,e.total_in>>8&255),c(o,e.total_in>>16&255),c(o,e.total_in>>24&255)):(u(o,e.adler>>>16),u(o,65535&e.adler)),a(e),o.wrap>0&&(o.wrap=-o.wrap),0!==o.pending?j:V)}function T(e){var t;return e&&e.state?(t=e.state.status,t!==fe&&t!==de&&t!==pe&&t!==he&&t!==me&&t!==ve&&t!==ge?r(e,F):(e.state=null,t===ve?r(e,q):j)):F}var S,O=e("../utils/common"),A=e("./trees"),N=e("./adler32"),B=e("./crc32"),R=e("./messages"),P=0,L=1,I=3,M=4,D=5,j=0,V=1,F=-2,q=-3,z=-5,H=-1,U=1,$=2,Q=3,W=4,J=0,X=2,K=8,G=9,Y=15,Z=8,ee=29,te=256,ne=te+1+ee,re=30,ie=19,se=2*ne+1,ae=15,oe=3,ce=258,ue=ce+oe+1,le=32,fe=42,de=69,pe=73,he=91,me=103,ve=113,ge=666,ye=1,_e=2,be=3,xe=4,we=3,ke=function(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i};S=[new ke(0,0,0,0,p),new ke(4,4,8,4,h),new ke(4,5,16,8,h),new ke(4,6,32,32,h),new ke(4,4,16,16,m),new ke(8,16,32,32,m),new ke(8,16,128,128,m),new ke(8,32,128,256,m),new ke(32,128,258,1024,m),new ke(32,258,258,4096,m)],n.deflateInit=E,n.deflateInit2=k,n.deflateReset=x,n.deflateResetKeep=b,n.deflateSetHeader=w,n.deflate=C,n.deflateEnd=T,n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":27,"./adler32":29,"./crc32":31,"./messages":37,"./trees":38}],33:[function(e,t,n){"use strict";function r(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}t.exports=r},{}],34:[function(e,t,n){"use strict";var r=30,i=12;t.exports=function(e,t){var n,s,a,o,c,u,l,f,d,p,h,m,v,g,y,_,b,x,w,k,E,C,T,S,O;n=e.state,s=e.next_in,S=e.input,a=s+(e.avail_in-5),o=e.next_out,O=e.output,c=o-(t-e.avail_out),u=o+(e.avail_out-257),l=n.dmax,f=n.wsize,d=n.whave,p=n.wnext,h=n.window,m=n.hold,v=n.bits,g=n.lencode,y=n.distcode,_=(1<<n.lenbits)-1,b=(1<<n.distbits)-1;e:do{15>v&&(m+=S[s++]<<v,v+=8,m+=S[s++]<<v,v+=8),x=g[m&_];t:for(;;){if(w=x>>>24,m>>>=w,v-=w,w=x>>>16&255,0===w)O[o++]=65535&x;else{if(!(16&w)){if(0===(64&w)){x=g[(65535&x)+(m&(1<<w)-1)];continue t}if(32&w){n.mode=i;break e}e.msg="invalid literal/length code",n.mode=r;break e}k=65535&x,w&=15,w&&(w>v&&(m+=S[s++]<<v,v+=8),k+=m&(1<<w)-1,m>>>=w,v-=w),15>v&&(m+=S[s++]<<v,v+=8,m+=S[s++]<<v,v+=8),x=y[m&b];n:for(;;){if(w=x>>>24,m>>>=w,v-=w,w=x>>>16&255,!(16&w)){if(0===(64&w)){x=y[(65535&x)+(m&(1<<w)-1)];continue n}e.msg="invalid distance code",n.mode=r;break e}if(E=65535&x,w&=15,w>v&&(m+=S[s++]<<v,v+=8,w>v&&(m+=S[s++]<<v,v+=8)),E+=m&(1<<w)-1,E>l){e.msg="invalid distance too far back",n.mode=r;break e}if(m>>>=w,v-=w,w=o-c,E>w){if(w=E-w,w>d&&n.sane){e.msg="invalid distance too far back",n.mode=r;break e}if(C=0,T=h,0===p){if(C+=f-w,k>w){k-=w;do O[o++]=h[C++];while(--w);C=o-E,T=O}}else if(w>p){if(C+=f+p-w,w-=p,k>w){k-=w;do O[o++]=h[C++];while(--w);if(C=0,k>p){w=p,k-=w;do O[o++]=h[C++];while(--w);C=o-E,T=O}}}else if(C+=p-w,k>w){k-=w;do O[o++]=h[C++];while(--w);C=o-E,T=O}for(;k>2;)O[o++]=T[C++],O[o++]=T[C++],O[o++]=T[C++],k-=3;k&&(O[o++]=T[C++],k>1&&(O[o++]=T[C++]))}else{C=o-E;do O[o++]=O[C++],O[o++]=O[C++],O[o++]=O[C++],k-=3;while(k>2);k&&(O[o++]=O[C++],k>1&&(O[o++]=O[C++]))}break}}break}}while(a>s&&u>o);k=v>>3,s-=k,v-=k<<3,m&=(1<<v)-1,e.next_in=s,e.next_out=o,e.avail_in=a>s?5+(a-s):5-(s-a),e.avail_out=u>o?257+(u-o):257-(o-u),n.hold=m,n.bits=v}},{}],35:[function(e,t,n){"use strict";function r(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function i(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new g.Buf16(320),this.work=new g.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function s(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=M,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new g.Buf32(he),t.distcode=t.distdyn=new g.Buf32(me),t.sane=1,t.back=-1,O):B}function a(e){var t;return e&&e.state?(t=e.state,t.wsize=0,t.whave=0,t.wnext=0,s(e)):B}function o(e,t){var n,r;return e&&e.state?(r=e.state,0>t?(n=0,t=-t):(n=(t>>4)+1,48>t&&(t&=15)),t&&(8>t||t>15)?B:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,a(e))):B}function c(e,t){var n,r;return e?(r=new i,e.state=r,r.window=null,n=o(e,t),n!==O&&(e.state=null),n):B}function u(e){return c(e,ge)}function l(e){if(ye){var t;for(m=new g.Buf32(512),v=new g.Buf32(32),t=0;144>t;)e.lens[t++]=8;for(;256>t;)e.lens[t++]=9;for(;280>t;)e.lens[t++]=7;for(;288>t;)e.lens[t++]=8;for(x(k,e.lens,0,288,m,0,e.work,{bits:9}),t=0;32>t;)e.lens[t++]=5;x(E,e.lens,0,32,v,0,e.work,{bits:5}),ye=!1}e.lencode=m,e.lenbits=9,e.distcode=v,e.distbits=5}function f(e,t,n,r){var i,s=e.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new g.Buf8(s.wsize)),r>=s.wsize?(g.arraySet(s.window,t,n-s.wsize,s.wsize,0),s.wnext=0,s.whave=s.wsize):(i=s.wsize-s.wnext,i>r&&(i=r),g.arraySet(s.window,t,n-r,i,s.wnext),r-=i,r?(g.arraySet(s.window,t,n-r,r,0),s.wnext=r,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0}function d(e,t){var n,i,s,a,o,c,u,d,p,h,m,v,he,me,ve,ge,ye,_e,be,xe,we,ke,Ee,Ce,Te=0,Se=new g.Buf8(4),Oe=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return B;n=e.state,n.mode===W&&(n.mode=J),o=e.next_out,s=e.output,u=e.avail_out,a=e.next_in,i=e.input,c=e.avail_in,d=n.hold,p=n.bits,h=c,m=u,ke=O;e:for(;;)switch(n.mode){case M:if(0===n.wrap){n.mode=J;break}for(;16>p;){if(0===c)break e;c--,d+=i[a++]<<p,p+=8}if(2&n.wrap&&35615===d){n.check=0,Se[0]=255&d,Se[1]=d>>>8&255,n.check=_(n.check,Se,2,0),d=0,p=0,n.mode=D;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&d)<<8)+(d>>8))%31){e.msg="incorrect header check",n.mode=fe;break}if((15&d)!==I){e.msg="unknown compression method",n.mode=fe;break}if(d>>>=4,p-=4,we=(15&d)+8,0===n.wbits)n.wbits=we;else if(we>n.wbits){e.msg="invalid window size",n.mode=fe;break}n.dmax=1<<we,e.adler=n.check=1,n.mode=512&d?$:W,d=0,p=0;break;case D:for(;16>p;){if(0===c)break e;c--,d+=i[a++]<<p,p+=8}if(n.flags=d,(255&n.flags)!==I){e.msg="unknown compression method",n.mode=fe;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=fe;break}n.head&&(n.head.text=d>>8&1),512&n.flags&&(Se[0]=255&d,Se[1]=d>>>8&255,n.check=_(n.check,Se,2,0)),d=0,p=0,n.mode=j;case j:for(;32>p;){if(0===c)break e;c--,d+=i[a++]<<p,p+=8}n.head&&(n.head.time=d),512&n.flags&&(Se[0]=255&d,Se[1]=d>>>8&255,Se[2]=d>>>16&255,Se[3]=d>>>24&255,n.check=_(n.check,Se,4,0)),d=0,p=0,n.mode=V;case V:for(;16>p;){if(0===c)break e;c--,d+=i[a++]<<p,p+=8}n.head&&(n.head.xflags=255&d,n.head.os=d>>8),512&n.flags&&(Se[0]=255&d,Se[1]=d>>>8&255,n.check=_(n.check,Se,2,0)),d=0,p=0,n.mode=F;case F:if(1024&n.flags){for(;16>p;){if(0===c)break e;c--,d+=i[a++]<<p,p+=8}n.length=d,n.head&&(n.head.extra_len=d),512&n.flags&&(Se[0]=255&d,Se[1]=d>>>8&255,n.check=_(n.check,Se,2,0)),d=0,p=0}else n.head&&(n.head.extra=null);n.mode=q;case q:if(1024&n.flags&&(v=n.length,v>c&&(v=c),v&&(n.head&&(we=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),g.arraySet(n.head.extra,i,a,v,we)),512&n.flags&&(n.check=_(n.check,i,v,a)),c-=v,a+=v,n.length-=v),n.length))break e;n.length=0,n.mode=z;case z:if(2048&n.flags){if(0===c)break e;v=0;do we=i[a+v++],n.head&&we&&n.length<65536&&(n.head.name+=String.fromCharCode(we));while(we&&c>v);if(512&n.flags&&(n.check=_(n.check,i,v,a)),c-=v,a+=v,we)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=H;case H:if(4096&n.flags){if(0===c)break e;v=0;do we=i[a+v++],n.head&&we&&n.length<65536&&(n.head.comment+=String.fromCharCode(we));while(we&&c>v);if(512&n.flags&&(n.check=_(n.check,i,v,a)),c-=v,a+=v,we)break e}else n.head&&(n.head.comment=null);n.mode=U;case U:if(512&n.flags){for(;16>p;){if(0===c)break e;c--,d+=i[a++]<<p,p+=8}if(d!==(65535&n.check)){e.msg="header crc mismatch",n.mode=fe;break}d=0,p=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=W;break;case $:for(;32>p;){if(0===c)break e;c--,d+=i[a++]<<p,p+=8}e.adler=n.check=r(d),d=0,p=0,n.mode=Q;case Q:if(0===n.havedict)return e.next_out=o,e.avail_out=u,e.next_in=a,e.avail_in=c,n.hold=d,n.bits=p,N;e.adler=n.check=1,n.mode=W;case W:if(t===T||t===S)break e;case J:if(n.last){d>>>=7&p,p-=7&p,n.mode=ce;break}for(;3>p;){if(0===c)break e;c--,d+=i[a++]<<p,p+=8}switch(n.last=1&d,d>>>=1,p-=1,3&d){case 0:n.mode=X;break;case 1:if(l(n),n.mode=te,t===S){d>>>=2,p-=2;break e}break;case 2:n.mode=Y;break;case 3:e.msg="invalid block type",n.mode=fe}d>>>=2,p-=2;break;case X:for(d>>>=7&p,p-=7&p;32>p;){if(0===c)break e;c--,d+=i[a++]<<p,p+=8}if((65535&d)!==(d>>>16^65535)){e.msg="invalid stored block lengths",n.mode=fe;break}if(n.length=65535&d,d=0,p=0,n.mode=K,t===S)break e;case K:n.mode=G;case G:if(v=n.length){if(v>c&&(v=c),v>u&&(v=u),0===v)break e;g.arraySet(s,i,a,v,o),c-=v,a+=v,u-=v,o+=v,n.length-=v;break}n.mode=W;break;case Y:for(;14>p;){if(0===c)break e;c--,d+=i[a++]<<p,p+=8}if(n.nlen=(31&d)+257,d>>>=5,p-=5,n.ndist=(31&d)+1,d>>>=5,p-=5,n.ncode=(15&d)+4,d>>>=4,p-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=fe;break}n.have=0,n.mode=Z;case Z:for(;n.have<n.ncode;){for(;3>p;){if(0===c)break e;c--,d+=i[a++]<<p,p+=8}n.lens[Oe[n.have++]]=7&d,d>>>=3,p-=3}for(;n.have<19;)n.lens[Oe[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,Ee={bits:n.lenbits},ke=x(w,n.lens,0,19,n.lencode,0,n.work,Ee),n.lenbits=Ee.bits,ke){e.msg="invalid code lengths set",n.mode=fe;break}n.have=0,n.mode=ee;case ee:for(;n.have<n.nlen+n.ndist;){for(;Te=n.lencode[d&(1<<n.lenbits)-1],ve=Te>>>24,ge=Te>>>16&255,ye=65535&Te,!(p>=ve);){if(0===c)break e;c--,d+=i[a++]<<p,p+=8}if(16>ye)d>>>=ve,p-=ve,n.lens[n.have++]=ye;else{if(16===ye){for(Ce=ve+2;Ce>p;){if(0===c)break e;c--,d+=i[a++]<<p,p+=8}if(d>>>=ve,p-=ve,0===n.have){e.msg="invalid bit length repeat",n.mode=fe;break}we=n.lens[n.have-1],v=3+(3&d),d>>>=2,p-=2}else if(17===ye){for(Ce=ve+3;Ce>p;){if(0===c)break e;c--,d+=i[a++]<<p,p+=8}d>>>=ve,p-=ve,we=0,v=3+(7&d),d>>>=3,p-=3}else{for(Ce=ve+7;Ce>p;){if(0===c)break e;c--,d+=i[a++]<<p,p+=8}d>>>=ve,p-=ve,we=0,v=11+(127&d),d>>>=7,p-=7}if(n.have+v>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=fe;break}for(;v--;)n.lens[n.have++]=we}}if(n.mode===fe)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=fe;break}if(n.lenbits=9,Ee={bits:n.lenbits},ke=x(k,n.lens,0,n.nlen,n.lencode,0,n.work,Ee),n.lenbits=Ee.bits,ke){e.msg="invalid literal/lengths set",n.mode=fe;break}if(n.distbits=6,n.distcode=n.distdyn,Ee={bits:n.distbits},ke=x(E,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,Ee),n.distbits=Ee.bits,ke){e.msg="invalid distances set",n.mode=fe;break}if(n.mode=te,t===S)break e;case te:n.mode=ne;case ne:if(c>=6&&u>=258){e.next_out=o,e.avail_out=u,e.next_in=a,e.avail_in=c,n.hold=d,n.bits=p,b(e,m),o=e.next_out,s=e.output,u=e.avail_out,a=e.next_in,i=e.input,c=e.avail_in,d=n.hold,p=n.bits,n.mode===W&&(n.back=-1);break}for(n.back=0;Te=n.lencode[d&(1<<n.lenbits)-1],ve=Te>>>24,ge=Te>>>16&255,ye=65535&Te,!(p>=ve);){if(0===c)break e;c--,d+=i[a++]<<p,p+=8}if(ge&&0===(240&ge)){for(_e=ve,be=ge,xe=ye;Te=n.lencode[xe+((d&(1<<_e+be)-1)>>_e)],ve=Te>>>24,ge=Te>>>16&255,ye=65535&Te,!(p>=_e+ve);){if(0===c)break e;c--,d+=i[a++]<<p,p+=8}d>>>=_e,p-=_e,n.back+=_e}if(d>>>=ve,p-=ve,n.back+=ve,n.length=ye,0===ge){n.mode=oe;break}if(32&ge){n.back=-1,n.mode=W;break}if(64&ge){e.msg="invalid literal/length code",n.mode=fe;break}n.extra=15&ge,n.mode=re;case re:if(n.extra){for(Ce=n.extra;Ce>p;){if(0===c)break e;c--,d+=i[a++]<<p,p+=8}n.length+=d&(1<<n.extra)-1,d>>>=n.extra,p-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=ie;case ie:for(;Te=n.distcode[d&(1<<n.distbits)-1],ve=Te>>>24,ge=Te>>>16&255,ye=65535&Te,!(p>=ve);){if(0===c)break e;c--,d+=i[a++]<<p,p+=8}if(0===(240&ge)){for(_e=ve,be=ge,xe=ye;Te=n.distcode[xe+((d&(1<<_e+be)-1)>>_e)],ve=Te>>>24,ge=Te>>>16&255,ye=65535&Te,!(p>=_e+ve);){if(0===c)break e;c--,d+=i[a++]<<p,p+=8}d>>>=_e,p-=_e,n.back+=_e}if(d>>>=ve,p-=ve,n.back+=ve,64&ge){e.msg="invalid distance code",n.mode=fe;break}n.offset=ye,n.extra=15&ge,n.mode=se;case se:if(n.extra){for(Ce=n.extra;Ce>p;){if(0===c)break e;c--,d+=i[a++]<<p,p+=8}n.offset+=d&(1<<n.extra)-1,d>>>=n.extra,p-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=fe;break}n.mode=ae;case ae:if(0===u)break e;if(v=m-u,n.offset>v){if(v=n.offset-v,v>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=fe;break}v>n.wnext?(v-=n.wnext,he=n.wsize-v):he=n.wnext-v,v>n.length&&(v=n.length),me=n.window}else me=s,he=o-n.offset,v=n.length;v>u&&(v=u),u-=v,n.length-=v;do s[o++]=me[he++];while(--v);0===n.length&&(n.mode=ne);break;case oe:if(0===u)break e;s[o++]=n.length,u--,n.mode=ne;break;case ce:if(n.wrap){for(;32>p;){if(0===c)break e;c--,d|=i[a++]<<p,p+=8}if(m-=u,e.total_out+=m,n.total+=m,m&&(e.adler=n.check=n.flags?_(n.check,s,m,o-m):y(n.check,s,m,o-m)),m=u,(n.flags?d:r(d))!==n.check){e.msg="incorrect data check",n.mode=fe;break}d=0,p=0}n.mode=ue;case ue:if(n.wrap&&n.flags){for(;32>p;){if(0===c)break e;c--,d+=i[a++]<<p,p+=8}if(d!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=fe;break}d=0,p=0}n.mode=le;case le:ke=A;break e;case fe:ke=R;break e;case de:return P;case pe:default:return B}return e.next_out=o,e.avail_out=u,e.next_in=a,e.avail_in=c,n.hold=d,n.bits=p,(n.wsize||m!==e.avail_out&&n.mode<fe&&(n.mode<ce||t!==C))&&f(e,e.output,e.next_out,m-e.avail_out)?(n.mode=de,P):(h-=e.avail_in,m-=e.avail_out,e.total_in+=h,e.total_out+=m,n.total+=m,n.wrap&&m&&(e.adler=n.check=n.flags?_(n.check,s,m,e.next_out-m):y(n.check,s,m,e.next_out-m)),e.data_type=n.bits+(n.last?64:0)+(n.mode===W?128:0)+(n.mode===te||n.mode===K?256:0),(0===h&&0===m||t===C)&&ke===O&&(ke=L),ke)}function p(e){if(!e||!e.state)return B;var t=e.state;return t.window&&(t.window=null),e.state=null,O}function h(e,t){var n;return e&&e.state?(n=e.state,0===(2&n.wrap)?B:(n.head=t,t.done=!1,O)):B}var m,v,g=e("../utils/common"),y=e("./adler32"),_=e("./crc32"),b=e("./inffast"),x=e("./inftrees"),w=0,k=1,E=2,C=4,T=5,S=6,O=0,A=1,N=2,B=-2,R=-3,P=-4,L=-5,I=8,M=1,D=2,j=3,V=4,F=5,q=6,z=7,H=8,U=9,$=10,Q=11,W=12,J=13,X=14,K=15,G=16,Y=17,Z=18,ee=19,te=20,ne=21,re=22,ie=23,se=24,ae=25,oe=26,ce=27,ue=28,le=29,fe=30,de=31,pe=32,he=852,me=592,ve=15,ge=ve,ye=!0;n.inflateReset=a,n.inflateReset2=o,n.inflateResetKeep=s,n.inflateInit=u,n.inflateInit2=c,n.inflate=d,n.inflateEnd=p,n.inflateGetHeader=h,n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":27,"./adler32":29,"./crc32":31,"./inffast":34,"./inftrees":36}],36:[function(e,t,n){"use strict";var r=e("../utils/common"),i=15,s=852,a=592,o=0,c=1,u=2,l=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],f=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],d=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],p=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,n,h,m,v,g,y){var _,b,x,w,k,E,C,T,S,O=y.bits,A=0,N=0,B=0,R=0,P=0,L=0,I=0,M=0,D=0,j=0,V=null,F=0,q=new r.Buf16(i+1),z=new r.Buf16(i+1),H=null,U=0;for(A=0;i>=A;A++)q[A]=0;for(N=0;h>N;N++)q[t[n+N]]++;for(P=O,R=i;R>=1&&0===q[R];R--);if(P>R&&(P=R),0===R)return m[v++]=20971520,m[v++]=20971520,y.bits=1,0;for(B=1;R>B&&0===q[B];B++);for(B>P&&(P=B),M=1,A=1;i>=A;A++)if(M<<=1,M-=q[A],0>M)return-1;if(M>0&&(e===o||1!==R))return-1;for(z[1]=0,A=1;i>A;A++)z[A+1]=z[A]+q[A];for(N=0;h>N;N++)0!==t[n+N]&&(g[z[t[n+N]]++]=N);if(e===o?(V=H=g,E=19):e===c?(V=l,F-=257,H=f,U-=257,E=256):(V=d,H=p,E=-1),j=0,N=0,A=B,k=v,L=P,I=0,x=-1,D=1<<P,w=D-1,e===c&&D>s||e===u&&D>a)return 1;for(var $=0;;){$++,C=A-I,g[N]<E?(T=0,S=g[N]):g[N]>E?(T=H[U+g[N]],S=V[F+g[N]]):(T=96,S=0),_=1<<A-I,b=1<<L,B=b;do b-=_,m[k+(j>>I)+b]=C<<24|T<<16|S|0;while(0!==b);for(_=1<<A-1;j&_;)_>>=1;if(0!==_?(j&=_-1,j+=_):j=0,N++,0===--q[A]){if(A===R)break;A=t[n+g[N]]}if(A>P&&(j&w)!==x){for(0===I&&(I=P),k+=B,L=A-I,M=1<<L;R>L+I&&(M-=q[L+I],!(0>=M));)L++,M<<=1;if(D+=1<<L,e===c&&D>s||e===u&&D>a)return 1;x=j&w,m[x]=P<<24|L<<16|k-v|0}}return 0!==j&&(m[k+j]=A-I<<24|64<<16|0),y.bits=P,0}},{"../utils/common":27}],37:[function(e,t,n){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],38:[function(e,t,n){"use strict";function r(e){for(var t=e.length;--t>=0;)e[t]=0}function i(e){return 256>e?ae[e]:ae[256+(e>>>7)]}function s(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function a(e,t,n){e.bi_valid>W-n?(e.bi_buf|=t<<e.bi_valid&65535,s(e,e.bi_buf),e.bi_buf=t>>W-e.bi_valid,e.bi_valid+=n-W):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function o(e,t,n){a(e,n[2*t],n[2*t+1])}function c(e,t){var n=0;do n|=1&e,e>>>=1,n<<=1;while(--t>0);return n>>>1}function u(e){16===e.bi_valid?(s(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}function l(e,t){var n,r,i,s,a,o,c=t.dyn_tree,u=t.max_code,l=t.stat_desc.static_tree,f=t.stat_desc.has_stree,d=t.stat_desc.extra_bits,p=t.stat_desc.extra_base,h=t.stat_desc.max_length,m=0;for(s=0;Q>=s;s++)e.bl_count[s]=0;for(c[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;$>n;n++)r=e.heap[n],s=c[2*c[2*r+1]+1]+1,s>h&&(s=h,m++),c[2*r+1]=s,r>u||(e.bl_count[s]++,a=0,r>=p&&(a=d[r-p]),o=c[2*r],e.opt_len+=o*(s+a),f&&(e.static_len+=o*(l[2*r+1]+a)));if(0!==m){do{for(s=h-1;0===e.bl_count[s];)s--;e.bl_count[s]--,e.bl_count[s+1]+=2,e.bl_count[h]--,m-=2}while(m>0);for(s=h;0!==s;s--)for(r=e.bl_count[s];0!==r;)i=e.heap[--n],i>u||(c[2*i+1]!==s&&(e.opt_len+=(s-c[2*i+1])*c[2*i],c[2*i+1]=s),r--)}}function f(e,t,n){var r,i,s=new Array(Q+1),a=0;for(r=1;Q>=r;r++)s[r]=a=a+n[r-1]<<1;for(i=0;t>=i;i++){var o=e[2*i+1];0!==o&&(e[2*i]=c(s[o]++,o))}}function d(){var e,t,n,r,i,s=new Array(Q+1);for(n=0,r=0;F-1>r;r++)for(ce[r]=n,e=0;e<1<<Z[r];e++)oe[n++]=r;for(oe[n-1]=r,i=0,r=0;16>r;r++)for(ue[r]=i,e=0;e<1<<ee[r];e++)ae[i++]=r;for(i>>=7;H>r;r++)for(ue[r]=i<<7,e=0;e<1<<ee[r]-7;e++)ae[256+i++]=r;for(t=0;Q>=t;t++)s[t]=0;for(e=0;143>=e;)ie[2*e+1]=8,e++,s[8]++;for(;255>=e;)ie[2*e+1]=9,e++,s[9]++;for(;279>=e;)ie[2*e+1]=7,e++,s[7]++;for(;287>=e;)ie[2*e+1]=8,e++,s[8]++;for(f(ie,z+1,s),e=0;H>e;e++)se[2*e+1]=5,se[2*e]=c(e,5);le=new pe(ie,Z,q+1,z,Q),fe=new pe(se,ee,0,H,Q),de=new pe(new Array(0),te,0,U,J)}function p(e){var t;for(t=0;z>t;t++)e.dyn_ltree[2*t]=0;for(t=0;H>t;t++)e.dyn_dtree[2*t]=0;for(t=0;U>t;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*X]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function h(e){e.bi_valid>8?s(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function m(e,t,n,r){h(e),r&&(s(e,n),s(e,~n)),N.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}function v(e,t,n,r){var i=2*t,s=2*n;return e[i]<e[s]||e[i]===e[s]&&r[t]<=r[n]}function g(e,t,n){for(var r=e.heap[n],i=n<<1;i<=e.heap_len&&(i<e.heap_len&&v(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!v(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r}function y(e,t,n){var r,s,c,u,l=0;if(0!==e.last_lit)do r=e.pending_buf[e.d_buf+2*l]<<8|e.pending_buf[e.d_buf+2*l+1],s=e.pending_buf[e.l_buf+l],l++,0===r?o(e,s,t):(c=oe[s],o(e,c+q+1,t),u=Z[c],0!==u&&(s-=ce[c],a(e,s,u)),r--,c=i(r),o(e,c,n),u=ee[c],0!==u&&(r-=ue[c],a(e,r,u)));while(l<e.last_lit);o(e,X,t)}function _(e,t){var n,r,i,s=t.dyn_tree,a=t.stat_desc.static_tree,o=t.stat_desc.has_stree,c=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=$,n=0;c>n;n++)0!==s[2*n]?(e.heap[++e.heap_len]=u=n,e.depth[n]=0):s[2*n+1]=0;for(;e.heap_len<2;)i=e.heap[++e.heap_len]=2>u?++u:0,s[2*i]=1,e.depth[i]=0,e.opt_len--,o&&(e.static_len-=a[2*i+1]);for(t.max_code=u,n=e.heap_len>>1;n>=1;n--)g(e,s,n);i=c;do n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],g(e,s,1),r=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=r,s[2*i]=s[2*n]+s[2*r],e.depth[i]=(e.depth[n]>=e.depth[r]?e.depth[n]:e.depth[r])+1,s[2*n+1]=s[2*r+1]=i,e.heap[1]=i++,g(e,s,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],l(e,t),f(s,u,e.bl_count)}function b(e,t,n){var r,i,s=-1,a=t[1],o=0,c=7,u=4;for(0===a&&(c=138,u=3),t[2*(n+1)+1]=65535,r=0;n>=r;r++)i=a,a=t[2*(r+1)+1],++o<c&&i===a||(u>o?e.bl_tree[2*i]+=o:0!==i?(i!==s&&e.bl_tree[2*i]++,e.bl_tree[2*K]++):10>=o?e.bl_tree[2*G]++:e.bl_tree[2*Y]++,o=0,s=i,0===a?(c=138,u=3):i===a?(c=6,u=3):(c=7,u=4))}function x(e,t,n){var r,i,s=-1,c=t[1],u=0,l=7,f=4;for(0===c&&(l=138,f=3),r=0;n>=r;r++)if(i=c,c=t[2*(r+1)+1],!(++u<l&&i===c)){if(f>u){do o(e,i,e.bl_tree);while(0!==--u)}else 0!==i?(i!==s&&(o(e,i,e.bl_tree),u--),o(e,K,e.bl_tree),a(e,u-3,2)):10>=u?(o(e,G,e.bl_tree),a(e,u-3,3)):(o(e,Y,e.bl_tree),a(e,u-11,7));u=0,s=i,0===c?(l=138,f=3):i===c?(l=6,f=3):(l=7,f=4)}}function w(e){var t;for(b(e,e.dyn_ltree,e.l_desc.max_code),b(e,e.dyn_dtree,e.d_desc.max_code),_(e,e.bl_desc),t=U-1;t>=3&&0===e.bl_tree[2*ne[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}function k(e,t,n,r){var i;for(a(e,t-257,5),a(e,n-1,5),a(e,r-4,4),i=0;r>i;i++)a(e,e.bl_tree[2*ne[i]+1],3);x(e,e.dyn_ltree,t-1),x(e,e.dyn_dtree,n-1)}function E(e){var t,n=4093624447;for(t=0;31>=t;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return R;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return P;for(t=32;q>t;t++)if(0!==e.dyn_ltree[2*t])return P;return R}function C(e){me||(d(),me=!0),e.l_desc=new he(e.dyn_ltree,le),e.d_desc=new he(e.dyn_dtree,fe),e.bl_desc=new he(e.bl_tree,de),e.bi_buf=0,e.bi_valid=0,p(e)}function T(e,t,n,r){a(e,(I<<1)+(r?1:0),3),m(e,t,n,!0)}function S(e){a(e,M<<1,3),o(e,X,ie),u(e)}function O(e,t,n,r){var i,s,o=0;e.level>0?(e.strm.data_type===L&&(e.strm.data_type=E(e)),_(e,e.l_desc),_(e,e.d_desc),o=w(e),i=e.opt_len+3+7>>>3,s=e.static_len+3+7>>>3,i>=s&&(i=s)):i=s=n+5,i>=n+4&&-1!==t?T(e,t,n,r):e.strategy===B||s===i?(a(e,(M<<1)+(r?1:0),3),y(e,ie,se)):(a(e,(D<<1)+(r?1:0),3),k(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),y(e,e.dyn_ltree,e.dyn_dtree)),p(e),r&&h(e)}function A(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(oe[n]+q+1)]++,e.dyn_dtree[2*i(t)]++),e.last_lit===e.lit_bufsize-1}var N=e("../utils/common"),B=4,R=0,P=1,L=2,I=0,M=1,D=2,j=3,V=258,F=29,q=256,z=q+1+F,H=30,U=19,$=2*z+1,Q=15,W=16,J=7,X=256,K=16,G=17,Y=18,Z=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],ee=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],te=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],ne=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],re=512,ie=new Array(2*(z+2));r(ie);var se=new Array(2*H);r(se);var ae=new Array(re);r(ae);var oe=new Array(V-j+1);r(oe);var ce=new Array(F);r(ce);var ue=new Array(H);r(ue);var le,fe,de,pe=function(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length},he=function(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t},me=!1;n._tr_init=C,n._tr_stored_block=T,n._tr_flush_block=O,n._tr_tally=A,n._tr_align=S},{"../utils/common":27}],39:[function(e,t,n){"use strict";function r(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}t.exports=r},{}]},{},[9])(9)}),function(){function e(e,t){for(var n=[];e;)n.push(t),--e;return n}function t(e,t){for(var n=0,r={};n<e.length;++n)r[e[n]]=t[n];return r}function n(e,t){var n=e.split(/%[ds]/);return n.length>t.length&&t.push(""),t.map(function(e,t){return n[t]+e}).join("")}function r(e,t){O.info(n(e,t))}function i(e,t){return-1!==e.indexOf(t,e.length-t.length)}function s(e){return Object.keys(e).map(function(e){return parseInt(e)})}function a(e,t){var n,r=[];if(Array.isArray(e))for(n=0;n<e.length;++n)n in e&&r.push([n,e[n]]);else for(n in e)r.push([n,e[n]]);return r.sort(t?function(e,t){return e[0]-t[0]}:function(e,t){return e[1]-t[1]||t[0]-e[0]}),r}function o(e){this.reset(),this.ixp=e,this.divs=this.mdur=this.ixm=0}function c(e,t){this.tijd=0,this.dur=e,this.fact=null,this.tup=[""],this.tupabc="",this.grace=this.beam=0,this.after=this.before="",this.ns=t?[t]:[],this.lyrs={},this.pos=0}function u(e){this.tijd=0,this.str=e,this.pos=0}function l(){}function f(e){this.maxtime=this.tijd=0,this.gMaten=[],this.gLyrics=[],this.vnums={},this.cnt=new l,this.vceCnt=1,this.lastnote=null,this.bpl=e.b,this.cpl=e.n,this.repbra=0,this.nvlt=e.v}function d(e,t,n,r){this.fnmext=e,this.outlist=[],this.infolist=[],this.title="T:Title",this.key="none",this.clefs={},this.mtr="none",this.tempo=0,this.pad=t,this.X=n+1,this.denL=r.d,this.volpan=r.m,this.cmpL=[],this.rightmargin=this.leftmargin=this.pagewidth=this.scale="",4==r.p.length&&(this.scale=""!=r.p[0]?parseFloat(r.p[0]):"",this.pagewidth=""!=r.p[1]?parseFloat(r.p[1]):"",this.leftmargin=""!=r.p[2]?parseFloat(r.p[2]):"",this.rightmargin=""!=r.p[3]?parseFloat(r.p[3]):"")}function p(e,t){if(!e.join(""))return["",0];for(var n=[],r=0;r<e.length;++r){var s=e[r];""==s?s=t?"_":"*":i(s,"_")&&!i(s,"\\_")?(s=s.replace("_",""),t=1):t=0,n.push(s)}return[n.join(" "),t]}function h(e,t){for(var n,r=e,i=t;t;)n=e%t,e=t,t=n;return[r/e,i/e]}function m(e,t,n){if(0==e.dur)return"";var i;return i=h(n*e.dur,4*t),t=i[0],n=i[1],e.fact&&(i=e.fact[0],e=e.fact[1],i=h(t*i,n*e),t=i[0],n=i[1]),n>64&&(i=h(Math.round(64*t/n)||1,64),r("denominator too small: %d/%d rounded to %d/%d",[t,n,i[0],i[1]]),t=i[0],n=i[1]),1==t?1==n?"":2==n?"/":"/"+n:1==n?""+t:t+"/"+n}function v(e){var t=e.match(/([_^]*)([A-Ga-g])([',]*)/);if(!t)return-1;
e=t[1];var n,r=t[2],t=t[3];return n=r.toUpperCase(),r=60+[0,2,4,5,7,9,11]["CDEFGAB".indexOf(n)]+(n!=r?12:0),e&&(r+=("^"==e[0]?1:-1)*e.length),t&&(r+=("'"==t[0]?12:-12)*t.length),r}function g(e,t,n,r){var i;return i=0,0<=n.indexOf("stafflines=1")&&(i+=4),!r&&0<=n.indexOf("bass")&&(i+=12),i&&(n="CDEFGAB".split(""),i=n.indexOf(e)+i,e=n[i%7],t+=Math.floor(i/7)),t>4&&(e=e.toLowerCase()),t>5&&(e+=Array(t-5+1).join("'")),4>t&&(e+=Array(4-t+1).join(",")),e}function y(e,t,r){var i,s,a=0,o=t[e];s=o.tup.indexOf("start"),s>-1&&o.tup.splice(s,1);var c=e;for(r=[o.fact[0]/r[0],o.fact[1]/r[1]];e<t.length;){if(o=t[e],!(o instanceof u||o.grace)){if(-1<o.tup.indexOf("start")?(s=y(e,t,r),e=s[0],s=s[1],a+=s):o.fact&&(a+=1),s=o.tup.indexOf("stop"),s>-1){o.tup.splice(s,1);break}if(!o.fact){e=i;break}i=e}e+=1}return i=[r[0],r[1],a],i="3,2,3"==i.toString()?"(3":n("(%d:%d:%d",i),t[c].tupabc=i+t[c].tupabc,[e,a]}function _(e){e=e.filter(function(e){return e instanceof c});for(var t=0;t<e.length-1;){var n=e[t],r=e[t+1];!n.fact&&!r.fact&&0<n.dur&&r.beam&&(3*n.dur==r.dur?(r.dur=2*r.dur/3,n.dur*=2,n.after="<"+n.after,t+=1):3*r.dur==n.dur&&(n.dur=2*n.dur/3,r.dur*=2,n.after=">"+n.after,t+=1)),t+=1}}function b(e,t,n,r,s){for(r=0;r<e.length;)n=e[r],n instanceof c&&n.fact&&(n=y(r,e,[1,1]),r=n[0]),r+=1;r=[];for(var a,o=0;o<e.length;++o){if(n=e[o],n instanceof c){var u=m(n,t,s),l=1<n.ns.length;a=n.ns.filter(function(e){return i(e,"-")}),a=a.map(function(e){return e.slice(0,-1)});var f="";l&&a.length==n.ns.length&&(n.ns=a,f="-"),a=n.tupabc+n.before,l&&(a+="["),a+=n.ns.join(""),l&&(a+="]"+f),i(a,"-")&&(a=a.slice(0,-1),f="-"),a+=u+f,a+=n.after,n=n.beam}else a=n.str,n=1;n?r.push(a):r.push(" "+a)}return r.join("")}function x(e,t){e.map(function(e,t){e.pos=t}),e.sort(function(e,t){return e.tijd-t.tijd||e.pos-t.pos});for(var n=0,i=[],s=0;s<e.length;++s){var a=e[s];if(a.tijd>n&&i.push(new c(a.tijd-n,"x")),a instanceof u)a.tijd<n&&(a.tijd=n),i.push(a),n=a.tijd;else{if(a.tijd<n){if("z"==a.ns[0])continue;var o=i[i.length-1];if(!(o.tijd<=a.tijd)){r("overlapping notes in one voice! part %d, measure %d, note %s discarded",[t.ixp+1,t.ixm+1,a instanceof c?a.ns:a.str]);continue}if("z"==o.ns[0])o.dur=a.tijd-o.tijd,0==o.dur&&pop(i),r("overlap in part %d, measure %d: rest shortened",[t.ixp+1,t.ixm+1]);else{if(o.ns=o.ns.concat(a.ns),r("overlap in part %d, measure %d: added chord",[t.ixp+1,t.ixm+1]),a.dur=a.tijd+a.dur-n,0>=a.dur)continue;a.tijd=n}}i.push(a),n=a.tijd+a.dur}}return 0==n&&r("empty measure in part %d, measure %d, it should contain at least a rest to advance the time!",[t.ixp+1,t.ixm+1]),i}function w(e){function t(e){return e=n('<part-group number="%d" type="%s"></part-group>',[e,"stop"]),e=$.parseXML(e).firstChild,$(e)}var r,i,s,a,o,c,u;for(r=[],i=[],c=e.children(),o=0;o<c.length;o++)e=$(c[o]),"part-group"==e[0].nodeName?(s=e.attr("number"),a=e.attr("type"),u=i.indexOf(s),"start"==a?u>-1?(r.push(t(s)),r.push(e)):(r.push(e),i.push(s)):u>-1&&(i.splice(u,1),r.push(e))):r.push(e);for(o=i.length-1;o>=0;--o)s=i[o],r.push(t(s));return r}function k(e,t,n){var r,i,s,a;if(0==e.length)return[[],[]];if(r=e.shift(),"part-group"==r[0].nodeName){if(i=r.attr("number"),s=r.attr("type"),"start"==s){s=[];for(a in{"group-symbol":0,"group-barline":0,"group-name":0,"group-abbreviation":0})s.push(r.find(a).text()||"");return t[i]=s,n.push(i),a=k(e,t,n),e=a[0],r=a[1],a=k(r,t,n),t=a[0],n=a[1],[[e].concat(t),n]}return n=n.pop(),e.length&&"stop"==e[0].attr("type")&&i!=n&&(a=t[n],t[n]=t[i],t[i]=a),t=t[i],[[t],e]}return a=k(e,t,n),t=a[0],e=a[1],[[["name_tuple",r.find("part-name").text()||"",r.find("part-abbreviation").text()||""]].concat(t),e]}function E(e){var t,n,r,i;if(0==e.length)return[];for(t=[],r=0;r<e.length;++r){if(n=e[r],1==n.length)t.push(""+n[0]);else{for(t.push("("),i=0;i<n.length;++i)t.push(""+n[i]);t.push(")")}t.push("|")}return t.splice(-1,1),1<e.length&&(t=["{"].concat(t).concat(["}"])),t}function C(e,t,n,r,i,s){if("name_tuple"==e[0])r=r.shift(),t[0]&&(e[1]=t[0]+":"+e[1],e[2]=t[1]+":"+e[2]),i.push(e),s.push.apply(s,E(r));else if(2==e.length)r=r.shift(),n=["name_tuple","",""],n[1]=e[0][1]+":"+e[1][2],n[2]=e[0][2]+":"+e[1][3],i.push(n),s.push.apply(s,E(r));else{var a,o,c;for(c=e[e.length-1],t=c[0],a=c[1],o=c[2],c=c[3],a="yes"==a||n,s.push("brace"==t?"{":"["),n=0;n<e.length-1;++n)C(e[n],[o,c],a,r,i,s),a&&s.push("|");a&&s.splice(-1,1),s.push("brace"==t?"}":"]")}}function T(e){for(var t="",n=e.children(),r=0;r<n.length;++r){var i=n[r];switch(i.nodeName){case"elision":t+="~";break;case"text":t+=$(i).text().replace(/_/g,"\\_").replace(/-/g,"\\-").replace(/ /g,"~")}}return t?(n=e.find("syllabic").text(),("begin"==n||"middle"==n)&&(t+="-"),e.find("extend").length&&(t+="_"),t):t}function S(e){this.slurBuf={},this.wedge_type="",this.ingrace=0,this.msc=new f(e),this.unfold=e.u,this.ctf=e.c,this.gStfMap=[],this.midiMap=[],this.drumInst={},this.drumNotes={},this.instMid=[],this.midDflt=[-1,-1,-1,-91],this.msralts={},this.curalts={},this.stfMap={},this.clefMap={},this.curClef={},this.clefOct={},this.curStf={},this.nolbrk=e.x,this.doPageFmt=1==e.p.length,this.tstep=e.t}var O,A=Math.pow(2,53),N={"ornaments>trill-mark":"T","ornaments>mordent":"M","ornaments>inverted-mordent":"P","ornaments>turn":"!turn!","ornaments>inverted-turn":"!invertedturn!","ornaments>tremolo":"!///!","technical>up-bow":"u","technical>down-bow":"v","technical>harmonic":"!open!","technical>open-string":"!open!","technical>stopped":"!plus!","articulations>accent":"!>!","articulations>strong-accent":"!>!","articulations>staccato":".","articulations>staccatissimo":"!wedge!",fermata:"!fermata!",arpeggiate:"!arpeggio!","articulations>tenuto":"!tenuto!","articulations>staccatissimo":"!wedge!","articulations>spiccato":"!wedge!","articulations>breath-mark":"!breath!","articulations>detached-legato":"!tenuto!."},B={p:"!p!",pp:"!pp!",ppp:"!ppp!",f:"!f!",ff:"!ff!",fff:"!fff!",mp:"!mp!",mf:"!mf!",sfz:"!sfz!"};xml2abc_VERSION=62,o.prototype.reset=function(){this.lline=this.attr="",this.rline="|",this.lnum=""},l.prototype.inc=function(e,t){this.counters[e][t]=(this.counters[e][t]||0)+1},l.prototype.clear=function(n){n=Object.keys(n);var r=e(n.length,0);this.counters={note:t(n,r),nopr:t(n,r),nopt:t(n,r)}},l.prototype.getv=function(e,t){return this.counters[e][t]},l.prototype.prcnt=function(e){for(var t in this.counters.note)0!=this.getv("nopr",t)&&r("part %d, voice %d has %d skipped non printable notes",[e,t,this.getv("nopr",t)]),0!=this.getv("nopt",t)&&r("part %d, voice %d has %d notes without pitch",[e,t,this.getv("nopt",t)]),0==this.getv("note",t)&&r("part %d, skipped empty voice %d",[e,t])},f.prototype.initVoices=function(e){this.vtimes={},this.voices={},this.lyrics={};for(var t in this.vnums)this.vtimes[t]=0,this.voices[t]=[],this.lyrics[t]=[];e&&this.cnt.clear(this.vnums)},f.prototype.incTime=function(e){this.tijd+=e,this.tijd>this.maxtime&&(this.maxtime=this.tijd)},f.prototype.appendElemCv=function(e,t){for(var n in e)this.appendElem(n,t)},f.prototype.insertElem=function(e,t){var n=new u(t);n.tijd=0,this.voices[e].unshift(n)},f.prototype.appendObj=function(e,t,n){t.tijd=this.tijd,this.voices[e].push(t),this.incTime(n),this.tijd>this.vtimes[e]&&(this.vtimes[e]=this.tijd)},f.prototype.appendElem=function(e,t){this.appendObj(e,new u(t),0)},f.prototype.appendNote=function(e,t,n){t.ns.push(n),this.appendObj(e,t,parseInt(t.dur)),"z"!=n&&(this.lastnote=t,this.cnt.inc("note",e),t.grace||this.lyrics[e].push(t.lyrs))},f.prototype.getLastRec=function(e){return this.gMaten.length?(e=this.gMaten[this.gMaten.length-1][e],e[e.length-1]):null},f.prototype.getLastMelis=function(e,t){if(this.gLyrics.length){var n=this.gLyrics[this.gLyrics.length-1][e];if(t in n)return n[t][1]}return 0},f.prototype.addChord=function(e){this.lastnote.ns.push(e)},f.prototype.addBar=function(e,t){t.mdur&&this.maxtime>t.mdur&&r("measure %d in part %d longer than metre",[t.ixm+1,t.ixp+1]),this.tijd=this.maxtime;for(var n in this.vnums){if(t.lline||t.lnum){var i=this.getLastRec(n);if(i){var a=i.str;t.lline&&(a=(a+t.lline).replace(/:\|:/g,"::").replace(/\|\|/g,"|")),3==this.nvlt?t.ixp+parseInt(n)==Math.min.apply(null,s(this.vnums))&&(a+=t.lnum):4==this.nvlt?parseInt(n)==Math.min.apply(null,s(this.vnums))&&(a+=t.lnum):t.lnum&&(a+=t.lnum,this.repbra=1),i.str=a}else t.lline&&this.insertElem(n,"|:")}e&&(i=this.getLastRec(n))&&(i.str+=e),t.attr&&this.insertElem(n,""+t.attr),this.appendElem(n," "+t.rline),this.voices[n]=x(this.voices[n],t);for(var i=this.lyrics[n],a={},o=i.reduce(function(e,t){return e.concat(s(t))},[]),c=Math.max.apply(null,o.concat([0]));c>0;--c){var o=i.map(function(e){return e[c]||""}),u=this.getLastMelis(n,c);a[c]=p(o,u)}this.lyrics[n]=a,_(this.voices[n])}this.gMaten.push(this.voices),this.gLyrics.push(this.lyrics),this.tijd=this.maxtime=0,this.initVoices()},f.prototype.outVoices=function(t,n){var r,i,o,l,f,d,p,h,v;f={},p=Math.min.apply(null,s(this.vnums));for(h in this.vnums)if(0!=this.cnt.getv("note",h)){if(O.denL)d=O.denL;else{var g=h,y=this.gMaten;d=t,v=0,l=A,i=r=void 0;for(var _=[4,8,16];_.length;){var x=_.shift(),w=0;for(r=0;r<y.length;++r){var k=y[r][g];for(i=0;i<k.length;++i){var E=k[i];E instanceof u||0==E.dur||(w+=m(E,d,x).length)}}l>w&&(v=x,l=w)}d=v}for(O.cmpL.push(d),g=[],y={},v=0;v<this.gMaten.length;++v){if(l=this.gMaten[v][h],g.push(b(l,t,v,n,d)),i=this.gLyrics,0!=v)for(_ in l=this.gMaten[v][h],r=i[v][h],i=i[v-1][h],x=x=_=void 0,i)if(x=i[_][1],!(_ in r)&&x){for(x=l,w=[],k=0;k<x.length;++k)if(E=x[k],E instanceof c&&!E.grace){if("z"==E.ns[0])break;w.push("_")}(x=w.join(" "))&&(r[_]=[x,0])}r=this.gLyrics[v][h];for(o in r)if(l=r[o],l=l[0],o in y){for(;y[o].length<v;)y[o].push("");y[o].push(l)}else y[o]=e(v,"").concat([l])}for(o in y)l=y[o],d=g.length-l.length,y[o]=l.concat(e(d,""));for(O.add("V:"+this.vceCnt),this.repbra&&(1==this.nvlt&&1<this.vceCnt&&O.add("I:repbra 0"),2==this.nvlt&&parseInt(h)>p&&O.add("I:repbra 0")),0<this.cpl?this.bpl=0:0==this.bpl&&(this.cpl=100),d=0;g.length;){for(v=1,l=g[0];v<g.length&&!(0<this.cpl&&l.length+g[v].length>=this.cpl)&&!(0<this.bpl&&v>=this.bpl);)l+=g[v],v+=1;for(d+=v,O.add(l+" %"+d),g.splice(0,v),r=a(y,1),i=0;i<r.length;++i)l=r[i],o=l[0],l=l[1],O.add("w: "+l.slice(0,v).join("|")+"|"),l.splice(0,v)}f[h]=this.vceCnt,this.vceCnt+=1}return this.gMaten=[],this.gLyrics=[],this.cnt.prcnt(n+1),f},d.prototype.add=function(e){this.outlist.push(e+"\n")},d.prototype.info=function(e,t){this.infolist.push(("undefined"==typeof t||t?"-- ":"")+e)},d.prototype.mkHeader=function(e,t,i){var s,o,c,u,l,f,d=[],p=[];for(u=e.slice(),f=0;f<t.length;++f){s=t[f];try{C(s,["",""],"",e,d,p)}catch(h){r("lousy musicxml: error in part-list",[])}}for(t=p.join(" "),e={},f=0;f<u.length;++f)o=u[f],s=d[f],c=s[1],s=s[2],0!=o.length&&(o=o[0][0],c=c.replace(/\n/g,"\\n").replace(/\.:/g,".").replace(/^:|:$/g,""),s=s.replace(/\n/g,"\\n").replace(/\.:/g,".").replace(/^:|:$/g,""),e[o]=(c?'nm="'+c+'"':"")+(s?' snm="'+s+'"':""));for(d=[n("X:%d\n%s\n",[this.X,this.title])],""!==this.scale&&d.push("%%scale "+this.scale+"\n"),""!==this.pagewidth&&d.push("%%pagewidth "+this.pagewidth+"cm\n"),""!==this.leftmargin&&d.push("%%leftmargin "+this.leftmargin+"cm\n"),""!==this.rightmargin&&d.push("%%rightmargin "+this.rightmargin+"cm\n"),t&&1<p.length&&d.push("%%score "+t+"\n"),u=this.tempo?"Q:1/4="+this.tempo+"\n":"",p=[],f=0;f<this.cmpL.length;++f)s=this.cmpL[f],p[s]=(p[s]||0)+1;p=a(p),p=p[p.length-1][0],p=this.denL?this.denL:p,d.push(n("L:1/%d\n%sM:%s\n",[p,u,this.mtr])),d.push(n("I:linebreak $\nK:%s\n",[this.key]));for(l in this.clefs){for(s=i[l-1],f=s[0],t=s[1],c=s[1],o=s[3],u=s.slice(4),s=this.clefs[l],u.length&&0>s.indexOf("perc")&&(s=(s+" map=perc").trim()),d.push(n("V:%d %s %s\n",[l,s,e[l]||""])),1<this.volpan?(f>0&&f!=l&&d.push("%%MIDI channel "+f+"\n"),t>0&&d.push("%%MIDI program "+(t-1)+"\n"),c>=0&&d.push("%%MIDI control 7 "+c+"\n"),o>=0&&d.push("%%MIDI control 10 "+o+"\n")):0<this.volpan&&(u.length&&f>0&&d.push("%%MIDI channel "+f+"\n"),t>0&&d.push("%%MIDI program "+(t-1)+"\n")),f=0;f<u.length;++f)s=u[f].nt,c=u[f].step,t=u[f].midi,(o=u[f].nhd)||(o="normal"),(v(s)!=t||s!=c)&&(0<this.volpan&&d.push("%%MIDI drummap "+s+" "+t+"\n"),d.push("I:percmap "+s+" "+c+" "+t+" "+o+"\n"));p!=this.cmpL[l-1]&&d.push("L:1/"+this.cmpL[l-1]+"\n")}this.outlist=d.concat(this.outlist)},S.prototype.matchSlur=function(e,t,n,i,s,a){if(-1!=["start","stop"].indexOf(e))if(t||(t="1"),t in this.slurBuf){var o=this.slurBuf[t],c=o[0],u=o[1],l=o[2],o=o[3];e!=c?(n!=u||"start"!=c||o&&a||(l.before="("+l.before,i.after+=")"),delete this.slurBuf[t]):(r("double slur numbers %s-%s in part %d, measure %d, voice %d note %s, first discarded",[e,t,this.msr.ixp+1,this.msr.ixm+1,n,i.ns]),this.slurBuf[t]=[e,n,i,s])}else this.slurBuf[t]=[e,n,i,s]},S.prototype.doNotations=function(e,t){for(var n=Object.keys(N).sort(),r=0;r<n.length;++r){var i=n[r],s=N[i];t.find(i).length&&(e.before+=s)}if(n=t.find("technical>fingering"),n.length&&(e.before+="!"+n.text()+"!"),n=t.find("ornaments>wavy-line"),n.length)switch(n.attr("type")){case"start":e.before="!trill(!"+e.before;break;case"stop":e.after+="!trill)!"}},S.prototype.ntAbc=function(e,t,n,i){var s={"double-flat":-2,"flat-flat":-2,flat:-1,natural:0,sharp:1,"sharp-sharp":2,"double-sharp":2};t+=this.clefOct[this.curStf[i]]||0;var a=e;t>4&&(a=e.toLowerCase()),t>5&&(a+=Array(t-5+1).join("'")),4>t&&(a+=Array(4-t+1).join(",")),t=n.find("accidental").text();var o=n.find("pitch>alter").text();!o&&this.msralts[e]&&(o=0);var c=a+"#"+i;if(""===t&&""===o)return a;if(""!=t)o=s[t];else{if(o=parseInt(o),c in this.curalts){if(o==this.curalts[c])return a}else if(o==(this.msralts[e]||0))return a;if(n.find("tie").map(function(){return $(this).attr("type")}).get().some(function(e){return"stop"==e}))return a;r("accidental %d added in part %d, measure %d, voice %d note %s",[o,this.msr.ixp+1,this.msr.ixm+1,i+1,a])}return this.curalts[c]=o,a=["__","_","=","^","^^"][o+2]+a},S.prototype.doNote=function(e){var t=new c(0,null),n=parseInt(e.find("voice").text()||"1");this.isSib&&(n+=100*(e.find("staff").text()||1));var r=0<e.find("chord").length,i=e.find("pitch>step").text()||e.find("unpitched>display-step").text(),s=e.find("pitch>octave").text()||e.find("unpitched>display-octave").text(),a=0<e.find("rest").length,o=e.find("time-modification>actual-notes").text();if(o){var u=e.find("time-modification>normal-notes").text();t.fact=[parseInt(o),parseInt(u)]}if(t.tup=e.find("notations>tuplet").map(function(){return $(this).attr("type")}).get(),u=e.find("duration").text(),o=e.find("grace"),t.grace=0<o.length,t.before="",t.after="",t.grace&&!this.ingrace&&(this.ingrace=1,t.before="{","yes"==o.attr("slash")&&(t.before+="/")),(o=!t.grace&&this.ingrace)&&(this.ingrace=0,this.msc.lastnote.after+="}"),a||"no"!=e.attr("print-object")){if((!u||t.grace)&&(u=0),t.dur=parseInt(u),a||i&&s||(this.msc.cnt.inc("nopt",n),s=5,i="E"),u=e.find("notations"),u.length&&this.doNotations(t,u),a=a?"z":this.ntAbc(i,parseInt(s),e,n),e.find("unpitched").length){var u=this.curClef[this.curStf[n]],i=g(i,parseInt(s),u,this.tstep),s=e.find("instrument"),s=s.length?s.attr("id"):"dummyId",s=this.drumInst[s]||v(a),u=e.find("notehead"),l=u.text().replace(" ","-");"yes"==u.attr("filled")&&(l+="+"),"x"==l&&(a="^"+a.replace(/\^/g,"").replace(/_/g,"")),("circle-x"==l||"diamond"==l)&&(a="_"+a.replace(/\^/g,"").replace(/_/g,"")),this.drumNotes[n+";"+a]=[i,s,l]}for(i=e.find("tie").map(function(){return $(this).attr("type")}).get(),-1<i.indexOf("start")&&(a+="-"),i=e.find("beam").map(function(){return $(this).text()}).get(),t.beam=-1<i.indexOf("continue")||-1<i.indexOf("end")||t.grace,i=e.find("lyric"),s=u=0;s<i.length;++s){var l=$(i[s]),f=parseInt((l.attr("number")||"1").replace(/^.*verse/,""));0==f?f=u+1:u=f,t.lyrs[f]=T(l)}for(r?this.msc.addChord(a):(r=parseInt(e.find("staff").text()||"1"),this.curStf[n]!=r&&(i=r-this.curStf[n],this.curStf[n]=r,this.msc.appendElem(n,"[I:staff "+(i>0?"+":"")+i+"]")),this.msc.appendNote(n,t,a)),i=e.find("notations>slur"),s=0;s<i.length;++s)e=$(i[s]),this.matchSlur(e.attr("type"),e.attr("number"),n,this.msc.lastnote,t.grace,o)}else this.msc.cnt.inc("nopr",n)},S.prototype.doAttr=function(n){var r,i,s,a,o,c,u,l,f,d,p,h;for(r={C1:"alto1",C2:"alto2",C3:"alto",C4:"tenor",F4:"bass",F3:"bass3",G2:"treble",TAB:"",percussion:"perc"},(i=n.find("divisions").text())&&(this.msr.divs=parseInt(i)),i=parseInt(n.find("transpose>chromatic").text()||"0"),s=n.find("key>fifths").first().text(),a=0==this.msc.tijd&&0==this.msr.ixm,s&&(o=parseInt(s),c=n.find("key>mode").first().text()||"major",f="FCGDAEB".split(""),l="Cb Gb Db Ab Eb Bb F C G D A E B F# C#".split(" "),u="Ab Eb Bb F C G D A E B F# C# G# D# A#".split(" "),s="","major"==c&&(s=l[7+o]),"minor"==c&&(s=u[7+o]+"min"),o=o>=0?t(f.slice(0,o),e(o,1)):t(f.slice(o),e(-o,-1)),o=[s,o],s=o[0],this.msralts=o[1],a&&!i&&"none"==O.key?O.key=s:s==O.key&&a||(this.msr.attr+="[K:"+s+"]")),(s=n.find("time>beats").text())&&(o=n.find("time>beat-type").text(),c=s+"/"+o,a?O.mtr=c:this.msr.attr+="[M:"+c+"]",this.msr.mdur=this.msr.divs*parseInt(s)*4/parseInt(o)),(s=n.find("transpose>octave-change").text()||"")&&(i+=12*parseInt(s)),c=n.find("clef"),o=0;o<c.length;o++)if(u=$(c[o]),s=parseInt(u.attr("number")||"1"),l=u.find("sign").text(),f="percussion"!=l?u.find("line").text()||"":"",f=r[l+f]||"",l=u.find("clef-octave-change").text()||"0",f+={"-2":"-15","-1":"-8",1:"+8",2:"+15"}[l]||"",this.clefOct[s]=-parseInt(l),i&&(f+=" transpose="+i),(l=n.find("staff-details>staff-lines").text())&&(f+=" stafflines="+l),this.curClef[s]=f,a)this.clefMap[s]=f;else for(u=this.stfMap[s],h=0;h<u.length;++h)d=u[h],s!=this.curStf[d]&&(p=s-this.curStf[d],this.curStf[d]=s,l=p>0?"+":"",this.msc.appendElem(d,"[I:staff "+l+p+"]")),this.msc.appendElem(d,"[K:"+f+"]")},S.prototype.doDirection=function(e){var t,n,r,i,s,a,o,c,u;if(r=parseInt(e.find("staff").first().text()||"1"),r=this.stfMap[r][0],t=e.attr("placement"),n=e.find("sound"),n.length){if(a=n.find("midi-instrument")){o=n.find("midi-instrument>midi-program").text(),c=n.find("midi-instrument>midi-channel").text();for(u in this.vceInst)this.vceInst[u]==a.attr("id")&&(r=u);(u=(o?o-1:c)+"")&&0<O.volpan&&this.msc.appendElem(r,"[I:MIDI= "+(o?"program":"channel")+" "+u+"]")}(n=n.attr("tempo"))&&(n=-1<n.indexOf(".")?parseFloat(n).toFixed(2):parseInt(n),0==this.msc.tijd&&0==this.msr.ixm?O.tempo=n:this.msc.appendElem(r,"[Q:1/4="+n+"]"))}if(e=e.children("direction-type"),e.length){if(n=e.find("wedge"),n.length){switch(n.attr("type")){case"crescendo":i="!<(!",this.wedge_type="<";break;case"diminuendo":i="!>(!",this.wedge_type=">";break;case"stop":i="<"==this.wedge_type?"!<)!":"!>)!";break;default:raise("wrong wedge type")}this.msc.appendElem(r,i)}i=e.find("words").eq(0),i.length&&(t="below"==t?"_":"^",0>parseFloat(i.attr("default-y")||"0")&&(t="_"),(i=i.text().replace(/"/g,'\\"').replace(/\n/g," ").trim())&&this.msc.appendElem(r,'"'+t+i+'"'));for(s in B)t=B[s],e.find("dynamics>"+s).length&&this.msc.appendElem(r,t);e.find("coda").length&&this.msc.appendElem(r,"O"),e.find("segno").length&&this.msc.appendElem(r,"S")}},S.prototype.doHarmony=function(e){var t,n,r,i,s,a,o,c,u;t=parseInt(e.children("staff").text()||"1"),t=this.stfMap[t][0],n={major:"",minor:"m",augmented:"+",diminished:"dim",dominant:"7","half-diminished":"m7b5"},r={major:"maj",dominant:"",minor:"m",diminished:"dim",augmented:"+",suspended:"sus"},i={second:"2",fourth:"4",seventh:"7",sixth:"6",ninth:"9","11th":"11","13th":"13"},s={1:"#",0:"","-1":"b"},a=e.find("root>root-step","").text(),o=s[e.find("root>root-alter").text()]||"",c="",u=e.find("kind").text(),u in n?u=n[u]:-1<u.indexOf("-")?(n=u.split("-"),u=n[0],n=n[1],u=(r[u]||"")+(i[n]||""),0==u.indexOf("sus")&&(c=u,u="")):"none"==u&&(u=e.find("kind").attr("text")),r=e.find("degree");for(i=0;i<r.length;++i)n=$(r[i]),u+=(s[n.find("degree-alter").text()]||"")+n.find("degree-value").text();u=u.replace("79","9").replace("713","13").replace("maj6","6"),e=e.find("bass>bass-step").text()+(s[e.find("bass>bass-alter").text()]||""),this.msc.appendElem(t,'"'+a+o+u+c+(e&&"/"+e)+'"')},S.prototype.doBarline=function(e){var t=e.find("repeat"),n=0;return t.length&&(n=t.attr("direction")),this.unfold?n?"forward"==n?1:2:0:("right"==e.attr("location")&&(t=e.find("bar-style").text(),"light-light"==t?this.msr.rline="||":"light-heavy"==t&&(this.msr.rline="|]")),n&&("forward"==n?this.msr.lline=":":this.msr.rline=":|"),e=e.find("ending"),e.length&&("start"==e.attr("type")?(e=(e.attr("number")||"1").replace(/\./g,"").replace(/ /g,""),/^[\d,]+$/.test(e)||(e='"'+e.trim()+'"'),this.msr.lnum=e):"|"==this.msr.rline&&(this.msr.rline="||")),0)},S.prototype.doPrint=function(e){return"yes"==e.attr("new-system")||"yes"==e.attr("new-page")?this.nolbrk?"":"$":void 0},S.prototype.doPartList=function(e){var t,n,r,i,s,a,o,c,u,l;for(i=e.find("part-list>score-part"),t=0;t<i.length;++t){for(n=i[t],s={},a=$(n).find("midi-instrument"),n=0;n<a.length;++n){for(o=$(a[n]),u=["midi-channel","midi-program","volume","pan"],c=[],r=0;r<u.length;++r)l=u[r],c.push(o.find(l).text()||this.midDflt[r]);r=c[3],r>=-90&&90>=r&&(r=(r+90)/180*127),s[o.attr("id")]=[parseInt(c[0]),parseInt(c[1]),parseFloat(c[2]),r],(c=o.find("midi-unpitched").text())&&(this.drumInst[o.attr("id")]=c-1)}this.instMid.push(s)}return e=e.find("part-list"),c=w(e),k(c,{},[])[0]},S.prototype.mkTitle=function(e){var t,n,i,s,a,o,c,u=[],l=[],f=[];for(t=e.find("work>work-title").text().trim(),n=e.find("movement-title").text().trim(),i=e.find("identification>creator"),s=0;s<i.length;++s)a=$(i[s]),o=a.text(),a=a.attr("type"),o&&(o=o.split("\n").map(function(e){return e.trim()}),"composer"==a?u.push.apply(u,o):"lyricist"!=a&&"transcriber"!=a||l.push.apply(l,o));for(i=e.find("identification>rights"),s=0;s<i.length;++s)o=$(i[s]).text(),o=o.split("\n").map(function(e){return e.trim()}),l.push.apply(l,o);for(i=e.find("credit"),s=0;s<i.length;++s){for(o="",a=$(i[s]).find("credit-words"),c=0;c<a.length;++c)o+=$(a[c]).text();f.push(o.replace(/\s*[\r\n]\s*/g," "))}f=function(e){function r(e){return e&&-1<i.indexOf(e)}var i,s,a=[];for(s=0;s<f.length;++s)i=f[s],6>e&&(i&&-1<t.indexOf(i)||i&&-1<n.indexOf(i))||5>e&&(i&&-1<u.indexOf(i)||i&&-1<l.indexOf(i))||4>e&&(t&&-1<i.indexOf(t)||n&&-1<i.indexOf(n))||3>e&&(u.some(r)||l.some(r))||2>e&&/^[\d\W]*$/.test(i)||a.push(i);return 0==e&&t+n&&(a=""),a}(this.ctf),t&&(t="T:"+t.replace(/\n/g,"\nT:")+"\n"),n&&(t+="T:"+n.replace(/\n/g,"\nT:")+"\n"),f.length&&(t+=f.map(function(e){return"T:"+e}).join("\n")+"\n"),u.length&&(t+=u.map(function(e){return"C:"+e}).join("\n")+"\n"),l.length&&(t+=l.map(function(e){return"Z:"+e}).join("\n")+"\n"),t&&(O.title=t.substr(0,t.length-1)),(this.isSib=0<=e.find("identification>encoding>software").text().indexOf("Sibelius"))&&r("Sibelius MusicXMl is unreliable",[])},S.prototype.doDefaults=function(e){var t,n,r,i;this.doPageFmt&&(t=e.find("defaults"),t.length&&(e=t.find("scaling>millimeters").text(),n=t.find("scaling>tenths").text(),n=e/n/10,e=t.find("page-layout>page-width").text()*n,r=t.find("page-layout>page-margins").first(),t=r.find("left-margin").text(),r=r.find("right-margin").text(),i=10*n/.2117,!O.scale&&i&&(O.scale=i.toFixed(2)),!O.pagewidth&&e&&(O.pagewidth=e.toFixed(2)),O.leftmargin||""==t||(O.leftmargin=(t*n).toFixed(2)),O.rightmargin||""==r||(O.rightmargin=(r*n).toFixed(2))))},S.prototype.locStaffMap=function(e){var t={};this.vceInst={},this.msc.vnums={},e=e.find("measure>note");for(var n=0;n<e.length;n++){var r=$(e[n]),i=parseInt(r.find("voice").text()||"1");this.isSib&&(i+=100*(r.find("staff").text()||1)),this.msc.vnums[i]=1;var s=parseInt(r.find("staff").text()||"1");if(i in t){var a=t[i];a[s]=(a[s]||0)+1}else a={},a[s]=1,t[i]=a;a=r.find("instrument"),a.length&&(this.vceInst[i]=$(a).attr("id"))}this.stfMap={},this.clefMap={};for(i in t){e=[],n=t[i];for(s in n)e.push([n[s],s]);e.sort(function(e,t){return t[0]-e[0]}),e=e[0][1],this.stfMap[e]=(this.stfMap[e]||[]).concat([i]),this.curStf[i]=e}},S.prototype.addStaffMap=function(e){var t,n,r,i,s,a,o=[],c=Object.keys(this.stfMap).sort();for(n=0;n<c.length;++n){for(s=c[n],i=this.stfMap[s],a=[],t=0;t<i.length;++t)r=i[t],r in e&&a.push(e[r]);if(a.length)for((o.push(a.sort()),i=s in this.clefMap?this.clefMap[s]:"treble",t=0);t<a.length;++t)r=a[t],O.clefs[r]=i}this.gStfMap.push(o)},S.prototype.addMidiMap=function(e,t){var n,r=this.instMid[e],i=Object.keys(r);n=i.length?r[i[0]]:this.midDflt;var s,a,o,c=[],u=this;for(s in t)i=Object.keys(this.drumNotes).sort().filter(function(e){return e.split(";")[0]==s}),o=i.map(function(e){return{nt:e.split(";")[1],step:u.drumNotes[e][0],midi:u.drumNotes[e][1],nhd:u.drumNotes[e][2]}}),i=t[s],a=this.vceInst[s]||"",a in r?c.push([i,r[a].concat(o)]):c.push([i,n.concat(o)]);for(c.sort(function(e,t){return e[0]-t[0]}),r=0;r<c.length;++r)i=c[r][0],n=c[r][1],this.midiMap.push(n)},S.prototype.parse=function(e){var t=$(e);this.mkTitle(t),this.doDefaults(t),partlist=this.doPartList(t),e=t.find("part");for(var n=0;n<e.length;++n){var t=$(e[n]),i=t.find("measure");this.locStaffMap(t),this.drumNotes={},this.clefOct={},this.msc.initVoices(1);var s=0,a=0;for(this.msr=new o(n);this.msr.ixm<i.length;){var c=$(i[this.msr.ixm]),u=0,l="";this.msr.reset(),this.curalts={};for(var f=c.children(),d=0;d<f.length;d++){var p=f[d],t=$(p);switch(p.nodeName){case"note":this.doNote(t);break;case"attributes":this.doAttr(t);break;case"direction":this.doDirection(t);break;case"sound":this.doDirection(c);break;case"harmony":this.doHarmony(t);break;case"barline":u=this.doBarline(t);break;case"backup":t=parseInt(t.find("duration").text()),this.msc.incTime(-t);break;case"forward":t=parseInt(t.find("duration").text()),this.msc.incTime(t);break;case"print":l=this.doPrint(t)}}this.msc.addBar(l,this.msr),1==u?(a=this.msr.ixm,this.msr.ixm+=1):2==u?1>s?(this.msr.ixm=a,s+=1):(s=0,this.msr.ixm+=1):this.msr.ixm+=1}i=this.msc.outVoices(this.msr.divs,n),this.addStaffMap(i),this.addMidiMap(n,i)}Object.keys(i).length?O.mkHeader(this.gStfMap,partlist,this.midiMap):r("nothing written, %s has no notes ...",[O.fnmext])},vertaal=function(e,t){var n,i={u:0,b:0,n:0,c:0,v:0,d:0,m:0,x:0,t:0,p:"f"};for(n in t)i[n]=t[n];i.p=i.p?i.p.split(","):[],O=new d(".abc","",0,i),i=new S(i);try{i.parse(e)}catch(s){r("** exception occurred: %s",[s])}return[O.outlist.join(""),O.infolist.join("\n")]}}(),!function(e){"use strict";function t(e,t){var n=(65535&e)+(65535&t),r=(e>>16)+(t>>16)+(n>>16);return r<<16|65535&n}function n(e,t){return e<<t|e>>>32-t}function r(e,r,i,s,a,o){return t(n(t(t(r,e),t(s,o)),a),i)}function i(e,t,n,i,s,a,o){return r(t&n|~t&i,e,t,s,a,o)}function s(e,t,n,i,s,a,o){return r(t&i|n&~i,e,t,s,a,o)}function a(e,t,n,i,s,a,o){return r(t^n^i,e,t,s,a,o)}function o(e,t,n,i,s,a,o){return r(n^(t|~i),e,t,s,a,o)}function c(e,n){e[n>>5]|=128<<n%32,e[(n+64>>>9<<4)+14]=n;var r,c,u,l,f,d=1732584193,p=-271733879,h=-1732584194,m=271733878;for(r=0;r<e.length;r+=16)c=d,u=p,l=h,f=m,d=i(d,p,h,m,e[r],7,-680876936),m=i(m,d,p,h,e[r+1],12,-389564586),h=i(h,m,d,p,e[r+2],17,606105819),p=i(p,h,m,d,e[r+3],22,-1044525330),d=i(d,p,h,m,e[r+4],7,-176418897),m=i(m,d,p,h,e[r+5],12,1200080426),h=i(h,m,d,p,e[r+6],17,-1473231341),p=i(p,h,m,d,e[r+7],22,-45705983),d=i(d,p,h,m,e[r+8],7,1770035416),m=i(m,d,p,h,e[r+9],12,-1958414417),h=i(h,m,d,p,e[r+10],17,-42063),p=i(p,h,m,d,e[r+11],22,-1990404162),d=i(d,p,h,m,e[r+12],7,1804603682),m=i(m,d,p,h,e[r+13],12,-40341101),h=i(h,m,d,p,e[r+14],17,-1502002290),p=i(p,h,m,d,e[r+15],22,1236535329),d=s(d,p,h,m,e[r+1],5,-165796510),m=s(m,d,p,h,e[r+6],9,-1069501632),h=s(h,m,d,p,e[r+11],14,643717713),p=s(p,h,m,d,e[r],20,-373897302),d=s(d,p,h,m,e[r+5],5,-701558691),m=s(m,d,p,h,e[r+10],9,38016083),h=s(h,m,d,p,e[r+15],14,-660478335),p=s(p,h,m,d,e[r+4],20,-405537848),d=s(d,p,h,m,e[r+9],5,568446438),m=s(m,d,p,h,e[r+14],9,-1019803690),h=s(h,m,d,p,e[r+3],14,-187363961),p=s(p,h,m,d,e[r+8],20,1163531501),d=s(d,p,h,m,e[r+13],5,-1444681467),m=s(m,d,p,h,e[r+2],9,-51403784),h=s(h,m,d,p,e[r+7],14,1735328473),p=s(p,h,m,d,e[r+12],20,-1926607734),d=a(d,p,h,m,e[r+5],4,-378558),m=a(m,d,p,h,e[r+8],11,-2022574463),h=a(h,m,d,p,e[r+11],16,1839030562),p=a(p,h,m,d,e[r+14],23,-35309556),d=a(d,p,h,m,e[r+1],4,-1530992060),m=a(m,d,p,h,e[r+4],11,1272893353),h=a(h,m,d,p,e[r+7],16,-155497632),p=a(p,h,m,d,e[r+10],23,-1094730640),d=a(d,p,h,m,e[r+13],4,681279174),m=a(m,d,p,h,e[r],11,-358537222),h=a(h,m,d,p,e[r+3],16,-722521979),p=a(p,h,m,d,e[r+6],23,76029189),d=a(d,p,h,m,e[r+9],4,-640364487),m=a(m,d,p,h,e[r+12],11,-421815835),h=a(h,m,d,p,e[r+15],16,530742520),p=a(p,h,m,d,e[r+2],23,-995338651),d=o(d,p,h,m,e[r],6,-198630844),m=o(m,d,p,h,e[r+7],10,1126891415),h=o(h,m,d,p,e[r+14],15,-1416354905),p=o(p,h,m,d,e[r+5],21,-57434055),d=o(d,p,h,m,e[r+12],6,1700485571),m=o(m,d,p,h,e[r+3],10,-1894986606),h=o(h,m,d,p,e[r+10],15,-1051523),p=o(p,h,m,d,e[r+1],21,-2054922799),d=o(d,p,h,m,e[r+8],6,1873313359),m=o(m,d,p,h,e[r+15],10,-30611744),h=o(h,m,d,p,e[r+6],15,-1560198380),p=o(p,h,m,d,e[r+13],21,1309151649),d=o(d,p,h,m,e[r+4],6,-145523070),m=o(m,d,p,h,e[r+11],10,-1120210379),h=o(h,m,d,p,e[r+2],15,718787259),p=o(p,h,m,d,e[r+9],21,-343485551),d=t(d,c),p=t(p,u),h=t(h,l),m=t(m,f);return[d,p,h,m]}function u(e){var t,n="";for(t=0;t<32*e.length;t+=8)n+=String.fromCharCode(e[t>>5]>>>t%32&255);return n}function l(e){var t,n=[];for(n[(e.length>>2)-1]=void 0,t=0;t<n.length;t+=1)n[t]=0;for(t=0;t<8*e.length;t+=8)n[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return n}function f(e){return u(c(l(e),8*e.length))}function d(e,t){var n,r,i=l(e),s=[],a=[];for(s[15]=a[15]=void 0,i.length>16&&(i=c(i,8*e.length)),n=0;16>n;n+=1)s[n]=909522486^i[n],a[n]=1549556828^i[n];return r=c(s.concat(l(t)),512+8*t.length),u(c(a.concat(r),640))}function p(e){var t,n,r="0123456789abcdef",i="";for(n=0;n<e.length;n+=1)t=e.charCodeAt(n),i+=r.charAt(t>>>4&15)+r.charAt(15&t);return i}function h(e){return unescape(encodeURIComponent(e))}function m(e){return f(h(e))}function v(e){return p(m(e))}function g(e,t){return d(h(e),h(t))}function y(e,t){return p(g(e,t))}function _(e,t,n){return t?n?g(t,e):y(t,e):n?m(e):v(e)}"function"==typeof define&&define.amd?define(function(){return _}):"object"==typeof module&&module.exports?module.exports=_:e.md5=_}(this),!function(e){function t(){var e=arguments[0],n=t.cache;return n[e]&&n.hasOwnProperty(e)||(n[e]=t.parse(e)),t.format.call(null,n[e],arguments)}function n(e){return"number"==typeof e?"number":"string"==typeof e?"string":Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function r(e,t){return t>=0&&7>=t&&a[e]?a[e][t]:Array(t+1).join(e)}var i={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/bcdiefguxX/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[\+\-]/};t.format=function(e,s){var a,o,c,u,l,f,d,p=1,h=e.length,m="",v=[],g=!0,y="";for(o=0;h>o;o++)if(m=n(e[o]),"string"===m)v[v.length]=e[o];else if("array"===m){if(u=e[o],u[2])for(a=s[p],c=0;c<u[2].length;c++){if(!a.hasOwnProperty(u[2][c]))throw new Error(t('[sprintf] property "%s" does not exist',u[2][c]));a=a[u[2][c]]}else a=u[1]?s[u[1]]:s[p++];if(i.not_type.test(u[8])&&i.not_primitive.test(u[8])&&"function"==n(a)&&(a=a()),i.numeric_arg.test(u[8])&&"number"!=n(a)&&isNaN(a))throw new TypeError(t("[sprintf] expecting number but found %s",n(a)));switch(i.number.test(u[8])&&(g=a>=0),u[8]){case"b":a=parseInt(a,10).toString(2);break;case"c":a=String.fromCharCode(parseInt(a,10));break;case"d":case"i":a=parseInt(a,10);break;case"j":a=JSON.stringify(a,null,u[6]?parseInt(u[6]):0);break;case"e":a=u[7]?parseFloat(a).toExponential(u[7]):parseFloat(a).toExponential();break;case"f":a=u[7]?parseFloat(a).toFixed(u[7]):parseFloat(a);break;case"g":a=u[7]?parseFloat(a).toPrecision(u[7]):parseFloat(a);break;case"o":a=a.toString(8);break;case"s":a=String(a),a=u[7]?a.substring(0,u[7]):a;break;case"t":a=String(!!a),a=u[7]?a.substring(0,u[7]):a;break;case"T":a=n(a),a=u[7]?a.substring(0,u[7]):a;break;case"u":
a=parseInt(a,10)>>>0;break;case"v":a=a.valueOf(),a=u[7]?a.substring(0,u[7]):a;break;case"x":a=parseInt(a,10).toString(16);break;case"X":a=parseInt(a,10).toString(16).toUpperCase()}i.json.test(u[8])?v[v.length]=a:(!i.number.test(u[8])||g&&!u[3]?y="":(y=g?"+":"-",a=a.toString().replace(i.sign,"")),f=u[4]?"0"===u[4]?"0":u[4].charAt(1):" ",d=u[6]-(y+a).length,l=u[6]&&d>0?r(f,d):"",v[v.length]=u[5]?y+a+l:"0"===f?y+l+a:l+y+a)}return v.join("")},t.cache={},t.parse=function(e){for(var t=e,n=[],r=[],s=0;t;){if(null!==(n=i.text.exec(t)))r[r.length]=n[0];else if(null!==(n=i.modulo.exec(t)))r[r.length]="%";else{if(null===(n=i.placeholder.exec(t)))throw new SyntaxError("[sprintf] unexpected placeholder");if(n[2]){s|=1;var a=[],o=n[2],c=[];if(null===(c=i.key.exec(o)))throw new SyntaxError("[sprintf] failed to parse named argument key");for(a[a.length]=c[1];""!==(o=o.substring(c[0].length));)if(null!==(c=i.key_access.exec(o)))a[a.length]=c[1];else{if(null===(c=i.index_access.exec(o)))throw new SyntaxError("[sprintf] failed to parse named argument key");a[a.length]=c[1]}n[2]=a}else s|=2;if(3===s)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");r[r.length]=n}t=t.substring(n[0].length)}return r};var s=function(e,n,r){return r=(n||[]).slice(0),r.splice(0,0,e),t.apply(null,r)},a={0:["","0","00","000","0000","00000","000000","0000000"]," ":[""," ","  ","   ","    ","     ","      ","       "],_:["","_","__","___","____","_____","______","_______"]};"undefined"!=typeof exports?(exports.sprintf=t,exports.vsprintf=s):(e.sprintf=t,e.vsprintf=s,"function"==typeof define&&define.amd&&define(function(){return{sprintf:t,vsprintf:s}}))}("undefined"==typeof window?this:window);var swfobject=function(){function e(){if(!H){try{var e=M.getElementsByTagName("body")[0].appendChild(v("span"));e.parentNode.removeChild(e)}catch(t){return}H=!0;for(var n=V.length,r=0;n>r;r++)V[r]()}}function t(e){H?e():V[V.length]=e}function n(e){if(typeof I.addEventListener!=O)I.addEventListener("load",e,!1);else if(typeof M.addEventListener!=O)M.addEventListener("load",e,!1);else if(typeof I.attachEvent!=O)g(I,"onload",e);else if("function"==typeof I.onload){var t=I.onload;I.onload=function(){t(),e()}}else I.onload=e}function r(){j?i():s()}function i(){var e=M.getElementsByTagName("body")[0],t=v(A);t.setAttribute("type",R);var n=e.appendChild(t);if(n){var r=0;!function(){if(typeof n.GetVariable!=O){var i=n.GetVariable("$version");i&&(i=i.split(" ")[1].split(","),Q.pv=[parseInt(i[0],10),parseInt(i[1],10),parseInt(i[2],10)])}else if(10>r)return r++,void setTimeout(arguments.callee,10);e.removeChild(t),n=null,s()}()}else s()}function s(){var e=F.length;if(e>0)for(var t=0;e>t;t++){var n=F[t].id,r=F[t].callbackFn,i={success:!1,id:n};if(Q.pv[0]>0){var s=m(n);if(s)if(!y(F[t].swfVersion)||Q.wk&&Q.wk<312)if(F[t].expressInstall&&o()){var l={};l.data=F[t].expressInstall,l.width=s.getAttribute("width")||"0",l.height=s.getAttribute("height")||"0",s.getAttribute("class")&&(l.styleclass=s.getAttribute("class")),s.getAttribute("align")&&(l.align=s.getAttribute("align"));for(var f={},d=s.getElementsByTagName("param"),p=d.length,h=0;p>h;h++)"movie"!=d[h].getAttribute("name").toLowerCase()&&(f[d[h].getAttribute("name")]=d[h].getAttribute("value"));c(l,f,n,r)}else u(s),r&&r(i);else b(n,!0),r&&(i.success=!0,i.ref=a(n),r(i))}else if(b(n,!0),r){var v=a(n);v&&typeof v.SetVariable!=O&&(i.success=!0,i.ref=v),r(i)}}}function a(e){var t=null,n=m(e);if(n&&"OBJECT"==n.nodeName)if(typeof n.SetVariable!=O)t=n;else{var r=n.getElementsByTagName(A)[0];r&&(t=r)}return t}function o(){return!U&&y("6.0.65")&&(Q.win||Q.mac)&&!(Q.wk&&Q.wk<312)}function c(e,t,n,r){U=!0,E=r||null,C={success:!1,id:n};var i=m(n);if(i){"OBJECT"==i.nodeName?(w=l(i),k=null):(w=i,k=n),e.id=P,(typeof e.width==O||!/%$/.test(e.width)&&parseInt(e.width,10)<310)&&(e.width="310"),(typeof e.height==O||!/%$/.test(e.height)&&parseInt(e.height,10)<137)&&(e.height="137"),M.title=M.title.slice(0,47)+" - Flash Player Installation";var s=Q.ie&&Q.win?"ActiveX":"PlugIn",a="MMredirectURL="+I.location.toString().replace(/&/g,"%26")+"&MMplayerType="+s+"&MMdoctitle="+M.title;if(typeof t.flashvars!=O?t.flashvars+="&"+a:t.flashvars=a,Q.ie&&Q.win&&4!=i.readyState){var o=v("div");n+="SWFObjectNew",o.setAttribute("id",n),i.parentNode.insertBefore(o,i),i.style.display="none",function(){4==i.readyState?i.parentNode.removeChild(i):setTimeout(arguments.callee,10)}()}f(e,t,n)}}function u(e){if(Q.ie&&Q.win&&4!=e.readyState){var t=v("div");e.parentNode.insertBefore(t,e),t.parentNode.replaceChild(l(e),t),e.style.display="none",function(){4==e.readyState?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}()}else e.parentNode.replaceChild(l(e),e)}function l(e){var t=v("div");if(Q.win&&Q.ie)t.innerHTML=e.innerHTML;else{var n=e.getElementsByTagName(A)[0];if(n){var r=n.childNodes;if(r)for(var i=r.length,s=0;i>s;s++)1==r[s].nodeType&&"PARAM"==r[s].nodeName||8==r[s].nodeType||t.appendChild(r[s].cloneNode(!0))}}return t}function f(e,t,n){var r,i=m(n);if(Q.wk&&Q.wk<312)return r;if(i)if(typeof e.id==O&&(e.id=n),Q.ie&&Q.win){var s="";for(var a in e)e[a]!=Object.prototype[a]&&("data"==a.toLowerCase()?t.movie=e[a]:"styleclass"==a.toLowerCase()?s+=' class="'+e[a]+'"':"classid"!=a.toLowerCase()&&(s+=" "+a+'="'+e[a]+'"'));var o="";for(var c in t)t[c]!=Object.prototype[c]&&(o+='<param name="'+c+'" value="'+t[c]+'" />');i.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+s+">"+o+"</object>",q[q.length]=e.id,r=m(e.id)}else{var u=v(A);u.setAttribute("type",R);for(var l in e)e[l]!=Object.prototype[l]&&("styleclass"==l.toLowerCase()?u.setAttribute("class",e[l]):"classid"!=l.toLowerCase()&&u.setAttribute(l,e[l]));for(var f in t)t[f]!=Object.prototype[f]&&"movie"!=f.toLowerCase()&&d(u,f,t[f]);i.parentNode.replaceChild(u,i),r=u}return r}function d(e,t,n){var r=v("param");r.setAttribute("name",t),r.setAttribute("value",n),e.appendChild(r)}function p(e){var t=m(e);t&&"OBJECT"==t.nodeName&&(Q.ie&&Q.win?(t.style.display="none",function(){4==t.readyState?h(e):setTimeout(arguments.callee,10)}()):t.parentNode.removeChild(t))}function h(e){var t=m(e);if(t){for(var n in t)"function"==typeof t[n]&&(t[n]=null);t.parentNode.removeChild(t)}}function m(e){var t=null;try{t=M.getElementById(e)}catch(n){}return t}function v(e){return M.createElement(e)}function g(e,t,n){e.attachEvent(t,n),z[z.length]=[e,t,n]}function y(e){var t=Q.pv,n=e.split(".");return n[0]=parseInt(n[0],10),n[1]=parseInt(n[1],10)||0,n[2]=parseInt(n[2],10)||0,t[0]>n[0]||t[0]==n[0]&&t[1]>n[1]||t[0]==n[0]&&t[1]==n[1]&&t[2]>=n[2]?!0:!1}function _(e,t,n,r){if(!Q.ie||!Q.mac){var i=M.getElementsByTagName("head")[0];if(i){var s=n&&"string"==typeof n?n:"screen";if(r&&(T=null,S=null),!T||S!=s){var a=v("style");a.setAttribute("type","text/css"),a.setAttribute("media",s),T=i.appendChild(a),Q.ie&&Q.win&&typeof M.styleSheets!=O&&M.styleSheets.length>0&&(T=M.styleSheets[M.styleSheets.length-1]),S=s}Q.ie&&Q.win?T&&typeof T.addRule==A&&T.addRule(e,t):T&&typeof M.createTextNode!=O&&T.appendChild(M.createTextNode(e+" {"+t+"}"))}}}function b(e,t){if($){var n=t?"visible":"hidden";H&&m(e)?m(e).style.visibility=n:_("#"+e,"visibility:"+n)}}function x(e){var t=/[\\\"<>\.;]/,n=null!=t.exec(e);return n&&typeof encodeURIComponent!=O?encodeURIComponent(e):e}var w,k,E,C,T,S,O="undefined",A="object",N="Shockwave Flash",B="ShockwaveFlash.ShockwaveFlash",R="application/x-shockwave-flash",P="SWFObjectExprInst",L="onreadystatechange",I=window,M=document,D=navigator,j=!1,V=[r],F=[],q=[],z=[],H=!1,U=!1,$=!0,Q=function(){var e=typeof M.getElementById!=O&&typeof M.getElementsByTagName!=O&&typeof M.createElement!=O,t=D.userAgent.toLowerCase(),n=D.platform.toLowerCase(),r=n?/win/.test(n):/win/.test(t),i=n?/mac/.test(n):/mac/.test(t),s=/webkit/.test(t)?parseFloat(t.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,a=!1,o=[0,0,0],c=null;if(typeof D.plugins!=O&&typeof D.plugins[N]==A)c=D.plugins[N].description,!c||typeof D.mimeTypes!=O&&D.mimeTypes[R]&&!D.mimeTypes[R].enabledPlugin||(j=!0,a=!1,c=c.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),o[0]=parseInt(c.replace(/^(.*)\..*$/,"$1"),10),o[1]=parseInt(c.replace(/^.*\.(.*)\s.*$/,"$1"),10),o[2]=/[a-zA-Z]/.test(c)?parseInt(c.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof I.ActiveXObject!=O)try{var u=new ActiveXObject(B);u&&(c=u.GetVariable("$version"),c&&(a=!0,c=c.split(" ")[1].split(","),o=[parseInt(c[0],10),parseInt(c[1],10),parseInt(c[2],10)]))}catch(l){}return{w3:e,pv:o,wk:s,ie:a,win:r,mac:i}}();(function(){Q.w3&&((typeof M.readyState!=O&&"complete"==M.readyState||typeof M.readyState==O&&(M.getElementsByTagName("body")[0]||M.body))&&e(),H||(typeof M.addEventListener!=O&&M.addEventListener("DOMContentLoaded",e,!1),Q.ie&&Q.win&&(M.attachEvent(L,function(){"complete"==M.readyState&&(M.detachEvent(L,arguments.callee),e())}),I==top&&!function(){if(!H){try{M.documentElement.doScroll("left")}catch(t){return void setTimeout(arguments.callee,0)}e()}}()),Q.wk&&!function(){return H?void 0:/loaded|complete/.test(M.readyState)?void e():void setTimeout(arguments.callee,0)}(),n(e)))})(),function(){Q.ie&&Q.win&&window.attachEvent("onunload",function(){for(var e=z.length,t=0;e>t;t++)z[t][0].detachEvent(z[t][1],z[t][2]);for(var n=q.length,r=0;n>r;r++)p(q[r]);for(var i in Q)Q[i]=null;Q=null;for(var s in swfobject)swfobject[s]=null;swfobject=null})}();return{registerObject:function(e,t,n,r){if(Q.w3&&e&&t){var i={};i.id=e,i.swfVersion=t,i.expressInstall=n,i.callbackFn=r,F[F.length]=i,b(e,!1)}else r&&r({success:!1,id:e})},getObjectById:function(e){return Q.w3?a(e):void 0},embedSWF:function(e,n,r,i,s,a,u,l,d,p){var h={success:!1,id:n};Q.w3&&!(Q.wk&&Q.wk<312)&&e&&n&&r&&i&&s?(b(n,!1),t(function(){r+="",i+="";var t={};if(d&&typeof d===A)for(var m in d)t[m]=d[m];t.data=e,t.width=r,t.height=i;var v={};if(l&&typeof l===A)for(var g in l)v[g]=l[g];if(u&&typeof u===A)for(var _ in u)typeof v.flashvars!=O?v.flashvars+="&"+_+"="+u[_]:v.flashvars=_+"="+u[_];if(y(s)){var x=f(t,v,n);t.id==n&&b(n,!0),h.success=!0,h.ref=x}else{if(a&&o())return t.data=a,void c(t,v,n,p);b(n,!0)}p&&p(h)})):p&&p(h)},switchOffAutoHideShow:function(){$=!1},ua:Q,getFlashPlayerVersion:function(){return{major:Q.pv[0],minor:Q.pv[1],release:Q.pv[2]}},hasFlashPlayerVersion:y,createSWF:function(e,t,n){return Q.w3?f(e,t,n):void 0},showExpressInstall:function(e,t,n,r){Q.w3&&o()&&c(e,t,n,r)},removeSWF:function(e){Q.w3&&p(e)},createCSS:function(e,t,n,r){Q.w3&&_(e,t,n,r)},addDomLoadEvent:t,addLoadEvent:n,getQueryParamValue:function(e){var t=M.location.search||M.location.hash;if(t){if(/\?/.test(t)&&(t=t.split("?")[1]),null==e)return x(t);for(var n=t.split("&"),r=0;r<n.length;r++)if(n[r].substring(0,n[r].indexOf("="))==e)return x(n[r].substring(n[r].indexOf("=")+1))}return""},expressInstallCallback:function(){if(U){var e=m(P);e&&w&&(e.parentNode.replaceChild(w,e),k&&(b(k,!0),Q.ie&&Q.win&&(w.style.display="block")),E&&E(C)),U=!1}}}}();!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Clipboard=e()}}(function(){return function e(t,n,r){function i(a,o){if(!n[a]){if(!t[a]){var c="function"==typeof require&&require;if(!o&&c)return c(a,!0);if(s)return s(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){var n=t[a][1][e];return i(n?n:e)},l,l.exports,e,t,n,r)}return n[a].exports}for(var s="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){var r=e("matches-selector");t.exports=function(e,t,n){for(var i=n?e:e.parentNode;i&&i!==document;){if(r(i,t))return i;i=i.parentNode}}},{"matches-selector":5}],2:[function(e,t,n){function r(e,t,n,r,s){var a=i.apply(this,arguments);return e.addEventListener(n,a,s),{destroy:function(){e.removeEventListener(n,a,s)}}}function i(e,t,n,r){return function(n){n.delegateTarget=s(n.target,t,!0),n.delegateTarget&&r.call(e,n)}}var s=e("closest");t.exports=r},{closest:1}],3:[function(e,t,n){n.node=function(e){return void 0!==e&&e instanceof HTMLElement&&1===e.nodeType},n.nodeList=function(e){var t=Object.prototype.toString.call(e);return void 0!==e&&("[object NodeList]"===t||"[object HTMLCollection]"===t)&&"length"in e&&(0===e.length||n.node(e[0]))},n.string=function(e){return"string"==typeof e||e instanceof String},n.fn=function(e){var t=Object.prototype.toString.call(e);return"[object Function]"===t}},{}],4:[function(e,t,n){function r(e,t,n){if(!e&&!t&&!n)throw new Error("Missing required arguments");if(!o.string(t))throw new TypeError("Second argument must be a String");if(!o.fn(n))throw new TypeError("Third argument must be a Function");if(o.node(e))return i(e,t,n);if(o.nodeList(e))return s(e,t,n);if(o.string(e))return a(e,t,n);throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList")}function i(e,t,n){return e.addEventListener(t,n),{destroy:function(){e.removeEventListener(t,n)}}}function s(e,t,n){return Array.prototype.forEach.call(e,function(e){e.addEventListener(t,n)}),{destroy:function(){Array.prototype.forEach.call(e,function(e){e.removeEventListener(t,n)})}}}function a(e,t,n){return c(document.body,e,t,n)}var o=e("./is"),c=e("delegate");t.exports=r},{"./is":3,delegate:2}],5:[function(e,t,n){function r(e,t){if(s)return s.call(e,t);for(var n=e.parentNode.querySelectorAll(t),r=0;r<n.length;++r)if(n[r]==e)return!0;return!1}var i=Element.prototype,s=i.matchesSelector||i.webkitMatchesSelector||i.mozMatchesSelector||i.msMatchesSelector||i.oMatchesSelector;t.exports=r},{}],6:[function(e,t,n){function r(e){var t;if("INPUT"===e.nodeName||"TEXTAREA"===e.nodeName)e.focus(),e.setSelectionRange(0,e.value.length),t=e.value;else{e.hasAttribute("contenteditable")&&e.focus();var n=window.getSelection(),r=document.createRange();r.selectNodeContents(e),n.removeAllRanges(),n.addRange(r),t=n.toString()}return t}t.exports=r},{}],7:[function(e,t,n){function r(){}r.prototype={on:function(e,t,n){var r=this.e||(this.e={});return(r[e]||(r[e]=[])).push({fn:t,ctx:n}),this},once:function(e,t,n){function r(){i.off(e,r),t.apply(n,arguments)}var i=this;return r._=t,this.on(e,r,n)},emit:function(e){var t=[].slice.call(arguments,1),n=((this.e||(this.e={}))[e]||[]).slice(),r=0,i=n.length;for(r;i>r;r++)n[r].fn.apply(n[r].ctx,t);return this},off:function(e,t){var n=this.e||(this.e={}),r=n[e],i=[];if(r&&t)for(var s=0,a=r.length;a>s;s++)r[s].fn!==t&&r[s].fn._!==t&&i.push(r[s]);return i.length?n[e]=i:delete n[e],this}},t.exports=r},{}],8:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.__esModule=!0;var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e("select"),o=r(a),c=function(){function e(t){i(this,e),this.resolveOptions(t),this.initSelection()}return e.prototype.resolveOptions=function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this.action=e.action,this.emitter=e.emitter,this.target=e.target,this.text=e.text,this.trigger=e.trigger,this.selectedText=""},e.prototype.initSelection=function(){if(this.text&&this.target)throw new Error('Multiple attributes declared, use either "target" or "text"');if(this.text)this.selectFake();else{if(!this.target)throw new Error('Missing required attributes, use either "target" or "text"');this.selectTarget()}},e.prototype.selectFake=function(){var e=this,t="rtl"==document.documentElement.getAttribute("dir");this.removeFake(),this.fakeHandler=document.body.addEventListener("click",function(){return e.removeFake()}),this.fakeElem=document.createElement("textarea"),this.fakeElem.style.fontSize="12pt",this.fakeElem.style.border="0",this.fakeElem.style.padding="0",this.fakeElem.style.margin="0",this.fakeElem.style.position="absolute",this.fakeElem.style[t?"right":"left"]="-9999px",this.fakeElem.style.top=(window.pageYOffset||document.documentElement.scrollTop)+"px",this.fakeElem.setAttribute("readonly",""),this.fakeElem.value=this.text,document.body.appendChild(this.fakeElem),this.selectedText=o["default"](this.fakeElem),this.copyText()},e.prototype.removeFake=function(){this.fakeHandler&&(document.body.removeEventListener("click"),this.fakeHandler=null),this.fakeElem&&(document.body.removeChild(this.fakeElem),this.fakeElem=null)},e.prototype.selectTarget=function(){this.selectedText=o["default"](this.target),this.copyText()},e.prototype.copyText=function(){var e=void 0;try{e=document.execCommand(this.action)}catch(t){e=!1}this.handleResult(e)},e.prototype.handleResult=function(e){e?this.emitter.emit("success",{action:this.action,text:this.selectedText,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)}):this.emitter.emit("error",{action:this.action,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)})},e.prototype.clearSelection=function(){this.target&&this.target.blur(),window.getSelection().removeAllRanges()},e.prototype.destroy=function(){this.removeFake()},s(e,[{key:"action",set:function(){var e=arguments.length<=0||void 0===arguments[0]?"copy":arguments[0];if(this._action=e,"copy"!==this._action&&"cut"!==this._action)throw new Error('Invalid "action" value, use either "copy" or "cut"')},get:function(){return this._action}},{key:"target",set:function(e){if(void 0!==e){if(!e||"object"!=typeof e||1!==e.nodeType)throw new Error('Invalid "target" value, use a valid Element');this._target=e}},get:function(){return this._target}}]),e}();n["default"]=c,t.exports=n["default"]},{select:6}],9:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t){var n="data-clipboard-"+e;return t.hasAttribute(n)?t.getAttribute(n):void 0}n.__esModule=!0;var o=e("./clipboard-action"),c=r(o),u=e("tiny-emitter"),l=r(u),f=e("good-listener"),d=r(f),p=function(e){function t(n,r){i(this,t),e.call(this),this.resolveOptions(r),this.listenClick(n)}return s(t,e),t.prototype.resolveOptions=function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this.action="function"==typeof e.action?e.action:this.defaultAction,this.target="function"==typeof e.target?e.target:this.defaultTarget,this.text="function"==typeof e.text?e.text:this.defaultText},t.prototype.listenClick=function(e){var t=this;this.listener=d["default"](e,"click",function(e){return t.onClick(e)})},t.prototype.onClick=function(e){var t=e.delegateTarget||e.currentTarget;this.clipboardAction&&(this.clipboardAction=null),this.clipboardAction=new c["default"]({action:this.action(t),target:this.target(t),text:this.text(t),trigger:t,emitter:this})},t.prototype.defaultAction=function(e){return a("action",e)},t.prototype.defaultTarget=function(e){var t=a("target",e);return t?document.querySelector(t):void 0},t.prototype.defaultText=function(e){return a("text",e)},t.prototype.destroy=function(){this.listener.destroy(),this.clipboardAction&&(this.clipboardAction.destroy(),this.clipboardAction=null)},t}(l["default"]);n["default"]=p,t.exports=n["default"]},{"./clipboard-action":8,"good-listener":4,"tiny-emitter":7}]},{},[9])(9)});var Survey;!function(e){var t=function(){function e(e,t){void 0===t&&(t=null),this.text=t,this.value=e}return e.setData=function(t,n){t.length=0;for(var r=0;r<n.length;r++){var i=n[r],s=new e(null);"undefined"!=typeof i.value?(s.text=i.text,s.value=i.value):s.value=i,t.push(s)}},e.getData=function(e){for(var t=new Array,n=0;n<e.length;n++){var r=e[n];r.hasText?t.push({value:r.value,text:r.text}):t.push(r.value)}return t},e.prototype.getType=function(){return"itemvalue"},Object.defineProperty(e.prototype,"value",{get:function(){return this.itemValue},set:function(t){if(this.itemValue=t,this.itemValue){var n=this.itemValue.toString(),r=n.indexOf(e.Separator);r>-1&&(this.itemValue=n.slice(0,r),this.text=n.slice(r+1))}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasText",{get:function(){return this.itemText?!0:!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this.hasText?this.itemText:this.value?this.value.toString():null},set:function(e){this.itemText=e},enumerable:!0,configurable:!0}),e.Separator="|",e}();e.ItemValue=t;var n=function(){function e(){}return e.prototype.getType=function(){throw new Error("This method is abstract")},e}();e.Base=n;var r=function(){function e(){}return e.prototype.getText=function(){throw new Error("This method is abstract")},e}();e.SurveyError=r;var i=function(){function e(){}return Object.defineProperty(e.prototype,"isEmpty",{get:function(){return null==this.callbacks||0==this.callbacks.length},enumerable:!0,configurable:!0}),e.prototype.fire=function(e,t){if(null!=this.callbacks)for(var n=0;n<this.callbacks.length;n++){this.callbacks[n](e,t)}},e.prototype.add=function(e){null==this.callbacks&&(this.callbacks=new Array),this.callbacks.push(e)},e.prototype.remove=function(e){if(null!=this.callbacks){var t=this.callbacks.indexOf(e,0);void 0!=t&&this.callbacks.splice(t,1)}},e}();e.Event=i}(Survey||(Survey={}));var Survey;!function(e){var t=function(){function e(){}return e.prototype.loadSurvey=function(t,n){var r=new XMLHttpRequest;r.open("GET",e.serviceUrl+"/getSurvey?surveyId="+t),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.onload=function(){var e=JSON.parse(r.response);n(200==r.status,e,r.response)},r.send()},e.prototype.sendResult=function(t,n,r,i,s){void 0===i&&(i=null),void 0===s&&(s=!1);var a=new XMLHttpRequest;a.open("POST",e.serviceUrl+"/post/"),a.setRequestHeader("Content-Type","application/json; charset=utf-8");var o={postId:t,surveyResult:JSON.stringify(n)};i&&(o.clientId=i),s&&(o.isPartialCompleted=!0);var c=JSON.stringify(o);a.setRequestHeader("Content-Length",c.length.toString());a.onload=function(){r(200==a.status,a.response)},a.send(c)},e.prototype.getResult=function(t,n,r){var i=new XMLHttpRequest,s="resultId="+t+"&name="+n;i.open("GET",e.serviceUrl+"/getResult?"+s),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded");i.onload=function(){var e=null,t=null;if(200==i.status){e=JSON.parse(i.response),t=[];for(var n in e.QuestionResult){var s={name:n,value:e.QuestionResult[n]};t.push(s)}}r(200==i.status,e,t,i.response)},i.send()},e.prototype.isCompleted=function(t,n,r){var i=new XMLHttpRequest,s="resultId="+t+"&clientId="+n;i.open("GET",e.serviceUrl+"/isCompleted?"+s),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded");i.onload=function(){var e=null;200==i.status&&(e=JSON.parse(i.response)),r(200==i.status,e,i.response)},i.send()},e.serviceUrl="https://dxsurveyapi.azurewebsites.net/api/Survey",e}();e.dxSurveyService=t}(Survey||(Survey={}));var Survey;!function(e){e.surveyLocalization={currentLocale:"",locales:{},getString:function(t){var n=this.currentLocale?this.locales[this.currentLocale]:e.surveyStrings;return n&&n[t]||(n=e.surveyStrings),n[t]},getLocales:function(){var e=[];e.push("");for(var t in this.locales)e.push(t);return e}},e.surveyStrings={pagePrevText:"Previous",pageNextText:"Next",completeText:"Complete",otherItemText:"Other (describe)",progressText:"Page {0} of {1}",optionsCaption:"Choose...",requiredError:"Please answer the question.",numericError:"The value should be a numeric.",textMinLength:"Please enter at least {0} symbols.",minSelectError:"Please select at least {0} variants.",maxSelectError:"Please select not more than {0} variants.",numericMinMax:"The '{0}' should be equal or more than {1} and equal or less than {2}",numericMin:"The '{0}' should be equal or more than {1}",numericMax:"The '{0}' should be equal or less than {1}"},e.surveyLocalization.locales.en=e.surveyStrings,String.prototype.format||(String.prototype.format=function(){var e=arguments;return this.replace(/{(\d+)}/g,function(t,n){return"undefined"!=typeof e[n]?e[n]:t})})}(Survey||(Survey={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Survey;!function(e){var t=function(t){function n(){t.call(this)}return __extends(n,t),n.prototype.getText=function(){return e.surveyLocalization.getString("requiredError")},n}(e.SurveyError);e.AnswerRequiredError=t;var n=function(t){function n(){t.call(this)}return __extends(n,t),n.prototype.getText=function(){return e.surveyLocalization.getString("numericError")},n}(e.SurveyError);e.RequreNumericError=n;var r=function(e){function t(t){e.call(this),this.text=t}return __extends(t,e),t.prototype.getText=function(){return this.text},t}(e.SurveyError);e.CustomError=r}(Survey||(Survey={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Survey;!function(e){var t=function(){function e(e){this.name=e,this.typeValue=null,this.choicesValue=null,this.choicesfunc=null,this.className=null,this.classNamePart=null,this.baseClassName=null,this.defaultValue=null,this.onGetValue=null}return Object.defineProperty(e.prototype,"type",{get:function(){return this.typeValue?this.typeValue:"string"},set:function(e){this.typeValue=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasToUseGetValue",{get:function(){return this.onGetValue},enumerable:!0,configurable:!0}),e.prototype.isDefaultValue=function(e){return this.defaultValue?this.defaultValue==e:!e},e.prototype.getValue=function(e){return this.onGetValue?this.onGetValue(e):null},Object.defineProperty(e.prototype,"hasToUseSetValue",{get:function(){return this.onSetValue},enumerable:!0,configurable:!0}),e.prototype.setValue=function(e,t,n){this.onSetValue&&this.onSetValue(e,t,n)},e.prototype.getObjType=function(e){return this.classNamePart?e.replace(this.classNamePart,""):e},e.prototype.getClassName=function(e){return this.classNamePart&&e.indexOf(this.classNamePart)<0?e+this.classNamePart:e},Object.defineProperty(e.prototype,"choices",{get:function(){return null!=this.choicesValue?this.choicesValue:null!=this.choicesfunc?this.choicesfunc():null},enumerable:!0,configurable:!0}),e.prototype.setChoices=function(e,t){this.choicesValue=e,this.choicesfunc=t},e}();e.JsonObjectProperty=t;var n=function(){function e(n,r,i,s){void 0===i&&(i=null),void 0===s&&(s=null),this.name=n,this.creator=i,this.parentName=s,this.properties=null,this.requiredProperties=null,this.properties=new Array;for(var a=0;a<r.length;a++){var o=r[a],c=null,u=o.indexOf(e.typeSymbol);u>-1&&(c=o.substring(u+1),o=o.substring(0,u));var o=this.getPropertyName(o),l=new t(o);c&&(l.type=c),this.properties.push(l)}}return e.prototype.find=function(e){for(var t=0;t<this.properties.length;t++)if(this.properties[t].name==e)return this.properties[t];return null},e.prototype.getPropertyName=function(t){return 0==t.length||t[0]!=e.requiredSymbol?t:(t=t.slice(1),this.requiredProperties||(this.requiredProperties=new Array),this.requiredProperties.push(t),t)},e.requiredSymbol="!",e.typeSymbol=":",e}();e.JsonMetadataClass=n;var r=function(){function e(){this.classes={},this.childrenClasses={},this.classProperties={},this.classRequiredProperties={}}return e.prototype.addClass=function(e,t,r,i){void 0===r&&(r=null),void 0===i&&(i=null);var s=new n(e,t,r,i);if(this.classes[e]=s,i){var a=this.childrenClasses[i];a||(this.childrenClasses[i]=[]),this.childrenClasses[i].push(s)}return s},e.prototype.overrideClassCreatore=function(e,t){var n=this.findClass(e);n&&(n.creator=t)},e.prototype.setPropertyValues=function(e,t,n,r,i,s){void 0===r&&(r=null),void 0===i&&(i=null),void 0===s&&(s=null);var a=this.findProperty(e,t);a&&(a.className=n,a.defaultValue=r,a.onGetValue=i,a.onSetValue=s)},e.prototype.setPropertyChoices=function(e,t,n,r){void 0===r&&(r=null);var i=this.findProperty(e,t);i&&i.setChoices(n,r)},e.prototype.setPropertyClassInfo=function(e,t,n,r){void 0===r&&(r=null);var i=this.findProperty(e,t);i&&(i.baseClassName=n,i.classNamePart=r)},e.prototype.getProperties=function(e){var t=this.classProperties[e];return t||(t=new Array,this.fillProperties(e,t),this.classProperties[e]=t),t},e.prototype.createClass=function(e){var t=this.findClass(e);return t?t.creator():null},e.prototype.getChildrenClasses=function(e,t){void 0===t&&(t=!1);var n=[];return this.fillChildrenClasses(e,t,n),n},e.prototype.getRequiredProperties=function(e){var t=this.classRequiredProperties[e];return t||(t=new Array,this.fillRequiredProperties(e,t),this.classRequiredProperties[e]=t),t},e.prototype.fillChildrenClasses=function(e,t,n){var r=this.childrenClasses[e];if(r)for(var i=0;i<r.length;i++)(!t||r[i].creator)&&n.push(r[i]),this.fillChildrenClasses(r[i].name,t,n)},e.prototype.findClass=function(e){return this.classes[e]},e.prototype.findProperty=function(e,t){var n=this.findClass(e);return n?n.find(t):null},e.prototype.fillProperties=function(e,t){var n=this.findClass(e);if(n){n.parentName&&this.fillProperties(n.parentName,t);for(var r=0;r<n.properties.length;r++)this.addProperty(n.properties[r],t,t.length)}},e.prototype.addProperty=function(e,t,n){for(var r=-1,i=0;n>i;i++)if(t[i].name==e.name){r=i;break}0>r?t.push(e):t[r]=e},e.prototype.fillRequiredProperties=function(e,t){var n=this.findClass(e);n&&(n.requiredProperties&&Array.prototype.push.apply(t,n.requiredProperties),n.parentName&&this.fillRequiredProperties(n.parentName,t))},e}();e.JsonMetadata=r;var i=function(){function e(e,t){this.type=e,this.message=t,this.description="",this.at=-1}return e.prototype.getFullDescription=function(){return this.message+(this.description?"\n"+this.description:"")},e}();e.JsonError=i;var s=function(e){function t(t,n){e.call(this,"unknownproperty","The property '"+t+"' in class '"+n+"' is unknown."),this.propertyName=t,this.className=n;var r=l.metaData.getProperties(n);if(r){this.description="The list of available properties are: ";for(var i=0;i<r.length;i++)i>0&&(this.description+=", "),this.description+=r[i].name;this.description+="."}}return __extends(t,e),t}(i);e.JsonUnknownPropertyError=s;var a=function(e){function t(t,n,r){e.call(this,n,r),this.baseClassName=t,this.type=n,this.message=r,this.description="The following types are available: ";for(var i=l.metaData.getChildrenClasses(t,!0),s=0;s<i.length;s++)s>0&&(this.description+=", "),this.description+="'"+i[s].name+"'";this.description+="."}return __extends(t,e),t}(i);e.JsonMissingTypeErrorBase=a;var o=function(e){function t(t,n){e.call(this,n,"missingtypeproperty","The property type is missing in the object. Please take a look at property: '"+t+"'."),this.propertyName=t,this.baseClassName=n}return __extends(t,e),t}(a);e.JsonMissingTypeError=o;var c=function(e){function t(t,n){e.call(this,n,"incorrecttypeproperty","The property type is incorrect in the object. Please take a look at property: '"+t+"'."),this.propertyName=t,this.baseClassName=n}return __extends(t,e),t}(a);e.JsonIncorrectTypeError=c;var u=function(e){function t(t,n){e.call(this,"requiredproperty","The property '"+t+"' is required in class '"+n+"'."),this.propertyName=t,this.className=n}return __extends(t,e),t}(i);e.JsonRequiredPropertyError=u;var l=function(){function e(){this.errors=new Array}return Object.defineProperty(e,"metaData",{get:function(){return e.metaDataValue;
},enumerable:!0,configurable:!0}),e.prototype.toJsonObject=function(e){return this.toJsonObjectCore(e,null)},e.prototype.toObject=function(t,n){if(t){var r=null;if(n.getType&&(r=e.metaData.getProperties(n.getType())),r)for(var i in t)if(i!=e.typePropertyName)if(i!=e.positionPropertyName){var a=this.findProperty(r,i);a?this.valueToObj(t[i],n,i,a):this.addNewError(new s(i.toString(),n.getType()),t)}else n[i]=t[i]}},e.prototype.toJsonObjectCore=function(t,n){if(!t.getType)return t;var r={};null==n||n.className||(r[e.typePropertyName]=n.getObjType(t.getType()));for(var i=e.metaData.getProperties(t.getType()),s=0;s<i.length;s++)this.valueToJson(t,r,i[s]);return r},e.prototype.valueToJson=function(e,t,n){var r=null;if(r=n.hasToUseGetValue?n.getValue(e):e[n.name],!n.isDefaultValue(r)){if(this.isValueArray(r)){for(var i=[],s=0;s<r.length;s++)i.push(this.toJsonObjectCore(r[s],n));r=i.length>0?i:null}else r=this.toJsonObjectCore(r,n);n.isDefaultValue(r)||(t[n.name]=r)}},e.prototype.valueToObj=function(e,t,n,r){if(null!=r&&r.hasToUseSetValue)return void r.setValue(t,e,this);if(this.isValueArray(e))return void this.valueToArray(e,t,n,r);var i=this.createNewObj(e,r);i.newObj&&(this.toObject(e,i.newObj),e=i.newObj),i.error||(t[n]=e)},e.prototype.isValueArray=function(e){return e.constructor.toString().indexOf("Array")>-1},e.prototype.createNewObj=function(t,n){var r={newObj:null,error:null},i=t[e.typePropertyName];return!i&&null!=n&&n.className&&(i=n.className),i=n.getClassName(i),r.newObj=i?e.metaData.createClass(i):null,r.error=this.checkNewObjectOnErrors(r.newObj,t,n,i),r},e.prototype.checkNewObjectOnErrors=function(t,n,r,i){var s=null;if(t){var a=e.metaData.getRequiredProperties(i);if(a)for(var l=0;l<a.length;l++)if(!n[a[l]]){s=new u(a[l],i);break}}else r.baseClassName&&(s=i?new c(r.name,r.baseClassName):new o(r.name,r.baseClassName));return s&&this.addNewError(s,n),s},e.prototype.addNewError=function(t,n){n&&n[e.positionPropertyName]&&(t.at=n[e.positionPropertyName].start),this.errors.push(t)},e.prototype.valueToArray=function(e,t,n,r){this.isValueArray(t[n])||(t[n]=[]);for(var i=0;i<e.length;i++){var s=this.createNewObj(e[i],r);s.newObj?(t[n].push(s.newObj),this.toObject(e[i],s.newObj)):s.error||t[n].push(e[i])}},e.prototype.findProperty=function(e,t){if(!e)return null;for(var n=0;n<e.length;n++)if(e[n].name==t)return e[n];return null},e.typePropertyName="type",e.positionPropertyName="pos",e.metaDataValue=new r,e}();e.JsonObject=l}(Survey||(Survey={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Survey;!function(e){var t=function(e){function t(t){e.call(this),this.name=t,this.visibleValue=!0,this.visibleIndexValue=-1,this.width="100%",this.onCreating()}return __extends(t,e),Object.defineProperty(t.prototype,"visible",{get:function(){return this.visibleValue},set:function(e){e!=this.visible&&(this.visibleValue=e,this.fireCallback(this.visibilityChangedCallback),this.data&&this.data.questionVisibilityChanged(this,this.visible))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visibleIndex",{get:function(){return this.visibleIndexValue},enumerable:!0,configurable:!0}),t.prototype.hasErrors=function(){return!1},Object.defineProperty(t.prototype,"hasTitle",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasComment",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype.setData=function(e){this.data=e,this.onSetData()},t.prototype.fireCallback=function(e){e&&e()},t.prototype.onSetData=function(){},t.prototype.onCreating=function(){},t.prototype.onSurveyValueChanged=function(e){},t.prototype.setVisibleIndex=function(e){this.visibleIndexValue!=e&&(this.visibleIndexValue=e,this.fireCallback(this.visibleIndexChangedCallback))},t}(e.Base);e.QuestionBase=t,e.JsonObject.metaData.addClass("questionbase",["!name","visible:boolean","width"]),e.JsonObject.metaData.setPropertyValues("questionbase","visible",null,!0),e.JsonObject.metaData.setPropertyValues("questionbase","width",null,"100%")}(Survey||(Survey={}));var Survey;!function(e){var t=function(){function e(){this.creatorHash={}}return e.prototype.registerQuestion=function(e,t){this.creatorHash[e]=t},e.prototype.getAllTypes=function(){var e=new Array;for(var t in this.creatorHash)e.push(t);return e.sort()},e.prototype.createQuestion=function(e,t){var n=this.creatorHash[e];return null==n?null:n(t)},e.Instance=new e,e.DefaultChoices=["one","two|second value",{value:3,text:"third value"}],e}();e.QuestionFactory=t}(Survey||(Survey={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Survey;!function(e){var t=function(t){function n(e){void 0===e&&(e=""),t.call(this),this.name=e,this.questions=new Array,this.data=null,this.title="",this.visibleIndex=-1,this.numValue=-1,this.visibleValue=!0;var n=this;this.questions.push=function(e){return null!=n.data&&e.setData(n.data),Array.prototype.push.call(this,e)}}return __extends(n,t),Object.defineProperty(n.prototype,"num",{get:function(){return this.numValue},set:function(e){this.numValue!=e&&(this.numValue=e,this.onNumChanged(e))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"visible",{get:function(){return this.visibleValue},set:function(e){e!==this.visible&&(this.visibleValue=e,null!=this.data&&this.data.pageVisibilityChanged(this,this.visible))},enumerable:!0,configurable:!0}),n.prototype.getType=function(){return"page"},Object.defineProperty(n.prototype,"isVisible",{get:function(){if(!this.visible)return!1;for(var e=0;e<this.questions.length;e++)if(this.questions[e].visible)return!0;return!1},enumerable:!0,configurable:!0}),n.prototype.addQuestion=function(e,t){void 0===t&&(t=-1),null!=e&&(0>t||t>=this.questions.length?this.questions.push(e):this.questions.splice(t,0,e),null!=this.data&&(e.setData(this.data),this.data.questionAdded(e,t)))},n.prototype.addNewQuestion=function(t,n){var r=e.QuestionFactory.Instance.createQuestion(t,n);return this.addQuestion(r),r},n.prototype.removeQuestion=function(e){var t=this.questions.indexOf(e);0>t||(this.questions.splice(t,1),null!=this.data&&this.data.questionRemoved(e))},n.prototype.hasErrors=function(){for(var e=!1,t=0;t<this.questions.length;t++)this.questions[t].visible&&this.questions[t].hasErrors()&&(e=!0);return e},n.prototype.addQuestionsToList=function(e,t){if(void 0===t&&(t=!1),!t||this.visible)for(var n=0;n<this.questions.length;n++)(!t||this.questions[n].visible)&&e.push(this.questions[n])},n.prototype.onNumChanged=function(e){},n}(e.Base);e.PageModel=t,e.JsonObject.metaData.addClass("page",["name","questions","visible:boolean","title"],function(){return new t}),e.JsonObject.metaData.setPropertyValues("page","visible",null,!0),e.JsonObject.metaData.setPropertyClassInfo("page","questions","question")}(Survey||(Survey={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Survey;!function(e){var t=function(){function e(e,t){void 0===t&&(t=null),this.value=e,this.error=t}return e}();e.ValidatorResult=t;var n=function(e){function t(){e.call(this),this.text=null}return __extends(t,e),t.prototype.getErrorText=function(e){return this.text?this.text:this.getDefaultErrorText(e)},t.prototype.getDefaultErrorText=function(e){return""},t.prototype.validate=function(e,t){return void 0===t&&(t=null),null},t}(e.Base);e.SurveyValidator=n;var r=function(){function e(){}return e.prototype.run=function(e){for(var t=0;t<e.validators.length;t++){var n=e.validators[t].validate(e.value,e.getValidatorTitle());if(null!=n){if(n.error)return n.error;n.value&&(e.value=n.value)}}return null},e}();e.ValidatorRunner=r;var i=function(n){function r(e,t){void 0===e&&(e=null),void 0===t&&(t=null),n.call(this),this.minValue=e,this.maxValue=t}return __extends(r,n),r.prototype.getType=function(){return"numericvalidator"},r.prototype.validate=function(n,r){if(void 0===r&&(r=null),!n||!this.isNumber(n))return new t(null,new e.RequreNumericError);var i=new t(parseFloat(n));return this.minValue&&this.minValue>i.value?(i.error=new e.CustomError(this.getErrorText(r)),i):this.maxValue&&this.maxValue<i.value?(i.error=new e.CustomError(this.getErrorText(r)),i):"number"==typeof n?null:i},r.prototype.getDefaultErrorText=function(t){var n=t?t:"value";return this.minValue&&this.maxValue?e.surveyLocalization.getString("numericMinMax").format(n,this.minValue,this.maxValue):this.minValue?e.surveyLocalization.getString("numericMin").format(n,this.minValue):e.surveyLocalization.getString("numericMax").format(n,this.maxValue)},r.prototype.isNumber=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},r}(n);e.NumericValidator=i;var s=function(n){function r(e){void 0===e&&(e=0),n.call(this),this.minLength=e}return __extends(r,n),r.prototype.getType=function(){return"textvalidator"},r.prototype.validate=function(n,r){return void 0===r&&(r=null),this.minLength<=0?void 0:n.length<this.minLength?new t(null,new e.CustomError(this.getErrorText(r))):null},r.prototype.getDefaultErrorText=function(t){return e.surveyLocalization.getString("textMinLength").format(this.minLength)},r}(n);e.TextValidator=s;var a=function(n){function r(e,t){void 0===e&&(e=null),void 0===t&&(t=null),n.call(this),this.minCount=e,this.maxCount=t}return __extends(r,n),r.prototype.getType=function(){return"answercountvalidator"},r.prototype.validate=function(n,r){if(void 0===r&&(r=null),null==n||n.constructor!=Array)return null;var i=n.length;return this.minCount&&i<this.minCount?new t(null,new e.CustomError(this.getErrorText(e.surveyLocalization.getString("minSelectError").format(this.minCount)))):this.maxCount&&i>this.maxCount?new t(null,new e.CustomError(this.getErrorText(e.surveyLocalization.getString("maxSelectError").format(this.maxCount)))):null},r.prototype.getDefaultErrorText=function(e){return e},r}(n);e.AnswerCountValidator=a,e.JsonObject.metaData.addClass("surveyvalidator",["text"]),e.JsonObject.metaData.addClass("numericvalidator",["minValue:number","maxValue:number"],function(){return new i},"surveyvalidator"),e.JsonObject.metaData.addClass("textvalidator",["minLength:number"],function(){return new s},"surveyvalidator"),e.JsonObject.metaData.addClass("answercountvalidator",["minCount:number","maxCount:number"],function(){return new a},"surveyvalidator")}(Survey||(Survey={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Survey;!function(e){var t=function(t){function n(e){t.call(this,e),this.name=e,this.titleValue=null,this.isRequiredValue=!1,this.hasCommentValue=!1,this.hasOtherValue=!1,this.errors=[],this.validators=new Array,this.isValueChangedInSurvey=!1}return __extends(n,t),Object.defineProperty(n.prototype,"hasTitle",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"title",{get:function(){return this.titleValue?this.titleValue:this.name},set:function(e){this.titleValue=e},enumerable:!0,configurable:!0}),n.prototype.supportComment=function(){return!1},n.prototype.supportOther=function(){return!1},Object.defineProperty(n.prototype,"isRequired",{get:function(){return this.isRequiredValue},set:function(e){this.isRequiredValue=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"hasComment",{get:function(){return this.hasCommentValue},set:function(e){this.supportComment()&&(this.hasCommentValue=e,this.hasComment&&(this.hasOther=!1))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"hasOther",{get:function(){return this.hasOtherValue},set:function(e){this.supportOther()&&(this.hasOtherValue=e,this.hasOther&&(this.hasComment=!1))},enumerable:!0,configurable:!0}),n.prototype.onSetData=function(){t.prototype.onSetData.call(this),this.onSurveyValueChanged(this.value)},Object.defineProperty(n.prototype,"value",{get:function(){return null!=this.data?this.data.getValue(this.name):this.questionValue},set:function(e){this.setNewValue(e),this.fireCallback(this.valueChangedCallback)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"comment",{get:function(){return null!=this.data?this.data.getComment(this.name):""},set:function(e){this.setNewComment(e),this.fireCallback(this.commentChangedCallback)},enumerable:!0,configurable:!0}),n.prototype.isEmpty=function(){return null==this.value},n.prototype.hasErrors=function(){return this.checkForErrors(),this.errors.length>0},n.prototype.checkForErrors=function(){var e=this.errors?this.errors.length:0;if(this.errors=[],this.onCheckForErrors(this.errors),0==this.errors.length){var t=this.runValidators();t&&this.errors.push(t)}if(this.data&&0==this.errors.length){var t=this.data.validateQuestion(this.name);t&&this.errors.push(t)}(e!=this.errors.length||e>0)&&this.fireCallback(this.errorsChangedCallback)},n.prototype.onCheckForErrors=function(t){this.isRequired&&this.isEmpty()&&this.errors.push(new e.AnswerRequiredError)},n.prototype.runValidators=function(){return(new e.ValidatorRunner).run(this)},n.prototype.setNewValue=function(e){this.isValueChangedInSurvey||null==this.data||this.data.setValue(this.name,e),this.questionValue=e,this.onValueChanged()},n.prototype.onValueChanged=function(){},n.prototype.setNewComment=function(e){null!=this.data&&this.data.setComment(this.name,e)},n.prototype.onSurveyValueChanged=function(e){this.isValueChangedInSurvey=!0,this.value=e,this.isValueChangedInSurvey=!1},n.prototype.getValidatorTitle=function(){return null},n}(e.QuestionBase);e.Question=t,e.JsonObject.metaData.addClass("question",["title","isRequired:boolean","validators:validators"],null,"questionbase"),e.JsonObject.metaData.setPropertyValues("question","title",null,null,function(e){return e.titleValue}),e.JsonObject.metaData.setPropertyClassInfo("question","validators","surveyvalidator","validator")}(Survey||(Survey={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Survey;!function(e){var t=function(t){function n(n){t.call(this,n),this.otherItem=new e.ItemValue("other",e.surveyLocalization.getString("otherItemText")),this.choicesValues=new Array,this.otherErrorText=null,this.choicesOrderValue="none"}return __extends(n,t),Object.defineProperty(n.prototype,"isOtherSelected",{get:function(){return this.value==this.otherItem.value},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"choices",{get:function(){return this.choicesValues},set:function(t){e.ItemValue.setData(this.choicesValues,t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"choicesOrder",{get:function(){return this.choicesOrderValue},set:function(e){e!=this.choicesOrderValue&&(this.choicesOrderValue=e)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"otherText",{get:function(){return this.otherItem.text},set:function(e){this.otherItem.text=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"visibleChoices",{get:function(){if(!this.hasOther&&"none"==this.choicesOrder)return this.choices;var e=this.sortVisibleChoices(this.choices.slice());return this.hasOther&&e.push(this.otherItem),e},enumerable:!0,configurable:!0}),n.prototype.supportComment=function(){return!0},n.prototype.supportOther=function(){return!0},n.prototype.onCheckForErrors=function(n){if(t.prototype.onCheckForErrors.call(this,n),this.isOtherSelected&&!this.comment){var r=this.otherErrorText;r||(r="Please enter the others value."),n.push(new e.CustomError(r))}},n.prototype.sortVisibleChoices=function(e){var t=this.choicesOrder.toLowerCase();return"asc"==t?this.sortArray(e,1):"desc"==t?this.sortArray(e,-1):"random"==t?this.randomizeArray(e):e},n.prototype.sortArray=function(e,t){return e.sort(function(e,n){return e.text<n.text?-1*t:e.text>n.text?1*t:0})},n.prototype.randomizeArray=function(e){for(var t=e.length-1;t>0;t--){var n=Math.floor(Math.random()*(t+1)),r=e[t];e[t]=e[n],e[n]=r}return e},n}(e.Question);e.QuestionSelectBase=t;var n=function(e){function t(t){e.call(this,t),this.name=t,this.colCountValue=1}return __extends(t,e),Object.defineProperty(t.prototype,"colCount",{get:function(){return this.colCountValue},set:function(e){0>e||e>4||(this.colCountValue=e,this.fireCallback(this.colCountChangedCallback))},enumerable:!0,configurable:!0}),t}(t);e.QuestionCheckboxBase=n,e.JsonObject.metaData.addClass("selectbase",["hasComment:boolean","hasOther:boolean","!choices:itemvalues","choicesOrder","otherText","otherErrorText"],null,"question"),e.JsonObject.metaData.setPropertyValues("selectbase","choices",null,null,function(t){return e.ItemValue.getData(t.choices)},function(t,n){e.ItemValue.setData(t.choices,n)}),e.JsonObject.metaData.setPropertyValues("selectbase","choicesOrder",null,"none"),e.JsonObject.metaData.setPropertyChoices("selectbase","choicesOrder",["none","asc","desc","random"]),e.JsonObject.metaData.setPropertyValues("selectbase","otherText",null,e.surveyLocalization.getString("otherItemText")),e.JsonObject.metaData.addClass("checkboxbase",["colCount:number"],null,"selectbase"),e.JsonObject.metaData.setPropertyValues("checkboxbase","colCount",null,1),e.JsonObject.metaData.setPropertyChoices("checkboxbase","colCount",[0,1,2,3,4])}(Survey||(Survey={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Survey;!function(e){var t=function(e){function t(t){e.call(this,t),this.name=t}return __extends(t,e),Object.defineProperty(t.prototype,"isOtherSelected",{get:function(){return this.value?this.value.indexOf(this.otherItem.value)>=0:!1},enumerable:!0,configurable:!0}),t.prototype.getType=function(){return"checkbox"},t}(e.QuestionCheckboxBase);e.QuestionCheckboxModel=t,e.JsonObject.metaData.addClass("checkbox",[],function(){return new t("")},"checkboxbase"),e.QuestionFactory.Instance.registerQuestion("checkbox",function(n){var r=new t(n);return r.choices=e.QuestionFactory.DefaultChoices,r})}(Survey||(Survey={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Survey;!function(e){var t=function(e){function t(t){e.call(this,t),this.name=t,this.rows=4,this.cols=50}return __extends(t,e),t.prototype.getType=function(){return"comment"},t.prototype.isEmpty=function(){return e.prototype.isEmpty.call(this)||""==this.value},t}(e.Question);e.QuestionCommentModel=t,e.JsonObject.metaData.addClass("comment",["cols:number","rows:number"],function(){return new t("")},"question"),e.JsonObject.metaData.setPropertyValues("comment","cols",null,50),e.JsonObject.metaData.setPropertyValues("comment","rows",null,4),e.QuestionFactory.Instance.registerQuestion("comment",function(e){return new t(e)})}(Survey||(Survey={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Survey;!function(e){var t=function(t){function n(e){t.call(this,e),this.name=e}return __extends(n,t),Object.defineProperty(n.prototype,"optionsCaption",{get:function(){return this.optionsCaptionValue?this.optionsCaptionValue:e.surveyLocalization.getString("optionsCaption")},set:function(e){this.optionsCaptionValue=e},enumerable:!0,configurable:!0}),n.prototype.getType=function(){return"dropdown"},n}(e.QuestionSelectBase);e.QuestionDropdownModel=t,e.JsonObject.metaData.addClass("dropdown",["optionsCaption"],function(){return new t("")},"selectbase"),e.JsonObject.metaData.setPropertyValues("dropdown","optionsCaption",null,null,function(e){return e.optionsCaptionValue}),e.QuestionFactory.Instance.registerQuestion("dropdown",function(n){var r=new t(n);return r.choices=e.QuestionFactory.DefaultChoices,r})}(Survey||(Survey={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Survey;!function(e){var t=function(e){function t(t){e.call(this,t),this.name=t}return __extends(t,e),t.prototype.getType=function(){return"html"},Object.defineProperty(t.prototype,"html",{get:function(){return this.htmlValue},set:function(e){this.htmlValue=e},enumerable:!0,configurable:!0}),t}(e.QuestionBase);e.QuestionHtmlModel=t,e.JsonObject.metaData.addClass("html",["html"],function(){return new t("")},"questionbase"),e.QuestionFactory.Instance.registerQuestion("html",function(e){return new t(e)})}(Survey||(Survey={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Survey;!function(e){var t=function(e){function t(t,n,r,i,s){e.call(this),this.name=t,this.text=n,this.fullName=r,this.data=i,this.rowValue=s}return __extends(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.rowValue},set:function(e){this.rowValue=e,this.data&&this.data.onMatrixRowChanged(this),this.onValueChanged()},enumerable:!0,configurable:!0}),t.prototype.onValueChanged=function(){},t}(e.Base);e.MatrixRowModel=t;var n=function(n){function r(e){n.call(this,e),this.name=e,this.columnsValue=[],this.rowsValue=[],this.isRowChanging=!1}return __extends(r,n),r.prototype.getType=function(){return"matrix"},Object.defineProperty(r.prototype,"hasRows",{get:function(){return this.rowsValue.length>0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"columns",{get:function(){return this.columnsValue},set:function(t){e.ItemValue.setData(this.columnsValue,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rows",{get:function(){return this.rowsValue},set:function(t){e.ItemValue.setData(this.rowsValue,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"visibleRows",{get:function(){var e=new Array,t=this.value;t||(t={});for(var n=0;n<this.rows.length;n++)this.rows[n].value&&e.push(this.createMatrixRow(this.rows[n].value,this.rows[n].text,this.name+"_"+this.rows[n].value.toString(),t[this.rows[n].value]));return 0==e.length&&e.push(this.createMatrixRow(null,"",this.name,t)),this.generatedVisibleRows=e,e},enumerable:!0,configurable:!0}),r.prototype.createMatrixRow=function(e,n,r,i){return new t(e,n,r,this,i)},r.prototype.onValueChanged=function(){if(!this.isRowChanging&&this.generatedVisibleRows&&0!=this.generatedVisibleRows.length){this.isRowChanging=!0;var e=this.value;if(e||(e={}),0==this.rows.length)this.generatedVisibleRows[0].value=e;else for(var t=0;t<this.generatedVisibleRows.length;t++){var n=this.generatedVisibleRows[t],r=e[n.name]?e[n.name]:null;this.generatedVisibleRows[t].value=r}this.isRowChanging=!1}},r.prototype.onMatrixRowChanged=function(e){if(!this.isRowChanging){if(this.isRowChanging=!0,this.hasRows){var t=this.value;t||(t={}),t[e.name]=e.value,this.setNewValue(t)}else this.setNewValue(e.value);this.isRowChanging=!1}},r}(e.Question);e.QuestionMatrixModel=n,e.JsonObject.metaData.addClass("matrix",["columns:itemvalues","rows:itemvalues"],function(){return new n("")},"question"),e.JsonObject.metaData.setPropertyValues("matrix","columns",null,null,function(t){return e.ItemValue.getData(t.columns)},function(e,t){e.columns=t}),e.JsonObject.metaData.setPropertyValues("matrix","rows",null,null,function(t){return e.ItemValue.getData(t.rows)},function(e,t){e.rows=t}),e.QuestionFactory.Instance.registerQuestion("matrix",function(e){var t=new n(e);return t.rows=["Row 1","Row 2"],t.columns=["Column 1","Column 2","Column 3"],t})}(Survey||(Survey={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Survey;!function(e){var t=function(t){function n(e,n){void 0===n&&(n=null),t.call(this),this.name=e,this.choicesValue=[]}return __extends(n,t),n.prototype.getType=function(){return"matrixdropdowncolumn"},Object.defineProperty(n.prototype,"title",{get:function(){return this.titleValue?this.titleValue:this.name},set:function(e){this.titleValue=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"choices",{get:function(){return this.choicesValue},set:function(t){e.ItemValue.setData(this.choicesValue,t)},enumerable:!0,configurable:!0}),n}(e.Base);e.MatrixDropdownColumn=t;var n=function(){function e(e,t,n,r){this.column=e,this.row=t,this.data=n,this.cellValue=r}return Object.defineProperty(e.prototype,"choices",{get:function(){return this.column.choices&&this.column.choices.length>0?this.column.choices:this.data.choices},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"optionsCaption",{get:function(){return this.column.optionsCaption?this.column.optionsCaption:this.data.optionsCaption},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this.cellValue},set:function(e){this.cellValue=e,this.data.onCellChanged(this),this.onValueChanged()},enumerable:!0,configurable:!0}),e.prototype.onValueChanged=function(){},e}();e.MatrixDropdownCellModel=n;var r=function(){function e(e,t,n,r){this.name=e,this.text=t,this.cells=[],this.data=n,this.rowValue=r,this.buildCells()}return Object.defineProperty(e.prototype,"value",{get:function(){return this.rowValue},set:function(e){this.rowValue=e;for(var t=0;t<this.cells.length;t++)this.cells[t].value=this.getCellValue(this.cells[t].column)},enumerable:!0,configurable:!0}),e.prototype.buildCells=function(){for(var e=this.data.columns,t=0;t<e.length;t++){var n=e[t];this.cells.push(this.createCell(n,this.getCellValue(n)))}},e.prototype.createCell=function(e,t){return new n(e,this,this.data,t)},e.prototype.getCellValue=function(e){return this.rowValue?this.rowValue[e.name]:null},e}();e.MatrixDropdownRowModel=r;var i=function(n){function i(e){n.call(this,e),this.name=e,this.columnsValue=[],this.rowsValue=[],this.choicesValue=[],this.isRowChanging=!1}return __extends(i,n),i.prototype.getType=function(){return"matrixdropdown"},Object.defineProperty(i.prototype,"columns",{get:function(){return this.columnsValue},set:function(e){this.columnsValue=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rows",{get:function(){return this.rowsValue},set:function(t){e.ItemValue.setData(this.rowsValue,t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"choices",{get:function(){return this.choicesValue},set:function(t){e.ItemValue.setData(this.choicesValue,t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"optionsCaption",{get:function(){return this.optionsCaptionValue?this.optionsCaptionValue:e.surveyLocalization.getString("optionsCaption")},set:function(e){this.optionsCaptionValue=e},enumerable:!0,configurable:!0}),i.prototype.addColumn=function(e,n){void 0===n&&(n=null);var r=new t(e,n);return this.columnsValue.push(r),r},Object.defineProperty(i.prototype,"visibleRows",{get:function(){var e=new Array;if(!this.rows||0===this.rows.length)return e;var t=this.value;t||(t={});for(var n=0;n<this.rows.length;n++)this.rows[n].value&&e.push(this.createMatrixRow(this.rows[n].value,this.rows[n].text,t[this.rows[n].value]));return this.generatedVisibleRows=e,e},enumerable:!0,configurable:!0}),i.prototype.createMatrixRow=function(e,t,n){return new r(e,t,this,n)},i.prototype.onValueChanged=function(){if(!this.isRowChanging&&this.generatedVisibleRows&&0!=this.generatedVisibleRows.length){this.isRowChanging=!0;var e=this.value;e||(e={});for(var t=0;t<this.generatedVisibleRows.length;t++){var n=this.generatedVisibleRows[t],r=e[n.name]?e[n.name]:null;this.generatedVisibleRows[t].value=r}this.isRowChanging=!1}},i.prototype.onCellChanged=function(e){var t=this.value;t||(t={});var n=t[e.row.name];n||(n={},t[e.row.name]=n),e.value?n[e.column.name]=e.value:(delete n[e.column.name],0==Object.keys(n).length&&(delete t[e.row.name],0==Object.keys(t).length&&(t=null))),this.isRowChanging=!0,this.setNewValue(t),this.isRowChanging=!1},i}(e.Question);e.QuestionMatrixDropdownModel=i,e.JsonObject.metaData.addClass("matrixdropdowncolumn",["name","title","choices:itemvalues","optionsCaption"],function(){return new t("")}),e.JsonObject.metaData.setPropertyValues("matrixdropdowncolumn","title",null,null,function(e){return e.titleValue}),e.JsonObject.metaData.setPropertyValues("matrixdropdowncolumn","choices",null,null,function(t){return e.ItemValue.getData(t.choices)},function(e,t){e.choices=t}),e.JsonObject.metaData.addClass("matrixdropdown",["columns:matrixdropdowncolumns","rows:itemvalues","choices:itemvalues","optionsCaption"],function(){return new i("")},"question"),e.JsonObject.metaData.setPropertyValues("matrixdropdown","columns","matrixdropdowncolumn"),e.JsonObject.metaData.setPropertyValues("matrixdropdown","choices",null,null,function(t){return e.ItemValue.getData(t.choices)},function(e,t){e.choices=t}),e.JsonObject.metaData.setPropertyValues("matrixdropdown","rows",null,null,function(t){return e.ItemValue.getData(t.rows)},function(e,t){e.rows=t}),e.JsonObject.metaData.setPropertyValues("matrixdropdown","optionsCaption",null,null,function(e){return e.optionsCaptionValue}),e.QuestionFactory.Instance.registerQuestion("matrixdropdown",function(e){var t=new i(e);return t.choices=[1,2,3,4,5],t.rows=["Row 1","Row 2"],t.addColumn("Column 1"),t.addColumn("Column 2"),t.addColumn("Column 3"),t})}(Survey||(Survey={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Survey;!function(e){var t=function(e){function t(t,n){void 0===t&&(t=null),void 0===n&&(n=null),e.call(this),this.name=t,this.validators=new Array,this.title=n}return __extends(t,e),t.prototype.getType=function(){return"multipletextitem"},t.prototype.setData=function(e){this.data=e},Object.defineProperty(t.prototype,"title",{get:function(){return this.titleValue?this.titleValue:this.name},set:function(e){this.titleValue=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this.data?this.data.getMultipleTextValue(this.name):null},set:function(e){null!=this.data&&this.data.setMultipleTextValue(this.name,e)},enumerable:!0,configurable:!0}),t.prototype.onValueChanged=function(e){},t.prototype.getValidatorTitle=function(){return this.title},t}(e.Base);e.MultipleTextItemModel=t;var n=function(n){function r(e){n.call(this,e),this.name=e,this.itemSize=25,this.items=new Array,this.isMultipleItemValueChanging=!1;var t=this;this.items.push=function(e){return e.setData(t),Array.prototype.push.call(this,e)}}return __extends(r,n),r.prototype.getType=function(){return"multipletext"},r.prototype.AddItem=function(e,t){void 0===t&&(t=null);var n=this.createTextItem(e,t);return this.items.push(n),n},r.prototype.onValueChanged=function(){n.prototype.onValueChanged.call(this),this.onItemValueChanged()},r.prototype.createTextItem=function(e,n){return new t(e,n)},r.prototype.onItemValueChanged=function(){if(!this.isMultipleItemValueChanging)for(var e=0;e<this.items.length;e++){var t=null;this.value&&this.items[e].name in this.value&&(t=this.value[this.items[e].name]),this.items[e].onValueChanged(t)}},r.prototype.runValidators=function(){var t=n.prototype.runValidators.call(this);if(null!=t)return t;for(var r=0;r<this.items.length;r++)if(t=(new e.ValidatorRunner).run(this.items[r]),
null!=t)return t;return null},r.prototype.getMultipleTextValue=function(e){return this.value?this.value[e]:null},r.prototype.setMultipleTextValue=function(e,t){this.isMultipleItemValueChanging=!0;var n=this.value;n||(n={}),n[e]=t,this.setNewValue(n),this.isMultipleItemValueChanging=!1},r}(e.Question);e.QuestionMultipleTextModel=n,e.JsonObject.metaData.addClass("multipletextitem",["name","title","validators:validators"],function(){return new t("")}),e.JsonObject.metaData.setPropertyClassInfo("multipletextitem","validators","surveyvalidator","validator"),e.JsonObject.metaData.setPropertyValues("multipletextitem","title",null,null,function(e){return e.titleValue}),e.JsonObject.metaData.addClass("multipletext",["!items:textitems","itemSize:number"],function(){return new n("")},"question"),e.JsonObject.metaData.setPropertyValues("multipletext","items","multipletextitem"),e.JsonObject.metaData.setPropertyValues("multipletext","itemSize",null,25),e.QuestionFactory.Instance.registerQuestion("multipletext",function(e){var t=new n(e);return t.AddItem("text1"),t.AddItem("text2"),t})}(Survey||(Survey={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Survey;!function(e){var t=function(e){function t(t){e.call(this,t),this.name=t}return __extends(t,e),t.prototype.getType=function(){return"radiogroup"},t}(e.QuestionCheckboxBase);e.QuestionRadiogroupModel=t,e.JsonObject.metaData.addClass("radiogroup",[],function(){return new t("")},"checkboxbase"),e.QuestionFactory.Instance.registerQuestion("radiogroup",function(n){var r=new t(n);return r.choices=e.QuestionFactory.DefaultChoices,r})}(Survey||(Survey={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Survey;!function(e){var t=function(t){function n(e){t.call(this,e),this.name=e,this.rates=[],this.mininumRateDescription=null,this.maximumRateDescription=null}return __extends(n,t),Object.defineProperty(n.prototype,"rateValues",{get:function(){return this.rates},set:function(t){e.ItemValue.setData(this.rates,t),this.fireCallback(this.rateValuesChangedCallback)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"visibleRateValues",{get:function(){return this.rateValues.length>0?this.rateValues:n.defaultRateValues},enumerable:!0,configurable:!0}),n.prototype.getType=function(){return"rating"},n.prototype.supportComment=function(){return!0},n.prototype.supportOther=function(){return!0},n.defaultRateValues=[],n}(e.Question);e.QuestionRatingModel=t,e.ItemValue.setData(t.defaultRateValues,[1,2,3,4,5]),e.JsonObject.metaData.addClass("rating",["hasComment:boolean","rateValues:itemvalues","mininumRateDescription","maximumRateDescription"],function(){return new t("")},"question"),e.JsonObject.metaData.setPropertyValues("rating","rateValues",null,null,function(t){return e.ItemValue.getData(t.rateValues)},function(e,t){e.rateValues=t}),e.QuestionFactory.Instance.registerQuestion("rating",function(e){return new t(e)})}(Survey||(Survey={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Survey;!function(e){var t=function(e){function t(t){e.call(this,t),this.name=t,this.size=25}return __extends(t,e),t.prototype.getType=function(){return"text"},t.prototype.isEmpty=function(){return e.prototype.isEmpty.call(this)||""==this.value},t}(e.Question);e.QuestionTextModel=t,e.JsonObject.metaData.addClass("text",["size:number"],function(){return new t("")},"question"),e.JsonObject.metaData.setPropertyValues("text","size",null,25),e.QuestionFactory.Instance.registerQuestion("text",function(e){return new t(e)})}(Survey||(Survey={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Survey;!function(e){var t=function(e){function t(){e.call(this),this.opValue="equal"}return __extends(t,e),Object.defineProperty(t,"operators",{get:function(){return null!=t.operatorsValue?t.operatorsValue:(t.operatorsValue={empty:function(e,t){return!e},notempty:function(e,t){return!!e},equal:function(e,t){return e==t},notequal:function(e,t){return e!=t},contains:function(e,t){return e&&e.indexOf&&e.indexOf(t)>-1},notcontains:function(e,t){return!e||!e.indexOf||-1==e.indexOf(t)},greater:function(e,t){return e>t},less:function(e,t){return t>e},greaterorequal:function(e,t){return e>=t},lessorequal:function(e,t){return t>=e}},t.operatorsValue)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"operator",{get:function(){return this.opValue},set:function(e){e&&(e=e.toLowerCase(),t.operators[e]&&(this.opValue=e))},enumerable:!0,configurable:!0}),t.prototype.check=function(e){t.operators[this.operator](e,this.value)?this.onSuccess():this.onFailure()},t.prototype.onSuccess=function(){},t.prototype.onFailure=function(){},t.operatorsValue=null,t}(e.Base);e.Trigger=t;var n=function(e){function t(){e.call(this),this.pages=[],this.questions=[],this.owner=null}return __extends(t,e),t.prototype.setOwner=function(e){this.owner=e},t.prototype.onSuccess=function(){this.onTrigger(this.onItemSuccess)},t.prototype.onFailure=function(){this.onTrigger(this.onItemFailure)},t.prototype.onTrigger=function(e){if(this.owner)for(var t=this.owner.getObjects(this.pages,this.questions),n=0;n<t.length;n++)e(t[n])},t.prototype.onItemSuccess=function(e){},t.prototype.onItemFailure=function(e){},t}(t);e.SurveyTrigger=n;var r=function(e){function t(){e.call(this)}return __extends(t,e),t.prototype.getType=function(){return"visibletrigger"},t.prototype.onItemSuccess=function(e){e.visible=!0},t.prototype.onItemFailure=function(e){e.visible=!1},t}(n);e.SurveyTriggerVisible=r,e.JsonObject.metaData.addClass("trigger",["operator","!value"]),e.JsonObject.metaData.addClass("surveytrigger",["!name","pages","questions"],null,"trigger"),e.JsonObject.metaData.addClass("visibletrigger",[],function(){return new r},"surveytrigger")}(Survey||(Survey={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Survey;!function(e){var t=function(t){function n(n,r){void 0===n&&(n=null),void 0===r&&(r=null),t.call(this),this.surveyId=null,this.surveyPostId=null,this.clientId=null,this.sendResultOnPageNext=!1,this.commentPrefix="-Comment",this.title="",this.showNavigationButtons=!0,this.showTitle=!0,this.showPageTitles=!0,this.requiredText="* ",this.showProgressBar="off",this.pages=new Array,this.triggers=new Array,this.currentPageValue=null,this.valuesHash={},this.showPageNumbersValue=!1,this.showQuestionNumbersValue="on",this.localeValue="",this.onComplete=new e.Event,this.onCurrentPageChanged=new e.Event,this.onValueChanged=new e.Event,this.onVisibleChanged=new e.Event,this.onPageVisibleChanged=new e.Event,this.onQuestionAdded=new e.Event,this.onQuestionRemoved=new e.Event,this.onValidateQuestion=new e.Event,this.onSendResult=new e.Event,this.onGetResult=new e.Event,this.jsonErrors=null,this.mode="normal";var i=this;this.pages.push=function(e){return e.data=i,Array.prototype.push.call(this,e)},this.triggers.push=function(e){return e.setOwner(i),Array.prototype.push.call(this,e)},this.onBeforeCreating(),n&&(this.setJsonObject(n),this.surveyId&&this.loadSurveyFromService(this.surveyId,r)),this.onCreating()}return __extends(n,t),n.prototype.getType=function(){return"survey"},Object.defineProperty(n.prototype,"locale",{get:function(){return this.localeValue},set:function(t){this.localeValue=t,e.surveyLocalization.currentLocale=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"pagePrevText",{get:function(){return this.pagePrevTextValue?this.pagePrevTextValue:e.surveyLocalization.getString("pagePrevText")},set:function(e){this.pagePrevTextValue=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"pageNextText",{get:function(){return this.pageNextTextValue?this.pageNextTextValue:e.surveyLocalization.getString("pageNextText")},set:function(e){this.pageNextTextValue=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"completeText",{get:function(){return this.completeTextValue?this.completeTextValue:e.surveyLocalization.getString("completeText")},set:function(e){this.completeTextValue=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"showPageNumbers",{get:function(){return this.showPageNumbersValue},set:function(e){e!==this.showPageNumbers&&(this.showPageNumbersValue=e,this.updateVisibleIndexes())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"showQuestionNumbers",{get:function(){return this.showQuestionNumbersValue},set:function(e){e!==this.showQuestionNumbers&&(this.showQuestionNumbersValue=e,this.updateVisibleIndexes())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"data",{get:function(){var e={};for(var t in this.valuesHash)e[t]=this.valuesHash[t];return e},set:function(e){if(this.valuesHash={},e)for(var t in e)this.valuesHash[t]=e[t],this.checkTriggers(t,e[t]);this.notifyAllQuestionsOnValueChanged()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"comments",{get:function(){var e={};for(var t in this.valuesHash)t.indexOf(this.commentPrefix)>0&&(e[t]=this.valuesHash[t]);return e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"visiblePages",{get:function(){if(this.isDesignMode)return this.pages;for(var e=new Array,t=0;t<this.pages.length;t++)this.pages[t].isVisible&&e.push(this.pages[t]);return e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isEmpty",{get:function(){return 0==this.pages.length},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"PageCount",{get:function(){return this.pages.length},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"visiblePageCount",{get:function(){return this.visiblePages.length},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"currentPage",{get:function(){var e=this.visiblePages;return null!=this.currentPageValue&&e.indexOf(this.currentPageValue)<0&&(this.currentPage=null),null==this.currentPageValue&&e.length>0&&(this.currentPage=e[0]),this.currentPageValue},set:function(e){var t=this.visiblePages;if(!(null!=e&&t.indexOf(e)<0)&&e!=this.currentPageValue){var n=this.currentPageValue;this.currentPageValue=e,this.currentPageChanged(e,n)}},enumerable:!0,configurable:!0}),n.prototype.currentPageChanged=function(e,t){this.onCurrentPageChanged.fire(this,{oldCurrentPage:t,newCurrentPage:e})},Object.defineProperty(n.prototype,"isDesignMode",{get:function(){return"designer"==this.mode},enumerable:!0,configurable:!0}),n.prototype.nextPage=function(){if(this.isLastPage)return!1;if(this.isCurrentPageHasErrors)return!1;this.sendResultOnPageNext&&this.clientId&&this.sendResult(this.surveyPostId,this.clientId,!0);var e=this.visiblePages,t=e.indexOf(this.currentPage);return this.currentPage=e[t+1],!0},Object.defineProperty(n.prototype,"isCurrentPageHasErrors",{get:function(){return null==this.currentPage?!0:this.currentPage.hasErrors()},enumerable:!0,configurable:!0}),n.prototype.prevPage=function(){if(this.isFirstPage)return!1;var e=this.visiblePages,t=e.indexOf(this.currentPage);this.currentPage=e[t-1]},n.prototype.completeLastPage=function(){return this.isCurrentPageHasErrors?!1:(this.onComplete.fire(this,null),this.surveyPostId&&this.sendResult(),!0)},Object.defineProperty(n.prototype,"isFirstPage",{get:function(){return null==this.currentPage?!0:0==this.visiblePages.indexOf(this.currentPage)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isLastPage",{get:function(){if(null==this.currentPage)return!0;var e=this.visiblePages;return e.indexOf(this.currentPage)==e.length-1},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"progressText",{get:function(){if(null==this.currentPage)return"";var t=this.visiblePages,n=t.indexOf(this.currentPage)+1;return e.surveyLocalization.getString("progressText").format(n,t.length)},enumerable:!0,configurable:!0}),n.prototype.getPage=function(e){return this.pages[e]},n.prototype.addPage=function(e){null!=e&&(this.pages.push(e),this.updateVisibleIndexes())},n.prototype.addNewPage=function(e){var t=this.createNewPage(e);return this.addPage(t),t},n.prototype.removePage=function(e){var t=this.pages.indexOf(e);0>t||(this.pages.splice(t,1),this.currentPageValue==e&&(this.currentPage=this.pages.length>0?this.pages[0]:null),this.updateVisibleIndexes())},n.prototype.getQuestionByName=function(e){for(var t=this.getAllQuestions(),n=0;n<t.length;n++)if(t[n].name==e)return t[n];return null},n.prototype.getQuestionsByNames=function(e){var t=[];if(!e)return t;for(var n=0;n<e.length;n++)if(e[n]){var r=this.getQuestionByName(e[n]);r&&t.push(r)}return t},n.prototype.getPageByQuestion=function(e){for(var t=0;t<this.pages.length;t++){var n=this.pages[t];if(n.questions.indexOf(e)>-1)return n}return null},n.prototype.getPageByName=function(e){for(var t=0;t<this.pages.length;t++)if(this.pages[t].name==e)return this.pages[t];return null},n.prototype.getPagesByNames=function(e){var t=[];if(!e)return t;for(var n=0;n<e.length;n++)if(e[n]){var r=this.getPageByName(e[n]);r&&t.push(r)}return t},n.prototype.getAllQuestions=function(e){void 0===e&&(e=!1);for(var t=new Array,n=0;n<this.pages.length;n++)this.pages[n].addQuestionsToList(t,e);return t},n.prototype.createNewPage=function(t){return new e.PageModel(t)},n.prototype.notifyQuestionOnValueChanged=function(e,t){for(var n=this.getAllQuestions(),r=0;r<n.length;r++)n[r].name==e&&n[r].onSurveyValueChanged(t);this.onValueChanged.fire(this,{name:e,value:t})},n.prototype.notifyAllQuestionsOnValueChanged=function(){for(var e=this.getAllQuestions(),t=0;t<e.length;t++)e[t].onSurveyValueChanged(this.getValue(e[t].name))},n.prototype.checkTriggers=function(e,t){for(var n=0;n<this.triggers.length;n++)this.triggers[n].name==e&&this.triggers[n].check(t)},n.prototype.sendResult=function(t,n,r){if(void 0===t&&(t=null),void 0===n&&(n=null),void 0===r&&(r=!1),!t&&this.surveyPostId&&(t=this.surveyPostId),t){n&&(this.clientId=n);var i=this;(new e.dxSurveyService).sendResult(t,this.data,function(e,t){i.onSendResult.fire(i,{success:e,response:t})},this.clientId,r)}},n.prototype.getResult=function(t,n){var r=this;(new e.dxSurveyService).getResult(t,n,function(e,t,n,i){r.onGetResult.fire(r,{success:e,data:t,dataList:n,response:i})})},n.prototype.loadSurveyFromService=function(t,n){void 0===t&&(t=null),void 0===n&&(n=null),t&&(this.surveyId=t);var r=this;(new e.dxSurveyService).loadSurvey(this.surveyId,function(e,t,i){e&&t&&(r.setJsonObject(t),r.onLoadSurveyFromService(n))})},n.prototype.onLoadSurveyFromService=function(e){},n.prototype.updateVisibleIndexes=function(){if(this.updatePageVisibleIndexes(this.showPageNumbers),"onPage"==this.showQuestionNumbers)for(var e=this.visiblePages,t=0;t<e.length;t++)this.updateQuestionVisibleIndexes(e[t].questions,!0);else this.updateQuestionVisibleIndexes(this.getAllQuestions(!1),"on"==this.showQuestionNumbers)},n.prototype.updatePageVisibleIndexes=function(e){for(var t=0,n=0;n<this.pages.length;n++)this.pages[n].visibleIndex=this.pages[n].visible?t++:-1,this.pages[n].num=e&&this.pages[n].visible?this.pages[n].visibleIndex+1:-1},n.prototype.updateQuestionVisibleIndexes=function(e,t){for(var n=0,r=0;r<e.length;r++)e[r].setVisibleIndex(t&&e[r].visible&&e[r].hasTitle?n++:-1)},n.prototype.setJsonObject=function(t){if(t){this.jsonErrors=null;var n=new e.JsonObject;n.toObject(t,this),n.errors.length>0&&(this.jsonErrors=n.errors),this.updateVisibleIndexes()}},n.prototype.onBeforeCreating=function(){},n.prototype.onCreating=function(){},n.prototype.getValue=function(e){return e&&0!=e.length?this.valuesHash[e]:null},n.prototype.setValue=function(e,t){""==t||null==t?delete this.valuesHash[e]:this.valuesHash[e]=t,this.notifyQuestionOnValueChanged(e,t),this.checkTriggers(e,t)},n.prototype.getComment=function(e){var t=this.data[e+this.commentPrefix];return null==t&&(t=""),t},n.prototype.setComment=function(e,t){e+=this.commentPrefix,""==t||null==t?delete this.valuesHash[e]:this.valuesHash[e]=t},n.prototype.questionVisibilityChanged=function(e,t){this.updateVisibleIndexes(),this.onVisibleChanged.fire(this,{question:e,name:e.name,visible:t})},n.prototype.pageVisibilityChanged=function(e,t){this.updateVisibleIndexes(),this.onPageVisibleChanged.fire(this,{page:e,visible:t})},n.prototype.questionAdded=function(e,t){this.updateVisibleIndexes(),this.onQuestionAdded.fire(this,{question:e,name:e.name,index:t})},n.prototype.questionRemoved=function(e){this.updateVisibleIndexes(),this.onQuestionRemoved.fire(this,{question:e,name:e.name})},n.prototype.validateQuestion=function(t){if(this.onValidateQuestion.isEmpty)return null;var n={name:t,value:this.getValue(t),error:null};return this.onValidateQuestion.fire(this,n),n.error?new e.CustomError(n.error):null},n.prototype.getObjects=function(e,t){var n=[];return Array.prototype.push.apply(n,this.getPagesByNames(e)),Array.prototype.push.apply(n,this.getQuestionsByNames(t)),n},n}(e.Base);e.SurveyModel=t,e.JsonObject.metaData.addClass("survey",["locale","title","pages","questions","triggers:triggers","surveyId","surveyPostId","sendResultOnPageNext:boolean","showNavigationButtons:boolean","showTitle:boolean","showPageTitles:boolean","showPageNumbers:boolean","showQuestionNumbers","showProgressBar","requiredText","pagePrevText","pageNextText","completeText"]),e.JsonObject.metaData.setPropertyValues("survey","pages","page"),e.JsonObject.metaData.setPropertyValues("survey","questions",null,null,function(e){return null},function(e,t,n){var r=e.addNewPage("");n.toObject({questions:t},r)}),e.JsonObject.metaData.setPropertyValues("survey","showNavigationButtons",null,!0),e.JsonObject.metaData.setPropertyValues("survey","showTitle",null,!0),e.JsonObject.metaData.setPropertyValues("survey","showPageTitles",null,!0),e.JsonObject.metaData.setPropertyValues("survey","showQuestionNumbers",null,"on"),e.JsonObject.metaData.setPropertyChoices("survey","showQuestionNumbers",["on","onPage","off"]),e.JsonObject.metaData.setPropertyValues("survey","showProgressBar",null,"off"),e.JsonObject.metaData.setPropertyChoices("survey","showProgressBar",["off","top","bottom"]),e.JsonObject.metaData.setPropertyValues("survey","requiredText",null,"* "),e.JsonObject.metaData.setPropertyValues("survey","pagePrevText",null,null,function(e){return e.pagePrevTextValue}),e.JsonObject.metaData.setPropertyValues("survey","pageNextText",null,null,function(e){return e.pageNextTextValue}),e.JsonObject.metaData.setPropertyValues("survey","completeText",null,null,function(e){return e.completeTextValue}),e.JsonObject.metaData.setPropertyClassInfo("survey","triggers","surveytrigger","trigger"),e.JsonObject.metaData.setPropertyClassInfo("survey","questions","question"),e.JsonObject.metaData.setPropertyChoices("survey","locale",null,function(){return e.surveyLocalization.getLocales()})}(Survey||(Survey={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Survey;!function(e){var t=function(t){function n(e){t.call(this),this.surveyValue=this.createSurvey(e),this.surveyValue.showTitle=!1,this.windowElement=document.createElement("div")}return __extends(n,t),n.prototype.getType=function(){return"window"},Object.defineProperty(n.prototype,"survey",{get:function(){return this.surveyValue},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isShowing",{get:function(){return this.isShowingValue},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isExpanded",{get:function(){return this.isExpandedValue},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"title",{get:function(){return this.titleValue?this.titleValue:this.survey.title},set:function(e){this.titleValue=e},enumerable:!0,configurable:!0}),n.prototype.expand=function(){this.expandcollapse(!0)},n.prototype.collapse=function(){this.expandcollapse(!1)},n.prototype.createSurvey=function(t){return new e.SurveyModel(t)},n.prototype.expandcollapse=function(e){this.isExpandedValue=e},n.surveyElementName="windowSurveyJS",n}(e.Base);e.SurveyWindowModel=t}(Survey||(Survey={}));var Survey;!function(e){var t={pagePrevText:"Zurck",pageNextText:"Weiter",completeText:"Fertig",progressText:"Seite {0} von {1}",otherItemText:"Andere (beschreiben)",optionsCaption:"Whlen...",requiredError:"Bitte antworten Sie auf die Frage.",numericError:"Der Wert sollte eine Zahl sein.",textMinLength:"Bitte geben Sie mindestens {0} Symbole.",minSelectError:"Bitte whlen Sie mindestens {0} Varianten.",maxSelectError:"Bitte whlen Sie nicth mehr als {0} Varianten.",numericMinMax:"'{0}' solte gleich oder grer sein als {1} und gleich oder kleiner als {2}",numericMin:"'{0}' solte gleich oder grer sein als {1}",numericMax:"'{0}' solte gleich oder kleiner als {1}"};e.surveyLocalization.locales.de=t}(Survey||(Survey={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Survey;!function(e){var t=function(e){function t(t){void 0===t&&(t=""),e.call(this,t),this.koNo=ko.observable(""),this.onCreating()}return __extends(t,e),t.prototype.onCreating=function(){},t.prototype.onNumChanged=function(e){this.koNo(e>0?e+". ":"")},t}(e.PageModel);e.Page=t,e.JsonObject.metaData.overrideClassCreatore("page",function(){return new t})}(Survey||(Survey={}));var Survey;!function(e){var t=function(){function e(e){this.question=e;var t=this;e.visibilityChangedCallback=function(){t.onVisibilityChanged()},e.visibleIndexChangedCallback=function(){t.onVisibleIndexChanged()},this.koVisible=ko.observable(this.question.visible),this.koErrors=ko.observableArray(),this.koNo=ko.observable(this.getNo()),this.question.koVisible=this.koVisible,this.question.koNo=this.koNo,this.question.koErrors=this.koErrors}return e.prototype.onVisibilityChanged=function(){this.koVisible(this.question.visible)},e.prototype.onVisibleIndexChanged=function(){this.koNo(this.getNo())},e.prototype.getNo=function(){return this.question.visibleIndex>-1?this.question.visibleIndex+1+". ":""},e}();e.QuestionImplementorBase=t}(Survey||(Survey={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Survey;!function(e){var t=function(e){function t(t){e.call(this,t),this.question=t,this.isUpdating=!1;var n=this;t.valueChangedCallback=function(){n.onValueChanged()},t.commentChangedCallback=function(){n.onCommentChanged()},t.errorsChangedCallback=function(){n.onErrorsChanged()},this.koValue=this.createkoValue(),this.koComment=ko.observable(this.question.comment),this.koErrors(this.question.errors),this.koValue.subscribe(function(e){n.updateValue(e)}),this.koComment.subscribe(function(e){n.updateComment(e)}),this.question.koValue=this.koValue,this.question.koComment=this.koComment}return __extends(t,e),t.prototype.onValueChanged=function(){this.isUpdating||this.setkoValue(this.question.value)},t.prototype.onCommentChanged=function(){this.isUpdating||this.koComment(this.question.comment)},t.prototype.onVisibilityChanged=function(){this.koVisible(this.question.visible)},t.prototype.onVisibleIndexChanged=function(){this.koNo(this.getNo())},t.prototype.onErrorsChanged=function(){this.koErrors(this.question.errors)},t.prototype.createkoValue=function(){return ko.observable(this.question.value)},t.prototype.setkoValue=function(e){this.koValue(e)},t.prototype.updateValue=function(e){this.isUpdating=!0,this.question.value=e,this.isUpdating=!1},t.prototype.updateComment=function(e){this.isUpdating=!0,this.question.comment=e,this.isUpdating=!1},t.prototype.getNo=function(){return this.question.visibleIndex>-1?this.question.visibleIndex+1+". ":""},t}(e.QuestionImplementorBase);e.QuestionImplementor=t}(Survey||(Survey={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Survey;!function(e){var t=function(e){function t(t){e.call(this,t);var n=this;this.koOtherVisible=ko.computed(function(){return n.koValue(),n.isOtherSelected}),this.question.koOtherVisible=this.koOtherVisible}return __extends(t,e),Object.defineProperty(t.prototype,"isOtherSelected",{get:function(){return this.question.isOtherSelected},enumerable:!0,configurable:!0}),t}(e.QuestionImplementor);e.QuestionSelectBaseImplementor=t;var n=function(e){function t(t){e.call(this,t),this.koWidth=ko.observable(this.colWidth),this.question.koWidth=this.koWidth,this.question.koAfterRender=this.koAfterRender;var n=this;this.question.colCountChangedCallback=function(){n.onColCountChanged()}}return __extends(t,e),t.prototype.onColCountChanged=function(){this.question.koWidth=ko.observable(this.colWidth)},Object.defineProperty(t.prototype,"colWidth",{get:function(){var e=this.question.colCount;return e>0?100/e+"%":""},enumerable:!0,configurable:!0}),t.prototype.koAfterRender=function(e,t){var n=e[0];"#text"==n.nodeName&&(n.data=""),n=e[e.length-1],"#text"==n.nodeName&&(n.data="")},t}(t);e.QuestionCheckboxBaseImplementor=n}(Survey||(Survey={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Survey;!function(e){var t=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.prototype.createkoValue=function(){return this.question.value?ko.observableArray(this.question.value):ko.observableArray()},t.prototype.setkoValue=function(e){e?this.koValue([].concat(e)):this.koValue([])},t}(e.QuestionCheckboxBaseImplementor),n=function(e){function n(n){e.call(this,n),this.name=n,new t(this)}return __extends(n,e),n}(e.QuestionCheckboxModel);e.QuestionCheckbox=n,e.JsonObject.metaData.overrideClassCreatore("checkbox",function(){return new n("")}),e.QuestionFactory.Instance.registerQuestion("checkbox",function(t){var r=new n(t);return r.choices=e.QuestionFactory.DefaultChoices,r})}(Survey||(Survey={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Survey;!function(e){var t=function(t){function n(n){t.call(this,n),this.name=n,new e.QuestionImplementor(this)}return __extends(n,t),n}(e.QuestionCommentModel);e.QuestionComment=t,e.JsonObject.metaData.overrideClassCreatore("comment",function(){return new t("")}),e.QuestionFactory.Instance.registerQuestion("comment",function(e){return new t(e)})}(Survey||(Survey={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Survey;!function(e){var t=function(t){function n(n){t.call(this,n),this.name=n,new e.QuestionSelectBaseImplementor(this)}return __extends(n,t),n}(e.QuestionDropdownModel);e.QuestionDropdown=t,e.JsonObject.metaData.overrideClassCreatore("dropdown",function(){return new t("")}),e.QuestionFactory.Instance.registerQuestion("dropdown",function(n){var r=new t(n);return r.choices=e.QuestionFactory.DefaultChoices,r})}(Survey||(Survey={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Survey;!function(e){var t=function(t){function n(n){t.call(this,n),this.name=n,new e.QuestionImplementorBase(this)}return __extends(n,t),n}(e.QuestionHtmlModel);e.QuestionHtml=t,e.JsonObject.metaData.overrideClassCreatore("html",function(){return new t("")}),e.QuestionFactory.Instance.registerQuestion("html",function(e){return new t(e)})}(Survey||(Survey={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Survey;!function(e){var t=function(e){function t(t,n,r,i,s){e.call(this,t,n,r,i,s),this.name=t,this.text=n,this.fullName=r,this.isValueUpdating=!1,this.koValue=ko.observable(this.value);var a=this;this.koValue.subscribe(function(e){a.isValueUpdating,a.value=e})}return __extends(t,e),t.prototype.onValueChanged=function(){this.isValueUpdating=!0,this.koValue(this.value),this.isValueUpdating=!1},t}(e.MatrixRowModel);e.MatrixRow=t;var n=function(n){function r(t){n.call(this,t),this.name=t,new e.QuestionImplementor(this)}return __extends(r,n),r.prototype.createMatrixRow=function(e,n,r,i){return new t(e,n,r,this,i)},r}(e.QuestionMatrixModel);e.QuestionMatrix=n,e.JsonObject.metaData.overrideClassCreatore("matrix",function(){return new n("")}),e.QuestionFactory.Instance.registerQuestion("matrix",function(e){var t=new n(e);return t.rows=["Row 1","Row 2"],t.columns=["Column 1","Column 2","Column 3"],t})}(Survey||(Survey={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Survey;!function(e){var t=function(e){function t(t,n,r,i){e.call(this,t,n,r,i),this.column=t,this.row=n,this.isValueUpdating=!1,this.koValue=ko.observable(this.value);var s=this;this.koValue.subscribe(function(e){s.isValueUpdating||(s.value=e)})}return __extends(t,e),t.prototype.onValueChanged=function(){this.isValueUpdating=!0,this.koValue(this.value),this.isValueUpdating=!1},t}(e.MatrixDropdownCellModel);e.MatrixDropdownCell=t;var n=function(e){function n(t,n,r,i){e.call(this,t,n,r,i),this.name=t,this.text=n}return __extends(n,e),n.prototype.createCell=function(e,n){return new t(e,this,this.data,n)},n}(e.MatrixDropdownRowModel);e.MatrixDropdownRow=n;var r=function(t){function r(n){t.call(this,n),this.name=n,new e.QuestionImplementor(this)}return __extends(r,t),r.prototype.createMatrixRow=function(e,t,r){return new n(e,t,this,r)},r}(e.QuestionMatrixDropdownModel);e.QuestionMatrixDropdown=r,e.JsonObject.metaData.overrideClassCreatore("matrixdropdown",function(){return new r("")}),e.QuestionFactory.Instance.registerQuestion("matrixdropdown",function(e){var t=new r(e);return t.choices=[1,2,3,4,5],t.rows=["Row 1","Row 2"],t.addColumn("Column 1"),t.addColumn("Column 2"),t.addColumn("Column 3"),t})}(Survey||(Survey={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Survey;!function(e){var t=function(e){function t(t,n){void 0===t&&(t=null),void 0===n&&(n=null),e.call(this,t,n),this.name=t,this.isKOValueUpdating=!1,this.koValue=ko.observable(this.value);var r=this;this.koValue.subscribe(function(e){r.isKOValueUpdating||(r.value=e)})}return __extends(t,e),t.prototype.onValueChanged=function(e){this.isKOValueUpdating=!0,this.koValue(e),this.isKOValueUpdating=!1},t}(e.MultipleTextItemModel);e.MultipleTextItem=t;var n=function(n){function r(t){n.call(this,t),this.name=t,new e.QuestionImplementor(this)}return __extends(r,n),r.prototype.createTextItem=function(e,n){return new t(e,n)},r}(e.QuestionMultipleTextModel);e.QuestionMultipleText=n,
e.JsonObject.metaData.overrideClassCreatore("multipletextitem",function(){return new t("")}),e.JsonObject.metaData.overrideClassCreatore("multipletext",function(){return new n("")}),e.QuestionFactory.Instance.registerQuestion("multipletext",function(e){var t=new n(e);return t.AddItem("text1"),t.AddItem("text2"),t})}(Survey||(Survey={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Survey;!function(e){var t=function(t){function n(n){t.call(this,n),this.name=n,new e.QuestionCheckboxBaseImplementor(this)}return __extends(n,t),n}(e.QuestionRadiogroupModel);e.QuestionRadiogroup=t,e.JsonObject.metaData.overrideClassCreatore("radiogroup",function(){return new t("")}),e.QuestionFactory.Instance.registerQuestion("radiogroup",function(n){var r=new t(n);return r.choices=e.QuestionFactory.DefaultChoices,r})}(Survey||(Survey={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Survey;!function(e){var t=function(e){function t(t){e.call(this,t),this.koVisibleRateValues=ko.observableArray(this.question.visibleRateValues),this.question.koVisibleRateValues=this.koVisibleRateValues;var n=this;this.koChange=function(e){n.koValue(e.itemValue)},this.question.koChange=this.koChange,this.question.rateValuesChangedCallback=function(){n.onRateValuesChanged()}}return __extends(t,e),t.prototype.onRateValuesChanged=function(){this.koVisibleRateValues(this.question.visibleRateValues)},t}(e.QuestionImplementor),n=function(e){function n(n){e.call(this,n),this.name=n,new t(this)}return __extends(n,e),n}(e.QuestionRatingModel);e.QuestionRating=n,e.JsonObject.metaData.overrideClassCreatore("rating",function(){return new n("")}),e.QuestionFactory.Instance.registerQuestion("rating",function(e){return new n(e)})}(Survey||(Survey={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Survey;!function(e){var t=function(t){function n(n){t.call(this,n),this.name=n,new e.QuestionImplementor(this)}return __extends(n,t),n}(e.QuestionTextModel);e.QuestionText=t,e.JsonObject.metaData.overrideClassCreatore("text",function(){return new t("")}),e.QuestionFactory.Instance.registerQuestion("text",function(e){return new t(e)})}(Survey||(Survey={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Survey;!function(e){var t=function(t){function n(n,r){if(void 0===n&&(n=null),void 0===r&&(r=null),t.call(this,n,r),this.onRendered=new e.Event,"undefined"==typeof ko)throw new Error("knockoutjs library is not loaded.");this.render(r)}return __extends(n,t),n.prototype.render=function(e){void 0===e&&(e=null);var t=this;e&&"string"==typeof e&&(e=document.getElementById(e)),e&&(this.renderedElement=e),e=this.renderedElement,e&&!this.isEmpty&&(e.innerHTML=this.getTemplate(),t.applyBinding(),t.onRendered.fire(t,{}))},n.prototype.createNewPage=function(t){return new e.Page(t)},n.prototype.getTemplate=function(){throw new Error("Please override this method")},n.prototype.onBeforeCreating=function(){var e=this;this.dummyObservable=ko.observable(0),this.koCurrentPage=ko.computed(function(){return e.dummyObservable(),e.currentPage}),this.koIsFirstPage=ko.computed(function(){return e.dummyObservable(),e.isFirstPage}),this.koIsLastPage=ko.computed(function(){return e.dummyObservable(),e.isLastPage}),this.koProgressText=ko.computed(function(){return e.dummyObservable(),e.progressText}),this.koProgress=ko.computed(function(){return e.dummyObservable(),e.getProgress()})},n.prototype.currentPageChanged=function(e,n){this.updateKoCurrentPage(),t.prototype.currentPageChanged.call(this,e,n)},n.prototype.onLoadSurveyFromService=function(e){this.render(e)},n.prototype.applyBinding=function(){this.renderedElement&&(this.updateKoCurrentPage(),ko.cleanNode(this.renderedElement),ko.applyBindings(this,this.renderedElement))},n.prototype.updateKoCurrentPage=function(){this.dummyObservable(this.dummyObservable()+1)},n.prototype.getProgress=function(){if(null==this.currentPage)return 0;var e=this.visiblePages.indexOf(this.currentPage)+1;return Math.ceil(100*e/this.visiblePageCount)},n}(e.SurveyModel);e.SurveyBase=t}(Survey||(Survey={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Survey;!function(e){var t=function(t){function n(e){t.call(this,e),this.koExpanded=ko.observable(!1);var n=this;this.doExpand=function(){n.changeExpanded()},this.survey.onComplete.add(function(e){n.onComplete()})}return __extends(n,t),n.prototype.createSurvey=function(t){return new e.SurveyBase(t)},n.prototype.expandcollapse=function(e){t.prototype.expandcollapse.call(this,e),this.koExpanded(this.isExpandedValue)},Object.defineProperty(n.prototype,"template",{get:function(){return this.templateValue?this.templateValue:this.getDefaultTemplate()},set:function(e){this.templateValue=e},enumerable:!0,configurable:!0}),n.prototype.show=function(){this.windowElement.innerHTML=this.template,ko.cleanNode(this.windowElement),ko.applyBindings(this,this.windowElement),document.body.appendChild(this.windowElement),this.survey.render(e.SurveyWindow.surveyElementName),this.isShowingValue=!0},n.prototype.getDefaultTemplate=function(){throw new Error("Please override this method")},n.prototype.hide=function(){document.body.removeChild(this.windowElement),this.windowElement.innerHTML="",this.isShowingValue=!1},n.prototype.changeExpanded=function(){this.expandcollapse(!this.isExpanded)},n.prototype.onComplete=function(){this.hide()},n}(e.SurveyWindowModel);e.SurveyWindowBase=t}(Survey||(Survey={}));var Survey;!function(e){var t=function(){function e(){}return e.prototype.replaceText=function(e,t,n){void 0===n&&(n=null),t=this.getId(t,n);var r=this.text.indexOf(t);if(!(0>r||(r=this.text.indexOf(">",r),0>r))){var i=r+1,s="</script>";r=this.text.indexOf(s,i),0>r||(this.text=this.text.substr(0,i)+e+this.text.substr(r))}},e.prototype.getId=function(e,t){var n='id="survey-'+e;return t&&(n+="-"+t),n+'"'},Object.defineProperty(e.prototype,"text",{get:function(){return""},set:function(e){},enumerable:!0,configurable:!0}),e}();e.SurveyTemplateTextBase=t}(Survey||(Survey={}));var template;!function(e){var t;!function(e){e.html='<script type="text/html" id="survey-comment">  <input data-bind="value:$data.question.koComment, visible:$data.visible" /></script><div class="sv_main">    <h2 data-bind="visible: (title.length > 0) && showTitle, text: title"></h2>    <!-- ko if: koCurrentPage() -->    <div data-bind="visible: showProgressBar ==\'top\', text:koProgressText"></div>    <div data-bind="template: { name: \'survey-page\', data: koCurrentPage }"></div>    <div data-bind="visible: showProgressBar ==\'bottom\', text:koProgressText"></div>    <p />    <div class="sv_nav" data-bind="visible: showNavigationButtons && !isDesignMode">        <input type="button" data-bind="value: pagePrevText, click: prevPage, visible: !koIsFirstPage()" />  <input type="button" value="Next" data-bind="value: pageNextText, click: nextPage, visible: !koIsLastPage()" />  <input type="button" value="Submit" data-bind="value: completeText, click: completeLastPage, visible: koIsLastPage()" />    </div>    <!-- /ko -->    <!-- ko if: koCurrentPage() == null -->    There is no any visible page or visible question in the survey.    <!-- /ko --></div><script type="text/html" id="survey-page">    <div class="sv_p_title" data-bind="visible: (title.length > 0) && data.showPageTitles, text: koNo() + title"></div>    <!-- ko foreach: { data: questions, as: \'question\' } -->        <!-- ko template: { name: \'survey-question\', data: question } -->        <!-- /ko -->    <!-- /ko --></script><script type="text/html" id="survey-question-checkbox">    <!-- ko foreach: { data: question.visibleChoices, as: \'item\', afterRender: question.koAfterRender}  -->    <div class="sv_qcbc"  data-bind="style:{width: question.koWidth}">            <label class="sv_q_checkbox">                <input type="checkbox"                       data-bind="value: item.value, checked: question.koValue" />                <span data-bind="text: item.text"></span>            </label>    </div>    <!-- /ko -->    <div data-bind="if:question.hasOther">        <div data-bind="template: { name: \'survey-comment\', data: {\'question\': question, \'visible\': question.koOtherVisible } }"></div>    </div></script><script type="text/html" id="survey-question-comment">    <textarea type="text" data-bind="attr: {cols: question.cols, rows: question.rows}, value:question.koValue" /></script><script type="text/html" id="survey-question-dropdown">    <select data-bind="options: question.visibleChoices, optionsText: \'text\', optionsValue: \'value\', value: question.koValue, optionsCaption: question.optionsCaption"></select>    <div data-bind="visible: question.hasOther">        <div data-bind="template: { name: \'survey-comment\', data: {\'question\': question, \'visible\': question.koOtherVisible } }"></div>    </div></script><script type="text/html" id="survey-question-html">    <div data-bind="html: question.html"></div></script><script type="text/html" id="survey-question-matrix">    <table class="sv_q_matrix">        <thead>            <tr>                <th data-bind="visible: question.hasRows"></th>                <!-- ko foreach: question.columns -->                <th data-bind="text:$data.text"></th>                <!-- /ko -->            </tr>        </thead>        <tbody>            <!-- ko foreach: { data: question.visibleRows, as: \'row\' } -->            <tr>                <td data-bind="visible: question.hasRows, text:row.text"></td>                <!-- ko foreach: question.columns -->                <td>                    <input type="radio" data-bind="attr: {name: row.fullName, value: $data.value}, checked: row.koValue"/>                </td>                <!-- /ko -->            </tr>            <!-- /ko -->        </tbody>    </table></script><script type="text/html" id="survey-question-matrixdropdown">    <table  class="sv_q_matrix">        <thead>            <tr>                <th></th>                <!-- ko foreach: question.columns -->                <th data-bind="text:$data.title"></th>                <!-- /ko -->            </tr>        </thead>        <tbody>            <!-- ko foreach: { data: question.visibleRows, as: \'row\' } -->            <tr>                <td data-bind="text:row.text"></td>                <!-- ko foreach: row.cells-->                <td>                    <select data-bind="options: $data.choices, optionsText: \'text\', optionsValue: \'value\', value: $data.koValue, optionsCaption: $data.optionsCaption"></select>                </td>                <!-- /ko -->            </tr>            <!-- /ko -->        </tbody>    </table></script><script type="text/html" id="survey-question-multipletext">    <table data-bind="foreach: { data:  question.items, as: \'item\' }">        <tr>            <td data-bind="text: item.title"></td>            <td><input type="text" data-bind="attr: {size: question.itemSize}, value: item.koValue" /></td>        </tr>    </table></script><script type="text/html" id="survey-question-radiogroup">    <!-- ko foreach: { data: question.visibleChoices, as: \'item\', afterRender: question.koAfterRender}  -->    <div class="sv_qcbc"  data-bind="style:{width: question.koWidth}">        <label class="sv_q_radiogroup">            <input type="radio" data-bind="name: question.name, attr: {value: item.value}, checked: question.koValue" />            <span data-bind="text: item.text"></span>        </label>    </div>    <!-- /ko -->    <div data-bind="if:question.hasOther">        <div data-bind="template: { name: \'survey-comment\', data: {\'question\': question, \'visible\': question.koOtherVisible } }"></div>    </div></script><script type="text/html" id="survey-question-rating">    <table class="sv_q_rating">        <thead>            <tr>                <th></th>                <!-- ko foreach: question.koVisibleRateValues -->                <th data-bind="text:$data.text"></th>                <!-- /ko -->                <th></th>            </tr>        </thead>        <tbody>            <tr>                <td data-bind="text:question.mininumRateDescription"></td>                <!-- ko foreach: question.koVisibleRateValues -->                <td>                    <input type="radio" data-bind="attr: {name: question.name, value: $data.value}, checked: question.koValue" />                </td>                <!-- /ko -->                <td data-bind="text:question.maximumRateDescription"></td>            </tr>        </tbody>    </table>    <div data-bind="visible: question.hasOther">        <div data-bind="template: { name: \'survey-comment\', data: {\'question\': question } }"></div>    </div></script><script type="text/html" id="survey-question-text">    <input type="text" data-bind="attr: {size: question.size}, value:question.koValue"/></script><script type="text/html" id="survey-question">    <div class="sv_q" data-bind="visible: question.koVisible()">        <div class="sv_q_erbox" data-bind="visible: koErrors().length > 0, foreach: koErrors">            <div data-bind="text:$data.getText()"></div>        </div>        <!-- ko if: question.hasTitle -->        <div class="sv_q_title" data-bind="text: question.koNo() +  (question.isRequired ? question.data.requiredText : \'\') + question.title"></div>        <!-- /ko -->        <!-- ko template: { name: \'survey-question-\' + question.getType(), data: question } -->        <!-- /ko -->        <div data-bind="visible: question.hasComment">            Other (please describe)            <div data-bind="template: { name: \'survey-comment\', data: {\'question\': question, \'visible\': true } }"></div>        </div>    </div></script>'}(t=e.ko||(e.ko={}))}(template||(template={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Survey;!function(e){var t=function(e){function t(t,n){void 0===t&&(t=null),void 0===n&&(n=null),e.call(this,t,n)}return __extends(t,e),t.prototype.getTemplate=function(){return template.ko.html},t}(e.SurveyBase);e.Survey=t}(Survey||(Survey={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Survey;!function(e){var t=function(t){function n(e){t.call(this,e)}return __extends(n,t),n.prototype.createSurvey=function(t){return new e.Survey(t)},n.prototype.getDefaultTemplate=function(){return template.window.ko.html},n}(e.SurveyWindowBase);e.SurveyWindow=t}(Survey||(Survey={}));var template;!function(e){var t;!function(e){var t;!function(e){e.html='<div class="sv_window">    <div class="sv_window_title"><a href="#" data-bind="click:doExpand" style="width:100%"><span data-bind="text:title"></span></a></div>    <div data-bind="visible:koExpanded">        <div class="sv_window_content" id="windowSurveyJS"></div>    </div></div>'}(t=e.ko||(e.ko={}))}(t=e.window||(e.window={}))}(template||(template={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Survey;!function(e){var t=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),Object.defineProperty(t.prototype,"text",{get:function(){return template.ko.html},set:function(e){template.ko.html=e},enumerable:!0,configurable:!0}),t}(e.SurveyTemplateTextBase);e.SurveyTemplateText=t}(Survey||(Survey={})),function(){!function(e){var t=this||(0,eval)("this"),n=t.document,r=t.navigator,i=t.jQuery,s=t.JSON;!function(e){"function"==typeof define&&define.amd?define(["exports","require"],e):e("object"==typeof exports&&"object"==typeof module?module.exports||exports:t.ko={})}(function(a,o){function c(e,t){return null===e||typeof e in v?e===t:!1}function u(t,n){var r;return function(){r||(r=m.a.setTimeout(function(){r=e,t()},n))}}function l(e,t){var n;return function(){clearTimeout(n),n=m.a.setTimeout(e,t)}}function f(e,t){t&&t!==g?"beforeChange"===t?this.Kb(e):this.Ha(e,t):this.Lb(e)}function d(e,t){null!==t&&t.k&&t.k()}function p(e,t){var n=this.Hc,r=n[w];r.R||(this.lb&&this.Ma[t]?(n.Pb(t,e,this.Ma[t]),this.Ma[t]=null,--this.lb):r.r[t]||n.Pb(t,e,r.s?{ia:e}:n.uc(e)))}function h(e,t,n,r){m.d[e]={init:function(e,i,s,a,o){var c,u;return m.m(function(){var s=m.a.c(i()),a=!n!=!s,l=!u;(l||t||a!==c)&&(l&&m.va.Aa()&&(u=m.a.ua(m.f.childNodes(e),!0)),a?(l||m.f.da(e,m.a.ua(u)),m.eb(r?r(o,s):o,e)):m.f.xa(e),c=a)},null,{i:e}),{controlsDescendantBindings:!0}}},m.h.ta[e]=!1,m.f.Z[e]=!0}var m="undefined"!=typeof a?a:{};m.b=function(e,t){for(var n=e.split("."),r=m,i=0;i<n.length-1;i++)r=r[n[i]];r[n[n.length-1]]=t},m.G=function(e,t,n){e[t]=n},m.version="3.4.0",m.b("version",m.version),m.options={deferUpdates:!1,useOnlyNativeEvents:!1},m.a=function(){function a(e,t){for(var n in e)e.hasOwnProperty(n)&&t(n,e[n])}function o(e,t){if(t)for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function c(e,t){return e.__proto__=t,e}function u(e,t,n,r){var i=e[t].match(g)||[];m.a.q(n.match(g),function(e){m.a.pa(i,e,r)}),e[t]=i.join(" ")}var l={__proto__:[]}instanceof Array,f="function"==typeof Symbol,d={},p={};d[r&&/Firefox\/2/i.test(r.userAgent)?"KeyboardEvent":"UIEvents"]=["keyup","keydown","keypress"],d.MouseEvents="click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave".split(" "),a(d,function(e,t){if(t.length)for(var n=0,r=t.length;r>n;n++)p[t[n]]=e});var h={propertychange:!0},v=n&&function(){for(var t=3,r=n.createElement("div"),i=r.getElementsByTagName("i");r.innerHTML="<!--[if gt IE "+ ++t+"]><i></i><![endif]-->",i[0];);return t>4?t:e}(),g=/\S+/g;return{cc:["authenticity_token",/^__RequestVerificationToken(_.*)?$/],q:function(e,t){for(var n=0,r=e.length;r>n;n++)t(e[n],n)},o:function(e,t){if("function"==typeof Array.prototype.indexOf)return Array.prototype.indexOf.call(e,t);for(var n=0,r=e.length;r>n;n++)if(e[n]===t)return n;return-1},Sb:function(e,t,n){for(var r=0,i=e.length;i>r;r++)if(t.call(n,e[r],r))return e[r];return null},La:function(e,t){var n=m.a.o(e,t);n>0?e.splice(n,1):0===n&&e.shift()},Tb:function(e){e=e||[];for(var t=[],n=0,r=e.length;r>n;n++)0>m.a.o(t,e[n])&&t.push(e[n]);return t},fb:function(e,t){e=e||[];for(var n=[],r=0,i=e.length;i>r;r++)n.push(t(e[r],r));return n},Ka:function(e,t){e=e||[];for(var n=[],r=0,i=e.length;i>r;r++)t(e[r],r)&&n.push(e[r]);return n},ra:function(e,t){if(t instanceof Array)e.push.apply(e,t);else for(var n=0,r=t.length;r>n;n++)e.push(t[n]);return e},pa:function(e,t,n){var r=m.a.o(m.a.zb(e),t);0>r?n&&e.push(t):n||e.splice(r,1)},ka:l,extend:o,Xa:c,Ya:l?c:o,D:a,Ca:function(e,t){if(!e)return e;var n,r={};for(n in e)e.hasOwnProperty(n)&&(r[n]=t(e[n],n,e));return r},ob:function(e){for(;e.firstChild;)m.removeNode(e.firstChild)},jc:function(e){e=m.a.V(e);for(var t=(e[0]&&e[0].ownerDocument||n).createElement("div"),r=0,i=e.length;i>r;r++)t.appendChild(m.$(e[r]));return t},ua:function(e,t){for(var n=0,r=e.length,i=[];r>n;n++){var s=e[n].cloneNode(!0);i.push(t?m.$(s):s)}return i},da:function(e,t){if(m.a.ob(e),t)for(var n=0,r=t.length;r>n;n++)e.appendChild(t[n])},qc:function(e,t){var n=e.nodeType?[e]:e;if(0<n.length){for(var r=n[0],i=r.parentNode,s=0,a=t.length;a>s;s++)i.insertBefore(t[s],r);for(s=0,a=n.length;a>s;s++)m.removeNode(n[s])}},za:function(e,t){if(e.length){for(t=8===t.nodeType&&t.parentNode||t;e.length&&e[0].parentNode!==t;)e.splice(0,1);for(;1<e.length&&e[e.length-1].parentNode!==t;)e.length--;if(1<e.length){var n=e[0],r=e[e.length-1];for(e.length=0;n!==r;)e.push(n),n=n.nextSibling;e.push(r)}}return e},sc:function(e,t){7>v?e.setAttribute("selected",t):e.selected=t},$a:function(t){return null===t||t===e?"":t.trim?t.trim():t.toString().replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},nd:function(e,t){return e=e||"",t.length>e.length?!1:e.substring(0,t.length)===t},Mc:function(e,t){if(e===t)return!0;if(11===e.nodeType)return!1;if(t.contains)return t.contains(3===e.nodeType?e.parentNode:e);if(t.compareDocumentPosition)return 16==(16&t.compareDocumentPosition(e));for(;e&&e!=t;)e=e.parentNode;return!!e},nb:function(e){return m.a.Mc(e,e.ownerDocument.documentElement)},Qb:function(e){return!!m.a.Sb(e,m.a.nb)},A:function(e){return e&&e.tagName&&e.tagName.toLowerCase()},Wb:function(e){return m.onError?function(){try{return e.apply(this,arguments)}catch(t){throw m.onError&&m.onError(t),t}}:e},setTimeout:function(e,t){return setTimeout(m.a.Wb(e),t)},$b:function(e){setTimeout(function(){throw m.onError&&m.onError(e),e},0)},p:function(e,t,n){var r=m.a.Wb(n);if(n=v&&h[t],m.options.useOnlyNativeEvents||n||!i)if(n||"function"!=typeof e.addEventListener){if("undefined"==typeof e.attachEvent)throw Error("Browser doesn't support addEventListener or attachEvent");var s=function(t){r.call(e,t)},a="on"+t;e.attachEvent(a,s),m.a.F.oa(e,function(){e.detachEvent(a,s)})}else e.addEventListener(t,r,!1);else i(e).bind(t,r)},Da:function(e,r){if(!e||!e.nodeType)throw Error("element must be a DOM node when calling triggerEvent");var s;if("input"===m.a.A(e)&&e.type&&"click"==r.toLowerCase()?(s=e.type,s="checkbox"==s||"radio"==s):s=!1,m.options.useOnlyNativeEvents||!i||s)if("function"==typeof n.createEvent){if("function"!=typeof e.dispatchEvent)throw Error("The supplied element doesn't support dispatchEvent");s=n.createEvent(p[r]||"HTMLEvents"),s.initEvent(r,!0,!0,t,0,0,0,0,0,!1,!1,!1,!1,0,e),e.dispatchEvent(s)}else if(s&&e.click)e.click();else{if("undefined"==typeof e.fireEvent)throw Error("Browser doesn't support triggering events");e.fireEvent("on"+r)}else i(e).trigger(r)},c:function(e){return m.H(e)?e():e},zb:function(e){return m.H(e)?e.t():e},bb:function(e,t,n){var r;t&&("object"==typeof e.classList?(r=e.classList[n?"add":"remove"],m.a.q(t.match(g),function(t){r.call(e.classList,t)})):"string"==typeof e.className.baseVal?u(e.className,"baseVal",t,n):u(e,"className",t,n))},Za:function(t,n){var r=m.a.c(n);(null===r||r===e)&&(r="");var i=m.f.firstChild(t);!i||3!=i.nodeType||m.f.nextSibling(i)?m.f.da(t,[t.ownerDocument.createTextNode(r)]):i.data=r,m.a.Rc(t)},rc:function(e,t){if(e.name=t,7>=v)try{e.mergeAttributes(n.createElement("<input name='"+e.name+"'/>"),!1)}catch(r){}},Rc:function(e){v>=9&&(e=1==e.nodeType?e:e.parentNode,e.style&&(e.style.zoom=e.style.zoom))},Nc:function(e){if(v){var t=e.style.width;e.style.width=0,e.style.width=t}},hd:function(e,t){e=m.a.c(e),t=m.a.c(t);for(var n=[],r=e;t>=r;r++)n.push(r);return n},V:function(e){for(var t=[],n=0,r=e.length;r>n;n++)t.push(e[n]);return t},Yb:function(e){return f?Symbol(e):e},rd:6===v,sd:7===v,C:v,ec:function(e,t){for(var n=m.a.V(e.getElementsByTagName("input")).concat(m.a.V(e.getElementsByTagName("textarea"))),r="string"==typeof t?function(e){return e.name===t}:function(e){return t.test(e.name)},i=[],s=n.length-1;s>=0;s--)r(n[s])&&i.push(n[s]);return i},ed:function(e){return"string"==typeof e&&(e=m.a.$a(e))?s&&s.parse?s.parse(e):new Function("return "+e)():null},Eb:function(e,t,n){if(!s||!s.stringify)throw Error("Cannot find JSON.stringify(). Some browsers (e.g., IE < 8) don't support it natively, but you can overcome this by adding a script reference to json2.js, downloadable from http://www.json.org/json2.js");return s.stringify(m.a.c(e),t,n)},fd:function(e,t,r){r=r||{};var i=r.params||{},s=r.includeFields||this.cc,o=e;if("object"==typeof e&&"form"===m.a.A(e))for(var o=e.action,c=s.length-1;c>=0;c--)for(var u=m.a.ec(e,s[c]),l=u.length-1;l>=0;l--)i[u[l].name]=u[l].value;t=m.a.c(t);var f=n.createElement("form");f.style.display="none",f.action=o,f.method="post";for(var d in t)e=n.createElement("input"),e.type="hidden",e.name=d,e.value=m.a.Eb(m.a.c(t[d])),f.appendChild(e);a(i,function(e,t){var r=n.createElement("input");r.type="hidden",r.name=e,r.value=t,f.appendChild(r)}),n.body.appendChild(f),r.submitter?r.submitter(f):f.submit(),setTimeout(function(){f.parentNode.removeChild(f)},0)}}}(),m.b("utils",m.a),m.b("utils.arrayForEach",m.a.q),m.b("utils.arrayFirst",m.a.Sb),m.b("utils.arrayFilter",m.a.Ka),m.b("utils.arrayGetDistinctValues",m.a.Tb),m.b("utils.arrayIndexOf",m.a.o),m.b("utils.arrayMap",m.a.fb),m.b("utils.arrayPushAll",m.a.ra),m.b("utils.arrayRemoveItem",m.a.La),m.b("utils.extend",m.a.extend),m.b("utils.fieldsIncludedWithJsonPost",m.a.cc),m.b("utils.getFormFields",m.a.ec),m.b("utils.peekObservable",m.a.zb),m.b("utils.postJson",m.a.fd),m.b("utils.parseJson",m.a.ed),m.b("utils.registerEventHandler",m.a.p),m.b("utils.stringifyJson",m.a.Eb),m.b("utils.range",m.a.hd),m.b("utils.toggleDomNodeCssClass",m.a.bb),m.b("utils.triggerEvent",m.a.Da),m.b("utils.unwrapObservable",m.a.c),m.b("utils.objectForEach",m.a.D),m.b("utils.addOrRemoveItem",m.a.pa),m.b("utils.setTextContent",m.a.Za),m.b("unwrap",m.a.c),Function.prototype.bind||(Function.prototype.bind=function(e){var t=this;if(1===arguments.length)return function(){return t.apply(e,arguments)};var n=Array.prototype.slice.call(arguments,1);return function(){var r=n.slice(0);return r.push.apply(r,arguments),t.apply(e,r)}}),m.a.e=new function(){function t(t,s){var a=t[r];if(!a||"null"===a||!i[a]){if(!s)return e;a=t[r]="ko"+n++,i[a]={}}return i[a]}var n=0,r="__ko__"+(new Date).getTime(),i={};return{get:function(n,r){var i=t(n,!1);return i===e?e:i[r]},set:function(n,r,i){(i!==e||t(n,!1)!==e)&&(t(n,!0)[r]=i)},clear:function(e){var t=e[r];return t?(delete i[t],e[r]=null,!0):!1},I:function(){return n++ +r}}},m.b("utils.domData",m.a.e),m.b("utils.domData.clear",m.a.e.clear),m.a.F=new function(){function t(t,n){var i=m.a.e.get(t,r);return i===e&&n&&(i=[],m.a.e.set(t,r,i)),i}function n(e){var r=t(e,!1);if(r)for(var r=r.slice(0),i=0;i<r.length;i++)r[i](e);if(m.a.e.clear(e),m.a.F.cleanExternalData(e),a[e.nodeType])for(r=e.firstChild;e=r;)r=e.nextSibling,8===e.nodeType&&n(e)}var r=m.a.e.I(),s={1:!0,8:!0,9:!0},a={1:!0,9:!0};return{oa:function(e,n){if("function"!=typeof n)throw Error("Callback must be a function");t(e,!0).push(n)},pc:function(n,i){var s=t(n,!1);s&&(m.a.La(s,i),0==s.length&&m.a.e.set(n,r,e))},$:function(e){if(s[e.nodeType]&&(n(e),a[e.nodeType])){var t=[];m.a.ra(t,e.getElementsByTagName("*"));for(var r=0,i=t.length;i>r;r++)n(t[r])}return e},removeNode:function(e){m.$(e),e.parentNode&&e.parentNode.removeChild(e)},cleanExternalData:function(e){i&&"function"==typeof i.cleanData&&i.cleanData([e])}}},m.$=m.a.F.$,m.removeNode=m.a.F.removeNode,m.b("cleanNode",m.$),m.b("removeNode",m.removeNode),m.b("utils.domNodeDisposal",m.a.F),m.b("utils.domNodeDisposal.addDisposeCallback",m.a.F.oa),m.b("utils.domNodeDisposal.removeDisposeCallback",m.a.F.pc),function(){var r=[0,"",""],s=[1,"<table>","</table>"],a=[3,"<table><tbody><tr>","</tr></tbody></table>"],o=[1,"<select multiple='multiple'>","</select>"],c={thead:s,tbody:s,tfoot:s,tr:[2,"<table><tbody>","</tbody></table>"],td:a,th:a,option:o,optgroup:o},u=8>=m.a.C;m.a.ma=function(e,s){var a;if(i){if(i.parseHTML)a=i.parseHTML(e,s)||[];else if((a=i.clean([e],s))&&a[0]){for(var o=a[0];o.parentNode&&11!==o.parentNode.nodeType;)o=o.parentNode;o.parentNode&&o.parentNode.removeChild(o)}}else{(a=s)||(a=n);var l,o=a.parentWindow||a.defaultView||t,f=m.a.$a(e).toLowerCase(),d=a.createElement("div");for(l=(f=f.match(/^<([a-z]+)[ >]/))&&c[f[1]]||r,f=l[0],l="ignored<div>"+l[1]+e+l[2]+"</div>","function"==typeof o.innerShiv?d.appendChild(o.innerShiv(l)):(u&&a.appendChild(d),d.innerHTML=l,u&&d.parentNode.removeChild(d));f--;)d=d.lastChild;a=m.a.V(d.lastChild.childNodes)}return a},m.a.Cb=function(t,n){if(m.a.ob(t),n=m.a.c(n),null!==n&&n!==e)if("string"!=typeof n&&(n=n.toString()),i)i(t).html(n);else for(var r=m.a.ma(n,t.ownerDocument),s=0;s<r.length;s++)t.appendChild(r[s])}}(),m.b("utils.parseHtmlFragment",m.a.ma),m.b("utils.setHtml",m.a.Cb),m.M=function(){function t(e,n){if(e)if(8==e.nodeType){var r=m.M.lc(e.nodeValue);null!=r&&n.push({Lc:e,cd:r})}else if(1==e.nodeType)for(var r=0,i=e.childNodes,s=i.length;s>r;r++)t(i[r],n)}var n={};return{wb:function(e){if("function"!=typeof e)throw Error("You can only pass a function to ko.memoization.memoize()");var t=(4294967296*(1+Math.random())|0).toString(16).substring(1)+(4294967296*(1+Math.random())|0).toString(16).substring(1);return n[t]=e,"<!--[ko_memo:"+t+"]-->"},xc:function(t,r){var i=n[t];if(i===e)throw Error("Couldn't find any memo with ID "+t+". Perhaps it's already been unmemoized.");try{return i.apply(null,r||[]),!0}finally{delete n[t]}},yc:function(e,n){var r=[];t(e,r);for(var i=0,s=r.length;s>i;i++){var a=r[i].Lc,o=[a];n&&m.a.ra(o,n),m.M.xc(r[i].cd,o),a.nodeValue="",a.parentNode&&a.parentNode.removeChild(a)}},lc:function(e){return(e=e.match(/^\[ko_memo\:(.*?)\]$/))?e[1]:null}}}(),m.b("memoization",m.M),m.b("memoization.memoize",m.M.wb),m.b("memoization.unmemoize",m.M.xc),m.b("memoization.parseMemoText",m.M.lc),m.b("memoization.unmemoizeDomNodeAndDescendants",m.M.yc),m.Y=function(){function e(){if(s)for(var e,t=s,n=0;s>o;)if(e=i[o++]){if(o>t){if(5e3<=++n){o=s,m.a.$b(Error("'Too much recursion' after processing "+n+" task groups."));break}t=s}try{e()}catch(r){m.a.$b(r)}}}function r(){e(),o=s=i.length=0}var i=[],s=0,a=1,o=0;return{scheduler:t.MutationObserver?function(e){var t=n.createElement("div");return new MutationObserver(e).observe(t,{attributes:!0}),function(){t.classList.toggle("foo")}}(r):n&&"onreadystatechange"in n.createElement("script")?function(e){var t=n.createElement("script");t.onreadystatechange=function(){t.onreadystatechange=null,n.documentElement.removeChild(t),t=null,e()},n.documentElement.appendChild(t)}:function(e){setTimeout(e,0)},Wa:function(e){return s||m.Y.scheduler(r),i[s++]=e,a++},cancel:function(e){e-=a-s,e>=o&&s>e&&(i[e]=null)},resetForTesting:function(){var e=s-o;return o=s=i.length=0,e},md:e}}(),m.b("tasks",m.Y),m.b("tasks.schedule",m.Y.Wa),m.b("tasks.runEarly",m.Y.md),m.ya={throttle:function(e,t){e.throttleEvaluation=t;var n=null;return m.B({read:e,write:function(r){clearTimeout(n),n=m.a.setTimeout(function(){e(r)},t)}})},rateLimit:function(e,t){var n,r,i;"number"==typeof t?n=t:(n=t.timeout,r=t.method),e.cb=!1,i="notifyWhenChangesStop"==r?l:u,e.Ta(function(e){return i(e,n)})},deferred:function(t,n){if(!0!==n)throw Error("The 'deferred' extender only accepts the value 'true', because it is not supported to turn deferral off once enabled.");t.cb||(t.cb=!0,t.Ta(function(n){var r;return function(){m.Y.cancel(r),r=m.Y.Wa(n),t.notifySubscribers(e,"dirty")}}))},notify:function(e,t){e.equalityComparer="always"==t?null:c}};var v={undefined:1,"boolean":1,number:1,string:1};m.b("extenders",m.ya),m.vc=function(e,t,n){this.ia=e,this.gb=t,this.Kc=n,this.R=!1,m.G(this,"dispose",this.k)},m.vc.prototype.k=function(){this.R=!0,this.Kc()},m.J=function(){m.a.Ya(this,y),y.rb(this)};var g="change",y={rb:function(e){e.K={},e.Nb=1},X:function(e,t,n){var r=this;n=n||g;var i=new m.vc(r,t?e.bind(t):e,function(){m.a.La(r.K[n],i),r.Ia&&r.Ia(n)});return r.sa&&r.sa(n),r.K[n]||(r.K[n]=[]),r.K[n].push(i),i},notifySubscribers:function(e,t){if(t=t||g,t===g&&this.zc(),this.Pa(t))try{m.l.Ub();for(var n,r=this.K[t].slice(0),i=0;n=r[i];++i)n.R||n.gb(e)}finally{m.l.end()}},Na:function(){return this.Nb},Uc:function(e){return this.Na()!==e},zc:function(){++this.Nb},Ta:function(e){var t,n,r,i=this,s=m.H(i);i.Ha||(i.Ha=i.notifySubscribers,i.notifySubscribers=f);
var a=e(function(){i.Mb=!1,s&&r===i&&(r=i()),t=!1,i.tb(n,r)&&i.Ha(n=r)});i.Lb=function(e){i.Mb=t=!0,r=e,a()},i.Kb=function(e){t||(n=e,i.Ha(e,"beforeChange"))}},Pa:function(e){return this.K[e]&&this.K[e].length},Sc:function(e){if(e)return this.K[e]&&this.K[e].length||0;var t=0;return m.a.D(this.K,function(e,n){"dirty"!==e&&(t+=n.length)}),t},tb:function(e,t){return!this.equalityComparer||!this.equalityComparer(e,t)},extend:function(e){var t=this;return e&&m.a.D(e,function(e,n){var r=m.ya[e];"function"==typeof r&&(t=r(t,n)||t)}),t}};m.G(y,"subscribe",y.X),m.G(y,"extend",y.extend),m.G(y,"getSubscriptionsCount",y.Sc),m.a.ka&&m.a.Xa(y,Function.prototype),m.J.fn=y,m.hc=function(e){return null!=e&&"function"==typeof e.X&&"function"==typeof e.notifySubscribers},m.b("subscribable",m.J),m.b("isSubscribable",m.hc),m.va=m.l=function(){function e(e){r.push(n),n=e}function t(){n=r.pop()}var n,r=[],i=0;return{Ub:e,end:t,oc:function(e){if(n){if(!m.hc(e))throw Error("Only subscribable things can act as dependencies");n.gb.call(n.Gc,e,e.Cc||(e.Cc=++i))}},w:function(n,r,i){try{return e(),n.apply(r,i||[])}finally{t()}},Aa:function(){return n?n.m.Aa():void 0},Sa:function(){return n?n.Sa:void 0}}}(),m.b("computedContext",m.va),m.b("computedContext.getDependenciesCount",m.va.Aa),m.b("computedContext.isInitial",m.va.Sa),m.b("ignoreDependencies",m.qd=m.l.w);var _=m.a.Yb("_latestValue");m.N=function(e){function t(){return 0<arguments.length?(t.tb(t[_],arguments[0])&&(t.ga(),t[_]=arguments[0],t.fa()),this):(m.l.oc(t),t[_])}return t[_]=e,m.a.ka||m.a.extend(t,m.J.fn),m.J.fn.rb(t),m.a.Ya(t,b),m.options.deferUpdates&&m.ya.deferred(t,!0),t};var b={equalityComparer:c,t:function(){return this[_]},fa:function(){this.notifySubscribers(this[_])},ga:function(){this.notifySubscribers(this[_],"beforeChange")}};m.a.ka&&m.a.Xa(b,m.J.fn);var x=m.N.gd="__ko_proto__";b[x]=m.N,m.Oa=function(t,n){return null===t||t===e||t[x]===e?!1:t[x]===n?!0:m.Oa(t[x],n)},m.H=function(e){return m.Oa(e,m.N)},m.Ba=function(e){return"function"==typeof e&&e[x]===m.N||"function"==typeof e&&e[x]===m.B&&e.Vc?!0:!1},m.b("observable",m.N),m.b("isObservable",m.H),m.b("isWriteableObservable",m.Ba),m.b("isWritableObservable",m.Ba),m.b("observable.fn",b),m.G(b,"peek",b.t),m.G(b,"valueHasMutated",b.fa),m.G(b,"valueWillMutate",b.ga),m.la=function(e){if(e=e||[],"object"!=typeof e||!("length"in e))throw Error("The argument passed when initializing an observable array must be an array, or null, or undefined.");return e=m.N(e),m.a.Ya(e,m.la.fn),e.extend({trackArrayChanges:!0})},m.la.fn={remove:function(e){for(var t=this.t(),n=[],r="function"!=typeof e||m.H(e)?function(t){return t===e}:e,i=0;i<t.length;i++){var s=t[i];r(s)&&(0===n.length&&this.ga(),n.push(s),t.splice(i,1),i--)}return n.length&&this.fa(),n},removeAll:function(t){if(t===e){var n=this.t(),r=n.slice(0);return this.ga(),n.splice(0,n.length),this.fa(),r}return t?this.remove(function(e){return 0<=m.a.o(t,e)}):[]},destroy:function(e){var t=this.t(),n="function"!=typeof e||m.H(e)?function(t){return t===e}:e;this.ga();for(var r=t.length-1;r>=0;r--)n(t[r])&&(t[r]._destroy=!0);this.fa()},destroyAll:function(t){return t===e?this.destroy(function(){return!0}):t?this.destroy(function(e){return 0<=m.a.o(t,e)}):[]},indexOf:function(e){var t=this();return m.a.o(t,e)},replace:function(e,t){var n=this.indexOf(e);n>=0&&(this.ga(),this.t()[n]=t,this.fa())}},m.a.ka&&m.a.Xa(m.la.fn,m.N.fn),m.a.q("pop push reverse shift sort splice unshift".split(" "),function(e){m.la.fn[e]=function(){var t=this.t();this.ga(),this.Vb(t,e,arguments);var n=t[e].apply(t,arguments);return this.fa(),n===t?this:n}}),m.a.q(["slice"],function(e){m.la.fn[e]=function(){var t=this();return t[e].apply(t,arguments)}}),m.b("observableArray",m.la),m.ya.trackArrayChanges=function(e,t){function n(){if(!i){i=!0;var t=e.notifySubscribers;e.notifySubscribers=function(e,n){return n&&n!==g||++a,t.apply(this,arguments)};var n=[].concat(e.t()||[]);s=null,r=e.X(function(t){if(t=[].concat(t||[]),e.Pa("arrayChange")){var r;(!s||a>1)&&(s=m.a.ib(n,t,e.hb)),r=s}n=t,s=null,a=0,r&&r.length&&e.notifySubscribers(r,"arrayChange")})}}if(e.hb={},t&&"object"==typeof t&&m.a.extend(e.hb,t),e.hb.sparse=!0,!e.Vb){var r,i=!1,s=null,a=0,o=e.sa,c=e.Ia;e.sa=function(t){o&&o.call(e,t),"arrayChange"===t&&n()},e.Ia=function(t){c&&c.call(e,t),"arrayChange"!==t||e.Pa("arrayChange")||(r.k(),i=!1)},e.Vb=function(e,t,n){function r(e,t,n){return o[o.length]={status:e,value:t,index:n}}if(i&&!a){var o=[],c=e.length,u=n.length,l=0;switch(t){case"push":l=c;case"unshift":for(t=0;u>t;t++)r("added",n[t],l+t);break;case"pop":l=c-1;case"shift":c&&r("deleted",e[l],l);break;case"splice":t=Math.min(Math.max(0,0>n[0]?c+n[0]:n[0]),c);for(var c=1===u?c:Math.min(t+(n[1]||0),c),u=t+u-2,l=Math.max(c,u),f=[],d=[],p=2;l>t;++t,++p)c>t&&d.push(r("deleted",e[t],t)),u>t&&f.push(r("added",n[p],t));m.a.dc(d,f);break;default:return}s=o}}}};var w=m.a.Yb("_state");m.m=m.B=function(t,n,r){function i(){if(0<arguments.length){if("function"!=typeof s)throw Error("Cannot write a value to a ko.computed unless you specify a 'write' option. If you wish to read the current value, don't pass any parameters.");return s.apply(a.pb,arguments),this}return m.l.oc(i),(a.S||a.s&&i.Qa())&&i.aa(),a.T}if("object"==typeof t?r=t:(r=r||{},t&&(r.read=t)),"function"!=typeof r.read)throw Error("Pass a function that returns the value of the ko.computed");var s=r.write,a={T:e,S:!0,Ra:!1,Fb:!1,R:!1,Va:!1,s:!1,jd:r.read,pb:n||r.owner,i:r.disposeWhenNodeIsRemoved||r.i||null,wa:r.disposeWhen||r.wa,mb:null,r:{},L:0,bc:null};return i[w]=a,i.Vc="function"==typeof s,m.a.ka||m.a.extend(i,m.J.fn),m.J.fn.rb(i),m.a.Ya(i,k),r.pure?(a.Va=!0,a.s=!0,m.a.extend(i,E)):r.deferEvaluation&&m.a.extend(i,C),m.options.deferUpdates&&m.ya.deferred(i,!0),a.i&&(a.Fb=!0,a.i.nodeType||(a.i=null)),a.s||r.deferEvaluation||i.aa(),a.i&&i.ba()&&m.a.F.oa(a.i,a.mb=function(){i.k()}),i};var k={equalityComparer:c,Aa:function(){return this[w].L},Pb:function(e,t,n){if(this[w].Va&&t===this)throw Error("A 'pure' computed must not be called recursively");this[w].r[e]=n,n.Ga=this[w].L++,n.na=t.Na()},Qa:function(){var e,t,n=this[w].r;for(e in n)if(n.hasOwnProperty(e)&&(t=n[e],t.ia.Uc(t.na)))return!0},bd:function(){this.Fa&&!this[w].Ra&&this.Fa()},ba:function(){return this[w].S||0<this[w].L},ld:function(){this.Mb||this.ac()},uc:function(e){if(e.cb&&!this[w].i){var t=e.X(this.bd,this,"dirty"),n=e.X(this.ld,this);return{ia:e,k:function(){t.k(),n.k()}}}return e.X(this.ac,this)},ac:function(){var e=this,t=e.throttleEvaluation;t&&t>=0?(clearTimeout(this[w].bc),this[w].bc=m.a.setTimeout(function(){e.aa(!0)},t)):e.Fa?e.Fa():e.aa(!0)},aa:function(e){var t=this[w],n=t.wa;if(!t.Ra&&!t.R){if(t.i&&!m.a.nb(t.i)||n&&n()){if(!t.Fb)return void this.k()}else t.Fb=!1;t.Ra=!0;try{this.Qc(e)}finally{t.Ra=!1}t.L||this.k()}},Qc:function(t){var n=this[w],r=n.Va?e:!n.L,i={Hc:this,Ma:n.r,lb:n.L};m.l.Ub({Gc:i,gb:p,m:this,Sa:r}),n.r={},n.L=0,i=this.Pc(n,i),this.tb(n.T,i)&&(n.s||this.notifySubscribers(n.T,"beforeChange"),n.T=i,n.s?this.zc():t&&this.notifySubscribers(n.T)),r&&this.notifySubscribers(n.T,"awake")},Pc:function(e,t){try{var n=e.jd;return e.pb?n.call(e.pb):n()}finally{m.l.end(),t.lb&&!e.s&&m.a.D(t.Ma,d),e.S=!1}},t:function(){var e=this[w];return(e.S&&!e.L||e.s&&this.Qa())&&this.aa(),e.T},Ta:function(e){m.J.fn.Ta.call(this,e),this.Fa=function(){this.Kb(this[w].T),this[w].S=!0,this.Lb(this)}},k:function(){var e=this[w];!e.s&&e.r&&m.a.D(e.r,function(e,t){t.k&&t.k()}),e.i&&e.mb&&m.a.F.pc(e.i,e.mb),e.r=null,e.L=0,e.R=!0,e.S=!1,e.s=!1,e.i=null}},E={sa:function(e){var t=this,n=t[w];if(!n.R&&n.s&&"change"==e){if(n.s=!1,n.S||t.Qa())n.r=null,n.L=0,n.S=!0,t.aa();else{var r=[];m.a.D(n.r,function(e,t){r[t.Ga]=e}),m.a.q(r,function(e,r){var i=n.r[e],s=t.uc(i.ia);s.Ga=r,s.na=i.na,n.r[e]=s})}n.R||t.notifySubscribers(n.T,"awake")}},Ia:function(t){var n=this[w];n.R||"change"!=t||this.Pa("change")||(m.a.D(n.r,function(e,t){t.k&&(n.r[e]={ia:t.ia,Ga:t.Ga,na:t.na},t.k())}),n.s=!0,this.notifySubscribers(e,"asleep"))},Na:function(){var e=this[w];return e.s&&(e.S||this.Qa())&&this.aa(),m.J.fn.Na.call(this)}},C={sa:function(e){"change"!=e&&"beforeChange"!=e||this.t()}};m.a.ka&&m.a.Xa(k,m.J.fn);var T=m.N.gd;m.m[T]=m.N,k[T]=m.m,m.Xc=function(e){return m.Oa(e,m.m)},m.Yc=function(e){return m.Oa(e,m.m)&&e[w]&&e[w].Va},m.b("computed",m.m),m.b("dependentObservable",m.m),m.b("isComputed",m.Xc),m.b("isPureComputed",m.Yc),m.b("computed.fn",k),m.G(k,"peek",k.t),m.G(k,"dispose",k.k),m.G(k,"isActive",k.ba),m.G(k,"getDependenciesCount",k.Aa),m.nc=function(e,t){return"function"==typeof e?m.m(e,t,{pure:!0}):(e=m.a.extend({},e),e.pure=!0,m.m(e,t))},m.b("pureComputed",m.nc),function(){function t(i,s,a){if(a=a||new r,i=s(i),"object"!=typeof i||null===i||i===e||i instanceof RegExp||i instanceof Date||i instanceof String||i instanceof Number||i instanceof Boolean)return i;var o=i instanceof Array?[]:{};return a.save(i,o),n(i,function(n){var r=s(i[n]);switch(typeof r){case"boolean":case"number":case"string":case"function":o[n]=r;break;case"object":case"undefined":var c=a.get(r);o[n]=c!==e?c:t(r,s,a)}}),o}function n(e,t){if(e instanceof Array){for(var n=0;n<e.length;n++)t(n);"function"==typeof e.toJSON&&t("toJSON")}else for(n in e)t(n)}function r(){this.keys=[],this.Ib=[]}m.wc=function(e){if(0==arguments.length)throw Error("When calling ko.toJS, pass the object you want to convert.");return t(e,function(e){for(var t=0;m.H(e)&&10>t;t++)e=e();return e})},m.toJSON=function(e,t,n){return e=m.wc(e),m.a.Eb(e,t,n)},r.prototype={save:function(e,t){var n=m.a.o(this.keys,e);n>=0?this.Ib[n]=t:(this.keys.push(e),this.Ib.push(t))},get:function(t){return t=m.a.o(this.keys,t),t>=0?this.Ib[t]:e}}}(),m.b("toJS",m.wc),m.b("toJSON",m.toJSON),function(){m.j={u:function(t){switch(m.a.A(t)){case"option":return!0===t.__ko__hasDomDataOptionValue__?m.a.e.get(t,m.d.options.xb):7>=m.a.C?t.getAttributeNode("value")&&t.getAttributeNode("value").specified?t.value:t.text:t.value;case"select":return 0<=t.selectedIndex?m.j.u(t.options[t.selectedIndex]):e;default:return t.value}},ha:function(t,n,r){switch(m.a.A(t)){case"option":switch(typeof n){case"string":m.a.e.set(t,m.d.options.xb,e),"__ko__hasDomDataOptionValue__"in t&&delete t.__ko__hasDomDataOptionValue__,t.value=n;break;default:m.a.e.set(t,m.d.options.xb,n),t.__ko__hasDomDataOptionValue__=!0,t.value="number"==typeof n?n:""}break;case"select":(""===n||null===n)&&(n=e);for(var i,s=-1,a=0,o=t.options.length;o>a;++a)if(i=m.j.u(t.options[a]),i==n||""==i&&n===e){s=a;break}(r||s>=0||n===e&&1<t.size)&&(t.selectedIndex=s);break;default:(null===n||n===e)&&(n=""),t.value=n}}}}(),m.b("selectExtensions",m.j),m.b("selectExtensions.readValue",m.j.u),m.b("selectExtensions.writeValue",m.j.ha),m.h=function(){function e(e){e=m.a.$a(e),123===e.charCodeAt(0)&&(e=e.slice(1,-1));var t,n=[],a=e.match(r),o=[],c=0;if(a){a.push(",");for(var u,l=0;u=a[l];++l){var f=u.charCodeAt(0);if(44===f){if(0>=c){n.push(t&&o.length?{key:t,value:o.join("")}:{unknown:t||o.join("")}),t=c=0,o=[];continue}}else if(58===f){if(!c&&!t&&1===o.length){t=o.pop();continue}}else 47===f&&l&&1<u.length?(f=a[l-1].match(i))&&!s[f[0]]&&(e=e.substr(e.indexOf(u)+1),a=e.match(r),a.push(","),l=-1,u="/"):40===f||123===f||91===f?++c:41===f||125===f||93===f?--c:t||o.length||34!==f&&39!==f||(u=u.slice(1,-1));o.push(u)}}return n}var t=["true","false","null","undefined"],n=/^(?:[$_a-z][$\w]*|(.+)(\.\s*[$_a-z][$\w]*|\[.+\]))$/i,r=RegExp("\"(?:[^\"\\\\]|\\\\.)*\"|'(?:[^'\\\\]|\\\\.)*'|/(?:[^/\\\\]|\\\\.)*/w*|[^\\s:,/][^,\"'{}()/:[\\]]*[^\\s,\"'{}()/:[\\]]|[^\\s]","g"),i=/[\])"'A-Za-z0-9_$]+$/,s={"in":1,"return":1,"typeof":1},a={};return{ta:[],ea:a,yb:e,Ua:function(r,i){function s(e,r){var i;if(!l){var f=m.getBindingHandler(e);if(f&&f.preprocess&&!(r=f.preprocess(r,e,s)))return;(f=a[e])&&(i=r,0<=m.a.o(t,i)?i=!1:(f=i.match(n),i=null===f?!1:f[1]?"Object("+f[1]+")"+f[2]:i),f=i),f&&c.push("'"+e+"':function(_z){"+i+"=_z}")}u&&(r="function(){return "+r+" }"),o.push("'"+e+"':"+r)}i=i||{};var o=[],c=[],u=i.valueAccessors,l=i.bindingParams,f="string"==typeof r?e(r):r;return m.a.q(f,function(e){s(e.key||e.unknown,e.value)}),c.length&&s("_ko_property_writers","{"+c.join(",")+" }"),o.join(",")},ad:function(e,t){for(var n=0;n<e.length;n++)if(e[n].key==t)return!0;return!1},Ea:function(e,t,n,r,i){e&&m.H(e)?!m.Ba(e)||i&&e.t()===r||e(r):(e=t.get("_ko_property_writers"))&&e[n]&&e[n](r)}}}(),m.b("expressionRewriting",m.h),m.b("expressionRewriting.bindingRewriteValidators",m.h.ta),m.b("expressionRewriting.parseObjectLiteral",m.h.yb),m.b("expressionRewriting.preProcessBindings",m.h.Ua),m.b("expressionRewriting._twoWayBindings",m.h.ea),m.b("jsonExpressionRewriting",m.h),m.b("jsonExpressionRewriting.insertPropertyAccessorsIntoJson",m.h.Ua),function(){function e(e){return 8==e.nodeType&&a.test(s?e.text:e.nodeValue)}function t(e){return 8==e.nodeType&&o.test(s?e.text:e.nodeValue)}function r(n,r){for(var i=n,s=1,a=[];i=i.nextSibling;){if(t(i)&&(s--,0===s))return a;a.push(i),e(i)&&s++}if(!r)throw Error("Cannot find closing comment tag to match: "+n.nodeValue);return null}function i(e,t){var n=r(e,t);return n?0<n.length?n[n.length-1].nextSibling:e.nextSibling:null}var s=n&&"<!--test-->"===n.createComment("test").text,a=s?/^\x3c!--\s*ko(?:\s+([\s\S]+))?\s*--\x3e$/:/^\s*ko(?:\s+([\s\S]+))?\s*$/,o=s?/^\x3c!--\s*\/ko\s*--\x3e$/:/^\s*\/ko\s*$/,c={ul:!0,ol:!0};m.f={Z:{},childNodes:function(t){return e(t)?r(t):t.childNodes},xa:function(t){if(e(t)){t=m.f.childNodes(t);for(var n=0,r=t.length;r>n;n++)m.removeNode(t[n])}else m.a.ob(t)},da:function(t,n){if(e(t)){m.f.xa(t);for(var r=t.nextSibling,i=0,s=n.length;s>i;i++)r.parentNode.insertBefore(n[i],r)}else m.a.da(t,n)},mc:function(t,n){e(t)?t.parentNode.insertBefore(n,t.nextSibling):t.firstChild?t.insertBefore(n,t.firstChild):t.appendChild(n)},gc:function(t,n,r){r?e(t)?t.parentNode.insertBefore(n,r.nextSibling):r.nextSibling?t.insertBefore(n,r.nextSibling):t.appendChild(n):m.f.mc(t,n)},firstChild:function(n){return e(n)?!n.nextSibling||t(n.nextSibling)?null:n.nextSibling:n.firstChild},nextSibling:function(n){return e(n)&&(n=i(n)),n.nextSibling&&t(n.nextSibling)?null:n.nextSibling},Tc:e,pd:function(e){return(e=(s?e.text:e.nodeValue).match(a))?e[1]:null},kc:function(n){if(c[m.a.A(n)]){var r=n.firstChild;if(r)do if(1===r.nodeType){var s;s=r.firstChild;var a=null;if(s)do if(a)a.push(s);else if(e(s)){var o=i(s,!0);o?s=o:a=[s]}else t(s)&&(a=[s]);while(s=s.nextSibling);if(s=a)for(a=r.nextSibling,o=0;o<s.length;o++)a?n.insertBefore(s[o],a):n.appendChild(s[o])}while(r=r.nextSibling)}}}}(),m.b("virtualElements",m.f),m.b("virtualElements.allowedBindings",m.f.Z),m.b("virtualElements.emptyNode",m.f.xa),m.b("virtualElements.insertAfter",m.f.gc),m.b("virtualElements.prepend",m.f.mc),m.b("virtualElements.setDomNodeChildren",m.f.da),function(){m.Q=function(){this.Fc={}},m.a.extend(m.Q.prototype,{nodeHasBindings:function(e){switch(e.nodeType){case 1:return null!=e.getAttribute("data-bind")||m.g.getComponentNameForNode(e);case 8:return m.f.Tc(e);default:return!1}},getBindings:function(e,t){var n=this.getBindingsString(e,t),n=n?this.parseBindingsString(n,t,e):null;return m.g.Ob(n,e,t,!1)},getBindingAccessors:function(e,t){var n=this.getBindingsString(e,t),n=n?this.parseBindingsString(n,t,e,{valueAccessors:!0}):null;return m.g.Ob(n,e,t,!0)},getBindingsString:function(e){switch(e.nodeType){case 1:return e.getAttribute("data-bind");case 8:return m.f.pd(e);default:return null}},parseBindingsString:function(e,t,n,r){try{var i,s=this.Fc,a=e+(r&&r.valueAccessors||"");if(!(i=s[a])){var o,c="with($context){with($data||{}){return{"+m.h.Ua(e,r)+"}}}";o=new Function("$context","$element",c),i=s[a]=o}return i(t,n)}catch(u){throw u.message="Unable to parse bindings.\nBindings value: "+e+"\nMessage: "+u.message,u}}}),m.Q.instance=new m.Q}(),m.b("bindingProvider",m.Q),function(){function n(e){return function(){return e}}function r(e){return e()}function s(e){return m.a.Ca(m.l.w(e),function(t,n){return function(){return e()[n]}})}function a(e,t,r){return"function"==typeof e?s(e.bind(null,t,r)):m.a.Ca(e,n)}function o(e,t){return s(this.getBindings.bind(this,e,t))}function c(e,t,n){var r,i=m.f.firstChild(t),s=m.Q.instance,a=s.preprocessNode;if(a){for(;r=i;)i=m.f.nextSibling(r),a.call(s,r);i=m.f.firstChild(t)}for(;r=i;)i=m.f.nextSibling(r),u(e,r,n)}function u(e,t,n){var r=!0,i=1===t.nodeType;i&&m.f.kc(t),(i&&n||m.Q.instance.nodeHasBindings(t))&&(r=f(t,null,e,n).shouldBindDescendants),r&&!p[m.a.A(t)]&&c(e,t,!i)}function l(e){var t=[],n={},r=[];return m.a.D(e,function i(s){if(!n[s]){var a=m.getBindingHandler(s);a&&(a.after&&(r.push(s),m.a.q(a.after,function(t){if(e[t]){if(-1!==m.a.o(r,t))throw Error("Cannot combine the following bindings, because they have a cyclic dependency: "+r.join(", "));i(t)}}),r.length--),t.push({key:s,fc:a})),n[s]=!0}}),t}function f(t,n,i,s){var a=m.a.e.get(t,h);if(!n){if(a)throw Error("You cannot apply bindings multiple times to the same element.");m.a.e.set(t,h,!0)}!a&&s&&m.tc(t,i);var c;if(n&&"function"!=typeof n)c=n;else{var u=m.Q.instance,f=u.getBindingAccessors||o,d=m.B(function(){return(c=n?n(i,t):f.call(u,t,i))&&i.P&&i.P(),c},null,{i:t});c&&d.ba()||(d=null)}var p;if(c){var v=d?function(e){return function(){return r(d()[e])}}:function(e){return c[e]},g=function(){return m.a.Ca(d?d():c,r)};g.get=function(e){return c[e]&&r(v(e))},g.has=function(e){return e in c},s=l(c),m.a.q(s,function(n){var r=n.fc.init,s=n.fc.update,a=n.key;if(8===t.nodeType&&!m.f.Z[a])throw Error("The binding '"+a+"' cannot be used with virtual elements");try{"function"==typeof r&&m.l.w(function(){var n=r(t,v(a),g,i.$data,i);if(n&&n.controlsDescendantBindings){if(p!==e)throw Error("Multiple bindings ("+p+" and "+a+") are trying to control descendant bindings of the same element. You cannot use these bindings together on the same element.");p=a}}),"function"==typeof s&&m.B(function(){s(t,v(a),g,i.$data,i)},null,{i:t})}catch(o){throw o.message='Unable to process binding "'+a+": "+c[a]+'"\nMessage: '+o.message,o}})}return{shouldBindDescendants:p===e}}function d(e){return e&&e instanceof m.U?e:new m.U(e)}m.d={};var p={script:!0,textarea:!0,template:!0};m.getBindingHandler=function(e){return m.d[e]},m.U=function(t,n,r,i){var s,a=this,o="function"==typeof t&&!m.H(t),c=m.B(function(){var e=o?t():t,s=m.a.c(e);return n?(n.P&&n.P(),m.a.extend(a,n),c&&(a.P=c)):(a.$parents=[],a.$root=s,a.ko=m),a.$rawData=e,a.$data=s,r&&(a[r]=s),i&&i(a,n,s),a.$data},null,{wa:function(){return s&&!m.a.Qb(s)},i:!0});c.ba()&&(a.P=c,c.equalityComparer=null,s=[],c.Ac=function(t){s.push(t),m.a.F.oa(t,function(t){m.a.La(s,t),s.length||(c.k(),a.P=c=e)})})},m.U.prototype.createChildContext=function(e,t,n){return new m.U(e,this,t,function(e,t){e.$parentContext=t,e.$parent=t.$data,e.$parents=(t.$parents||[]).slice(0),e.$parents.unshift(e.$parent),n&&n(e)})},m.U.prototype.extend=function(e){return new m.U(this.P||this.$data,this,null,function(t,n){t.$rawData=n.$rawData,m.a.extend(t,"function"==typeof e?e():e)})};var h=m.a.e.I(),v=m.a.e.I();m.tc=function(e,t){return 2!=arguments.length?m.a.e.get(e,v):(m.a.e.set(e,v,t),void(t.P&&t.P.Ac(e)))},m.Ja=function(e,t,n){return 1===e.nodeType&&m.f.kc(e),f(e,t,d(n),!0)},m.Dc=function(e,t,n){return n=d(n),m.Ja(e,a(t,n,e),n)},m.eb=function(e,t){1!==t.nodeType&&8!==t.nodeType||c(d(e),t,!0)},m.Rb=function(e,n){if(!i&&t.jQuery&&(i=t.jQuery),n&&1!==n.nodeType&&8!==n.nodeType)throw Error("ko.applyBindings: first parameter should be your view model; second parameter should be a DOM node");n=n||t.document.body,u(d(e),n,!0)},m.kb=function(t){switch(t.nodeType){case 1:case 8:var n=m.tc(t);if(n)return n;if(t.parentNode)return m.kb(t.parentNode)}return e},m.Jc=function(t){return(t=m.kb(t))?t.$data:e},m.b("bindingHandlers",m.d),m.b("applyBindings",m.Rb),m.b("applyBindingsToDescendants",m.eb),m.b("applyBindingAccessorsToNode",m.Ja),m.b("applyBindingsToNode",m.Dc),m.b("contextFor",m.kb),m.b("dataFor",m.Jc)}(),function(e){function t(t,r){var a,o=i.hasOwnProperty(t)?i[t]:e;o?o.X(r):(o=i[t]=new m.J,o.X(r),n(t,function(e,n){var r=!(!n||!n.synchronous);s[t]={definition:e,Zc:r},delete i[t],a||r?o.notifySubscribers(e):m.Y.Wa(function(){o.notifySubscribers(e)})}),a=!0)}function n(e,t){r("getConfig",[e],function(n){n?r("loadComponent",[e,n],function(e){t(e,n)}):t(null,null)})}function r(t,n,i,s){s||(s=m.g.loaders.slice(0));var a=s.shift();if(a){var o=a[t];if(o){var c=!1;if(o.apply(a,n.concat(function(e){c?i(null):null!==e?i(e):r(t,n,i,s)}))!==e&&(c=!0,!a.suppressLoaderExceptions))throw Error("Component loaders must supply values by invoking the callback, not by returning values synchronously.")}else r(t,n,i,s)}else i(null)}var i={},s={};m.g={get:function(n,r){var i=s.hasOwnProperty(n)?s[n]:e;i?i.Zc?m.l.w(function(){r(i.definition)}):m.Y.Wa(function(){r(i.definition)}):t(n,r)},Xb:function(e){delete s[e]},Jb:r},m.g.loaders=[],m.b("components",m.g),m.b("components.get",m.g.get),m.b("components.clearCachedDefinition",m.g.Xb)}(),function(){function e(e,t,n,r){function i(){0===--o&&r(s)}var s={},o=2,c=n.template;n=n.viewModel,c?a(t,c,function(t){m.g.Jb("loadTemplate",[e,t],function(e){s.template=e,i()})}):i(),n?a(t,n,function(t){m.g.Jb("loadViewModel",[e,t],function(e){s[l]=e,i()})}):i()}function r(e,t,n){if("function"==typeof t)n(function(e){return new t(e)});else if("function"==typeof t[l])n(t[l]);else if("instance"in t){var i=t.instance;n(function(){return i})}else"viewModel"in t?r(e,t.viewModel,n):e("Unknown viewModel value: "+t)}function i(e){switch(m.a.A(e)){case"script":return m.a.ma(e.text);case"textarea":return m.a.ma(e.value);case"template":if(s(e.content))return m.a.ua(e.content.childNodes)}return m.a.ua(e.childNodes)}function s(e){return t.DocumentFragment?e instanceof DocumentFragment:e&&11===e.nodeType}function a(e,n,r){"string"==typeof n.require?o||t.require?(o||t.require)([n.require],r):e("Uses require, but no AMD loader is present"):r(n)}function c(e){return function(t){throw Error("Component '"+e+"': "+t)}}var u={};m.g.register=function(e,t){if(!t)throw Error("Invalid configuration for "+e);if(m.g.ub(e))throw Error("Component "+e+" is already registered");u[e]=t},m.g.ub=function(e){return u.hasOwnProperty(e)},m.g.od=function(e){delete u[e],m.g.Xb(e)},m.g.Zb={getConfig:function(e,t){t(u.hasOwnProperty(e)?u[e]:null)},loadComponent:function(t,n,r){var i=c(t);a(i,n,function(n){e(t,i,n,r)})},loadTemplate:function(e,r,a){if(e=c(e),"string"==typeof r)a(m.a.ma(r));else if(r instanceof Array)a(r);else if(s(r))a(m.a.V(r.childNodes));else if(r.element)if(r=r.element,t.HTMLElement?r instanceof HTMLElement:r&&r.tagName&&1===r.nodeType)a(i(r));else if("string"==typeof r){var o=n.getElementById(r);o?a(i(o)):e("Cannot find element with ID "+r)}else e("Unknown element type: "+r);else e("Unknown template value: "+r)},loadViewModel:function(e,t,n){r(c(e),t,n)}};var l="createViewModel";m.b("components.register",m.g.register),m.b("components.isRegistered",m.g.ub),m.b("components.unregister",m.g.od),m.b("components.defaultLoader",m.g.Zb),m.g.loaders.push(m.g.Zb),m.g.Bc=u}(),function(){function e(e,n){var r=e.getAttribute("params");if(r){var r=t.parseBindingsString(r,n,e,{valueAccessors:!0,bindingParams:!0}),r=m.a.Ca(r,function(t){return m.m(t,null,{i:e})}),i=m.a.Ca(r,function(t){var n=t.t();return t.ba()?m.m({read:function(){return m.a.c(t())},write:m.Ba(n)&&function(e){t()(e)},i:e}):n});return i.hasOwnProperty("$raw")||(i.$raw=r),i}return{$raw:{}}}m.g.getComponentNameForNode=function(e){var t=m.a.A(e);return m.g.ub(t)&&(-1!=t.indexOf("-")||"[object HTMLUnknownElement]"==""+e||8>=m.a.C&&e.tagName===t)?t:void 0},m.g.Ob=function(t,n,r,i){if(1===n.nodeType){var s=m.g.getComponentNameForNode(n);if(s){if(t=t||{},t.component)throw Error('Cannot use the "component" binding on a custom element matching a component');var a={name:s,params:e(n,r)};t.component=i?function(){return a}:a}}return t};var t=new m.Q;9>m.a.C&&(m.g.register=function(e){return function(t){return n.createElement(t),e.apply(this,arguments)}}(m.g.register),n.createDocumentFragment=function(e){return function(){var t,n=e(),r=m.g.Bc;for(t in r)r.hasOwnProperty(t)&&n.createElement(t);return n}}(n.createDocumentFragment))}(),function(e){function t(e,t,n){if(t=t.template,!t)throw Error("Component '"+e+"' has no template");e=m.a.ua(t),m.f.da(n,e)}function n(e,t,n,r){var i=e.createViewModel;return i?i.call(e,r,{element:t,templateNodes:n}):r}var r=0;m.d.component={init:function(i,s,a,o,c){function u(){var e=l&&l.dispose;"function"==typeof e&&e.call(l),f=l=null}var l,f,d=m.a.V(m.f.childNodes(i));return m.a.F.oa(i,u),m.m(function(){var a,o,p=m.a.c(s());if("string"==typeof p?a=p:(a=m.a.c(p.name),o=m.a.c(p.params)),!a)throw Error("No component name specified");var h=f=++r;m.g.get(a,function(r){if(f===h){if(u(),!r)throw Error("Unknown component '"+a+"'");t(a,r,i);var s=n(r,i,d,o);r=c.createChildContext(s,e,function(e){e.$component=s,e.$componentTemplateNodes=d}),l=s,m.eb(r,i)}})},null,{i:i}),{controlsDescendantBindings:!0}}},m.f.Z.component=!0}();var S={"class":"className","for":"htmlFor"};m.d.attr={update:function(t,n){var r=m.a.c(n())||{};m.a.D(r,function(n,r){r=m.a.c(r);var i=!1===r||null===r||r===e;i&&t.removeAttribute(n),8>=m.a.C&&n in S?(n=S[n],i?t.removeAttribute(n):t[n]=r):i||t.setAttribute(n,r.toString()),"name"===n&&m.a.rc(t,i?"":r.toString())})}},function(){m.d.checked={after:["value","attr"],init:function(t,n,r){function i(){var e=t.checked,i=p?a():e;if(!m.va.Sa()&&(!c||e)){var s=m.l.w(n);if(l){var o=f?s.t():s;d!==i?(e&&(m.a.pa(o,i,!0),m.a.pa(o,d,!1)),d=i):m.a.pa(o,i,e),f&&m.Ba(s)&&s(o)}else m.h.Ea(s,r,"checked",i,!0)}}function s(){var e=m.a.c(n());t.checked=l?0<=m.a.o(e,a()):o?e:a()===e}var a=m.nc(function(){return r.has("checkedValue")?m.a.c(r.get("checkedValue")):r.has("value")?m.a.c(r.get("value")):t.value}),o="checkbox"==t.type,c="radio"==t.type;if(o||c){var u=n(),l=o&&m.a.c(u)instanceof Array,f=!(l&&u.push&&u.splice),d=l?a():e,p=c||l;c&&!t.name&&m.d.uniqueName.init(t,function(){return!0}),m.m(i,null,{i:t}),m.a.p(t,"click",i),m.m(s,null,{i:t}),u=e}}},m.h.ea.checked=!0,m.d.checkedValue={update:function(e,t){e.value=m.a.c(t())}}}(),m.d.css={update:function(e,t){var n=m.a.c(t());null!==n&&"object"==typeof n?m.a.D(n,function(t,n){n=m.a.c(n),m.a.bb(e,t,n)}):(n=m.a.$a(String(n||"")),m.a.bb(e,e.__ko__cssValue,!1),e.__ko__cssValue=n,m.a.bb(e,n,!0))}},m.d.enable={update:function(e,t){var n=m.a.c(t());n&&e.disabled?e.removeAttribute("disabled"):n||e.disabled||(e.disabled=!0)}},m.d.disable={update:function(e,t){m.d.enable.update(e,function(){return!m.a.c(t())})}},m.d.event={init:function(e,t,n,r,i){var s=t()||{};m.a.D(s,function(s){"string"==typeof s&&m.a.p(e,s,function(e){var a,o=t()[s];if(o){try{var c=m.a.V(arguments);r=i.$data,c.unshift(r),a=o.apply(r,c)}finally{!0!==a&&(e.preventDefault?e.preventDefault():e.returnValue=!1)}!1===n.get(s+"Bubble")&&(e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation())}})})}},m.d.foreach={ic:function(e){return function(){var t=e(),n=m.a.zb(t);return n&&"number"!=typeof n.length?(m.a.c(t),{foreach:n.data,as:n.as,includeDestroyed:n.includeDestroyed,afterAdd:n.afterAdd,beforeRemove:n.beforeRemove,afterRender:n.afterRender,beforeMove:n.beforeMove,afterMove:n.afterMove,templateEngine:m.W.sb}):{foreach:t,templateEngine:m.W.sb}}},init:function(e,t){return m.d.template.init(e,m.d.foreach.ic(t))},update:function(e,t,n,r,i){return m.d.template.update(e,m.d.foreach.ic(t),n,r,i)}},m.h.ta.foreach=!1,m.f.Z.foreach=!0,m.d.hasfocus={init:function(e,t,n){function r(r){e.__ko_hasfocusUpdating=!0;var i=e.ownerDocument;if("activeElement"in i){var s;try{s=i.activeElement}catch(a){s=i.body}r=s===e}i=t(),m.h.Ea(i,n,"hasfocus",r,!0),e.__ko_hasfocusLastValue=r,e.__ko_hasfocusUpdating=!1}var i=r.bind(null,!0),s=r.bind(null,!1);m.a.p(e,"focus",i),m.a.p(e,"focusin",i),m.a.p(e,"blur",s),m.a.p(e,"focusout",s)},update:function(e,t){var n=!!m.a.c(t());e.__ko_hasfocusUpdating||e.__ko_hasfocusLastValue===n||(n?e.focus():e.blur(),!n&&e.__ko_hasfocusLastValue&&e.ownerDocument.body.focus(),m.l.w(m.a.Da,null,[e,n?"focusin":"focusout"]))}},m.h.ea.hasfocus=!0,m.d.hasFocus=m.d.hasfocus,m.h.ea.hasFocus=!0,m.d.html={init:function(){return{controlsDescendantBindings:!0}},update:function(e,t){m.a.Cb(e,t())}},h("if"),h("ifnot",!1,!0),h("with",!0,!1,function(e,t){return e.createChildContext(t)});var O={};m.d.options={init:function(e){if("select"!==m.a.A(e))throw Error("options binding applies only to SELECT elements");for(;0<e.length;)e.remove(0);return{controlsDescendantBindings:!0}},update:function(t,n,r){function i(){return m.a.Ka(t.options,function(e){return e.selected})}function s(e,t,n){var r=typeof t;return"function"==r?t(e):"string"==r?e[t]:n}function a(e,n){if(h&&l)m.j.ha(t,m.a.c(r.get("value")),!0);else if(p.length){var i=0<=m.a.o(p,m.j.u(n[0]));m.a.sc(n[0],i),h&&!i&&m.l.w(m.a.Da,null,[t,"change"])}}var o=t.multiple,c=0!=t.length&&o?t.scrollTop:null,u=m.a.c(n()),l=r.get("valueAllowUnset")&&r.has("value"),f=r.get("optionsIncludeDestroyed");n={};var d,p=[];l||(o?p=m.a.fb(i(),m.j.u):0<=t.selectedIndex&&p.push(m.j.u(t.options[t.selectedIndex]))),u&&("undefined"==typeof u.length&&(u=[u]),d=m.a.Ka(u,function(t){return f||t===e||null===t||!m.a.c(t._destroy)}),r.has("optionsCaption")&&(u=m.a.c(r.get("optionsCaption")),null!==u&&u!==e&&d.unshift(O)));var h=!1;n.beforeRemove=function(e){t.removeChild(e)},u=a,r.has("optionsAfterRender")&&"function"==typeof r.get("optionsAfterRender")&&(u=function(t,n){a(0,n),m.l.w(r.get("optionsAfterRender"),null,[n[0],t!==O?t:e])}),m.a.Bb(t,d,function(n,i,a){return a.length&&(p=!l&&a[0].selected?[m.j.u(a[0])]:[],h=!0),i=t.ownerDocument.createElement("option"),n===O?(m.a.Za(i,r.get("optionsCaption")),m.j.ha(i,e)):(a=s(n,r.get("optionsValue"),n),m.j.ha(i,m.a.c(a)),n=s(n,r.get("optionsText"),a),m.a.Za(i,n)),[i]},n,u),m.l.w(function(){l?m.j.ha(t,m.a.c(r.get("value")),!0):(o?p.length&&i().length<p.length:p.length&&0<=t.selectedIndex?m.j.u(t.options[t.selectedIndex])!==p[0]:p.length||0<=t.selectedIndex)&&m.a.Da(t,"change")}),m.a.Nc(t),c&&20<Math.abs(c-t.scrollTop)&&(t.scrollTop=c)}},m.d.options.xb=m.a.e.I(),m.d.selectedOptions={after:["options","foreach"],init:function(e,t,n){m.a.p(e,"change",function(){var r=t(),i=[];m.a.q(e.getElementsByTagName("option"),function(e){e.selected&&i.push(m.j.u(e))}),m.h.Ea(r,n,"selectedOptions",i)})},update:function(e,t){if("select"!=m.a.A(e))throw Error("values binding applies only to SELECT elements");var n=m.a.c(t()),r=e.scrollTop;n&&"number"==typeof n.length&&m.a.q(e.getElementsByTagName("option"),function(e){var t=0<=m.a.o(n,m.j.u(e));e.selected!=t&&m.a.sc(e,t)}),e.scrollTop=r}},m.h.ea.selectedOptions=!0,m.d.style={update:function(t,n){var r=m.a.c(n()||{});m.a.D(r,function(n,r){r=m.a.c(r),(null===r||r===e||!1===r)&&(r=""),t.style[n]=r})}},m.d.submit={init:function(e,t,n,r,i){if("function"!=typeof t())throw Error("The value for a submit binding must be a function");m.a.p(e,"submit",function(n){var r,s=t();try{r=s.call(i.$data,e)}finally{!0!==r&&(n.preventDefault?n.preventDefault():n.returnValue=!1)}})}},m.d.text={init:function(){return{controlsDescendantBindings:!0}},update:function(e,t){m.a.Za(e,t())}},m.f.Z.text=!0,function(){if(t&&t.navigator)var n=function(e){return e?parseFloat(e[1]):void 0},r=t.opera&&t.opera.version&&parseInt(t.opera.version()),i=t.navigator.userAgent,s=n(i.match(/^(?:(?!chrome).)*version\/([^ ]*) safari/i)),a=n(i.match(/Firefox\/([^ ]*)/));if(10>m.a.C)var o=m.a.e.I(),c=m.a.e.I(),u=function(e){var t=this.activeElement;(t=t&&m.a.e.get(t,c))&&t(e)},l=function(e,t){var n=e.ownerDocument;m.a.e.get(n,o)||(m.a.e.set(n,o,!0),m.a.p(n,"selectionchange",u)),m.a.e.set(e,c,t)};m.d.textInput={init:function(t,n,i){function o(e,n){m.a.p(t,e,n)}function c(){var r=m.a.c(n());(null===r||r===e)&&(r=""),p!==e&&r===p?m.a.setTimeout(c,4):t.value!==r&&(h=r,t.value=r)}function u(){d||(p=t.value,d=m.a.setTimeout(f,4))}function f(){clearTimeout(d),p=d=e;var r=t.value;h!==r&&(h=r,m.h.Ea(n(),i,"textInput",r))}var d,p,h=t.value,v=9==m.a.C?u:f;10>m.a.C?(o("propertychange",function(e){
"value"===e.propertyName&&v(e)}),8==m.a.C&&(o("keyup",f),o("keydown",f)),8<=m.a.C&&(l(t,v),o("dragend",u))):(o("input",f),5>s&&"textarea"===m.a.A(t)?(o("keydown",u),o("paste",u),o("cut",u)):11>r?o("keydown",u):4>a&&(o("DOMAutoComplete",f),o("dragdrop",f),o("drop",f))),o("change",f),m.m(c,null,{i:t})}},m.h.ea.textInput=!0,m.d.textinput={preprocess:function(e,t,n){n("textInput",e)}}}(),m.d.uniqueName={init:function(e,t){if(t()){var n="ko_unique_"+ ++m.d.uniqueName.Ic;m.a.rc(e,n)}}},m.d.uniqueName.Ic=0,m.d.value={after:["options","foreach"],init:function(e,t,n){if("input"!=e.tagName.toLowerCase()||"checkbox"!=e.type&&"radio"!=e.type){var r=["change"],i=n.get("valueUpdate"),s=!1,a=null;i&&("string"==typeof i&&(i=[i]),m.a.ra(r,i),r=m.a.Tb(r));var o=function(){a=null,s=!1;var r=t(),i=m.j.u(e);m.h.Ea(r,n,"value",i)};!m.a.C||"input"!=e.tagName.toLowerCase()||"text"!=e.type||"off"==e.autocomplete||e.form&&"off"==e.form.autocomplete||-1!=m.a.o(r,"propertychange")||(m.a.p(e,"propertychange",function(){s=!0}),m.a.p(e,"focus",function(){s=!1}),m.a.p(e,"blur",function(){s&&o()})),m.a.q(r,function(t){var n=o;m.a.nd(t,"after")&&(n=function(){a=m.j.u(e),m.a.setTimeout(o,0)},t=t.substring(5)),m.a.p(e,t,n)});var c=function(){var r=m.a.c(t()),i=m.j.u(e);if(null!==a&&r===a)m.a.setTimeout(c,0);else if(r!==i)if("select"===m.a.A(e)){var s=n.get("valueAllowUnset"),i=function(){m.j.ha(e,r,s)};i(),s||r===m.j.u(e)?m.a.setTimeout(i,0):m.l.w(m.a.Da,null,[e,"change"])}else m.j.ha(e,r)};m.m(c,null,{i:e})}else m.Ja(e,{checkedValue:t})},update:function(){}},m.h.ea.value=!0,m.d.visible={update:function(e,t){var n=m.a.c(t()),r="none"!=e.style.display;n&&!r?e.style.display="":!n&&r&&(e.style.display="none")}},function(e){m.d[e]={init:function(t,n,r,i,s){return m.d.event.init.call(this,t,function(){var t={};return t[e]=n(),t},r,i,s)}}}("click"),m.O=function(){},m.O.prototype.renderTemplateSource=function(){throw Error("Override renderTemplateSource")},m.O.prototype.createJavaScriptEvaluatorBlock=function(){throw Error("Override createJavaScriptEvaluatorBlock")},m.O.prototype.makeTemplateSource=function(e,t){if("string"==typeof e){t=t||n;var r=t.getElementById(e);if(!r)throw Error("Cannot find template with ID "+e);return new m.v.n(r)}if(1==e.nodeType||8==e.nodeType)return new m.v.qa(e);throw Error("Unknown template type: "+e)},m.O.prototype.renderTemplate=function(e,t,n,r){return e=this.makeTemplateSource(e,r),this.renderTemplateSource(e,t,n,r)},m.O.prototype.isTemplateRewritten=function(e,t){return!1===this.allowTemplateRewriting?!0:this.makeTemplateSource(e,t).data("isRewritten")},m.O.prototype.rewriteTemplate=function(e,t,n){e=this.makeTemplateSource(e,n),t=t(e.text()),e.text(t),e.data("isRewritten",!0)},m.b("templateEngine",m.O),m.Gb=function(){function e(e,t,n,r){e=m.h.yb(e);for(var i=m.h.ta,s=0;s<e.length;s++){var a=e[s].key;if(i.hasOwnProperty(a)){var o=i[a];if("function"==typeof o){if(a=o(e[s].value))throw Error(a)}else if(!o)throw Error("This template engine does not support the '"+a+"' binding within its templates")}}return n="ko.__tr_ambtns(function($context,$element){return(function(){return{ "+m.h.Ua(e,{valueAccessors:!0})+" } })()},'"+n.toLowerCase()+"')",r.createJavaScriptEvaluatorBlock(n)+t}var t=/(<([a-z]+\d*)(?:\s+(?!data-bind\s*=\s*)[a-z0-9\-]+(?:=(?:\"[^\"]*\"|\'[^\']*\'|[^>]*))?)*\s+)data-bind\s*=\s*(["'])([\s\S]*?)\3/gi,n=/\x3c!--\s*ko\b\s*([\s\S]*?)\s*--\x3e/g;return{Oc:function(e,t,n){t.isTemplateRewritten(e,n)||t.rewriteTemplate(e,function(e){return m.Gb.dd(e,t)},n)},dd:function(r,i){return r.replace(t,function(t,n,r,s,a){return e(a,n,r,i)}).replace(n,function(t,n){return e(n,"<!-- ko -->","#comment",i)})},Ec:function(e,t){return m.M.wb(function(n,r){var i=n.nextSibling;i&&i.nodeName.toLowerCase()===t&&m.Ja(i,e,r)})}}}(),m.b("__tr_ambtns",m.Gb.Ec),function(){m.v={},m.v.n=function(e){if(this.n=e){var t=m.a.A(e);this.ab="script"===t?1:"textarea"===t?2:"template"==t&&e.content&&11===e.content.nodeType?3:4}},m.v.n.prototype.text=function(){var e=1===this.ab?"text":2===this.ab?"value":"innerHTML";if(0==arguments.length)return this.n[e];var t=arguments[0];"innerHTML"===e?m.a.Cb(this.n,t):this.n[e]=t};var t=m.a.e.I()+"_";m.v.n.prototype.data=function(e){return 1===arguments.length?m.a.e.get(this.n,t+e):void m.a.e.set(this.n,t+e,arguments[1])};var n=m.a.e.I();m.v.n.prototype.nodes=function(){var t=this.n;return 0==arguments.length?(m.a.e.get(t,n)||{}).jb||(3===this.ab?t.content:4===this.ab?t:e):void m.a.e.set(t,n,{jb:arguments[0]})},m.v.qa=function(e){this.n=e},m.v.qa.prototype=new m.v.n,m.v.qa.prototype.text=function(){if(0==arguments.length){var t=m.a.e.get(this.n,n)||{};return t.Hb===e&&t.jb&&(t.Hb=t.jb.innerHTML),t.Hb}m.a.e.set(this.n,n,{Hb:arguments[0]})},m.b("templateSources",m.v),m.b("templateSources.domElement",m.v.n),m.b("templateSources.anonymousTemplate",m.v.qa)}(),function(){function t(e,t,n){var r;for(t=m.f.nextSibling(t);e&&(r=e)!==t;)e=m.f.nextSibling(r),n(r,e)}function n(e,n){if(e.length){var r=e[0],i=e[e.length-1],s=r.parentNode,a=m.Q.instance,o=a.preprocessNode;if(o){if(t(r,i,function(e,t){var n=e.previousSibling,s=o.call(a,e);s&&(e===r&&(r=s[0]||t),e===i&&(i=s[s.length-1]||n))}),e.length=0,!r)return;r===i?e.push(r):(e.push(r,i),m.a.za(e,s))}t(r,i,function(e){1!==e.nodeType&&8!==e.nodeType||m.Rb(n,e)}),t(r,i,function(e){1!==e.nodeType&&8!==e.nodeType||m.M.yc(e,[n])}),m.a.za(e,s)}}function r(e){return e.nodeType?e:0<e.length?e[0]:null}function i(e,t,i,s,o){o=o||{};var c=(e&&r(e)||i||{}).ownerDocument,u=o.templateEngine||a;if(m.Gb.Oc(i,u,c),i=u.renderTemplate(i,s,o,c),"number"!=typeof i.length||0<i.length&&"number"!=typeof i[0].nodeType)throw Error("Template engine must return an array of DOM nodes");switch(c=!1,t){case"replaceChildren":m.f.da(e,i),c=!0;break;case"replaceNode":m.a.qc(e,i),c=!0;break;case"ignoreTargetNode":break;default:throw Error("Unknown renderMode: "+t)}return c&&(n(i,s),o.afterRender&&m.l.w(o.afterRender,null,[i,s.$data])),i}function s(e,t,n){return m.H(e)?e():"function"==typeof e?e(t,n):e}var a;m.Db=function(t){if(t!=e&&!(t instanceof m.O))throw Error("templateEngine must inherit from ko.templateEngine");a=t},m.Ab=function(t,n,o,c,u){if(o=o||{},(o.templateEngine||a)==e)throw Error("Set a template engine before calling renderTemplate");if(u=u||"replaceChildren",c){var l=r(c);return m.B(function(){var e=n&&n instanceof m.U?n:new m.U(m.a.c(n)),a=s(t,e.$data,e),e=i(c,u,a,e,o);"replaceNode"==u&&(c=e,l=r(c))},null,{wa:function(){return!l||!m.a.nb(l)},i:l&&"replaceNode"==u?l.parentNode:l})}return m.M.wb(function(e){m.Ab(t,n,o,e,"replaceNode")})},m.kd=function(t,r,a,o,c){function u(e,t){n(t,f),a.afterRender&&a.afterRender(t,e),f=null}function l(e,n){f=c.createChildContext(e,a.as,function(e){e.$index=n});var r=s(t,e,f);return i(null,"ignoreTargetNode",r,f,a)}var f;return m.B(function(){var t=m.a.c(r)||[];"undefined"==typeof t.length&&(t=[t]),t=m.a.Ka(t,function(t){return a.includeDestroyed||t===e||null===t||!m.a.c(t._destroy)}),m.l.w(m.a.Bb,null,[o,t,l,a,u])},null,{i:o})};var o=m.a.e.I();m.d.template={init:function(e,t){var n=m.a.c(t());if("string"==typeof n||n.name)m.f.xa(e);else{if("nodes"in n){if(n=n.nodes||[],m.H(n))throw Error('The "nodes" option must be a plain, non-observable array.')}else n=m.f.childNodes(e);n=m.a.jc(n),new m.v.qa(e).nodes(n)}return{controlsDescendantBindings:!0}},update:function(t,n,r,i,s){var a,c=n();n=m.a.c(c),r=!0,i=null,"string"==typeof n?n={}:(c=n.name,"if"in n&&(r=m.a.c(n["if"])),r&&"ifnot"in n&&(r=!m.a.c(n.ifnot)),a=m.a.c(n.data)),"foreach"in n?i=m.kd(c||t,r&&n.foreach||[],n,t,s):r?(s="data"in n?s.createChildContext(a,n.as):s,i=m.Ab(c||t,s,n,t)):m.f.xa(t),s=i,(a=m.a.e.get(t,o))&&"function"==typeof a.k&&a.k(),m.a.e.set(t,o,s&&s.ba()?s:e)}},m.h.ta.template=function(e){return e=m.h.yb(e),1==e.length&&e[0].unknown||m.h.ad(e,"name")?null:"This template engine does not support anonymous templates nested within its templates"},m.f.Z.template=!0}(),m.b("setTemplateEngine",m.Db),m.b("renderTemplate",m.Ab),m.a.dc=function(e,t,n){if(e.length&&t.length){var r,i,s,a,o;for(r=i=0;(!n||n>r)&&(a=e[i]);++i){for(s=0;o=t[s];++s)if(a.value===o.value){a.moved=o.index,o.moved=a.index,t.splice(s,1),r=s=0;break}r+=s}}},m.a.ib=function(){function e(e,t,n,r,i){var s,a,o,c,u,l=Math.min,f=Math.max,d=[],p=e.length,h=t.length,v=h-p||1,g=p+h+1;for(s=0;p>=s;s++)for(c=o,d.push(o=[]),u=l(h,s+v),a=f(0,s-1);u>=a;a++)o[a]=a?s?e[s-1]===t[a-1]?c[a-1]:l(c[a]||g,o[a-1]||g)+1:a+1:s+1;for(l=[],f=[],v=[],s=p,a=h;s||a;)h=d[s][a]-1,a&&h===d[s][a-1]?f.push(l[l.length]={status:n,value:t[--a],index:a}):s&&h===d[s-1][a]?v.push(l[l.length]={status:r,value:e[--s],index:s}):(--a,--s,i.sparse||l.push({status:"retained",value:t[a]}));return m.a.dc(v,f,!i.dontLimitMoves&&10*p),l.reverse()}return function(t,n,r){return r="boolean"==typeof r?{dontLimitMoves:r}:r||{},t=t||[],n=n||[],t.length<n.length?e(t,n,"added","deleted",r):e(n,t,"deleted","added",r)}}(),m.b("utils.compareArrays",m.a.ib),function(){function t(t,n,r,i,s){var a=[],o=m.B(function(){var e=n(r,s,m.a.za(a,t))||[];0<a.length&&(m.a.qc(a,e),i&&m.l.w(i,null,[r,e,s])),a.length=0,m.a.ra(a,e)},null,{i:t,wa:function(){return!m.a.Qb(a)}});return{ca:a,B:o.ba()?o:e}}var n=m.a.e.I(),r=m.a.e.I();m.a.Bb=function(i,s,a,o,c){function u(e,t){x=d[t],y!==t&&(E[e]=x),x.qb(y++),m.a.za(x.ca,i),v.push(x),b.push(x)}function l(e,t){if(e)for(var n=0,r=t.length;r>n;n++)t[n]&&m.a.q(t[n].ca,function(r){e(r,n,t[n].ja)})}s=s||[],o=o||{};var f=m.a.e.get(i,n)===e,d=m.a.e.get(i,n)||[],p=m.a.fb(d,function(e){return e.ja}),h=m.a.ib(p,s,o.dontLimitMoves),v=[],g=0,y=0,_=[],b=[];s=[];for(var x,w,k,E=[],p=[],C=0;w=h[C];C++)switch(k=w.moved,w.status){case"deleted":k===e&&(x=d[g],x.B&&(x.B.k(),x.B=e),m.a.za(x.ca,i).length&&(o.beforeRemove&&(v.push(x),b.push(x),x.ja===r?x=null:s[C]=x),x&&_.push.apply(_,x.ca))),g++;break;case"retained":u(C,g++);break;case"added":k!==e?u(C,k):(x={ja:w.value,qb:m.N(y++)},v.push(x),b.push(x),f||(p[C]=x))}m.a.e.set(i,n,v),l(o.beforeMove,E),m.a.q(_,o.beforeRemove?m.$:m.removeNode);for(var T,C=0,f=m.f.firstChild(i);x=b[C];C++){for(x.ca||m.a.extend(x,t(i,a,x.ja,c,x.qb)),g=0;h=x.ca[g];f=h.nextSibling,T=h,g++)h!==f&&m.f.gc(i,h,T);!x.Wc&&c&&(c(x.ja,x.ca,x.qb),x.Wc=!0)}for(l(o.beforeRemove,s),C=0;C<s.length;++C)s[C]&&(s[C].ja=r);l(o.afterMove,E),l(o.afterAdd,p)}}(),m.b("utils.setDomNodeChildrenFromArrayMapping",m.a.Bb),m.W=function(){this.allowTemplateRewriting=!1},m.W.prototype=new m.O,m.W.prototype.renderTemplateSource=function(e,t,n,r){return(t=(9>m.a.C?0:e.nodes)?e.nodes():null)?m.a.V(t.cloneNode(!0).childNodes):(e=e.text(),m.a.ma(e,r))},m.W.sb=new m.W,m.Db(m.W.sb),m.b("nativeTemplateEngine",m.W),function(){m.vb=function(){var e=this.$c=function(){if(!i||!i.tmpl)return 0;try{if(0<=i.tmpl.tag.tmpl.open.toString().indexOf("__"))return 2}catch(e){}return 1}();this.renderTemplateSource=function(t,r,s,a){if(a=a||n,s=s||{},2>e)throw Error("Your version of jQuery.tmpl is too old. Please upgrade to jQuery.tmpl 1.0.0pre or later.");var o=t.data("precompiled");return o||(o=t.text()||"",o=i.template(null,"{{ko_with $item.koBindingContext}}"+o+"{{/ko_with}}"),t.data("precompiled",o)),t=[r.$data],r=i.extend({koBindingContext:r},s.templateOptions),r=i.tmpl(o,t,r),r.appendTo(a.createElement("div")),i.fragments={},r},this.createJavaScriptEvaluatorBlock=function(e){return"{{ko_code ((function() { return "+e+" })()) }}"},this.addTemplate=function(e,t){n.write("<script type='text/html' id='"+e+"'>"+t+"</script>")},e>0&&(i.tmpl.tag.ko_code={open:"__.push($1 || '');"},i.tmpl.tag.ko_with={open:"with($1) {",close:"} "})},m.vb.prototype=new m.O;var e=new m.vb;0<e.$c&&m.Db(e),m.b("jqueryTmplTemplateEngine",m.vb)}()})}()}();
//# sourceMappingURL=http://nlp.cs.uic.edu/didactyl/abcde/lib